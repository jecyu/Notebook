<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>浏览器 | Naluduo&#39;s Notebook</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/Notebook/images/logo.jpeg">
    <meta name="description" content="📝每天记录一点点">
    <link rel="preload" href="/Notebook/assets/css/0.styles.b1f38863.css" as="style"><link rel="preload" href="/Notebook/assets/js/app.accc6ad4.js" as="script"><link rel="preload" href="/Notebook/assets/js/4.2708dfb6.js" as="script"><link rel="preload" href="/Notebook/assets/js/25.d24012cb.js" as="script"><link rel="prefetch" href="/Notebook/assets/js/10.868273fb.js"><link rel="prefetch" href="/Notebook/assets/js/100.1b860150.js"><link rel="prefetch" href="/Notebook/assets/js/101.93399fce.js"><link rel="prefetch" href="/Notebook/assets/js/102.6cbb290c.js"><link rel="prefetch" href="/Notebook/assets/js/103.8ff3d751.js"><link rel="prefetch" href="/Notebook/assets/js/104.0a2f7daa.js"><link rel="prefetch" href="/Notebook/assets/js/105.155f54c6.js"><link rel="prefetch" href="/Notebook/assets/js/106.4d7d0c3a.js"><link rel="prefetch" href="/Notebook/assets/js/107.8373d2e5.js"><link rel="prefetch" href="/Notebook/assets/js/108.8c95a110.js"><link rel="prefetch" href="/Notebook/assets/js/109.85bb673d.js"><link rel="prefetch" href="/Notebook/assets/js/11.fb903a5e.js"><link rel="prefetch" href="/Notebook/assets/js/110.52ad03a9.js"><link rel="prefetch" href="/Notebook/assets/js/111.956208cd.js"><link rel="prefetch" href="/Notebook/assets/js/112.2009b21f.js"><link rel="prefetch" href="/Notebook/assets/js/113.82a49283.js"><link rel="prefetch" href="/Notebook/assets/js/114.3b3a5472.js"><link rel="prefetch" href="/Notebook/assets/js/115.7ee78dd6.js"><link rel="prefetch" href="/Notebook/assets/js/116.7c8bbb6c.js"><link rel="prefetch" href="/Notebook/assets/js/117.d0907fb0.js"><link rel="prefetch" href="/Notebook/assets/js/118.3fb43a39.js"><link rel="prefetch" href="/Notebook/assets/js/119.ec92ea48.js"><link rel="prefetch" href="/Notebook/assets/js/12.29652b2c.js"><link rel="prefetch" href="/Notebook/assets/js/120.35ff1e70.js"><link rel="prefetch" href="/Notebook/assets/js/121.d8b18139.js"><link rel="prefetch" href="/Notebook/assets/js/122.648ffe96.js"><link rel="prefetch" href="/Notebook/assets/js/123.ed3b8b2f.js"><link rel="prefetch" href="/Notebook/assets/js/124.142abf67.js"><link rel="prefetch" href="/Notebook/assets/js/125.329314b8.js"><link rel="prefetch" href="/Notebook/assets/js/126.3a121da0.js"><link rel="prefetch" href="/Notebook/assets/js/127.022c6641.js"><link rel="prefetch" href="/Notebook/assets/js/128.547c2d5c.js"><link rel="prefetch" href="/Notebook/assets/js/129.ecb5273b.js"><link rel="prefetch" href="/Notebook/assets/js/13.fa32345e.js"><link rel="prefetch" href="/Notebook/assets/js/130.2a0d3a19.js"><link rel="prefetch" href="/Notebook/assets/js/131.c7a84d57.js"><link rel="prefetch" href="/Notebook/assets/js/132.07da823d.js"><link rel="prefetch" href="/Notebook/assets/js/133.f851d5af.js"><link rel="prefetch" href="/Notebook/assets/js/134.de309ceb.js"><link rel="prefetch" href="/Notebook/assets/js/135.0b83f289.js"><link rel="prefetch" href="/Notebook/assets/js/136.99ddbb8e.js"><link rel="prefetch" href="/Notebook/assets/js/137.9ce91c54.js"><link rel="prefetch" href="/Notebook/assets/js/138.d1e6c7df.js"><link rel="prefetch" href="/Notebook/assets/js/139.9e57818f.js"><link rel="prefetch" href="/Notebook/assets/js/14.e6b1fa67.js"><link rel="prefetch" href="/Notebook/assets/js/140.b97a7c8d.js"><link rel="prefetch" href="/Notebook/assets/js/141.db0d7e4b.js"><link rel="prefetch" href="/Notebook/assets/js/142.c9528ba0.js"><link rel="prefetch" href="/Notebook/assets/js/143.5cd17cfd.js"><link rel="prefetch" href="/Notebook/assets/js/144.c8a3236c.js"><link rel="prefetch" href="/Notebook/assets/js/145.ce3e815f.js"><link rel="prefetch" href="/Notebook/assets/js/146.5d5fdead.js"><link rel="prefetch" href="/Notebook/assets/js/147.7ca58039.js"><link rel="prefetch" href="/Notebook/assets/js/148.0528dfc6.js"><link rel="prefetch" href="/Notebook/assets/js/149.e219ef4f.js"><link rel="prefetch" href="/Notebook/assets/js/15.ede5e660.js"><link rel="prefetch" href="/Notebook/assets/js/150.367684ad.js"><link rel="prefetch" href="/Notebook/assets/js/151.bb7cc840.js"><link rel="prefetch" href="/Notebook/assets/js/152.50e2b443.js"><link rel="prefetch" href="/Notebook/assets/js/153.5143d68e.js"><link rel="prefetch" href="/Notebook/assets/js/154.5f75c4d5.js"><link rel="prefetch" href="/Notebook/assets/js/155.2c97d8c7.js"><link rel="prefetch" href="/Notebook/assets/js/156.04597855.js"><link rel="prefetch" href="/Notebook/assets/js/157.27a46ea1.js"><link rel="prefetch" href="/Notebook/assets/js/158.b0e54b34.js"><link rel="prefetch" href="/Notebook/assets/js/159.980a2077.js"><link rel="prefetch" href="/Notebook/assets/js/16.7cea63af.js"><link rel="prefetch" href="/Notebook/assets/js/160.dd7c4dd5.js"><link rel="prefetch" href="/Notebook/assets/js/161.076ac5ad.js"><link rel="prefetch" href="/Notebook/assets/js/162.49697d65.js"><link rel="prefetch" href="/Notebook/assets/js/163.022e5acc.js"><link rel="prefetch" href="/Notebook/assets/js/164.8ceaf7a5.js"><link rel="prefetch" href="/Notebook/assets/js/165.d613540e.js"><link rel="prefetch" href="/Notebook/assets/js/166.c0af31ff.js"><link rel="prefetch" href="/Notebook/assets/js/167.e42b9f57.js"><link rel="prefetch" href="/Notebook/assets/js/168.fa026739.js"><link rel="prefetch" href="/Notebook/assets/js/169.1f7e3137.js"><link rel="prefetch" href="/Notebook/assets/js/17.b7ca32be.js"><link rel="prefetch" href="/Notebook/assets/js/170.c4c1402a.js"><link rel="prefetch" href="/Notebook/assets/js/171.d1075313.js"><link rel="prefetch" href="/Notebook/assets/js/172.31ae23b8.js"><link rel="prefetch" href="/Notebook/assets/js/173.283df959.js"><link rel="prefetch" href="/Notebook/assets/js/174.8a34b9ed.js"><link rel="prefetch" href="/Notebook/assets/js/175.3678f179.js"><link rel="prefetch" href="/Notebook/assets/js/176.c26a8292.js"><link rel="prefetch" href="/Notebook/assets/js/177.783e1466.js"><link rel="prefetch" href="/Notebook/assets/js/178.9fa7eae4.js"><link rel="prefetch" href="/Notebook/assets/js/179.44544c8c.js"><link rel="prefetch" href="/Notebook/assets/js/18.dbdceb5d.js"><link rel="prefetch" href="/Notebook/assets/js/180.15b47c99.js"><link rel="prefetch" href="/Notebook/assets/js/181.73b4c3aa.js"><link rel="prefetch" href="/Notebook/assets/js/182.6a5b17a2.js"><link rel="prefetch" href="/Notebook/assets/js/183.28ec67b1.js"><link rel="prefetch" href="/Notebook/assets/js/184.2cccbd70.js"><link rel="prefetch" href="/Notebook/assets/js/185.de7fec26.js"><link rel="prefetch" href="/Notebook/assets/js/186.0932e1a1.js"><link rel="prefetch" href="/Notebook/assets/js/187.8c1730fc.js"><link rel="prefetch" href="/Notebook/assets/js/188.300dd277.js"><link rel="prefetch" href="/Notebook/assets/js/189.a1bee58b.js"><link rel="prefetch" href="/Notebook/assets/js/19.3d59d024.js"><link rel="prefetch" href="/Notebook/assets/js/190.7663ddc6.js"><link rel="prefetch" href="/Notebook/assets/js/191.7c824181.js"><link rel="prefetch" href="/Notebook/assets/js/192.e85118bd.js"><link rel="prefetch" href="/Notebook/assets/js/193.e954b79c.js"><link rel="prefetch" href="/Notebook/assets/js/194.f4adcdbc.js"><link rel="prefetch" href="/Notebook/assets/js/195.62735b27.js"><link rel="prefetch" href="/Notebook/assets/js/196.e0fafeec.js"><link rel="prefetch" href="/Notebook/assets/js/197.07c5e539.js"><link rel="prefetch" href="/Notebook/assets/js/198.cd686b20.js"><link rel="prefetch" href="/Notebook/assets/js/199.d51b40b4.js"><link rel="prefetch" href="/Notebook/assets/js/2.fa311fa4.js"><link rel="prefetch" href="/Notebook/assets/js/20.b4b2d322.js"><link rel="prefetch" href="/Notebook/assets/js/200.e245b2cd.js"><link rel="prefetch" href="/Notebook/assets/js/201.bd88542b.js"><link rel="prefetch" href="/Notebook/assets/js/202.6eefc25c.js"><link rel="prefetch" href="/Notebook/assets/js/203.98180f0d.js"><link rel="prefetch" href="/Notebook/assets/js/204.cb560045.js"><link rel="prefetch" href="/Notebook/assets/js/205.db965c26.js"><link rel="prefetch" href="/Notebook/assets/js/206.f692627d.js"><link rel="prefetch" href="/Notebook/assets/js/207.885fb929.js"><link rel="prefetch" href="/Notebook/assets/js/208.cb1bebca.js"><link rel="prefetch" href="/Notebook/assets/js/209.7dac81a0.js"><link rel="prefetch" href="/Notebook/assets/js/21.4c9bb6e4.js"><link rel="prefetch" href="/Notebook/assets/js/210.21121b1f.js"><link rel="prefetch" href="/Notebook/assets/js/211.cfd188b5.js"><link rel="prefetch" href="/Notebook/assets/js/212.c691e30a.js"><link rel="prefetch" href="/Notebook/assets/js/213.1a9a1f8d.js"><link rel="prefetch" href="/Notebook/assets/js/214.8c871f29.js"><link rel="prefetch" href="/Notebook/assets/js/215.7dd76ed3.js"><link rel="prefetch" href="/Notebook/assets/js/216.b9c6e46d.js"><link rel="prefetch" href="/Notebook/assets/js/217.bbb09b50.js"><link rel="prefetch" href="/Notebook/assets/js/218.3c93e6af.js"><link rel="prefetch" href="/Notebook/assets/js/219.735de793.js"><link rel="prefetch" href="/Notebook/assets/js/22.6908c05f.js"><link rel="prefetch" href="/Notebook/assets/js/220.3531b68a.js"><link rel="prefetch" href="/Notebook/assets/js/221.220d5f13.js"><link rel="prefetch" href="/Notebook/assets/js/222.9d0535e5.js"><link rel="prefetch" href="/Notebook/assets/js/223.f870f2a0.js"><link rel="prefetch" href="/Notebook/assets/js/224.0b56afa6.js"><link rel="prefetch" href="/Notebook/assets/js/225.cc5b31fd.js"><link rel="prefetch" href="/Notebook/assets/js/226.f4ee0adc.js"><link rel="prefetch" href="/Notebook/assets/js/227.eb919eea.js"><link rel="prefetch" href="/Notebook/assets/js/228.6a28f264.js"><link rel="prefetch" href="/Notebook/assets/js/229.2a8bf537.js"><link rel="prefetch" href="/Notebook/assets/js/23.afd0f5c6.js"><link rel="prefetch" href="/Notebook/assets/js/230.a2f5121e.js"><link rel="prefetch" href="/Notebook/assets/js/231.b10cb770.js"><link rel="prefetch" href="/Notebook/assets/js/232.ae7ad32a.js"><link rel="prefetch" href="/Notebook/assets/js/233.cca18966.js"><link rel="prefetch" href="/Notebook/assets/js/234.f9dd9c73.js"><link rel="prefetch" href="/Notebook/assets/js/235.c9a4bfbe.js"><link rel="prefetch" href="/Notebook/assets/js/236.61c4fb4d.js"><link rel="prefetch" href="/Notebook/assets/js/237.fed9e8fe.js"><link rel="prefetch" href="/Notebook/assets/js/238.86670bd9.js"><link rel="prefetch" href="/Notebook/assets/js/239.9ec3d9e2.js"><link rel="prefetch" href="/Notebook/assets/js/24.c1da07f8.js"><link rel="prefetch" href="/Notebook/assets/js/240.355da7ac.js"><link rel="prefetch" href="/Notebook/assets/js/241.f3420570.js"><link rel="prefetch" href="/Notebook/assets/js/242.ba7e4bd1.js"><link rel="prefetch" href="/Notebook/assets/js/243.2a52effa.js"><link rel="prefetch" href="/Notebook/assets/js/244.7f4499d8.js"><link rel="prefetch" href="/Notebook/assets/js/245.8574f4ac.js"><link rel="prefetch" href="/Notebook/assets/js/246.9b36bc23.js"><link rel="prefetch" href="/Notebook/assets/js/247.107c7608.js"><link rel="prefetch" href="/Notebook/assets/js/248.d8d1aa96.js"><link rel="prefetch" href="/Notebook/assets/js/249.00f19ac8.js"><link rel="prefetch" href="/Notebook/assets/js/250.9b97127c.js"><link rel="prefetch" href="/Notebook/assets/js/251.7c05b25d.js"><link rel="prefetch" href="/Notebook/assets/js/252.b3ee0f29.js"><link rel="prefetch" href="/Notebook/assets/js/253.aac3e92c.js"><link rel="prefetch" href="/Notebook/assets/js/254.694f77fc.js"><link rel="prefetch" href="/Notebook/assets/js/255.7fc65b86.js"><link rel="prefetch" href="/Notebook/assets/js/256.f559aa7a.js"><link rel="prefetch" href="/Notebook/assets/js/257.3855a8f5.js"><link rel="prefetch" href="/Notebook/assets/js/258.0236288d.js"><link rel="prefetch" href="/Notebook/assets/js/259.4a65ba3f.js"><link rel="prefetch" href="/Notebook/assets/js/26.7a74bf43.js"><link rel="prefetch" href="/Notebook/assets/js/260.e110d77b.js"><link rel="prefetch" href="/Notebook/assets/js/261.6ca5e50b.js"><link rel="prefetch" href="/Notebook/assets/js/262.974a7503.js"><link rel="prefetch" href="/Notebook/assets/js/263.b93c02d1.js"><link rel="prefetch" href="/Notebook/assets/js/264.7e9188c1.js"><link rel="prefetch" href="/Notebook/assets/js/265.f68b4748.js"><link rel="prefetch" href="/Notebook/assets/js/266.04a71924.js"><link rel="prefetch" href="/Notebook/assets/js/267.256e6833.js"><link rel="prefetch" href="/Notebook/assets/js/268.18b52093.js"><link rel="prefetch" href="/Notebook/assets/js/269.ddca242f.js"><link rel="prefetch" href="/Notebook/assets/js/27.4af13b47.js"><link rel="prefetch" href="/Notebook/assets/js/270.c63a6e91.js"><link rel="prefetch" href="/Notebook/assets/js/271.9d5de52b.js"><link rel="prefetch" href="/Notebook/assets/js/272.b3d8fe27.js"><link rel="prefetch" href="/Notebook/assets/js/273.aac68402.js"><link rel="prefetch" href="/Notebook/assets/js/274.8b89191a.js"><link rel="prefetch" href="/Notebook/assets/js/275.c748ef07.js"><link rel="prefetch" href="/Notebook/assets/js/276.477c27a9.js"><link rel="prefetch" href="/Notebook/assets/js/277.1084dbc6.js"><link rel="prefetch" href="/Notebook/assets/js/278.98e8be2a.js"><link rel="prefetch" href="/Notebook/assets/js/279.61378737.js"><link rel="prefetch" href="/Notebook/assets/js/28.1f5903ad.js"><link rel="prefetch" href="/Notebook/assets/js/280.c2fda5bf.js"><link rel="prefetch" href="/Notebook/assets/js/281.4497cf31.js"><link rel="prefetch" href="/Notebook/assets/js/282.6b02e04d.js"><link rel="prefetch" href="/Notebook/assets/js/283.c579b5f7.js"><link rel="prefetch" href="/Notebook/assets/js/284.25f19977.js"><link rel="prefetch" href="/Notebook/assets/js/285.1567c42d.js"><link rel="prefetch" href="/Notebook/assets/js/286.8729eefe.js"><link rel="prefetch" href="/Notebook/assets/js/287.5109124c.js"><link rel="prefetch" href="/Notebook/assets/js/288.aff2f2a1.js"><link rel="prefetch" href="/Notebook/assets/js/289.11ee7f93.js"><link rel="prefetch" href="/Notebook/assets/js/29.9750e313.js"><link rel="prefetch" href="/Notebook/assets/js/290.a080d505.js"><link rel="prefetch" href="/Notebook/assets/js/291.8a62b81f.js"><link rel="prefetch" href="/Notebook/assets/js/292.8f2b2816.js"><link rel="prefetch" href="/Notebook/assets/js/293.a6073f5d.js"><link rel="prefetch" href="/Notebook/assets/js/294.8036aeb4.js"><link rel="prefetch" href="/Notebook/assets/js/295.4aaf6175.js"><link rel="prefetch" href="/Notebook/assets/js/296.22622ba4.js"><link rel="prefetch" href="/Notebook/assets/js/297.598bfede.js"><link rel="prefetch" href="/Notebook/assets/js/298.68edb938.js"><link rel="prefetch" href="/Notebook/assets/js/299.1f0f84fe.js"><link rel="prefetch" href="/Notebook/assets/js/3.0cb2ce57.js"><link rel="prefetch" href="/Notebook/assets/js/30.5fc87000.js"><link rel="prefetch" href="/Notebook/assets/js/300.9c7600af.js"><link rel="prefetch" href="/Notebook/assets/js/301.0d95fc30.js"><link rel="prefetch" href="/Notebook/assets/js/302.b923baab.js"><link rel="prefetch" href="/Notebook/assets/js/303.d20079b9.js"><link rel="prefetch" href="/Notebook/assets/js/304.12a70192.js"><link rel="prefetch" href="/Notebook/assets/js/305.4ea4d8da.js"><link rel="prefetch" href="/Notebook/assets/js/306.282edebe.js"><link rel="prefetch" href="/Notebook/assets/js/307.3a37e321.js"><link rel="prefetch" href="/Notebook/assets/js/308.9221f97f.js"><link rel="prefetch" href="/Notebook/assets/js/309.c7c3ca1a.js"><link rel="prefetch" href="/Notebook/assets/js/31.18d6f54f.js"><link rel="prefetch" href="/Notebook/assets/js/310.5dde0eb7.js"><link rel="prefetch" href="/Notebook/assets/js/311.819aad83.js"><link rel="prefetch" href="/Notebook/assets/js/312.c2037cae.js"><link rel="prefetch" href="/Notebook/assets/js/313.52ee9f6c.js"><link rel="prefetch" href="/Notebook/assets/js/314.d0105766.js"><link rel="prefetch" href="/Notebook/assets/js/315.02d1beff.js"><link rel="prefetch" href="/Notebook/assets/js/316.69816787.js"><link rel="prefetch" href="/Notebook/assets/js/317.22d3b673.js"><link rel="prefetch" href="/Notebook/assets/js/318.483e3b5e.js"><link rel="prefetch" href="/Notebook/assets/js/319.bc984d80.js"><link rel="prefetch" href="/Notebook/assets/js/32.4ebe70c0.js"><link rel="prefetch" href="/Notebook/assets/js/320.d023db3c.js"><link rel="prefetch" href="/Notebook/assets/js/321.909f7332.js"><link rel="prefetch" href="/Notebook/assets/js/322.3b32a676.js"><link rel="prefetch" href="/Notebook/assets/js/323.9eb049fd.js"><link rel="prefetch" href="/Notebook/assets/js/324.5eae3717.js"><link rel="prefetch" href="/Notebook/assets/js/325.c9aa7e97.js"><link rel="prefetch" href="/Notebook/assets/js/326.2ec27286.js"><link rel="prefetch" href="/Notebook/assets/js/327.1096ac53.js"><link rel="prefetch" href="/Notebook/assets/js/328.17578c44.js"><link rel="prefetch" href="/Notebook/assets/js/329.f6f1b4fc.js"><link rel="prefetch" href="/Notebook/assets/js/33.4c170b35.js"><link rel="prefetch" href="/Notebook/assets/js/330.b84e8b18.js"><link rel="prefetch" href="/Notebook/assets/js/331.2ce71bd6.js"><link rel="prefetch" href="/Notebook/assets/js/332.d49f1076.js"><link rel="prefetch" href="/Notebook/assets/js/333.18846963.js"><link rel="prefetch" href="/Notebook/assets/js/334.07d784aa.js"><link rel="prefetch" href="/Notebook/assets/js/335.b2d18495.js"><link rel="prefetch" href="/Notebook/assets/js/336.27d6fdac.js"><link rel="prefetch" href="/Notebook/assets/js/337.e3b8a4d6.js"><link rel="prefetch" href="/Notebook/assets/js/338.4e17425d.js"><link rel="prefetch" href="/Notebook/assets/js/339.ca72b051.js"><link rel="prefetch" href="/Notebook/assets/js/34.4137a6d9.js"><link rel="prefetch" href="/Notebook/assets/js/340.a9c58e42.js"><link rel="prefetch" href="/Notebook/assets/js/341.015e17e5.js"><link rel="prefetch" href="/Notebook/assets/js/342.883cb2ad.js"><link rel="prefetch" href="/Notebook/assets/js/343.26e0511c.js"><link rel="prefetch" href="/Notebook/assets/js/344.5437611f.js"><link rel="prefetch" href="/Notebook/assets/js/345.26f6e7c4.js"><link rel="prefetch" href="/Notebook/assets/js/346.f7a3f23f.js"><link rel="prefetch" href="/Notebook/assets/js/347.27ccd6a8.js"><link rel="prefetch" href="/Notebook/assets/js/348.eff0a33d.js"><link rel="prefetch" href="/Notebook/assets/js/349.dd942ff5.js"><link rel="prefetch" href="/Notebook/assets/js/35.36b834f7.js"><link rel="prefetch" href="/Notebook/assets/js/350.9128eb0c.js"><link rel="prefetch" href="/Notebook/assets/js/351.e26fffba.js"><link rel="prefetch" href="/Notebook/assets/js/352.59cc3f38.js"><link rel="prefetch" href="/Notebook/assets/js/353.3ad59a15.js"><link rel="prefetch" href="/Notebook/assets/js/354.544a13c0.js"><link rel="prefetch" href="/Notebook/assets/js/355.d5f7255f.js"><link rel="prefetch" href="/Notebook/assets/js/356.7efdf2cd.js"><link rel="prefetch" href="/Notebook/assets/js/357.0b296e32.js"><link rel="prefetch" href="/Notebook/assets/js/358.a532d695.js"><link rel="prefetch" href="/Notebook/assets/js/359.01fd142f.js"><link rel="prefetch" href="/Notebook/assets/js/36.4ef6c0d1.js"><link rel="prefetch" href="/Notebook/assets/js/360.c71cb25e.js"><link rel="prefetch" href="/Notebook/assets/js/361.db70e72e.js"><link rel="prefetch" href="/Notebook/assets/js/362.670b7527.js"><link rel="prefetch" href="/Notebook/assets/js/363.ef0b3005.js"><link rel="prefetch" href="/Notebook/assets/js/364.63c1df56.js"><link rel="prefetch" href="/Notebook/assets/js/37.b0f3cb5d.js"><link rel="prefetch" href="/Notebook/assets/js/38.2ca6e078.js"><link rel="prefetch" href="/Notebook/assets/js/39.77206fea.js"><link rel="prefetch" href="/Notebook/assets/js/40.18d76f1c.js"><link rel="prefetch" href="/Notebook/assets/js/41.ed792d7a.js"><link rel="prefetch" href="/Notebook/assets/js/42.b983e72e.js"><link rel="prefetch" href="/Notebook/assets/js/43.3cdbe61c.js"><link rel="prefetch" href="/Notebook/assets/js/44.a4c1a462.js"><link rel="prefetch" href="/Notebook/assets/js/45.727fa84a.js"><link rel="prefetch" href="/Notebook/assets/js/46.a5665d33.js"><link rel="prefetch" href="/Notebook/assets/js/47.45efede1.js"><link rel="prefetch" href="/Notebook/assets/js/48.24e8e78b.js"><link rel="prefetch" href="/Notebook/assets/js/49.c426b444.js"><link rel="prefetch" href="/Notebook/assets/js/5.89a78b31.js"><link rel="prefetch" href="/Notebook/assets/js/50.41038e45.js"><link rel="prefetch" href="/Notebook/assets/js/51.3c34459c.js"><link rel="prefetch" href="/Notebook/assets/js/52.6df1c335.js"><link rel="prefetch" href="/Notebook/assets/js/53.69e41130.js"><link rel="prefetch" href="/Notebook/assets/js/54.591891ed.js"><link rel="prefetch" href="/Notebook/assets/js/55.d8d5bf6e.js"><link rel="prefetch" href="/Notebook/assets/js/56.c43a3733.js"><link rel="prefetch" href="/Notebook/assets/js/57.2c24f33c.js"><link rel="prefetch" href="/Notebook/assets/js/58.15a5e91b.js"><link rel="prefetch" href="/Notebook/assets/js/59.20cda08a.js"><link rel="prefetch" href="/Notebook/assets/js/6.f66bffc9.js"><link rel="prefetch" href="/Notebook/assets/js/60.beb8a99d.js"><link rel="prefetch" href="/Notebook/assets/js/61.2313bfd8.js"><link rel="prefetch" href="/Notebook/assets/js/62.ae93bded.js"><link rel="prefetch" href="/Notebook/assets/js/63.c0de4f2c.js"><link rel="prefetch" href="/Notebook/assets/js/64.b42cacb6.js"><link rel="prefetch" href="/Notebook/assets/js/65.719a31bb.js"><link rel="prefetch" href="/Notebook/assets/js/66.5c0128e7.js"><link rel="prefetch" href="/Notebook/assets/js/67.6107a140.js"><link rel="prefetch" href="/Notebook/assets/js/68.ac7fc4fa.js"><link rel="prefetch" href="/Notebook/assets/js/69.122426ed.js"><link rel="prefetch" href="/Notebook/assets/js/7.fbf1f9ec.js"><link rel="prefetch" href="/Notebook/assets/js/70.66e6b252.js"><link rel="prefetch" href="/Notebook/assets/js/71.28956fa1.js"><link rel="prefetch" href="/Notebook/assets/js/72.fcf3fb10.js"><link rel="prefetch" href="/Notebook/assets/js/73.947d80fa.js"><link rel="prefetch" href="/Notebook/assets/js/74.1d9d59de.js"><link rel="prefetch" href="/Notebook/assets/js/75.bbe5b314.js"><link rel="prefetch" href="/Notebook/assets/js/76.d018671b.js"><link rel="prefetch" href="/Notebook/assets/js/77.fca59f83.js"><link rel="prefetch" href="/Notebook/assets/js/78.4a545e59.js"><link rel="prefetch" href="/Notebook/assets/js/79.a039fbdf.js"><link rel="prefetch" href="/Notebook/assets/js/8.c69b9065.js"><link rel="prefetch" href="/Notebook/assets/js/80.d203faaa.js"><link rel="prefetch" href="/Notebook/assets/js/81.d193c9f3.js"><link rel="prefetch" href="/Notebook/assets/js/82.4675ade1.js"><link rel="prefetch" href="/Notebook/assets/js/83.ee538b4f.js"><link rel="prefetch" href="/Notebook/assets/js/84.8962589d.js"><link rel="prefetch" href="/Notebook/assets/js/85.76922906.js"><link rel="prefetch" href="/Notebook/assets/js/86.ec43215f.js"><link rel="prefetch" href="/Notebook/assets/js/87.46322abb.js"><link rel="prefetch" href="/Notebook/assets/js/88.5594f40a.js"><link rel="prefetch" href="/Notebook/assets/js/89.7f421583.js"><link rel="prefetch" href="/Notebook/assets/js/9.e0bdbf17.js"><link rel="prefetch" href="/Notebook/assets/js/90.853bb5b2.js"><link rel="prefetch" href="/Notebook/assets/js/91.fa605797.js"><link rel="prefetch" href="/Notebook/assets/js/92.f770f194.js"><link rel="prefetch" href="/Notebook/assets/js/93.1f9e6fb6.js"><link rel="prefetch" href="/Notebook/assets/js/94.2260cf7f.js"><link rel="prefetch" href="/Notebook/assets/js/95.6b1244de.js"><link rel="prefetch" href="/Notebook/assets/js/96.39617d63.js"><link rel="prefetch" href="/Notebook/assets/js/97.e4b8e984.js"><link rel="prefetch" href="/Notebook/assets/js/98.85e69ce3.js"><link rel="prefetch" href="/Notebook/assets/js/99.e2930b98.js">
    <link rel="stylesheet" href="/Notebook/assets/css/0.styles.b1f38863.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Notebook/" class="home-link router-link-active"><!----> <span class="site-name">Naluduo's Notebook</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Notebook/dailyRecord/" class="nav-link">
  📝日常记录
</a></div><div class="nav-item"><a href="/Notebook/blogs/" class="nav-link">
  📖文章合集
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端知识体系" class="dropdown-title"><span class="title">前端知识体系</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Notebook/frontend-web/" class="nav-link router-link-active">
  基础知识
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/web-framework/" class="nav-link">
  🐂web 框架
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/rethink/" class="nav-link">
  🤔复盘
</a></li><li class="dropdown-item"><h4>
          ️️🧘算法修炼
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Notebook/understand-the-computer/" class="nav-link">
  理解计算机
</a></li><li class="dropdown-subitem"><a href="/Notebook/algorithm/dataStructure.html" class="nav-link">
  数据结构
</a></li><li class="dropdown-subitem"><a href="/Notebook/algorithm/algorithm.html" class="nav-link">
  算法分类
</a></li><li class="dropdown-subitem"><a href="/Notebook/dataBase/index.html" class="nav-link">
  数据库
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/Notebook/devops/" class="nav-link">
  ☁️运维
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/test/" class="nav-link">
  🚬测试
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/gis/" class="nav-link">
  🌍GIS
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/tools/" class="nav-link">
  ️️🖱️工具
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/network/" class="nav-link">
  ️️🐛网络工程
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/game-development/" class="nav-link">
  ️️🎮游戏开发
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/programming-language/" class="nav-link">
  🚶编程语言
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/programming-paradigm/" class="nav-link">
  编程范式
</a></li></ul></div></div><div class="nav-item"><a href="/Notebook/lint/" class="nav-link">
  ✔️编码规范&amp;协同开发
</a></div><div class="nav-item"><a href="/Notebook/math/" class="nav-link">
  𝜋数学
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="设计" class="dropdown-title"><span class="title">设计</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Notebook/design/" class="nav-link">
  🖌️UI
</a></li></ul></div></div><div class="nav-item"><a href="/Notebook/bookmark/" class="nav-link">
  🏷书签整理
</a></div><div class="nav-item"><a href="http://shooterblog.site/Learn-JS-Demo/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  📖知识脑图
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://naluduo.vip/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🔧个人博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🔗Github" class="dropdown-title"><span class="title">🔗Github</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/naluduo233" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Jecyu github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://naluduo233.github.io/language-learning/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  英语学习
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://naluduo233.github.io/Fe-Auto-Testing/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端自动化测试
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://naluduo233.github.io/JS-Event-Loop/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JS 事件循环机制
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://naluduo233.github.io/Web-Performance-Optimization/reference/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  微谈 Web 前端性能优化
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Notebook/dailyRecord/" class="nav-link">
  📝日常记录
</a></div><div class="nav-item"><a href="/Notebook/blogs/" class="nav-link">
  📖文章合集
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端知识体系" class="dropdown-title"><span class="title">前端知识体系</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Notebook/frontend-web/" class="nav-link router-link-active">
  基础知识
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/web-framework/" class="nav-link">
  🐂web 框架
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/rethink/" class="nav-link">
  🤔复盘
</a></li><li class="dropdown-item"><h4>
          ️️🧘算法修炼
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Notebook/understand-the-computer/" class="nav-link">
  理解计算机
</a></li><li class="dropdown-subitem"><a href="/Notebook/algorithm/dataStructure.html" class="nav-link">
  数据结构
</a></li><li class="dropdown-subitem"><a href="/Notebook/algorithm/algorithm.html" class="nav-link">
  算法分类
</a></li><li class="dropdown-subitem"><a href="/Notebook/dataBase/index.html" class="nav-link">
  数据库
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/Notebook/devops/" class="nav-link">
  ☁️运维
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/test/" class="nav-link">
  🚬测试
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/gis/" class="nav-link">
  🌍GIS
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/tools/" class="nav-link">
  ️️🖱️工具
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/network/" class="nav-link">
  ️️🐛网络工程
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/game-development/" class="nav-link">
  ️️🎮游戏开发
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/programming-language/" class="nav-link">
  🚶编程语言
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/programming-paradigm/" class="nav-link">
  编程范式
</a></li></ul></div></div><div class="nav-item"><a href="/Notebook/lint/" class="nav-link">
  ✔️编码规范&amp;协同开发
</a></div><div class="nav-item"><a href="/Notebook/math/" class="nav-link">
  𝜋数学
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="设计" class="dropdown-title"><span class="title">设计</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Notebook/design/" class="nav-link">
  🖌️UI
</a></li></ul></div></div><div class="nav-item"><a href="/Notebook/bookmark/" class="nav-link">
  🏷书签整理
</a></div><div class="nav-item"><a href="http://shooterblog.site/Learn-JS-Demo/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  📖知识脑图
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://naluduo.vip/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🔧个人博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🔗Github" class="dropdown-title"><span class="title">🔗Github</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/naluduo233" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Jecyu github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://naluduo233.github.io/language-learning/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  英语学习
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://naluduo233.github.io/Fe-Auto-Testing/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端自动化测试
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://naluduo233.github.io/JS-Event-Loop/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JS 事件循环机制
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://naluduo233.github.io/Web-Performance-Optimization/reference/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  微谈 Web 前端性能优化
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>基础知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Notebook/frontend-web/browser.html" aria-current="page" class="active sidebar-link">浏览器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/browser.html#浏览器是多进程的" class="sidebar-link">浏览器是多进程的</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/browser.html#浏览器都包含了哪些进程" class="sidebar-link">浏览器都包含了哪些进程</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/browser.html#浏览器多进程的优势" class="sidebar-link">浏览器多进程的优势</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/browser.html#重点：浏览器内核（渲染进程）" class="sidebar-link">重点：浏览器内核（渲染进程）</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/browser.html#browser-进程和浏览器内核（renderer-进程）的通信过程" class="sidebar-link">Browser 进程和浏览器内核（Renderer 进程）的通信过程</a></li></ul></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/browser.html#梳理浏览器内核中线程之间的关系" class="sidebar-link">梳理浏览器内核中线程之间的关系</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/browser.html#gui-渲染线程与-js-引擎线程互斥" class="sidebar-link">GUI 渲染线程与 JS 引擎线程互斥</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/browser.html#js-阻塞页面加载" class="sidebar-link">JS 阻塞页面加载</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/browser.html#webworker，js-的多线程？" class="sidebar-link">WebWorker，JS 的多线程？</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/browser.html#webworker-与-sharedworker" class="sidebar-link">WebWorker 与 SharedWorker</a></li></ul></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/browser.html#浏览器渲染流程" class="sidebar-link">浏览器渲染流程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/browser.html#load-事件与-domcontentloaded-事件的先后" class="sidebar-link">load 事件与 DOMContentLoaded 事件的先后</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/browser.html#告别阻塞：css-与-js-的加载顺序优化" class="sidebar-link">告别阻塞：CSS 与 JS 的加载顺序优化</a></li></ul></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/browser.html#从-event-loop-谈-js-的运行机制" class="sidebar-link">从 Event Loop 谈 JS 的运行机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/browser.html#事件循环机制的进一步补充" class="sidebar-link">事件循环机制的进一步补充</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/browser.html#单独说说定时器" class="sidebar-link">单独说说定时器</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/browser.html#settimeout-而不是-setinterval" class="sidebar-link">setTimeout 而不是 setInterval</a></li></ul></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/browser.html#事件循环进阶：macrotask-与-microtask" class="sidebar-link">事件循环进阶：macrotask 与 microtask</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/browser.html#它们的定义？区别？简单点可以按如下理解：" class="sidebar-link">它们的定义？区别？简单点可以按如下理解：</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/browser.html#分别是什么样的场景会形成-macrotask-和-microtask-呢？" class="sidebar-link">分别是什么样的场景会形成 macrotask 和 microtask 呢？</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/browser.html#结合线程来理解" class="sidebar-link">结合线程来理解</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/browser.html#使用-mutationobserver-实现-microtask" class="sidebar-link">使用 MutationObserver 实现 microtask</a></li></ul></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/browser.html#cookie-和-token-都存放在-header-中，为什么不会劫持-token？" class="sidebar-link">cookie 和 token 都存放在 header 中，为什么不会劫持 token？</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/browser.html#介绍下如何实现-token-加密？" class="sidebar-link">介绍下如何实现 token 加密？</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/browser.html#数据库" class="sidebar-link">数据库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/browser.html#cookies，sessionstorage-和-localstorage-的区别" class="sidebar-link">cookies，sessionStorage 和 localStorage 的区别</a></li></ul></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/browser.html#输入一个url到浏览器页面展示都经历了哪些过程" class="sidebar-link">输入一个url到浏览器页面展示都经历了哪些过程</a></li><li class="sidebar-sub-header"><a href="/Notebook/frontend-web/browser.html#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/Notebook/frontend-web/css.html" class="sidebar-link">CSS 项目实战总结（持续更新）</a></li><li><a href="/Notebook/frontend-web/js.html" class="sidebar-link">JS</a></li><li><a href="/Notebook/frontend-web/es6.html" class="sidebar-link">ES6</a></li><li><a href="/Notebook/frontend-web/ts.html" class="sidebar-link">TypeScript 项目总结（持续更新）</a></li><li><a href="/Notebook/frontend-web/vue2.html" class="sidebar-link">Vue 2.x项目开发总结（持续更新）</a></li><li><a href="/Notebook/frontend-web/react.html" class="sidebar-link">React</a></li><li><a href="/Notebook/frontend-web/regex.html" class="sidebar-link">正则表达式</a></li><li><a href="/Notebook/frontend-web/" aria-current="page" class="sidebar-link">前端工程化</a></li><li><a href="/Notebook/frontend-web/webgl.html" class="sidebar-link">WebGL 从入门到实战总结</a></li><li><a href="/Notebook/frontend-web/architecture.html" class="sidebar-link">前端架构</a></li><li><a href="/Notebook/frontend-web/authentication.html" class="sidebar-link">鉴权&amp;&amp;认证</a></li><li><a href="/Notebook/frontend-web/chrome.html" class="sidebar-link">chrome 调试技巧</a></li><li><a href="/Notebook/frontend-web/noJQ.html" class="sidebar-link">You (Might) Don't Need jQuery</a></li><li><a href="/Notebook/frontend-web/performance.html" class="sidebar-link">性能优化</a></li><li><a href="/Notebook/frontend-web/npm.html" class="sidebar-link">npm</a></li><li><a href="/Notebook/frontend-web/lodash.html" class="sidebar-link">lodash 源码分析及思路学习</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="浏览器"><a href="#浏览器" class="header-anchor">#</a> 浏览器</h1> <p><img src="/Notebook/assets/img/browser-vs-nodejs.cff86be0.png" alt=""></p> <h2 id="浏览器是多进程的"><a href="#浏览器是多进程的" class="header-anchor">#</a> 浏览器是多进程的</h2> <ul><li>浏览器是多进程的。</li> <li>浏览器之所以能够运行，是因为系统给它的进程分配了资源（cpu，内存）。</li> <li>简单点，每打开一个 tab 页，就相当于创建了一个独立的浏览器进程。</li></ul> <p>关于以上的几点的验证，如下图：
<img src="/Notebook/assets/img/browser-process.2ece01ce.png" alt=""></p> <p>图中打开了 <code>Chrome</code> 浏览器的多个标签页，然后可以在 <code>Chrome 的任务管理器</code>中可以看到有多个进程（分别是每一个 Tab 页面有一个独立的进程，以及一个主进程浏览器）。感兴趣可以自行尝试下，如果再多打开一个 Tab 页，进程正常会 +1 以上。</p> <p>**注意：**在这里浏览器应该也有自己的优化机制，有时候打开多个 tab 页后，可以在 Chrome 任务管理器中看到，有些进程被合并了，如图中的 onetab（所以每一个Tab 标签对应一个进程并不一定是绝对的）</p> <h3 id="浏览器都包含了哪些进程"><a href="#浏览器都包含了哪些进程" class="header-anchor">#</a> 浏览器都包含了哪些进程</h3> <p>知道了浏览器是多进程后，再来看看它到底包含哪些进程：（为了简化理解，以下列举主要进程）</p> <ul><li><strong>Browser进程：浏览器的主进程（负责协调、主控），只有一个。作用有：</strong> <ul><li>负责浏览器界面显示，与用户交互。如前进，后退等。</li> <li>负责各个页面的管理，创建和销毁其他进程。</li> <li>将 Renderer 进程得到的内存中 Bitmap，绘制到用户界面上</li> <li>网络资源的管理，下载等。</li></ul></li> <li><strong>第三方插件进程：每种类型的插件对应一个进程，仅当使用该插件时才创建。</strong></li> <li><strong>GPU 进程：最多一个，用于 3D 绘制等。</strong></li> <li><strong>浏览器渲染进程（浏览器内核）（Renderer 进程，内部是多线程）：默认每个 Tab 页面创建一个进程，互不影响。主要作用为：</strong> <ul><li>页面渲染，脚本执行，事件处理等。
在浏览器中打开一个网页相当于新起了一个进程（进程内有自己的多线程）。
当然，浏览器有时会将多个进程合并（例如打开多个空白标签页后，会发现多个空白标签页被合并成了一个进程），如图：</li></ul></li></ul> <p><img src="/Notebook/assets/img/browser-process-2.0937794e.png" alt=""></p> <h3 id="浏览器多进程的优势"><a href="#浏览器多进程的优势" class="header-anchor">#</a> 浏览器多进程的优势</h3> <p>相比于单进程浏览器，多进程有如下有点难：</p> <ul><li>避免单个 page crash 影响整个浏览器</li> <li>避免第三方插件 crash 影响整个浏览器</li> <li>多进程充分利用多核优势</li> <li>方便使用沙盒模型呢隔壁插件等进程，提供浏览器稳定性。</li></ul> <p>简单点理解：如果浏览器是单进程，那么某个 Tab 页崩溃了，就影响了整个浏览器，体验很差；同理如果是单进程，插件崩溃了也会影响整个浏览器；多进程还有其他的诸多优势。与之带来的是，内存等资源消耗也会更大，有点空间换时间的意思。</p> <h3 id="重点：浏览器内核（渲染进程）"><a href="#重点：浏览器内核（渲染进程）" class="header-anchor">#</a> 重点：浏览器内核（渲染进程）</h3> <p><img src="/Notebook/assets/img/browser-core.cff98afa.png" alt=""></p> <p>对于普通的前端操作来说，最终要的是渲染进程。可以这样理解，页面的渲染、JS 的执行、事件的循环，都在这个进程内进行。</p> <p>请牢记，浏览器的渲染进程是多线程的。那么接下来看看它都包含了哪些线程（列举一些主要常驻线程）：</p> <ul><li><strong>GUI 渲染线程</strong> <ul><li>负责渲染浏览器界面，解析 HTML，CSS，构建 DOM 树和 RenderObject 树，布局和绘制等。</li> <li>档节目需要重绘（Repaint）或由于某种操作引发回流（reflow）时，该线程就会执行。</li> <li>注意，<strong>GUI 渲染流程与JS引擎线程是互斥的</strong>，共享了临界资源。当JS引擎执行时 GUI 线程回被挂起（相当于被冻结了），GUI 更新会被保存到一个队列中等到 <strong>JS 引擎空闲时</strong>立即被执行。</li></ul></li> <li><strong>JS 引擎线程</strong> <ul><li>也称为JS内核，负责处理 JavaScript 脚本程序。（例如 V8 引擎）</li> <li>JS 引擎线程负责解析 JavaScript 脚本，运行代码。</li> <li>JS 引擎一直等待着<strong>任务队列</strong>中任务的到来，然后加以处理，一个 Tab 页（renderer进程）中无论什么时候都只有一个 JS 线程在运行 JS 程序。</li> <li>同样注意，GUI 渲染线程 与 JS 引擎是互斥的，所以如果 JS 执行的时间过长，这样就会造成页面的渲染不连贯，导致页面渲染加载阻塞。</li></ul></li> <li><strong>事件触发线程</strong> <ul><li>归属于浏览器而不是 JS 引擎，用来控制事件循环（可以理解，JS 引擎自己都忙不过来，需要浏览器另开线程协助）。</li> <li>当 JS 引擎执行代码块如 setTimeout 时（也可以来自浏览器内核的其他线程，如鼠标点击、AJAX 异步请求等），会将对应任务添加到<strong>事件线程中</strong>。</li> <li>当对应的事件符合触发条件被触发时，该线程会把事件添加到待处理<strong>任务队列</strong>的队尾，等待 JS 引擎的处理。</li> <li>注意，由于 JS 的单线程关系（在某一时间点执行的处理只有一个），所以这些待处理队列中的事件都得排队等待 JS 引擎处理（当 JS 引擎空闲时才会去执行）。</li></ul></li> <li><strong>定时触发器线程</strong> <ul><li>传说中的 <code>setInterval</code> 与 <code>setTimeout</code> 所在线程。</li> <li>浏览器定时计数器并不是由 JavaScript 引擎计数的，（因为 JavaScript 引擎是单线程的，如果处于阻塞线程状态就会影响计时的准确）</li> <li>因此通过单线程来计时并触发定时（计时完毕后，执行事件触发线程，把任务添加到事件队列中，等待 JS 引擎空闲后执行。）</li> <li>注意，W3C 在 HTML 标准中规定，规定要求 setTimeout 中低于4ms的时间间隔算为4ms。</li></ul></li> <li><strong>异步 http 请求线程</strong> <ul><li>在 <code>XMLHttpRequest</code> 在连接后是通过浏览器新开一个线程请求</li> <li>将检测到状态变更时，如果设置有回调函数，异步线程就<strong>产生状态变更事件</strong>，事件触发线程将这个回调放入事件任务队列中，然后由 JS 引擎执行。</li></ul></li></ul> <p>补充：为什么 JS 引擎是单线程的？这个可能仅仅是因为由于多线程的复杂性，譬如多线程操作一般要加锁，因此最初设计时选择了单线程。</p> <h3 id="browser-进程和浏览器内核（renderer-进程）的通信过程"><a href="#browser-进程和浏览器内核（renderer-进程）的通信过程" class="header-anchor">#</a> Browser 进程和浏览器内核（Renderer 进程）的通信过程</h3> <ul><li>Browser 进程收到用户请求，首先需要获取页面内容（譬如通过网络下载资源），随后将该任务通过 RendererHost 接口传递给 Render 进程。</li> <li>Renderer 进程的 Renderer 收到消息，简单解释后，交给渲染线程，然后开始渲染。
<ul><li>渲染线程接收请求，加载网页并渲染网页，这其中可能需要 Browser 进程获取资源和需要 <strong>GPU </strong>进程来帮助渲染。</li> <li>当然可能会有 JS 线程操作 DOM（这样可能会造成回流并重绘）。</li> <li>最后 Renderer 进程将结果传递给 Browser 进程。</li></ul></li> <li>Browser 进程接收到结果并将结果绘制出来。</li></ul> <p><img src="/Notebook/assets/img/browser-communicate-renderer.eb8f5c74.png" alt=""></p> <h2 id="梳理浏览器内核中线程之间的关系"><a href="#梳理浏览器内核中线程之间的关系" class="header-anchor">#</a> 梳理浏览器内核中线程之间的关系</h2> <h3 id="gui-渲染线程与-js-引擎线程互斥"><a href="#gui-渲染线程与-js-引擎线程互斥" class="header-anchor">#</a> GUI 渲染线程与 JS 引擎线程互斥</h3> <p>由于 JavaScript 是可操纵 DOM（DOM 是临界区资源），如果在修改这些元素属性同时渲染界面（即 JS 线程和 UI 线程同时运时），那么渲染线程前后获得的元素数据就可能不一致了。</p> <p>因此为了防止渲染出现不可预期的结果，浏览器设置 GUI 渲染线程与 JS 引擎线程为互斥的关系，当你 JS 引擎执行时 GUI 线程会被挂起，GUI 更新则会被保存在一个队列中等到 JS 引擎线程空闲时立即被执行。</p> <h3 id="js-阻塞页面加载"><a href="#js-阻塞页面加载" class="header-anchor">#</a> JS 阻塞页面加载</h3> <p>从上述的互斥关系，可以推导出，JS 如果执行时间过长就会阻塞页面。</p> <p>譬如，假设 JS 引擎正在进行巨量的计算，此时就算 GUI 有更新，<u>也会被保存到队列中</u>，等待 JS 引擎空闲后执行。然后，由于巨量计算，所以 JS 引擎很可能很久很久后才能空闲，自然会让用户感觉巨卡无比。</p> <p>所以，要尽量避免 JS 执行时间过长，这样就会造成页面的渲染不连贯，导致页面渲染加载时阻塞的感觉。</p> <h3 id="webworker，js-的多线程？"><a href="#webworker，js-的多线程？" class="header-anchor">#</a> WebWorker，JS 的多线程？</h3> <p>前文中有提到 JS 引擎是单线程的，而且 JS 执行时间过长会阻塞页面，那么 JS 就真的对 cpu 密集型计算无能为力了么？</p> <p>所以，后来 HTML5 中支持了 <code>Web Worker</code>。</p> <blockquote><p>MDN：Web Worker 为 Web 内容呢在后台线程中运行脚本提供了一种简单的方法。线程可以执行任务而不干扰用户界面。
一个 woker 是使用一个构造函数创建的一个对象（eg. Woker()）运行一个命名的 JavaScript 文件呢。
这个文件包含将在工作线程中运行的代码；worker 运行在另一个全局上下文中，不同于当前的 window。
因此，使用 window 快捷方式获取当前全局的范围（而不是 self）在一个 Worker 内将返回错误。</p></blockquote> <p>这样理解下：</p> <ul><li>创建 Worker 时，JS 引擎向浏览器申请开一个子线程（子线程是浏览器开的，完全受主线程控制，而且不能操作 DOM）。</li> <li>JS 引擎线程与 worker 线程间通信通过特定的方式通信（postMessage API，需要通过序列号对象来与线程交互特定的数据）。</li></ul> <p>所以，如果有非常耗时的工作（如解码视频），请单独申请开一个 Worker 线程，这样里面不管如何翻天覆地都不会影响 JS 引擎主线程，只待计算结果后，将结果通信给主线程即可。</p> <p>而且注意下，<strong>JS 引擎是单线程的</strong>，这一点的本质仍然未改变，Worker 可以理解是浏览器给 JS 引擎开的外挂，专门用来解决那些大量计算问题。</p> <p>根据2017年新版的HTML规范，浏览器包含2类事件循环：browsing contexts 和 web workers。 链接：<a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" target="_blank" rel="noopener noreferrer">HTML Standard<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="webworker-与-sharedworker"><a href="#webworker-与-sharedworker" class="header-anchor">#</a> WebWorker 与 SharedWorker</h3> <ul><li>WebWorker 只属于某个页面，不会和其他页面的 Render 进程（浏览器内核进程）共享
<ul><li>所以 Chrome 在 Renderer 进程中（每一个 Tab 页就是一个 Render 进程），创建一个新的线程来运行 Worker 中的 JavaScript 程序。</li></ul></li> <li>SharedWorker 是浏览器所有页面共享的，不能采用呢与 Worker 同样的方式实现，因为它不隶属于某个 Renderer 进程，可以为多个 Rendnerer 进程共享使用
<ul><li>所以 Chrome 浏览器为 SharedWorker 单独创建一个进程来运行 JavaScript 程序，在浏览器中每个相同的 JavaScript 只存在一个 SharedWorker 进程，不管它被创建多少次。</li></ul></li></ul> <p>它们之间的区别本质上是进程和线程的区别。SharedWorker 由独立的进程管理，WebWorker 只是属于 render 进程下的一个线程。</p> <h2 id="浏览器渲染流程"><a href="#浏览器渲染流程" class="header-anchor">#</a> 浏览器渲染流程</h2> <p>为了简化理解，前期工作直接省略成：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>- 浏览器输入 url，浏览器主进程接管，开一个下载线程，
然后进行 http 请求（略去 DNS 查询，IP 寻址等待响应，获取内容），
随后将内容通过 RendererHost 接口转交给 Renderer 进程

- 浏览器渲染流程开始
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><img src="/Notebook/assets/img/web-lifecycle.5a779de2.png" alt=""></p> <p>客户端 Web 引用的周期从用户指定某个网站地址（或单击某个链接）开始，由两个步骤组成：</p> <ul><li>页面构建（首次渲染）
<ul><li>步骤1： 解析 HTML 代码并够构建文档对象模型（DOM）；</li> <li>步骤2：执行 JavaScript 代码。（在 HTML 解析到一种特殊节点——脚本节点（包含或引用 JavaScript 代码的节点）时执行）</li> <li>页面构建阶段，这两个步骤会交替执行多次。</li></ul></li> <li>事件处理（用户交互）</li></ul> <p>浏览器内核拿到内容后，渲染大概可以划分成以下几个步骤：（页面构建部分）</p> <ol><li>解析HTML：在解析 HTML 的过程中发出了页面渲染所需的各种外部资源请求。
<ul><li>解析 html 建立 dom 树。</li></ul></li> <li>计算样式：
<ul><li>解析 css 构建 render 树（将 css 代码解析成树形的数据结构，然后结合 DOM 合并成 render 树）。</li></ul></li> <li>计算图层布局：
<ul><li>布局 render 树（Layout/reflow），负责各元素尺寸、位置的计算。</li></ul></li> <li>绘制图层：
<ul><li>绘制 render 树（paint），绘制页面像素信息。</li></ul></li> <li>整合图层，得到页面：
<ul><li>浏览器会将各层的信息发送给 GPU，GPU将各层合成（composite），显示在屏幕上。（复杂的视图层会给这个阶段的 GPU 计算带来一些压力，在实际应用中为了优化动画性能，我们有时会手动区分不同的图层）。</li></ul></li></ol> <p>之后每当一个新元素加入到这个 DOM 树当中，浏览器便会通过 CSS 引擎查遍 CSS 样式表，找到符合该元素的样式规则应用到这个元素上，然后再重新去绘制它。</p> <p>下面通过一个例子来说明：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ie=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Web app lifecycle<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
  <span class="token selector">#first</span> <span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">#second</span> <span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>first<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token comment">/**
     * @description 定义一个函数用于向一个元素增加一条信息
     */</span>
    <span class="token keyword">function</span> <span class="token function">addMessage</span><span class="token punctuation">(</span><span class="token parameter">element<span class="token punctuation">,</span> message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> messageElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      messageElement<span class="token punctuation">.</span>textContent <span class="token operator">=</span> message<span class="token punctuation">;</span>
      element<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>messageElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'second'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这个时候 脚本阻塞了 dom 的构建</span>
    <span class="token keyword">const</span> first <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'first'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">addMessage</span><span class="token punctuation">(</span>first<span class="token punctuation">,</span> <span class="token string">&quot;Page loading&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'DOM fully loaded and parsed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'page is fully loaded'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>second<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> second <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'second'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">addMessage</span><span class="token punctuation">(</span>second<span class="token punctuation">,</span> <span class="token string">&quot;Event: mousemove&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> second <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'second'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">addMessage</span><span class="token punctuation">(</span>second<span class="token punctuation">,</span> <span class="token string">'Event: click'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><p>注意：当浏览器在页面构建阶段遇到了脚本节点，它会停止 HTML 和 DOM 的构建，转而开始执行 JavaScript 代码，也就是执行包含在脚本元素的全局 JavaScript 代码（以及由全局代码执行中调用的函数代码）。直到 JavaScript 引擎执行到了脚本元素中 JavaScript 代码的最后一行，浏览器就退出了 JavaScript 执行模式，并继续余下的 HTML 构建为 DOM 节点。在这期间，如果浏览器再遇到脚本元素，那么从 HTML 到 DOM 的构建再次暂停，JavaScript 引擎运行环境开始执行余下的 JavaScript 代码。</p> <p>需要重点注意：JavaScript 应用在此时依然会保持着全局状态。所有在某个 JavaScript 代码执行期间用户创建的全局变量都能正常被其他脚本元素中的 JavaScript 代码所访问到。其原因在于全局 Window 对象会存在于整个页面的生存期之间，在它上面存储着所有的 JavaScript 变量。只要还有没处理完的 HTML 元素和没执行完的 JavaScript，下面两个步骤就会一直交替执行。</p> <p>所有详细步骤都已经略去，渲染完毕后就是 load 事件了。</p> <p><img src="/Notebook/assets/img/page-parse.c76a82c5.png" alt="page"></p> <h3 id="load-事件与-domcontentloaded-事件的先后"><a href="#load-事件与-domcontentloaded-事件的先后" class="header-anchor">#</a> load 事件与 DOMContentLoaded 事件的先后</h3> <ul><li>当 <code>DOMContentLoaded</code> 事件触发时，仅当 DOM 加载完成，不包括样式表，图片（譬如如果有 async 加载的脚本就不一定完成）</li> <li>当 <code>onload</code> 事件触发时，页面上所有的 DOM，样式表，脚本，图片都已经加载完成了。（渲染完毕了）</li></ul> <p>所以，顺序是：<code>DOMContentloaded</code> -&gt; <code>load</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'DOM fully loaded and parsed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'page is fully loaded'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="告别阻塞：css-与-js-的加载顺序优化"><a href="#告别阻塞：css-与-js-的加载顺序优化" class="header-anchor">#</a> 告别阻塞：CSS 与 JS 的加载顺序优化</h3> <p>HTML、CSS 和 JS，都具有阻塞渲染的特性。</p> <p>HTML 阻塞，天经地义————没有 HTML，何来 DOM？没有 DOM，渲染和优化，都是空谈。</p> <h4 id="css-加载是否会阻塞-dom-树渲染？"><a href="#css-加载是否会阻塞-dom-树渲染？" class="header-anchor">#</a> css 加载是否会阻塞 dom 树渲染？</h4> <p>这里说的是头部引入 css 的情况。</p> <p>首先，我们都知道：<strong>css 是由单独的下载线程异步下载的。</strong></p> <p>然后再说以下几个现象：</p> <ul><li>css 加载不会阻塞 <code>DOM 树</code>解析（异步加载时 DOM 照常构建）。</li> <li>但会阻塞 <code>render 树</code>（由 CSSOM 树与 DOM树结合）渲染（渲染时需等 css 加载完毕，因为 render 树需要 css 信息）。</li></ul> <p>这可能也是浏览器的一种优化机制。</p> <p>因为当你加载 css 的时候，可能会修改下面 DOM 节点的样式，如果 css 加载不阻塞 <code>render 树</code>的渲染，那么当 css 加载完之后，render 树可能又得重新<code>重绘或者回流</code>了，这就造成了一些没有必要的损耗。所以干脆就先把 DOM 树的结构先解析完，把可以做的工作做完，然后等 css 加载完之后，再根据最终的样式来渲染 <code>render 树</code>，这种做法性能方面确实会比较好一点。</p> <p>在刚刚的过程中，我们提到 DOM 和 CSSOM 合力才能构建渲染。这一点会给性能造成严重影响：默认情况下，CSS 是阻塞的资源。浏览器在构建 CSSOM 的过程中，不会渲染任何已经处理的内容。即便 DOM 已经解析完毕了，只要 CSSOM 不 OK，那么渲染这个事情就不 OK（这主要是为了避免没有 CSS 的 HTML 页面丑陋地“裸奔”在用户眼前）。</p> <p>我们知道，只有当我们开始解析 HTML 后、解析到 link 标签或者 style 标签时，CSS 才登场，CSSOM 的构建才开始。很多时候，DOM 不得不等待 CSSOM。因此我们可以这样总结：</p> <blockquote><p>CSS 是阻塞渲染的资源，需要将它尽早、尽快地下载到客户端，以便缩短首次渲染的时间。</p></blockquote> <p>事实上，现在很多团队已经做到了尽早（将 CSS 放在 head 标签里）和尽快（启用 CDN 实现静态资源加载速度的优化。）这个“把 CSS 往前放”的动作它是由 CSS 的特性决定的。</p> <h4 id="js-的阻塞"><a href="#js-的阻塞" class="header-anchor">#</a> JS 的阻塞</h4> <p>在首次渲染过程，JS 并不是一个非登场不可的角色——没有 JS，CSSOM 和 DOM 照样可以组成渲染树，页面依然会呈现——即使它毫无交互。</p> <p>JS 的作用在于修改，它帮助我们修改网页的方方面面：内容、样式以及它如何响应用户交互。这“方方面面”的修改，本质上都是对 DOM 和 CSSDOM 进行修改。因此 JS 的执行会阻止 CSSOM，在我们不作显式声明的情况下，它也会阻塞 DOM。</p> <p>我们通过一个例子来理解一下这个机制：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ie=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>JS 阻塞测试<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
    <span class="token selector">#container</span> <span class="token punctuation">{</span>
      <span class="token property">background-color</span><span class="token punctuation">:</span> yellow<span class="token punctuation">;</span>
      <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
      <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- &lt;script src=&quot;../examples/JS阻塞.js&quot;&gt;&lt;/script&gt; --&gt;</span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token comment">// 尝试获取 container 元素</span>
    <span class="token keyword">var</span> container <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'container :'</span><span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">;</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- &lt;script src=&quot;../examples/JS阻塞.js&quot;&gt;&lt;/script&gt; --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token comment">// 尝试获取 container 元素</span>
    <span class="token keyword">var</span> container <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'container :'</span><span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 输出 container 元素此刻的背景色</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'container bgColor'</span><span class="token punctuation">,</span> <span class="token function">getComputedStyle</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">.</span>backgroundColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
    <span class="token selector">#container</span> <span class="token punctuation">{</span>
      <span class="token property">background-color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>三个 console 的结果分别是：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>container : null
container : &lt;div id=​&quot;container&quot;&gt;​&lt;/div&gt;​
container bgColor rgb(255, 255, 0)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>本例仅使用了内联 JS 做测试，感兴趣的同学可以把这部分 JS 当作外部文件引入看看效果——它们的表现一致。</p> <p>第一次尝试获取 id 为 container 的 DOM 失败，这说明 JS 执行时阻塞了 DOM，后续的 DOM 无法构建；第二次才成功，这说明脚本块只能找到它前面构建好的元素。这两者结合起来，“阻塞 DOM”得到了验证。再看第三个 console，尝试获取 CSS 样式，获取的是 JS 代码执行前的背景色（yellow），而非后续设定的新样式（blue），说明 CSSOM 也被阻塞了。那么在阻塞的背后，到底发生了什么呢？</p> <p>这就是前面说的 JS 引擎与渲染引擎是互斥的。我们的 JS 代码在文档的何处插入，就在何处执行（script 标签没有设置 defer，async等属性）。当 HTML解析器遇到一个 script 标签时，它会暂停渲染过程，将控制权交给 JS 引擎。JS 引擎对内联的 JS 代码会直接执行，对外部 JS 文件还要先获取脚本、再进行执行。等 JS 引擎运行完毕，浏览器又会把控制权还给渲染引擎，继续 CSSOM 和 DOM 的构建。因此与其说 JS 把 CSS 和HTML 阻塞了，不如说是 JS 引擎抢走了渲染引擎的控制权。</p> <p>浏览器之所以可以让 JS 阻塞其他的活动，是因为它不知道 JS 会做说明改变，担心如果不阻止后续的操作，会造成混乱（DOM渲染混乱）。但是写 JS 的人知道 JS 会做什么改变。假如我们可以确认一个 JS 文件的执行时机并不一定非要是此时此刻，我们就可以通过对它使用 <code>defer</code> 和<code>async</code> 来避免不必要的阻塞，这里我们就引出了外部 JS的三种加载方式。</p> <ul><li>正常模式<div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>index.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div>这种情况下 JS 会阻塞浏览器，浏览器必须等待 <code>index.js</code> 加载和执行完毕才能去做其他事情。</li> <li>async 模式<div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">async</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>index.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div>async 模式下，JS 不会阻塞浏览器做任何其他的事情，它的加载是异步的（异步 http 请求线程），当它加载结束，<strong>JS 脚本会立即执行。</strong>（浏览器渲染引擎线程空闲时）</li> <li>defer 模式：<div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">defer</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>index.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div>defer 模式下，JS 的加载是异步的，**执行是被推迟的。**等整个文档解析完成、<code>DOMContentLoaded</code> 事件即将被触发时，被标记了 defer 的 JS 文件才会开始依次执行。</li></ul> <p>从应用的角度来说，一般当我们的脚本与 DOM 元素和其他脚本之间的依赖关系不强时（这个其实通过 webpack + es6 规范基本可以解决模块依赖问题），我们会选用 <code>async</code>；当脚本依赖于 DOM 元素和其他脚本的执行结果时，我们会选用 <code>defer</code>。</p> <p>通过审时度势地向 script 标签添加 <code>async/defer</code>，我们就可以告诉浏览器在等待脚本可用期间不阻止其他的工作，这样可以显著提升性能。</p> <p>经过 webpack 打包后的代码，最终也是通过 script 标签被引入 html 文件中。</p> <p>补充：除了一个 JS 文件外，针对 JS 文件里面的代码层级，可以是通过异步编程（promise）来解决同步阻塞的问题。</p> <h2 id="从-event-loop-谈-js-的运行机制"><a href="#从-event-loop-谈-js-的运行机制" class="header-anchor">#</a> 从 Event Loop 谈 JS 的运行机制</h2> <p>单线程 == 一个调用栈 == one thing at a time（一个时间点做一件事）</p> <p>我们知道 JS 引擎是单线程的，这里会用到上文中的几个概念：</p> <ul><li>JS 引擎线程</li> <li>事件触发线程</li> <li>定时触发器线程</li></ul> <p>然后再理解一个概念：</p> <ul><li>JS 分为同步任务和异步任务。</li> <li>同步任务都在主线程上执行难，形成一个<code>执行栈</code>。</li> <li>主线程之外，<strong>事件触发线程</strong>管理着一个<code>任务队列</code>，只要异步任务有了运行结果，就在<code>任务队列</code>之中放置一个事件。</li> <li>一旦<code>执行栈</code>中的所有同步任务执行完毕（此时 JS 引擎空闲），系统就会读取<code>任务队列</code>，将可运行的异步任务添加到可执行栈中，开始执行。</li></ul> <p><img src="/Notebook/assets/img/event-loop-1.2aaf1500.png" alt="event-loop-1"></p> <p>看到这里，应该可以理解了：为什么有时候 setTimeout 推入的事件不能准时执行？因为可能在它推入到事件列表时，主线程还不空闲，正在执行其他代码，所以自然有误差。</p> <h3 id="事件循环机制的进一步补充"><a href="#事件循环机制的进一步补充" class="header-anchor">#</a> 事件循环机制的进一步补充</h3> <p><img src="/Notebook/assets/img/event-loop-2.285ae868.png" alt="event-loop-2"></p> <p>上图描述就是：</p> <ul><li>主线程运行时会产生<strong>执行栈</strong>，栈中的代码调用某些 api 时，（当满足触发条件后，如 ajax 请求完毕）它们会在事件任务队列中添加各种事件。</li> <li>而栈中的代码执行完毕，就会读取事件队列中的事件，去执行那些回调。</li> <li>如此循环，“读取-处理-读取”</li> <li>注意，总是要等待栈中的代码执行完毕后才会去读取事件队列中的事件。</li></ul> <p>可以进入可视化工具<a href="http://latentflip.com/loupe/?code=bGV0IGEgPSAxOwogY29uc29sZS5sb2coYSkKICBmdW5jdGlvbiBtdWx0aXBseShhLCBiKSB7CiAgICAgIHJldHVybiBhICogYjsKICAgIH0gIAogICAgZnVuY3Rpb24gc3F1YXJlKG4pIHsKICAgICAgcmV0dXJuIG11bHRpcGx5KG4sIG4pOwogICAgfQogICAgZnVuY3Rpb24gcHJpbnRTdXFhcmUobikgewogICAgICBjb25zdCBzcXVhcmVkID0gc3F1YXJlKG4pOwogICAgICBjb25zb2xlLmxvZyhzcXVhcmVkKTsKICAgIH0KICAgIHByaW50U3VxYXJlKDQpOw%3D%3D!!!PGJ1dHRvbj5DbGljayBtZSE8L2J1dHRvbj4%3D" target="_blank" rel="noopener noreferrer">loupe<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，粘贴下面代码，看事件循环工作流程。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 事件循环</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hi'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// setTimeout(function() {</span>
<span class="token comment">//   console.log('there');</span>
<span class="token comment">// }, 5000);</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'there'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Jecyu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="单独说说定时器"><a href="#单独说说定时器" class="header-anchor">#</a> 单独说说定时器</h3> <p>上述事件机制的核心是：JS 引擎线程和事件触发线程。</p> <p>但事件上，里面还有一些隐藏细节，譬如调用 <code>setTimeout</code> 后，是如何等待特定时间后才添加到事件队列中的？</p> <p>它不是由 JS 引擎检测的，而是由<strong>定时器线程</strong>控制。</p> <p>为什么要单独的定时器线程？因为 JavaScript 引擎是单线程的，如果处于阻塞状态就会影响记时器的准确，因此很有必要单独开一个线程用来计时。</p> <p>什么时候会用到定时器线程？当使用 <code>setTimeout</code> 或 <code>setInterval</code> 时，它需要定时器线程计时，计时完成后就会将特定的事件推入事件队列中。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Jecyu'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Hi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>这段代码的作用是当 <code>1000</code> 毫秒计时完毕后（由定时器线程计时），将回调函数推入事件队列中，等待主线程执行</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Jecyu'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Hi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>这段代码的效果是最快的时间内将回调函数推入事件队列中，等待主线程执行。</p> <p>注意：</p> <ul><li>执行结果：先<code>Hi</code> 后，<code>Jecyu</code>。</li> <li>虽然代码的本意是0毫秒后就推入事件队列，但是 W3C 在 HTML 标准中规定，规定要求 <code>setTimeout</code> 中低于4ms的时间间隔算为4ms。（不过也有一说是不同浏览器有不同的最小时间设定)</li> <li>就算不等待 4ms，就算假设0毫秒就推入事件队列，也会先执行<code>Hi</code>（因为只有可执行栈内空了后才会主动读取事件队列）。</li></ul> <h3 id="settimeout-而不是-setinterval"><a href="#settimeout-而不是-setinterval" class="header-anchor">#</a> setTimeout 而不是 setInterval</h3> <p>用 <code>setTimeout</code> 模拟定期计时和直接使用 <code>setInterval</code> 是有区别的。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hi'</span><span class="token punctuation">)</span> <span class="token comment">// 执行代码需要时间，会导致误差</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>  
<span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>因为每次 setTimeout 计时到后就会去执行，然后执行一段时间后才会继续 setTimeout，中间就多了误差（误差多少与代码执行时间有关）</p> <p>而 setInterval 则是每次都精确的隔一段时间推入一个事件（但是，事件的实际执行时间不一定就准确，还有可能是这个事件还没执行完毕，下一个事件就来了。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment">// 如果这里花费时间很长的话（超过1s），将会导致一个问题，当前的事件还没执行完，后续的事件继续添加进来。</span>
 <span class="token comment">// 那么后续的回调执行事件频率会小于 1s 的间隔进行触发，解决：可以使用 setTimeout 来模拟 setInterval 执行。</span>
 <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 模拟执行时间</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hi'</span><span class="token punctuation">)</span> 
 <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>执行分析如图：</p> <p>而且 <code>setInterval</code> 有一些比较致命的问题就是：</p> <ul><li>累计效应（上面提到的），如果 <code>setInterval</code> 代码再（<code>setInerval</code>）再次添加到队列之前还没有完成执行，就会导致定时器代码连续运行好几次，而之间没有间隔。就算正常间隔执行，多个 setInterval 的代码执行时间可能会比预期小（因为代码执行需要一定时间）。</li> <li>而且把浏览器最小化显示等操作时，<code>setInterval</code> 并不是不执行程序，它会把 <code>setInterval</code> 的回调函数放到队列中，等浏览器窗口再次打开时，一瞬间全部执行完。</li></ul> <p>所以，鉴于这么多问题，目前一般认为的最佳方案是：用 <code>setTimeout</code> 模拟 <code>setInterval</code>，或者特殊场合（做动画）直接用 <code>requestAnimationFrame</code>。</p> <p>补充：JS</p> <h2 id="事件循环进阶：macrotask-与-microtask"><a href="#事件循环进阶：macrotask-与-microtask" class="header-anchor">#</a> 事件循环进阶：macrotask 与 microtask</h2> <p>上文中将 JS 事件循环机制梳理了一遍，在 ES5 的情况是够用了，但是在 ES6 盛行的现在，仍然会遇到一些问题，譬如下面这题：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>

Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script end'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>它的正确执行顺序是这样子的：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>script start
script end
promise1
promise2
setTimeout
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>为什么呢，因为 Promise 里有了一个新的概念：<code>microtask</code>。</p> <p>或者，进一步，JS 中分为两种任务类型：<code>macrotask</code> 和 <code>microtask</code>，在 ECMAScript 中，microtask 称为 <code>jobs</code>，macrotask 可称为 <code>task</code>。</p> <h3 id="它们的定义？区别？简单点可以按如下理解："><a href="#它们的定义？区别？简单点可以按如下理解：" class="header-anchor">#</a> 它们的定义？区别？简单点可以按如下理解：</h3> <ul><li>macrotask（又称为宏任务），可以理解是每次执行栈执行的代码就是一个宏任务（包括每次从事件队列中获取一个事件回调并放到执行栈中执行）
<ul><li>每一个 <code>task</code> 会从头到尾将这个任务执行完毕，不会执行其它。</li> <li>浏览器为了能够使得 JS 内部 task 与 DOM 任务能够有序的执行，会在一个 <code>task</code>执行结束后，在下一个 <code>task</code> 执行开始前，对页面进行重新渲染（<code>task-&gt;渲染-&gt;task-&gt;...</code>）。</li></ul></li> <li>micortask（又称为微任务），可以理解是在当前 <code>task</code> 执行结束后立即执行的任务。
<ul><li>也就是说，在当前 <code>task</code> 任务后，下一个 <code>task</code> 之前，在渲染之前</li> <li>所以它的响应速度比 <code>setTimeout</code> （setTimeout 是 <code>task</code>），会更快，因为无需等渲染。</li> <li>也就是说，在某一个 <code>microtask</code> 执行完后，就会将它执行期间产生的所有 <code>micortask</code> 都执行完毕（在渲染前）。
微任务使得我们能够在重新渲染 UI 之前执行指定的行为，避免不必要的 UI 重绘，UI 重绘会使应用状态不连续。</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span>macroTask <span class="token keyword">of</span> macroTaskQueue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1. Handle current MACRO-TASK</span>
  <span class="token function">handleMacroTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 2. Handle all MICRO-TASK</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>microTask <span class="token keyword">of</span> microTaskQueue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">handleMicroTask</span><span class="token punctuation">(</span>microTask<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="分别是什么样的场景会形成-macrotask-和-microtask-呢？"><a href="#分别是什么样的场景会形成-macrotask-和-microtask-呢？" class="header-anchor">#</a> 分别是什么样的场景会形成 macrotask 和 microtask 呢？</h3> <p><code>macrotask</code> 和 <code>micortask</code> 表示异步任务的两种分类，在挂起时，JS 引擎回将所有的任务按照类别分到这两个队列中。</p> <ul><li>**macrotask：**script（整体代码），<code>setTimeout</code>，<code>setInterval</code>，<code>setImmediate</code>，I/O，UI rendering等（可以看到，事件队列中的每一个事件都是一个 macrotask）。</li> <li><strong>microtask：</strong><code>Promise</code>（这里指浏览器实现的原生的 Promise），<code>process.nextTick</code> 、<code>Object.observe</code>、<code>MutationObserver</code>等。</li></ul> <p>补充：**在 node 环境下，process.nextTick 的优先级高于 Promise，**也就是可以简单理解为：在宏任务结束后会先执行微任务队列中的 <code>nextTickQueue</code> 部分呢，然后才会执行微任务中的 <code>Promise</code> 部分。</p> <p>看下面的例子输出：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 注意，new Promise是同步的，会马上执行function参数中的事情。</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">/// 这段代码运行的结果是 1 2 4 3 5</span>
<span class="token comment">/// process.nexTick 永远大于 promise.then，原因是在 Node 中，_tickCallback 在每一次执行完 TaskQueue 中的一个任务后被调用，而这个 _tickCallback 中实质上干了两件事：</span>
<span class="token comment">// 1. nextTickQueue 中所有任务执行掉</span>
<span class="token comment">// 2. 第一步执行完后执行 _runMicroTasks 函数，执行 microtask 中的部分（promise.then 注册的回调）</span>
<span class="token comment">// 所以 process.nextTick &gt; promise.then</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="结合线程来理解"><a href="#结合线程来理解" class="header-anchor">#</a> 结合线程来理解</h3> <ul><li><code>macrotask</code> 中的事件都是放在一个事件队列中的，而这个队列由<strong>事件触发线程</strong>维护。</li> <li><code>micortask</code> 中的所有微任务都是添加到微任务队列（Job Queues）中，等待当你 <code>macrotask</code>执行完毕后执行，而这个队列由 <code>JS 引擎线程维护</code>（因为它是在主线程下无缝执行的）。
如这里</li></ul> <p>所以，总结下运行机制：</p> <p>一个浏览器环境（浏览器内核）只能有一个事件循环（Event loop），而一个事件循环可以有多个<strong>任务队列（Task queue）</strong>，每个任务都有一个任务源（Task source）（timer 的回调、鼠标事件等）</p> <ul><li>相同任务源的任务，只能放到一个任务队列中。</li> <li>不同任务源的任务，可以放到不同任务队列中。</li> <li>同一个任务队列中的任务必须按先进先出的顺序执行。</li></ul> <p>具体看 HTML 规范，HTML的事件循环吧。
<a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loops" target="_blank" rel="noopener noreferrer">6.1.4 Event loops<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>执行流程：</p> <ul><li>执行一个宏任务（栈中没有就从时间队列中获取）。</li> <li>执行过程中如果遇到微任务，就将它添加到微任务的任务队列中。</li> <li>宏任务执行完毕后，立即执行当前微任务队列中的所有微任务（依次执行）。</li> <li>当前宏任务执行完毕，开始检查渲染，然后 GUI 线程接管渲染。</li> <li>渲染完毕后，JS 线程继续接管，开始下一个宏任务（从事件队列中获取）。</li></ul> <p>如图：</p> <p><img src="/Notebook/assets/img/event-loop-3.d3b32727.png" alt=""></p> <p>另外，请注意下 <code>Promise</code> 的 <code>polyfill</code> 与官方版本的区别：</p> <ul><li>官方版本中，是标准的 <code>microtask</code> 的形式。</li> <li>polyfill，一般都是通过 <code>setTimeout</code> 模拟的，所以是 <code>macrotask</code> 形式。</li> <li>请特别注意这两点区别</li></ul> <p>注意，有一些浏览器执行结果不一样（因为它们可能把 microtask 当成 macrotask 来执行了），请记住，有些浏览器可能不标准。</p> <h3 id="使用-mutationobserver-实现-microtask"><a href="#使用-mutationobserver-实现-microtask" class="header-anchor">#</a> 使用 MutationObserver 实现 microtask</h3> <h2 id="cookie-和-token-都存放在-header-中，为什么不会劫持-token？"><a href="#cookie-和-token-都存放在-header-中，为什么不会劫持-token？" class="header-anchor">#</a> cookie 和 token 都存放在 header 中，为什么不会劫持 token？</h2> <h2 id="介绍下如何实现-token-加密？"><a href="#介绍下如何实现-token-加密？" class="header-anchor">#</a> 介绍下如何实现 token 加密？</h2> <h2 id="数据库"><a href="#数据库" class="header-anchor">#</a> 数据库</h2> <h3 id="cookies，sessionstorage-和-localstorage-的区别"><a href="#cookies，sessionstorage-和-localstorage-的区别" class="header-anchor">#</a> cookies，sessionStorage 和 localStorage 的区别</h3> <p><code>cookie</code> 是网站为了标识用户身份而储存在用户本地终端（Client Side） 上的数据（通常经过加密）。<code>cookie</code> 数据始终在同源的 http 请求中携带（即使不需要），它会在浏览器和服务器间来回传递。
<code>sessionStorage</code> 和 <code>localStorage</code> <strong>不会自动把数据发给服务器</strong>，仅在本地保存。</p> <p><strong>存储大小：</strong><code>cookie</code> 数据大小不能超过4k。<code>sessionStorage</code> 和<code>localStorage</code> 虽然也有存储大小的限制，但比 <code>cookie</code> 大得多，可以达到 5M 或更大。</p> <p><strong>有效期时间：</strong></p> <ul><li><code>localStorage</code> 存储持久数据，浏览器关闭后数据不丢失除非主动删除数据。（所以很多时候，需要在登录成功后，把旧的登录信息删掉）；</li> <li><code>sessionStorage</code> 数据在当前浏览器关闭后自动删除，每个 tab 页独立。</li> <li><code>cookie</code> 设置的 cookies 过期时间之前一直有效，即使窗口或浏览器关闭。</li></ul> <h4 id="应用"><a href="#应用" class="header-anchor">#</a> 应用</h4> <ol><li>尝试从cookie中获取session-key，如果有则继续判断是否具有用户信息和用户权限。如果无session-key则直接跳转到登录页。</li> <li>如果获取用户信息和用户权限的过程失败了，则清除session-key,并且跳转到登录页。 这个session-key是在用户登录成功后存入cookie的，过期时间为0.5天。</li></ol> <h2 id="输入一个url到浏览器页面展示都经历了哪些过程"><a href="#输入一个url到浏览器页面展示都经历了哪些过程" class="header-anchor">#</a> 输入一个url到浏览器页面展示都经历了哪些过程</h2> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <ul><li><a href="https://blog.csdn.net/u013510838/article/details/55211033" target="_blank" rel="noopener noreferrer">浏览器内核分析2 -- Webkit和Chromium源码结构<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>-- 简明清晰分析浏览器的内核源码</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/16/2019, 9:07:50 AM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/Notebook/frontend-web/css.html">
        CSS 项目实战总结（持续更新）
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Notebook/assets/js/app.accc6ad4.js" defer></script><script src="/Notebook/assets/js/4.2708dfb6.js" defer></script><script src="/Notebook/assets/js/25.d24012cb.js" defer></script>
  </body>
</html>
