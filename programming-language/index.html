<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CSharp | Naluduo&#39;s Notebook</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/Notebook/images/logo.jpeg">
    <meta name="description" content="📝每天记录一点点">
    <link rel="preload" href="/Notebook/assets/css/0.styles.b1f38863.css" as="style"><link rel="preload" href="/Notebook/assets/js/app.accc6ad4.js" as="script"><link rel="preload" href="/Notebook/assets/js/4.2708dfb6.js" as="script"><link rel="preload" href="/Notebook/assets/js/3.0cb2ce57.js" as="script"><link rel="prefetch" href="/Notebook/assets/js/10.868273fb.js"><link rel="prefetch" href="/Notebook/assets/js/100.1b860150.js"><link rel="prefetch" href="/Notebook/assets/js/101.93399fce.js"><link rel="prefetch" href="/Notebook/assets/js/102.6cbb290c.js"><link rel="prefetch" href="/Notebook/assets/js/103.8ff3d751.js"><link rel="prefetch" href="/Notebook/assets/js/104.0a2f7daa.js"><link rel="prefetch" href="/Notebook/assets/js/105.155f54c6.js"><link rel="prefetch" href="/Notebook/assets/js/106.4d7d0c3a.js"><link rel="prefetch" href="/Notebook/assets/js/107.8373d2e5.js"><link rel="prefetch" href="/Notebook/assets/js/108.8c95a110.js"><link rel="prefetch" href="/Notebook/assets/js/109.85bb673d.js"><link rel="prefetch" href="/Notebook/assets/js/11.fb903a5e.js"><link rel="prefetch" href="/Notebook/assets/js/110.52ad03a9.js"><link rel="prefetch" href="/Notebook/assets/js/111.956208cd.js"><link rel="prefetch" href="/Notebook/assets/js/112.2009b21f.js"><link rel="prefetch" href="/Notebook/assets/js/113.82a49283.js"><link rel="prefetch" href="/Notebook/assets/js/114.3b3a5472.js"><link rel="prefetch" href="/Notebook/assets/js/115.7ee78dd6.js"><link rel="prefetch" href="/Notebook/assets/js/116.7c8bbb6c.js"><link rel="prefetch" href="/Notebook/assets/js/117.d0907fb0.js"><link rel="prefetch" href="/Notebook/assets/js/118.3fb43a39.js"><link rel="prefetch" href="/Notebook/assets/js/119.ec92ea48.js"><link rel="prefetch" href="/Notebook/assets/js/12.29652b2c.js"><link rel="prefetch" href="/Notebook/assets/js/120.35ff1e70.js"><link rel="prefetch" href="/Notebook/assets/js/121.d8b18139.js"><link rel="prefetch" href="/Notebook/assets/js/122.648ffe96.js"><link rel="prefetch" href="/Notebook/assets/js/123.ed3b8b2f.js"><link rel="prefetch" href="/Notebook/assets/js/124.142abf67.js"><link rel="prefetch" href="/Notebook/assets/js/125.329314b8.js"><link rel="prefetch" href="/Notebook/assets/js/126.3a121da0.js"><link rel="prefetch" href="/Notebook/assets/js/127.022c6641.js"><link rel="prefetch" href="/Notebook/assets/js/128.547c2d5c.js"><link rel="prefetch" href="/Notebook/assets/js/129.ecb5273b.js"><link rel="prefetch" href="/Notebook/assets/js/13.fa32345e.js"><link rel="prefetch" href="/Notebook/assets/js/130.2a0d3a19.js"><link rel="prefetch" href="/Notebook/assets/js/131.c7a84d57.js"><link rel="prefetch" href="/Notebook/assets/js/132.07da823d.js"><link rel="prefetch" href="/Notebook/assets/js/133.f851d5af.js"><link rel="prefetch" href="/Notebook/assets/js/134.de309ceb.js"><link rel="prefetch" href="/Notebook/assets/js/135.0b83f289.js"><link rel="prefetch" href="/Notebook/assets/js/136.99ddbb8e.js"><link rel="prefetch" href="/Notebook/assets/js/137.9ce91c54.js"><link rel="prefetch" href="/Notebook/assets/js/138.d1e6c7df.js"><link rel="prefetch" href="/Notebook/assets/js/139.9e57818f.js"><link rel="prefetch" href="/Notebook/assets/js/14.e6b1fa67.js"><link rel="prefetch" href="/Notebook/assets/js/140.b97a7c8d.js"><link rel="prefetch" href="/Notebook/assets/js/141.db0d7e4b.js"><link rel="prefetch" href="/Notebook/assets/js/142.c9528ba0.js"><link rel="prefetch" href="/Notebook/assets/js/143.5cd17cfd.js"><link rel="prefetch" href="/Notebook/assets/js/144.c8a3236c.js"><link rel="prefetch" href="/Notebook/assets/js/145.ce3e815f.js"><link rel="prefetch" href="/Notebook/assets/js/146.5d5fdead.js"><link rel="prefetch" href="/Notebook/assets/js/147.7ca58039.js"><link rel="prefetch" href="/Notebook/assets/js/148.0528dfc6.js"><link rel="prefetch" href="/Notebook/assets/js/149.e219ef4f.js"><link rel="prefetch" href="/Notebook/assets/js/15.ede5e660.js"><link rel="prefetch" href="/Notebook/assets/js/150.367684ad.js"><link rel="prefetch" href="/Notebook/assets/js/151.bb7cc840.js"><link rel="prefetch" href="/Notebook/assets/js/152.50e2b443.js"><link rel="prefetch" href="/Notebook/assets/js/153.5143d68e.js"><link rel="prefetch" href="/Notebook/assets/js/154.5f75c4d5.js"><link rel="prefetch" href="/Notebook/assets/js/155.2c97d8c7.js"><link rel="prefetch" href="/Notebook/assets/js/156.04597855.js"><link rel="prefetch" href="/Notebook/assets/js/157.27a46ea1.js"><link rel="prefetch" href="/Notebook/assets/js/158.b0e54b34.js"><link rel="prefetch" href="/Notebook/assets/js/159.980a2077.js"><link rel="prefetch" href="/Notebook/assets/js/16.7cea63af.js"><link rel="prefetch" href="/Notebook/assets/js/160.dd7c4dd5.js"><link rel="prefetch" href="/Notebook/assets/js/161.076ac5ad.js"><link rel="prefetch" href="/Notebook/assets/js/162.49697d65.js"><link rel="prefetch" href="/Notebook/assets/js/163.022e5acc.js"><link rel="prefetch" href="/Notebook/assets/js/164.8ceaf7a5.js"><link rel="prefetch" href="/Notebook/assets/js/165.d613540e.js"><link rel="prefetch" href="/Notebook/assets/js/166.c0af31ff.js"><link rel="prefetch" href="/Notebook/assets/js/167.e42b9f57.js"><link rel="prefetch" href="/Notebook/assets/js/168.fa026739.js"><link rel="prefetch" href="/Notebook/assets/js/169.1f7e3137.js"><link rel="prefetch" href="/Notebook/assets/js/17.b7ca32be.js"><link rel="prefetch" href="/Notebook/assets/js/170.c4c1402a.js"><link rel="prefetch" href="/Notebook/assets/js/171.d1075313.js"><link rel="prefetch" href="/Notebook/assets/js/172.31ae23b8.js"><link rel="prefetch" href="/Notebook/assets/js/173.283df959.js"><link rel="prefetch" href="/Notebook/assets/js/174.8a34b9ed.js"><link rel="prefetch" href="/Notebook/assets/js/175.3678f179.js"><link rel="prefetch" href="/Notebook/assets/js/176.c26a8292.js"><link rel="prefetch" href="/Notebook/assets/js/177.783e1466.js"><link rel="prefetch" href="/Notebook/assets/js/178.9fa7eae4.js"><link rel="prefetch" href="/Notebook/assets/js/179.44544c8c.js"><link rel="prefetch" href="/Notebook/assets/js/18.dbdceb5d.js"><link rel="prefetch" href="/Notebook/assets/js/180.15b47c99.js"><link rel="prefetch" href="/Notebook/assets/js/181.73b4c3aa.js"><link rel="prefetch" href="/Notebook/assets/js/182.6a5b17a2.js"><link rel="prefetch" href="/Notebook/assets/js/183.28ec67b1.js"><link rel="prefetch" href="/Notebook/assets/js/184.2cccbd70.js"><link rel="prefetch" href="/Notebook/assets/js/185.de7fec26.js"><link rel="prefetch" href="/Notebook/assets/js/186.0932e1a1.js"><link rel="prefetch" href="/Notebook/assets/js/187.8c1730fc.js"><link rel="prefetch" href="/Notebook/assets/js/188.300dd277.js"><link rel="prefetch" href="/Notebook/assets/js/189.a1bee58b.js"><link rel="prefetch" href="/Notebook/assets/js/19.3d59d024.js"><link rel="prefetch" href="/Notebook/assets/js/190.7663ddc6.js"><link rel="prefetch" href="/Notebook/assets/js/191.7c824181.js"><link rel="prefetch" href="/Notebook/assets/js/192.e85118bd.js"><link rel="prefetch" href="/Notebook/assets/js/193.e954b79c.js"><link rel="prefetch" href="/Notebook/assets/js/194.f4adcdbc.js"><link rel="prefetch" href="/Notebook/assets/js/195.62735b27.js"><link rel="prefetch" href="/Notebook/assets/js/196.e0fafeec.js"><link rel="prefetch" href="/Notebook/assets/js/197.07c5e539.js"><link rel="prefetch" href="/Notebook/assets/js/198.cd686b20.js"><link rel="prefetch" href="/Notebook/assets/js/199.d51b40b4.js"><link rel="prefetch" href="/Notebook/assets/js/2.fa311fa4.js"><link rel="prefetch" href="/Notebook/assets/js/20.b4b2d322.js"><link rel="prefetch" href="/Notebook/assets/js/200.e245b2cd.js"><link rel="prefetch" href="/Notebook/assets/js/201.bd88542b.js"><link rel="prefetch" href="/Notebook/assets/js/202.6eefc25c.js"><link rel="prefetch" href="/Notebook/assets/js/203.98180f0d.js"><link rel="prefetch" href="/Notebook/assets/js/204.cb560045.js"><link rel="prefetch" href="/Notebook/assets/js/205.db965c26.js"><link rel="prefetch" href="/Notebook/assets/js/206.f692627d.js"><link rel="prefetch" href="/Notebook/assets/js/207.885fb929.js"><link rel="prefetch" href="/Notebook/assets/js/208.cb1bebca.js"><link rel="prefetch" href="/Notebook/assets/js/209.7dac81a0.js"><link rel="prefetch" href="/Notebook/assets/js/21.4c9bb6e4.js"><link rel="prefetch" href="/Notebook/assets/js/210.21121b1f.js"><link rel="prefetch" href="/Notebook/assets/js/211.cfd188b5.js"><link rel="prefetch" href="/Notebook/assets/js/212.c691e30a.js"><link rel="prefetch" href="/Notebook/assets/js/213.1a9a1f8d.js"><link rel="prefetch" href="/Notebook/assets/js/214.8c871f29.js"><link rel="prefetch" href="/Notebook/assets/js/215.7dd76ed3.js"><link rel="prefetch" href="/Notebook/assets/js/216.b9c6e46d.js"><link rel="prefetch" href="/Notebook/assets/js/217.bbb09b50.js"><link rel="prefetch" href="/Notebook/assets/js/218.3c93e6af.js"><link rel="prefetch" href="/Notebook/assets/js/219.735de793.js"><link rel="prefetch" href="/Notebook/assets/js/22.6908c05f.js"><link rel="prefetch" href="/Notebook/assets/js/220.3531b68a.js"><link rel="prefetch" href="/Notebook/assets/js/221.220d5f13.js"><link rel="prefetch" href="/Notebook/assets/js/222.9d0535e5.js"><link rel="prefetch" href="/Notebook/assets/js/223.f870f2a0.js"><link rel="prefetch" href="/Notebook/assets/js/224.0b56afa6.js"><link rel="prefetch" href="/Notebook/assets/js/225.cc5b31fd.js"><link rel="prefetch" href="/Notebook/assets/js/226.f4ee0adc.js"><link rel="prefetch" href="/Notebook/assets/js/227.eb919eea.js"><link rel="prefetch" href="/Notebook/assets/js/228.6a28f264.js"><link rel="prefetch" href="/Notebook/assets/js/229.2a8bf537.js"><link rel="prefetch" href="/Notebook/assets/js/23.afd0f5c6.js"><link rel="prefetch" href="/Notebook/assets/js/230.a2f5121e.js"><link rel="prefetch" href="/Notebook/assets/js/231.b10cb770.js"><link rel="prefetch" href="/Notebook/assets/js/232.ae7ad32a.js"><link rel="prefetch" href="/Notebook/assets/js/233.cca18966.js"><link rel="prefetch" href="/Notebook/assets/js/234.f9dd9c73.js"><link rel="prefetch" href="/Notebook/assets/js/235.c9a4bfbe.js"><link rel="prefetch" href="/Notebook/assets/js/236.61c4fb4d.js"><link rel="prefetch" href="/Notebook/assets/js/237.fed9e8fe.js"><link rel="prefetch" href="/Notebook/assets/js/238.86670bd9.js"><link rel="prefetch" href="/Notebook/assets/js/239.9ec3d9e2.js"><link rel="prefetch" href="/Notebook/assets/js/24.c1da07f8.js"><link rel="prefetch" href="/Notebook/assets/js/240.355da7ac.js"><link rel="prefetch" href="/Notebook/assets/js/241.f3420570.js"><link rel="prefetch" href="/Notebook/assets/js/242.ba7e4bd1.js"><link rel="prefetch" href="/Notebook/assets/js/243.2a52effa.js"><link rel="prefetch" href="/Notebook/assets/js/244.7f4499d8.js"><link rel="prefetch" href="/Notebook/assets/js/245.8574f4ac.js"><link rel="prefetch" href="/Notebook/assets/js/246.9b36bc23.js"><link rel="prefetch" href="/Notebook/assets/js/247.107c7608.js"><link rel="prefetch" href="/Notebook/assets/js/248.d8d1aa96.js"><link rel="prefetch" href="/Notebook/assets/js/249.00f19ac8.js"><link rel="prefetch" href="/Notebook/assets/js/25.d24012cb.js"><link rel="prefetch" href="/Notebook/assets/js/250.9b97127c.js"><link rel="prefetch" href="/Notebook/assets/js/251.7c05b25d.js"><link rel="prefetch" href="/Notebook/assets/js/252.b3ee0f29.js"><link rel="prefetch" href="/Notebook/assets/js/253.aac3e92c.js"><link rel="prefetch" href="/Notebook/assets/js/254.694f77fc.js"><link rel="prefetch" href="/Notebook/assets/js/255.7fc65b86.js"><link rel="prefetch" href="/Notebook/assets/js/256.f559aa7a.js"><link rel="prefetch" href="/Notebook/assets/js/257.3855a8f5.js"><link rel="prefetch" href="/Notebook/assets/js/258.0236288d.js"><link rel="prefetch" href="/Notebook/assets/js/259.4a65ba3f.js"><link rel="prefetch" href="/Notebook/assets/js/26.7a74bf43.js"><link rel="prefetch" href="/Notebook/assets/js/260.e110d77b.js"><link rel="prefetch" href="/Notebook/assets/js/261.6ca5e50b.js"><link rel="prefetch" href="/Notebook/assets/js/262.974a7503.js"><link rel="prefetch" href="/Notebook/assets/js/263.b93c02d1.js"><link rel="prefetch" href="/Notebook/assets/js/264.7e9188c1.js"><link rel="prefetch" href="/Notebook/assets/js/265.f68b4748.js"><link rel="prefetch" href="/Notebook/assets/js/266.04a71924.js"><link rel="prefetch" href="/Notebook/assets/js/267.256e6833.js"><link rel="prefetch" href="/Notebook/assets/js/268.18b52093.js"><link rel="prefetch" href="/Notebook/assets/js/269.ddca242f.js"><link rel="prefetch" href="/Notebook/assets/js/27.4af13b47.js"><link rel="prefetch" href="/Notebook/assets/js/270.c63a6e91.js"><link rel="prefetch" href="/Notebook/assets/js/271.9d5de52b.js"><link rel="prefetch" href="/Notebook/assets/js/272.b3d8fe27.js"><link rel="prefetch" href="/Notebook/assets/js/273.aac68402.js"><link rel="prefetch" href="/Notebook/assets/js/274.8b89191a.js"><link rel="prefetch" href="/Notebook/assets/js/275.c748ef07.js"><link rel="prefetch" href="/Notebook/assets/js/276.477c27a9.js"><link rel="prefetch" href="/Notebook/assets/js/277.1084dbc6.js"><link rel="prefetch" href="/Notebook/assets/js/278.98e8be2a.js"><link rel="prefetch" href="/Notebook/assets/js/279.61378737.js"><link rel="prefetch" href="/Notebook/assets/js/28.1f5903ad.js"><link rel="prefetch" href="/Notebook/assets/js/280.c2fda5bf.js"><link rel="prefetch" href="/Notebook/assets/js/281.4497cf31.js"><link rel="prefetch" href="/Notebook/assets/js/282.6b02e04d.js"><link rel="prefetch" href="/Notebook/assets/js/283.c579b5f7.js"><link rel="prefetch" href="/Notebook/assets/js/284.25f19977.js"><link rel="prefetch" href="/Notebook/assets/js/285.1567c42d.js"><link rel="prefetch" href="/Notebook/assets/js/286.8729eefe.js"><link rel="prefetch" href="/Notebook/assets/js/287.5109124c.js"><link rel="prefetch" href="/Notebook/assets/js/288.aff2f2a1.js"><link rel="prefetch" href="/Notebook/assets/js/289.11ee7f93.js"><link rel="prefetch" href="/Notebook/assets/js/29.9750e313.js"><link rel="prefetch" href="/Notebook/assets/js/290.a080d505.js"><link rel="prefetch" href="/Notebook/assets/js/291.8a62b81f.js"><link rel="prefetch" href="/Notebook/assets/js/292.8f2b2816.js"><link rel="prefetch" href="/Notebook/assets/js/293.a6073f5d.js"><link rel="prefetch" href="/Notebook/assets/js/294.8036aeb4.js"><link rel="prefetch" href="/Notebook/assets/js/295.4aaf6175.js"><link rel="prefetch" href="/Notebook/assets/js/296.22622ba4.js"><link rel="prefetch" href="/Notebook/assets/js/297.598bfede.js"><link rel="prefetch" href="/Notebook/assets/js/298.68edb938.js"><link rel="prefetch" href="/Notebook/assets/js/299.1f0f84fe.js"><link rel="prefetch" href="/Notebook/assets/js/30.5fc87000.js"><link rel="prefetch" href="/Notebook/assets/js/300.9c7600af.js"><link rel="prefetch" href="/Notebook/assets/js/301.0d95fc30.js"><link rel="prefetch" href="/Notebook/assets/js/302.b923baab.js"><link rel="prefetch" href="/Notebook/assets/js/303.d20079b9.js"><link rel="prefetch" href="/Notebook/assets/js/304.12a70192.js"><link rel="prefetch" href="/Notebook/assets/js/305.4ea4d8da.js"><link rel="prefetch" href="/Notebook/assets/js/306.282edebe.js"><link rel="prefetch" href="/Notebook/assets/js/307.3a37e321.js"><link rel="prefetch" href="/Notebook/assets/js/308.9221f97f.js"><link rel="prefetch" href="/Notebook/assets/js/309.c7c3ca1a.js"><link rel="prefetch" href="/Notebook/assets/js/31.18d6f54f.js"><link rel="prefetch" href="/Notebook/assets/js/310.5dde0eb7.js"><link rel="prefetch" href="/Notebook/assets/js/311.819aad83.js"><link rel="prefetch" href="/Notebook/assets/js/312.c2037cae.js"><link rel="prefetch" href="/Notebook/assets/js/313.52ee9f6c.js"><link rel="prefetch" href="/Notebook/assets/js/314.d0105766.js"><link rel="prefetch" href="/Notebook/assets/js/315.02d1beff.js"><link rel="prefetch" href="/Notebook/assets/js/316.69816787.js"><link rel="prefetch" href="/Notebook/assets/js/317.22d3b673.js"><link rel="prefetch" href="/Notebook/assets/js/318.483e3b5e.js"><link rel="prefetch" href="/Notebook/assets/js/319.bc984d80.js"><link rel="prefetch" href="/Notebook/assets/js/32.4ebe70c0.js"><link rel="prefetch" href="/Notebook/assets/js/320.d023db3c.js"><link rel="prefetch" href="/Notebook/assets/js/321.909f7332.js"><link rel="prefetch" href="/Notebook/assets/js/322.3b32a676.js"><link rel="prefetch" href="/Notebook/assets/js/323.9eb049fd.js"><link rel="prefetch" href="/Notebook/assets/js/324.5eae3717.js"><link rel="prefetch" href="/Notebook/assets/js/325.c9aa7e97.js"><link rel="prefetch" href="/Notebook/assets/js/326.2ec27286.js"><link rel="prefetch" href="/Notebook/assets/js/327.1096ac53.js"><link rel="prefetch" href="/Notebook/assets/js/328.17578c44.js"><link rel="prefetch" href="/Notebook/assets/js/329.f6f1b4fc.js"><link rel="prefetch" href="/Notebook/assets/js/33.4c170b35.js"><link rel="prefetch" href="/Notebook/assets/js/330.b84e8b18.js"><link rel="prefetch" href="/Notebook/assets/js/331.2ce71bd6.js"><link rel="prefetch" href="/Notebook/assets/js/332.d49f1076.js"><link rel="prefetch" href="/Notebook/assets/js/333.18846963.js"><link rel="prefetch" href="/Notebook/assets/js/334.07d784aa.js"><link rel="prefetch" href="/Notebook/assets/js/335.b2d18495.js"><link rel="prefetch" href="/Notebook/assets/js/336.27d6fdac.js"><link rel="prefetch" href="/Notebook/assets/js/337.e3b8a4d6.js"><link rel="prefetch" href="/Notebook/assets/js/338.4e17425d.js"><link rel="prefetch" href="/Notebook/assets/js/339.ca72b051.js"><link rel="prefetch" href="/Notebook/assets/js/34.4137a6d9.js"><link rel="prefetch" href="/Notebook/assets/js/340.a9c58e42.js"><link rel="prefetch" href="/Notebook/assets/js/341.015e17e5.js"><link rel="prefetch" href="/Notebook/assets/js/342.883cb2ad.js"><link rel="prefetch" href="/Notebook/assets/js/343.26e0511c.js"><link rel="prefetch" href="/Notebook/assets/js/344.5437611f.js"><link rel="prefetch" href="/Notebook/assets/js/345.26f6e7c4.js"><link rel="prefetch" href="/Notebook/assets/js/346.f7a3f23f.js"><link rel="prefetch" href="/Notebook/assets/js/347.27ccd6a8.js"><link rel="prefetch" href="/Notebook/assets/js/348.eff0a33d.js"><link rel="prefetch" href="/Notebook/assets/js/349.dd942ff5.js"><link rel="prefetch" href="/Notebook/assets/js/35.36b834f7.js"><link rel="prefetch" href="/Notebook/assets/js/350.9128eb0c.js"><link rel="prefetch" href="/Notebook/assets/js/351.e26fffba.js"><link rel="prefetch" href="/Notebook/assets/js/352.59cc3f38.js"><link rel="prefetch" href="/Notebook/assets/js/353.3ad59a15.js"><link rel="prefetch" href="/Notebook/assets/js/354.544a13c0.js"><link rel="prefetch" href="/Notebook/assets/js/355.d5f7255f.js"><link rel="prefetch" href="/Notebook/assets/js/356.7efdf2cd.js"><link rel="prefetch" href="/Notebook/assets/js/357.0b296e32.js"><link rel="prefetch" href="/Notebook/assets/js/358.a532d695.js"><link rel="prefetch" href="/Notebook/assets/js/359.01fd142f.js"><link rel="prefetch" href="/Notebook/assets/js/36.4ef6c0d1.js"><link rel="prefetch" href="/Notebook/assets/js/360.c71cb25e.js"><link rel="prefetch" href="/Notebook/assets/js/361.db70e72e.js"><link rel="prefetch" href="/Notebook/assets/js/362.670b7527.js"><link rel="prefetch" href="/Notebook/assets/js/363.ef0b3005.js"><link rel="prefetch" href="/Notebook/assets/js/364.63c1df56.js"><link rel="prefetch" href="/Notebook/assets/js/37.b0f3cb5d.js"><link rel="prefetch" href="/Notebook/assets/js/38.2ca6e078.js"><link rel="prefetch" href="/Notebook/assets/js/39.77206fea.js"><link rel="prefetch" href="/Notebook/assets/js/40.18d76f1c.js"><link rel="prefetch" href="/Notebook/assets/js/41.ed792d7a.js"><link rel="prefetch" href="/Notebook/assets/js/42.b983e72e.js"><link rel="prefetch" href="/Notebook/assets/js/43.3cdbe61c.js"><link rel="prefetch" href="/Notebook/assets/js/44.a4c1a462.js"><link rel="prefetch" href="/Notebook/assets/js/45.727fa84a.js"><link rel="prefetch" href="/Notebook/assets/js/46.a5665d33.js"><link rel="prefetch" href="/Notebook/assets/js/47.45efede1.js"><link rel="prefetch" href="/Notebook/assets/js/48.24e8e78b.js"><link rel="prefetch" href="/Notebook/assets/js/49.c426b444.js"><link rel="prefetch" href="/Notebook/assets/js/5.89a78b31.js"><link rel="prefetch" href="/Notebook/assets/js/50.41038e45.js"><link rel="prefetch" href="/Notebook/assets/js/51.3c34459c.js"><link rel="prefetch" href="/Notebook/assets/js/52.6df1c335.js"><link rel="prefetch" href="/Notebook/assets/js/53.69e41130.js"><link rel="prefetch" href="/Notebook/assets/js/54.591891ed.js"><link rel="prefetch" href="/Notebook/assets/js/55.d8d5bf6e.js"><link rel="prefetch" href="/Notebook/assets/js/56.c43a3733.js"><link rel="prefetch" href="/Notebook/assets/js/57.2c24f33c.js"><link rel="prefetch" href="/Notebook/assets/js/58.15a5e91b.js"><link rel="prefetch" href="/Notebook/assets/js/59.20cda08a.js"><link rel="prefetch" href="/Notebook/assets/js/6.f66bffc9.js"><link rel="prefetch" href="/Notebook/assets/js/60.beb8a99d.js"><link rel="prefetch" href="/Notebook/assets/js/61.2313bfd8.js"><link rel="prefetch" href="/Notebook/assets/js/62.ae93bded.js"><link rel="prefetch" href="/Notebook/assets/js/63.c0de4f2c.js"><link rel="prefetch" href="/Notebook/assets/js/64.b42cacb6.js"><link rel="prefetch" href="/Notebook/assets/js/65.719a31bb.js"><link rel="prefetch" href="/Notebook/assets/js/66.5c0128e7.js"><link rel="prefetch" href="/Notebook/assets/js/67.6107a140.js"><link rel="prefetch" href="/Notebook/assets/js/68.ac7fc4fa.js"><link rel="prefetch" href="/Notebook/assets/js/69.122426ed.js"><link rel="prefetch" href="/Notebook/assets/js/7.fbf1f9ec.js"><link rel="prefetch" href="/Notebook/assets/js/70.66e6b252.js"><link rel="prefetch" href="/Notebook/assets/js/71.28956fa1.js"><link rel="prefetch" href="/Notebook/assets/js/72.fcf3fb10.js"><link rel="prefetch" href="/Notebook/assets/js/73.947d80fa.js"><link rel="prefetch" href="/Notebook/assets/js/74.1d9d59de.js"><link rel="prefetch" href="/Notebook/assets/js/75.bbe5b314.js"><link rel="prefetch" href="/Notebook/assets/js/76.d018671b.js"><link rel="prefetch" href="/Notebook/assets/js/77.fca59f83.js"><link rel="prefetch" href="/Notebook/assets/js/78.4a545e59.js"><link rel="prefetch" href="/Notebook/assets/js/79.a039fbdf.js"><link rel="prefetch" href="/Notebook/assets/js/8.c69b9065.js"><link rel="prefetch" href="/Notebook/assets/js/80.d203faaa.js"><link rel="prefetch" href="/Notebook/assets/js/81.d193c9f3.js"><link rel="prefetch" href="/Notebook/assets/js/82.4675ade1.js"><link rel="prefetch" href="/Notebook/assets/js/83.ee538b4f.js"><link rel="prefetch" href="/Notebook/assets/js/84.8962589d.js"><link rel="prefetch" href="/Notebook/assets/js/85.76922906.js"><link rel="prefetch" href="/Notebook/assets/js/86.ec43215f.js"><link rel="prefetch" href="/Notebook/assets/js/87.46322abb.js"><link rel="prefetch" href="/Notebook/assets/js/88.5594f40a.js"><link rel="prefetch" href="/Notebook/assets/js/89.7f421583.js"><link rel="prefetch" href="/Notebook/assets/js/9.e0bdbf17.js"><link rel="prefetch" href="/Notebook/assets/js/90.853bb5b2.js"><link rel="prefetch" href="/Notebook/assets/js/91.fa605797.js"><link rel="prefetch" href="/Notebook/assets/js/92.f770f194.js"><link rel="prefetch" href="/Notebook/assets/js/93.1f9e6fb6.js"><link rel="prefetch" href="/Notebook/assets/js/94.2260cf7f.js"><link rel="prefetch" href="/Notebook/assets/js/95.6b1244de.js"><link rel="prefetch" href="/Notebook/assets/js/96.39617d63.js"><link rel="prefetch" href="/Notebook/assets/js/97.e4b8e984.js"><link rel="prefetch" href="/Notebook/assets/js/98.85e69ce3.js"><link rel="prefetch" href="/Notebook/assets/js/99.e2930b98.js">
    <link rel="stylesheet" href="/Notebook/assets/css/0.styles.b1f38863.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Notebook/" class="home-link router-link-active"><!----> <span class="site-name">Naluduo's Notebook</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Notebook/dailyRecord/" class="nav-link">
  📝日常记录
</a></div><div class="nav-item"><a href="/Notebook/blogs/" class="nav-link">
  📖文章合集
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端知识体系" class="dropdown-title"><span class="title">前端知识体系</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Notebook/frontend-web/" class="nav-link">
  基础知识
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/web-framework/" class="nav-link">
  🐂web 框架
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/rethink/" class="nav-link">
  🤔复盘
</a></li><li class="dropdown-item"><h4>
          ️️🧘算法修炼
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Notebook/understand-the-computer/" class="nav-link">
  理解计算机
</a></li><li class="dropdown-subitem"><a href="/Notebook/algorithm/dataStructure.html" class="nav-link">
  数据结构
</a></li><li class="dropdown-subitem"><a href="/Notebook/algorithm/algorithm.html" class="nav-link">
  算法分类
</a></li><li class="dropdown-subitem"><a href="/Notebook/dataBase/index.html" class="nav-link">
  数据库
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/Notebook/devops/" class="nav-link">
  ☁️运维
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/test/" class="nav-link">
  🚬测试
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/gis/" class="nav-link">
  🌍GIS
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/tools/" class="nav-link">
  ️️🖱️工具
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/network/" class="nav-link">
  ️️🐛网络工程
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/game-development/" class="nav-link">
  ️️🎮游戏开发
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/programming-language/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  🚶编程语言
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/programming-paradigm/" class="nav-link">
  编程范式
</a></li></ul></div></div><div class="nav-item"><a href="/Notebook/lint/" class="nav-link">
  ✔️编码规范&amp;协同开发
</a></div><div class="nav-item"><a href="/Notebook/math/" class="nav-link">
  𝜋数学
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="设计" class="dropdown-title"><span class="title">设计</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Notebook/design/" class="nav-link">
  🖌️UI
</a></li></ul></div></div><div class="nav-item"><a href="/Notebook/bookmark/" class="nav-link">
  🏷书签整理
</a></div><div class="nav-item"><a href="http://shooterblog.site/Learn-JS-Demo/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  📖知识脑图
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://naluduo.vip/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🔧个人博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🔗Github" class="dropdown-title"><span class="title">🔗Github</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/naluduo233" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Jecyu github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://naluduo233.github.io/language-learning/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  英语学习
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://naluduo233.github.io/Fe-Auto-Testing/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端自动化测试
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://naluduo233.github.io/JS-Event-Loop/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JS 事件循环机制
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://naluduo233.github.io/Web-Performance-Optimization/reference/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  微谈 Web 前端性能优化
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Notebook/dailyRecord/" class="nav-link">
  📝日常记录
</a></div><div class="nav-item"><a href="/Notebook/blogs/" class="nav-link">
  📖文章合集
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端知识体系" class="dropdown-title"><span class="title">前端知识体系</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Notebook/frontend-web/" class="nav-link">
  基础知识
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/web-framework/" class="nav-link">
  🐂web 框架
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/rethink/" class="nav-link">
  🤔复盘
</a></li><li class="dropdown-item"><h4>
          ️️🧘算法修炼
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Notebook/understand-the-computer/" class="nav-link">
  理解计算机
</a></li><li class="dropdown-subitem"><a href="/Notebook/algorithm/dataStructure.html" class="nav-link">
  数据结构
</a></li><li class="dropdown-subitem"><a href="/Notebook/algorithm/algorithm.html" class="nav-link">
  算法分类
</a></li><li class="dropdown-subitem"><a href="/Notebook/dataBase/index.html" class="nav-link">
  数据库
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/Notebook/devops/" class="nav-link">
  ☁️运维
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/test/" class="nav-link">
  🚬测试
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/gis/" class="nav-link">
  🌍GIS
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/tools/" class="nav-link">
  ️️🖱️工具
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/network/" class="nav-link">
  ️️🐛网络工程
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/game-development/" class="nav-link">
  ️️🎮游戏开发
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/programming-language/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  🚶编程语言
</a></li><li class="dropdown-item"><!----> <a href="/Notebook/programming-paradigm/" class="nav-link">
  编程范式
</a></li></ul></div></div><div class="nav-item"><a href="/Notebook/lint/" class="nav-link">
  ✔️编码规范&amp;协同开发
</a></div><div class="nav-item"><a href="/Notebook/math/" class="nav-link">
  𝜋数学
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="设计" class="dropdown-title"><span class="title">设计</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Notebook/design/" class="nav-link">
  🖌️UI
</a></li></ul></div></div><div class="nav-item"><a href="/Notebook/bookmark/" class="nav-link">
  🏷书签整理
</a></div><div class="nav-item"><a href="http://shooterblog.site/Learn-JS-Demo/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  📖知识脑图
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://naluduo.vip/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🔧个人博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🔗Github" class="dropdown-title"><span class="title">🔗Github</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/naluduo233" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Jecyu github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://naluduo233.github.io/language-learning/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  英语学习
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://naluduo233.github.io/Fe-Auto-Testing/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端自动化测试
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://naluduo233.github.io/JS-Event-Loop/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JS 事件循环机制
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://naluduo233.github.io/Web-Performance-Optimization/reference/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  微谈 Web 前端性能优化
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>🚶不止前端</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Notebook/programming-language/" aria-current="page" class="active sidebar-link">CSharp</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#c-的进化史" class="sidebar-link">C# 的进化史</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#简单的数据类型开始" class="sidebar-link">简单的数据类型开始</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#排序和过滤" class="sidebar-link">排序和过滤</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#处理未知数据" class="sidebar-link">处理未知数据</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#linq-简介" class="sidebar-link">LINQ 简介</a></li></ul></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#c-1-所搭建的核心基础" class="sidebar-link">C#1 所搭建的核心基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#委托" class="sidebar-link">委托</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#类型系统的特征" class="sidebar-link">类型系统的特征</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#值类型和引用类型" class="sidebar-link">值类型和引用类型</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#c-1-之外：构建于坚实基础之上的新特性" class="sidebar-link">C#1 之外：构建于坚实基础之上的新特性</a></li></ul></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#入门（初级）" class="sidebar-link">入门（初级）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#第一章-简介" class="sidebar-link">第一章 简介</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#环境：c-和-net-框架" class="sidebar-link">环境：C#和 .NET 框架</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#c-编程概述" class="sidebar-link">C# 编程概述</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#类型、存储和变量" class="sidebar-link">类型、存储和变量</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#类的基本概念" class="sidebar-link">类的基本概念</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#方法-2" class="sidebar-link">方法</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#深入理解类" class="sidebar-link">深入理解类</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#类和继承" class="sidebar-link">类和继承</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#表达式和运算符" class="sidebar-link">表达式和运算符</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#语句-2" class="sidebar-link">语句</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#结构" class="sidebar-link">结构</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#枚举" class="sidebar-link">枚举</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#数组" class="sidebar-link">数组</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#委托-2" class="sidebar-link">委托</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#事件" class="sidebar-link">事件</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#接口" class="sidebar-link">接口</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#转换" class="sidebar-link">转换</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#泛型" class="sidebar-link">泛型</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#枚举器和迭代器" class="sidebar-link">枚举器和迭代器</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#linq" class="sidebar-link">LINQ</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#异步编程" class="sidebar-link">异步编程</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#命名空间和程序集" class="sidebar-link">命名空间和程序集</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#异常" class="sidebar-link">异常</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#预处理指令" class="sidebar-link">预处理指令</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#反射和特性" class="sidebar-link">反射和特性</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#其他主题" class="sidebar-link">其他主题</a></li></ul></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#单元测试" class="sidebar-link">单元测试</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#基础（中级）" class="sidebar-link">基础（中级）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#协程" class="sidebar-link">协程</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#override-和-overload-以及-new-修饰符" class="sidebar-link">override 和 overload 以及 new 修饰符</a></li></ul></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#进阶活用（高级）" class="sidebar-link">进阶活用（高级）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#修改事件运算符的行为" class="sidebar-link">修改事件运算符的行为</a></li></ul></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#项目实战" class="sidebar-link">项目实战</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#底层原理" class="sidebar-link">底层原理</a></li><li class="sidebar-sub-header"><a href="/Notebook/programming-language/#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/Notebook/programming-language/node.html" class="sidebar-link">Node.js</a></li><li><a href="/Notebook/programming-language/java.html" class="sidebar-link">Java</a></li><li><a href="/Notebook/programming-language/c.html" class="sidebar-link">C 语言</a></li><li><a href="/Notebook/programming-language/ruby.html" class="sidebar-link">Ruby</a></li><li><a href="/Notebook/programming-language/lua.html" class="sidebar-link">Lua</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="csharp"><a href="#csharp" class="header-anchor">#</a> CSharp</h1> <p></p><div class="table-of-contents"><ul><li><a href="#c-的进化史">C# 的进化史</a><ul><li><a href="#简单的数据类型开始">简单的数据类型开始</a></li><li><a href="#排序和过滤">排序和过滤</a></li><li><a href="#处理未知数据">处理未知数据</a></li><li><a href="#linq-简介">LINQ 简介</a></li></ul></li><li><a href="#c-1-所搭建的核心基础">C#1 所搭建的核心基础</a><ul><li><a href="#委托">委托</a></li><li><a href="#类型系统的特征">类型系统的特征</a></li><li><a href="#值类型和引用类型">值类型和引用类型</a></li><li><a href="#c-1-之外：构建于坚实基础之上的新特性">C#1 之外：构建于坚实基础之上的新特性</a></li></ul></li><li><a href="#入门（初级）">入门（初级）</a><ul><li><a href="#第一章-简介">第一章 简介</a></li><li><a href="#环境：c-和-net-框架">环境：C#和 .NET 框架</a></li><li><a href="#c-编程概述">C# 编程概述</a></li><li><a href="#类型、存储和变量">类型、存储和变量</a></li><li><a href="#类的基本概念">类的基本概念</a></li><li><a href="#方法">方法</a></li><li><a href="#深入理解类">深入理解类</a></li><li><a href="#类和继承">类和继承</a></li><li><a href="#表达式和运算符">表达式和运算符</a></li><li><a href="#语句">语句</a></li><li><a href="#结构">结构</a></li><li><a href="#枚举">枚举</a></li><li><a href="#数组">数组</a></li><li><a href="#委托">委托</a></li><li><a href="#事件">事件</a></li><li><a href="#接口">接口</a></li><li><a href="#转换">转换</a></li><li><a href="#泛型">泛型</a></li><li><a href="#枚举器和迭代器">枚举器和迭代器</a></li><li><a href="#linq">LINQ</a></li><li><a href="#异步编程">异步编程</a></li><li><a href="#命名空间和程序集">命名空间和程序集</a></li><li><a href="#异常">异常</a></li><li><a href="#预处理指令">预处理指令</a></li><li><a href="#反射和特性">反射和特性</a></li><li><a href="#其他主题">其他主题</a></li></ul></li><li><a href="#单元测试">单元测试</a></li><li><a href="#基础（中级）">基础（中级）</a><ul><li><a href="#协程">协程</a></li><li><a href="#override-和-overload-以及-new-修饰符">override 和 overload 以及 new 修饰符</a></li></ul></li><li><a href="#进阶活用（高级）">进阶活用（高级）</a><ul><li><a href="#修改事件运算符的行为">修改事件运算符的行为</a></li></ul></li><li><a href="#项目实战">项目实战</a></li><li><a href="#底层原理">底层原理</a></li><li><a href="#参考资料">参考资料</a></li></ul></div><p></p> <h2 id="c-的进化史"><a href="#c-的进化史" class="header-anchor">#</a> C# 的进化史</h2> <h3 id="简单的数据类型开始"><a href="#简单的数据类型开始" class="header-anchor">#</a> 简单的数据类型开始</h3> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Product</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">readonly</span> <span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name
    <span class="token punctuation">{</span>
      <span class="token keyword">get</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Product<span class="token punctuation">&gt;</span></span> <span class="token function">GetSampleProducts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>Product<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Product</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">name</span><span class="token punctuation">:</span> <span class="token string">&quot;West Side Story&quot;</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">price</span><span class="token punctuation">:</span> <span class="token number">9.99m</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Product</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">name</span><span class="token punctuation">:</span> <span class="token string">&quot;Assassins&quot;</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">price</span><span class="token punctuation">:</span> <span class="token number">14.99m</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Product</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">name</span><span class="token punctuation">:</span> <span class="token string">&quot;Frogs&quot;</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">price</span><span class="token punctuation">:</span> <span class="token number">13.99m</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Product</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">name</span><span class="token punctuation">:</span> <span class="token string">&quot;Sweenty Todd&quot;</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">price</span><span class="token punctuation">:</span> <span class="token number">10.99m</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><ul><li>C# 1
<ul><li>只读属性、弱类型集合（ArrayList）</li> <li>弱类型的比较功能、不支持委托排序</li></ul></li> <li>C# 2
<ul><li>私有属性赋值方法强类型集合（泛型如 List）</li></ul></li> <li>C# 3
<ul><li>自动实现的属性、增强的集合和对象初始化</li></ul></li> <li>C# 4
<ul><li>用命名实参更清晰地调用构造函数和方法（<code>new Product(name: &quot;Sweenty Todd&quot;, price: 10.99m),</code>）</li></ul></li></ul> <h3 id="排序和过滤"><a href="#排序和过滤" class="header-anchor">#</a> 排序和过滤</h3> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">class</span> <span class="token class-name">ProductNameComparer</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IComparer</span></span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">Compare</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> x<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">object</span></span> y<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">Product</span> first <span class="token operator">=</span> <span class="token punctuation">(</span>Product<span class="token punctuation">)</span>x<span class="token punctuation">;</span>
      <span class="token class-name">Product</span> second <span class="token operator">=</span> <span class="token punctuation">(</span>Product<span class="token punctuation">)</span>y<span class="token punctuation">;</span>
      <span class="token keyword">return</span> first<span class="token punctuation">.</span>Name<span class="token punctuation">.</span><span class="token function">CompareTo</span><span class="token punctuation">(</span>second<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">MainClass</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SortTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">ArrayList</span> products <span class="token operator">=</span> Product<span class="token punctuation">.</span><span class="token function">GetSampleProducts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      products<span class="token punctuation">.</span><span class="token function">Sort</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ProductNameComparer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">Product</span> product <span class="token keyword">in</span> products<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>C# 1 必须引入一个额外的类型来帮助排序，并且出现需要强制转换类型的情况（有可能 ArrayList 出现字符串的类型）。在 foreach 也出现隐式转换类型。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">class</span> <span class="token class-name">ProductNameComparer</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IComparer<span class="token punctuation">&lt;</span>Product<span class="token punctuation">&gt;</span></span></span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">Compare</span><span class="token punctuation">(</span><span class="token class-name">Product</span> x<span class="token punctuation">,</span> <span class="token class-name">Product</span> y<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> x<span class="token punctuation">.</span>Name<span class="token punctuation">.</span><span class="token function">CompareTo</span><span class="token punctuation">(</span>y<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SortTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">List<span class="token punctuation">&lt;</span>Product<span class="token punctuation">&gt;</span></span> products <span class="token operator">=</span> Product<span class="token punctuation">.</span><span class="token function">GetSampleProducts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      products<span class="token punctuation">.</span><span class="token function">Sort</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ProductNameComparer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//products.Sort((x, y) =&gt; x.Name.CompareTo(y.Name)); // Lambda 表达式</span>

      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">Product</span> product <span class="token keyword">in</span> products<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><div class="language-cs line-numbers-mode"><pre class="language-cs"><code> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">FindTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">List<span class="token punctuation">&lt;</span>Product<span class="token punctuation">&gt;</span></span> products <span class="token operator">=</span> Product<span class="token punctuation">.</span><span class="token function">GetSampleProducts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">Predicate<span class="token punctuation">&lt;</span>Product<span class="token punctuation">&gt;</span></span> test <span class="token operator">=</span> <span class="token keyword">delegate</span> <span class="token punctuation">(</span><span class="token class-name">Product</span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> p<span class="token punctuation">.</span>Price <span class="token operator">&gt;</span> <span class="token number">10m</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token class-name">List<span class="token punctuation">&lt;</span>Product<span class="token punctuation">&gt;</span></span> matches <span class="token operator">=</span> products<span class="token punctuation">.</span><span class="token function">FindAll</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token class-name">Action<span class="token punctuation">&lt;</span>Product<span class="token punctuation">&gt;</span></span> print <span class="token operator">=</span> Console<span class="token punctuation">.</span>WriteLine<span class="token punctuation">;</span>

      matches<span class="token punctuation">.</span><span class="token function">ForEach</span><span class="token punctuation">(</span>print<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">Product</span> product <span class="token keyword">in</span> products<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li>C# 1
<ul><li>表达式</li> <li>允许列表保持未排序状态</li> <li>条件和操作紧密耦合</li> <li>两者都是硬编码</li></ul></li> <li>C# 2
<ul><li>委托比较</li> <li>匿名方法</li> <li>条件和操作分开</li> <li>匿名方法使委托变得简单</li></ul></li> <li>C# 3
<ul><li>扩展方法</li> <li>允许列表保持未排序状态</li> <li>Lambda 表达式使条件变得更容易阅读</li></ul></li> <li>C# 4 用命名实参更清晰地调用构造函数和方法</li></ul> <h3 id="处理未知数据"><a href="#处理未知数据" class="header-anchor">#</a> 处理未知数据</h3> <h4 id="表示未知的价格"><a href="#表示未知的价格" class="header-anchor">#</a> 表示未知的价格</h4> <p>可以将 null 值传递</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">readonly</span> <span class="token class-name"><span class="token keyword">decimal</span><span class="token punctuation">?</span></span> price<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">decimal</span><span class="token punctuation">?</span></span> Price
    <span class="token punctuation">{</span>
      <span class="token keyword">get</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">return</span> price<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="可选参数和默认值"><a href="#可选参数和默认值" class="header-anchor">#</a> 可选参数和默认值</h4> <p>有时你并不想给出方法所需的所有东西，比如对于某个特定参数，你可能总是会使用同样的值。传统的解决方案是对该方法进行重载，现在 C# 4 引入的可选参数<code>（optional parameter）</code>可以简化这一操作。</p> <p>在 Product 类型的 C# 4 版本中，构造函数接收产品的名称和价格。在 C# 2 和 C# 3 中，我们可以将价格设置为可空的 decimal 类型，<u>但现在我们假设大多数产品都不包含价格。</u>如果能够像下面这样初始化产品就再好不过了：</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name">Product</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Product</span><span class="token punctuation">(</span><span class="token string">&quot;Unreleased product&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在 C#4 之前，我们只能添加一个 Product <code>构造函数的重载</code>来实现这一目的。而使用 C#4 可以为价格参数声明一个默认值。（如果函数内部的逻辑是一样的，则可以用默认参数替代部分的重载，如果根据参数不同实现不同的逻辑，还是使用重载方便）</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">public</span> <span class="token function">Product</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">decimal</span><span class="token punctuation">?</span></span> price <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> price<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>C# 1
<ul><li>要么维护一个标志（像 || 这样），要么更改引用类型的语义，要么利用一个魔数。</li></ul></li> <li>C# 2
<ul><li>可控类型(给属性添加 <code>?</code> 修饰符，即可传入 null)避免了采用 C# 1 的各种繁琐的方案。语法糖进一步简化了编程。</li></ul></li> <li>C# 3
<ul><li>可选参数简化了默认设置</li></ul></li></ul> <h3 id="linq-简介"><a href="#linq-简介" class="header-anchor">#</a> LINQ 简介</h3> <p>LINQ （Language Integrated Query，语言集成查询），是 C# 3 的核心。顾名思义，LINQ 是关于查询的，其目的是使用一致的语法和特性，以一种易阅读、可组合的方式，使对多<code>数据源</code>的查询变得简单，它是声明式风格（即告诉想要的结构 what）</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">LINQTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">List<span class="token punctuation">&lt;</span>Product<span class="token punctuation">&gt;</span></span> products <span class="token operator">=</span> Product<span class="token punctuation">.</span><span class="token function">GetSampleProducts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>Product<span class="token punctuation">&gt;</span></span> filtered <span class="token operator">=</span> <span class="token keyword">from</span> <span class="token class-name">Product</span> p <span class="token keyword">in</span> products
                                      <span class="token keyword">where</span> <span class="token class-name">p</span><span class="token punctuation">.</span>Price <span class="token operator">&gt;</span> <span class="token number">10</span>
                                      <span class="token keyword">select</span> p<span class="token punctuation">;</span>
      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">Product</span> product <span class="token keyword">in</span> filtered<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>连接（joining）、过滤（filtering）、排序（ordering）和投影（projecting）</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">LINQTest2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">List<span class="token punctuation">&lt;</span>Product<span class="token punctuation">&gt;</span></span> products <span class="token operator">=</span> Product<span class="token punctuation">.</span><span class="token function">GetSampleProducts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">List<span class="token punctuation">&lt;</span>Supplier<span class="token punctuation">&gt;</span></span> suppliers <span class="token operator">=</span> Supplier<span class="token punctuation">.</span><span class="token function">GetSampleSuppliers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name"><span class="token keyword">var</span></span> filtered <span class="token operator">=</span> <span class="token keyword">from</span> p <span class="token keyword">in</span> products
                     <span class="token keyword">join</span> s <span class="token keyword">in</span> suppliers
                     <span class="token keyword">on</span> p<span class="token punctuation">.</span>supplierID equals s<span class="token punctuation">.</span>SupplierID <span class="token comment">// 选择有配置的供应商</span>
                     <span class="token keyword">where</span> <span class="token class-name">p</span><span class="token punctuation">.</span>Price <span class="token operator">&gt;</span> <span class="token number">10</span>
                     <span class="token keyword">orderby</span> s<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> p<span class="token punctuation">.</span>Name <span class="token comment">// 先按供货商排序，再按产品名排序</span>
                     <span class="token keyword">select</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> SupplierName <span class="token operator">=</span> s<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> ProductName <span class="token operator">=</span> p<span class="token punctuation">.</span>Name <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 嵌套对象</span>
      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> v <span class="token keyword">in</span> filtered<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Supplier={0}; Product={1}&quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span>SupplierName<span class="token punctuation">,</span> v<span class="token punctuation">.</span>ProductName<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="查询-xml"><a href="#查询-xml" class="header-anchor">#</a> 查询 XML</h4> <h4 id="剖析-net-平台"><a href="#剖析-net-平台" class="header-anchor">#</a> 剖析 .NET 平台</h4> <p>C# 语言是由它的规范定义的。C# 规范描述了 C# 源代码的格式，其中包括语法和行为。平台需要同时支持值类型和引用类型，另外还要支持垃圾回收。</p> <p>任何平台只要支持要求的特性，C# 编译器就可以以它为目标平台。</p> <h5 id="运行时"><a href="#运行时" class="header-anchor">#</a> 运行时</h5> <h5 id="框架库"><a href="#框架库" class="header-anchor">#</a> 框架库</h5> <h2 id="c-1-所搭建的核心基础"><a href="#c-1-所搭建的核心基础" class="header-anchor">#</a> C#1 所搭建的核心基础</h2> <h3 id="委托"><a href="#委托" class="header-anchor">#</a> 委托</h3> <blockquote><p><a href="https://baike.baidu.com/item/%E5%A7%94%E6%89%98/7900553" target="_blank" rel="noopener noreferrer">委托<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是一个类，它定义了方法的类型，<code>使得可以将方法当作另一个方法的参数来进行传递，这种将方法动态地赋给参数的做法</code>，可以避免在程序中大量使用 If-Else(Switch) 语句，同时使得程序具有更好的可扩展性。——百度百科</p></blockquote> <p>这里的委托其实是 C# 静态类型面向对象的一个声明，有点类似在 JS 中每个函数都是对象，自然也是可以当作另外一个方法的参数进行传递。只不过这里的委托可以是一个装有调用方法列表的容器。</p> <p>.NET 中的委托是类型安全的，委托会检测它所保存的函数引用是否和声明的委托匹配。</p> <p>当我们用 <code>delegate</code> 关键字声明委托时，<code>编译器自动为我们生成类</code>。类的名字即为委托变量名，访问类型为定义的委托访问类型。如上例中，public delegate void CallBack(string name, int number); 定义的委托对应的类为 CallBack，访问类型为public，该类继承自<code>[mscorlib]System.MulticastDelegate</code>。如果我们定义委托的访问类型为 private 或者 protected，则对应的委托类的访问类型为private 或者 protected。但是任何委托都继承自[mscorlib]System.MulticastDelegate。</p> <p>你可以把 <code>delegate</code> 看做一个包含有序方法列表的对象，这些方法具有相同的签名和返回类型。</p> <ul><li>方法的列表称为调用列表。</li> <li>委托保存的方法可以来自任何类或结构，只要它们在下面两点匹配：
<ul><li>委托的返回类型；</li> <li>委托的签名（包括 ref 和 out 修饰符）。</li></ul></li> <li>调用列表中的方法可以是实例方法也可以是静态方法。</li> <li>在调用委托的时候，会执行其调用列表中的所有方法。</li></ul> <p><img src="/Notebook/assets/img/delegate-as-methods.95f3ea2f.png" alt=""></p> <p>在使用委托的时候，你可以像对待一个类一样对待它。即先声明，再实例化。只是有点不同，类在实例化之后叫对象或实例，<code>但委托在实例化后仍叫委托。</code></p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">StringProcessor</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> input<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1. 声明委托类型</span>
  <span class="token keyword">class</span> <span class="token class-name">Person</span>
  <span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Say</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> message<span class="token punctuation">)</span> <span class="token comment">// 2. 声明兼容的实例方法</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0} says：{1}&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">class</span> <span class="token class-name">Background</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Note</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> note<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;({0})&quot;</span><span class="token punctuation">,</span> note<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">MainClass</span> <span class="token punctuation">{</span>
     <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token function">SimpleDelegateUse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SimpleDelegateUse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">Person</span> jon <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;Jon&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">Person</span> tom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;Tom&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">StringProcessor</span> jonsVoice<span class="token punctuation">,</span> tomsVoice<span class="token punctuation">,</span> background<span class="token punctuation">;</span> <span class="token comment">// 4. 创建 3 个委托实例</span>
      jonsVoice <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StringProcessor</span><span class="token punctuation">(</span>jon<span class="token punctuation">.</span>Say<span class="token punctuation">)</span><span class="token punctuation">;</span>
      tomsVoice <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StringProcessor</span><span class="token punctuation">(</span>tom<span class="token punctuation">.</span>Say<span class="token punctuation">)</span><span class="token punctuation">;</span>
      background <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StringProcessor</span><span class="token punctuation">(</span>Background<span class="token punctuation">.</span>Note<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">jonsVoice</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, son.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5. 调用委托实例</span>
      tomsVoice<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, Daddy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">background</span><span class="token punctuation">(</span><span class="token string">&quot;An airplane flies past.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h4 id="合并和删除委托"><a href="#合并和删除委托" class="header-anchor">#</a> 合并和删除委托</h4> <ul><li>可以为委托实例增加和移除方法（通过 <code>+-</code> 运算符）</li> <li>也可以组合多个委托生成新的委托实例</li></ul> <p>说明：委托是不易变的，创建了委托实例后，<code>有关它的一切就不能改变</code>。这样一来，就可以安全地传递委托实例的引用，并把它们与其他委托实例合并，同时不必担心<code>一致性</code>、<code>线程安全性</code>或者是否有其他人视图更改。在这一点上，委托实例和 string 是一样的。string 的实例也是不易变的。之所以提到 string，是因为 Delegate.Combine 和 String.Concat 很像——都是合并现有的实例来形成一个新实例，同时根本不更改原始对象。对于委托实例，原始调用列表被你连接到一起。注意，如果视图将 null 和委托实例合并到一起，null 将被视为带有空调用列表的一个委托。</p> <p><img src="/Notebook/assets/img/combing-delegate.9cb402b4.png" alt=""></p> <ul><li>Delegate.Combine</li> <li>Delegate.Remove(sourece, value) 将创建一个新的委托实例，其调用列表来自 source，value 中的列表则被删除。</li></ul> <p>调用委托实例时，它的所有操作（方法列表）都顺序执行。如果委托的签名具有一个非 void 的返回类型，则 Invoke 的返回值似乎是最后一个操作的返回值。</p> <p>可以使用委托实现发布-订阅消息中心</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token generic-method"><span class="token function">Callback</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">T</span> arg1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token generic-method"><span class="token function">Callback</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> U<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">T</span> arg1<span class="token punctuation">,</span> <span class="token class-name">U</span> arg2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * A messenger for events that have no parameters.
 */</span>
<span class="token keyword">static</span> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Messenger</span>
<span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> Delegate<span class="token punctuation">&gt;</span></span> eventTable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> Delegate<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">static</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AddListener</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> eventType<span class="token punctuation">,</span> <span class="token class-name">Callback</span> handler<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// Obtain a lock on the event table to keep this thread-safe.</span>
    <span class="token keyword">lock</span> <span class="token punctuation">(</span>eventTable<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// Create an entry for this event type if it doesn't already exist.</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>eventTable<span class="token punctuation">.</span><span class="token function">ContainsKey</span><span class="token punctuation">(</span>eventType<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        eventTable<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>eventType<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// Add the handler to the event.</span>
      eventTable<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>Callback<span class="token punctuation">)</span>eventTable<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span> <span class="token operator">+</span> handler<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token range operator">..</span><span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h4 id="对事件的简单讨论"><a href="#对事件的简单讨论" class="header-anchor">#</a> 对事件的简单讨论</h4> <p>事件不是委托实例，“事件”存在的首要理由和“属性”差不多——它们添加了一个封装层，实现发布/订阅模式（publish/subscribe）。</p> <p>表面上似乎能调用一个事件，但为了调用事件处理程序，实际做的事情是调用存储在字段中的委托实例。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// Messenger.cs v0.1 (20090925) by Rod Hyde (badlydrawnrod).</span>
<span class="token comment">//</span>
<span class="token comment">// This is a C# messenger (notification center) for Unity. It uses delegates</span>
<span class="token comment">// and generics to provide type-checked messaging between event producers and</span>
<span class="token comment">// event consumers, without the need for producers or consumers to be aware of</span>
<span class="token comment">// each other.</span>

<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>


<span class="token comment">// Callback.cs v0.1 (20090925) by Rod Hyde (badlydrawnrod).</span>
<span class="token comment">//</span>
<span class="token comment">// These are callbacks (delegates) that can be used by the messengers defined</span>
<span class="token comment">// in Messenger.cs.</span>

<span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token generic-method"><span class="token function">Callback</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">T</span> arg1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token generic-method"><span class="token function">Callback</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> U<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">T</span> arg1<span class="token punctuation">,</span> <span class="token class-name">U</span> arg2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * A messenger for events that have no parameters.
 */</span>
<span class="token keyword">static</span> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Messenger</span>
<span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> Delegate<span class="token punctuation">&gt;</span></span> eventTable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> Delegate<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">static</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AddListener</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> eventType<span class="token punctuation">,</span> <span class="token class-name">Callback</span> handler<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// Obtain a lock on the event table to keep this thread-safe.</span>
    <span class="token keyword">lock</span> <span class="token punctuation">(</span>eventTable<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// Create an entry for this event type if it doesn't already exist.</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>eventTable<span class="token punctuation">.</span><span class="token function">ContainsKey</span><span class="token punctuation">(</span>eventType<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        eventTable<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>eventType<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// Add the handler to the event.</span>
      eventTable<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>Callback<span class="token punctuation">)</span>eventTable<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span> <span class="token operator">+</span> handler<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RemoveListener</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> eventType<span class="token punctuation">,</span> <span class="token class-name">Callback</span> handler<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// Obtain a lock on the event table to keep this thread-safe.</span>
    <span class="token keyword">lock</span> <span class="token punctuation">(</span>eventTable<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// Only take action if this event type exists.</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>eventTable<span class="token punctuation">.</span><span class="token function">ContainsKey</span><span class="token punctuation">(</span>eventType<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// Remove the event handler from this event.</span>
        eventTable<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>Callback<span class="token punctuation">)</span>eventTable<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span> <span class="token operator">-</span> handler<span class="token punctuation">;</span>

        <span class="token comment">// If there's nothing left then remove the event type from the event table.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>eventTable<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
          eventTable<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>eventType<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> eventType<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token class-name">Delegate</span> d<span class="token punctuation">;</span>
    <span class="token comment">// Invoke the delegate only if the event type is in the dictionary.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>eventTable<span class="token punctuation">.</span><span class="token function">TryGetValue</span><span class="token punctuation">(</span>eventType<span class="token punctuation">,</span> <span class="token keyword">out</span> d<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// Take a local copy to prevent a race condition if another thread</span>
      <span class="token comment">// were to unsubscribe from this event.</span>
      <span class="token class-name">Callback</span> callback <span class="token operator">=</span> <span class="token punctuation">(</span>Callback<span class="token punctuation">)</span>d<span class="token punctuation">;</span>

      <span class="token comment">// Invoke the delegate if it's not null.</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>callback <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">/**
 * A messenger for events that have one parameter of type T.
 */</span>
<span class="token keyword">static</span> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Messenger<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span>
<span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> Delegate<span class="token punctuation">&gt;</span></span> eventTable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> Delegate<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">static</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AddListener</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> eventType<span class="token punctuation">,</span> <span class="token class-name">Callback<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> handler<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// Obtain a lock on the event table to keep this thread-safe.</span>
    <span class="token keyword">lock</span> <span class="token punctuation">(</span>eventTable<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// Create an entry for this event type if it doesn't already exist.</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>eventTable<span class="token punctuation">.</span><span class="token function">ContainsKey</span><span class="token punctuation">(</span>eventType<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        eventTable<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>eventType<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// Add the handler to the event.</span>
      eventTable<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>Callback<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">)</span>eventTable<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span> <span class="token operator">+</span> handler<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RemoveListener</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> eventType<span class="token punctuation">,</span> <span class="token class-name">Callback<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> handler<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// Obtain a lock on the event table to keep this thread-safe.</span>
    <span class="token keyword">lock</span> <span class="token punctuation">(</span>eventTable<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// Only take action if this event type exists.</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>eventTable<span class="token punctuation">.</span><span class="token function">ContainsKey</span><span class="token punctuation">(</span>eventType<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// Remove the event handler from this event.</span>
        eventTable<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>Callback<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">)</span>eventTable<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span> <span class="token operator">-</span> handler<span class="token punctuation">;</span>

        <span class="token comment">// If there's nothing left then remove the event type from the event table.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>eventTable<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
          eventTable<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>eventType<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> eventType<span class="token punctuation">,</span> <span class="token class-name">T</span> arg1<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token class-name">Delegate</span> d<span class="token punctuation">;</span>
    <span class="token comment">// Invoke the delegate only if the event type is in the dictionary.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>eventTable<span class="token punctuation">.</span><span class="token function">TryGetValue</span><span class="token punctuation">(</span>eventType<span class="token punctuation">,</span> <span class="token keyword">out</span> d<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// Take a local copy to prevent a race condition if another thread</span>
      <span class="token comment">// were to unsubscribe from this event.</span>
      <span class="token class-name">Callback<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> callback <span class="token operator">=</span> <span class="token punctuation">(</span>Callback<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">)</span>d<span class="token punctuation">;</span>

      <span class="token comment">// Invoke the delegate if it's not null.</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>callback <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>arg1<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">/**
 * A messenger for events that have two parameters of types T and U.
 */</span>
<span class="token keyword">static</span> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Messenger<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> U<span class="token punctuation">&gt;</span></span>
<span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> Delegate<span class="token punctuation">&gt;</span></span> eventTable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> Delegate<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">static</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AddListener</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> eventType<span class="token punctuation">,</span> <span class="token class-name">Callback<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> U<span class="token punctuation">&gt;</span></span> handler<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// Obtain a lock on the event table to keep this thread-safe.</span>
    <span class="token keyword">lock</span> <span class="token punctuation">(</span>eventTable<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// Create an entry for this event type if it doesn't already exist.</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>eventTable<span class="token punctuation">.</span><span class="token function">ContainsKey</span><span class="token punctuation">(</span>eventType<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        eventTable<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>eventType<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// Add the handler to the event.</span>
      eventTable<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>Callback<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> U<span class="token operator">&gt;</span><span class="token punctuation">)</span>eventTable<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span> <span class="token operator">+</span> handler<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RemoveListener</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> eventType<span class="token punctuation">,</span> <span class="token class-name">Callback<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> U<span class="token punctuation">&gt;</span></span> handler<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// Obtain a lock on the event table to keep this thread-safe.</span>
    <span class="token keyword">lock</span> <span class="token punctuation">(</span>eventTable<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// Only take action if this event type exists.</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>eventTable<span class="token punctuation">.</span><span class="token function">ContainsKey</span><span class="token punctuation">(</span>eventType<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// Remove the event handler from this event.</span>
        eventTable<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>Callback<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> U<span class="token operator">&gt;</span><span class="token punctuation">)</span>eventTable<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span> <span class="token operator">-</span> handler<span class="token punctuation">;</span>

        <span class="token comment">// If there's nothing left then remove the event type from the event table.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>eventTable<span class="token punctuation">[</span>eventType<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
          eventTable<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>eventType<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> eventType<span class="token punctuation">,</span> <span class="token class-name">T</span> arg1<span class="token punctuation">,</span> <span class="token class-name">U</span> arg2<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token class-name">Delegate</span> d<span class="token punctuation">;</span>
    <span class="token comment">// Invoke the delegate only if the event type is in the dictionary.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>eventTable<span class="token punctuation">.</span><span class="token function">TryGetValue</span><span class="token punctuation">(</span>eventType<span class="token punctuation">,</span> <span class="token keyword">out</span> d<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// Take a local copy to prevent a race condition if another thread</span>
      <span class="token comment">// were to unsubscribe from this event.</span>
      <span class="token class-name">Callback<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> U<span class="token punctuation">&gt;</span></span> callback <span class="token operator">=</span> <span class="token punctuation">(</span>Callback<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> U<span class="token operator">&gt;</span><span class="token punctuation">)</span>d<span class="token punctuation">;</span>

      <span class="token comment">// Invoke the delegate if it's not null.</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>callback <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br></div></div><h4 id="委托总结"><a href="#委托总结" class="header-anchor">#</a> 委托总结</h4> <ul><li>委托封装了包含特殊返回类型和一组参数的行为，类似包含单一方法的接口</li> <li>委托类型声明中所描述的类型签名决定了哪个方法可用于委托实例，同时决定了调用的签名。</li> <li>为了创建委托实例</li> <li>事件不是委托实例——只是成对的 add/remove 方法（类似于属性的取值方法/赋值方法）</li></ul> <h3 id="类型系统的特征"><a href="#类型系统的特征" class="header-anchor">#</a> 类型系统的特征</h3> <h4 id="c-在类型系统世界中的位置"><a href="#c-在类型系统世界中的位置" class="header-anchor">#</a> C# 在类型系统世界中的位置</h4> <p>C#1 的类型系统是<code>静态的、显式的和安全</code>的。</p> <p>你可能很期望<code>强</code> 这个形容词出现在列表中。但是，虽然大多数人都很容易就一种语言是否具有上面列出的特征取得共识，<u>但在判断语言是不是一种“强类型” 定义中，要求禁止任何形式的转换（不管是显式还是隐式转换）</u>，这明显会使 C# 失去资源。但在另一些定义中，却相当接近（甚至等同于）静态类型，这会使 C# 获得资格。虽然大多数文章和书籍都将 C# 描述成强类型的语言，<u>但最终的意义实际都是指它是一种静态类型的语言。</u></p> <h5 id="_1-静态类型和动态类型"><a href="#_1-静态类型和动态类型" class="header-anchor">#</a> 1. 静态类型和动态类型</h5> <p>C# 是静态类型的：每个变量都有一个特定的类型，而且该类型在编译时是已知的。只有该类型已知的操作才是允许，这一点由编译器强制生效。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">object</span></span> o <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>Lenght<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>从开发者的角度看上述代码，我们知道 o 的值是一个字符串。同时 string 类型有一个 Length 属性。<u>但是，编译器只把 o 看做 object 类型。如果想访问 Length 属性，必须让编译器知道 o 的值实际是一个字符串。</u></p> <p>与静态类型对应的是动态类型，后者可能具有多种形式。动态类型的实质是变量中含有值，<u>但那些值并不限于特定的类型，所以编译器不能执行相同形式的检查。</u>相反，执行环境试图采取一种合适的方式来理解引用值的给定表达式。例如，假定 C# 1 是动态类型的，就可以做下面的事情：</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code>o <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span><span class="token string">&quot;hi&quot;</span><span class="token punctuation">,</span> &quot;there<span class="token punctuation">}</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>通过执行时动态检查类型，最终会调用两个完全无关的 Length 属性—— String.Length 和 Array.Length。</p> <h5 id="_2-显式类型和隐式类型"><a href="#_2-显式类型和隐式类型" class="header-anchor">#</a> 2. 显式类型和隐式类型</h5> <p>显式类型和隐式类型只有在即ing天类型的语言中才有意义。对于显式类型来说，每个变量的类型都必须在声明中显式指明。隐式类型则允许编译器根据变量的用途来推断变量的类型。</p> <table><thead><tr><th>无效的 C#1——隐式类型</th> <th>有效的 C#1——显式类型</th></tr></thead> <tbody><tr><td>var s = &quot;hello&quot;;<br> var x = s.Length; <br> var twiceX = x * 2;</td> <td>string s = &quot;hello&quot;;<br> int x = s.Length; <br> int twiceX = x * 2;</td></tr></tbody></table> <p>无论隐式类型还是显式类型，变量的类型在编译时都是已知的——即使在代码中没有显式地声明。在动态类型的情况下，变量根本没有一个类型可供声明或推断。</p> <h5 id="_3-类型安全和类型不安全"><a href="#_3-类型安全和类型不安全" class="header-anchor">#</a> 3. 类型安全和类型不安全</h5> <p>强制类型转换，可能会出现转换错误，比如把 char 类型强制转换为 int 类型。</p> <h4 id="c-1-的类型系统何时不够用"><a href="#c-1-的类型系统何时不够用" class="header-anchor">#</a> C#1 的类型系统何时不够用</h4> <h5 id="_1-集合，强和弱"><a href="#_1-集合，强和弱" class="header-anchor">#</a> 1. 集合，强和弱</h5> <p>集合</p> <ul><li>数组——强类型——内建到语言和运行时中；</li> <li>System.Collections 命名空间中的弱类型集合</li> <li>System.Collections.Specialized 命名空间中的强类型集合。</li></ul> <p>弱类型</p> <ul><li>ArrayList</li> <li>Hashtable</li></ul> <h5 id="_2-缺乏协变的返回类型"><a href="#_2-缺乏协变的返回类型" class="header-anchor">#</a> 2. 缺乏协变的返回类型</h5> <h4 id="类型系统特征总结"><a href="#类型系统特征总结" class="header-anchor">#</a> 类型系统特征总结</h4> <ul><li>C#1 是静态类型的——编译器知道你能使用哪些成员。</li> <li>C#1 是显式的——必须告诉编译器变量具有什么类型。</li> <li>C#1 是安全的——除非存在真实的转换关系，否则不能一种类型当作另一种类型。</li> <li>方法覆盖和接口实现不允许协变性/逆变性。</li></ul> <h3 id="值类型和引用类型"><a href="#值类型和引用类型" class="header-anchor">#</a> 值类型和引用类型</h3> <p>除了以下总结的特殊情况，类（使用 class 来声明）是引用类悉尼港，而<code>结构（使用 struct 来声明）是值类型</code>。特殊情况包括以下方面：</p> <ul><li>数组类型是引用类型，即使元素类型是值类型（所以你即便 int 是值类型，int[] 仍是引用类型）；</li> <li>枚举（使用 enum 来声明）是值类型；</li> <li>委托类型（使用 delegate 来声明）是引用类型；</li> <li>接口类型（使用 interface 来声明）是引用类型，但可由值类型实现。</li></ul> <h4 id="值类型和引用类型-2"><a href="#值类型和引用类型-2" class="header-anchor">#</a> 值类型和引用类型</h4> <p>变量的值在它声明时的位置存储。局部变量的值总是存储在栈（stack）中，实例变量的值总是存储在实例本身存储的地方。引用类型实例（对象）总是存储在堆（heap）中，静态变量也是。</p> <p>两种类型的另一个差异在于，值类型不可以派生出其他类洗ing。</p> <h3 id="c-1-之外：构建于坚实基础之上的新特性"><a href="#c-1-之外：构建于坚实基础之上的新特性" class="header-anchor">#</a> C#1 之外：构建于坚实基础之上的新特性</h3> <h2 id="入门（初级）"><a href="#入门（初级）" class="header-anchor">#</a> 入门（初级）</h2> <h3 id="第一章-简介"><a href="#第一章-简介" class="header-anchor">#</a> 第一章 简介</h3> <p>C# 是一个现代的、通用的、面向对象的编程语言，它是由微软（Microsoft）开发的，由 Ecma 和 ISO 核准认可的。</p> <p>C# 是由 Anders Hejlsberg 和他的团队在 .Net 框架开发期间开发的。</p> <p>C# 是专为公共语言基础结构（CLI）设计的。CLI 由可执行代码和运行时环境组成，允许在不同的计算机平台和体系结构上使用各种高级语言。</p> <p>下面列出了 C# 成为一种广泛应用的专业语言的原因：</p> <ul><li><p>现代的、通用的编程语言。</p></li> <li><p>面向对象。</p></li> <li><p>面向组件。</p></li> <li><p>容易学习。</p></li> <li><p>结构化语言。</p></li> <li><p>它产生高效率的程序。</p></li> <li><p>它可以在多种计算机平台上编译。</p></li> <li><p>.Net 框架的一部分。</p></li> <li><p>布尔条件（Boolean Conditions）</p></li> <li><p>自动垃圾回收（Automatic Garbage Collection）</p></li> <li><p>标准库（Standard Library）</p></li> <li><p>组件版本（Assembly Versioning）</p></li> <li><p>属性（Properties）和事件（Events）</p></li> <li><p>委托（Delegates）和事件管理（Events Management）</p></li> <li><p>易于使用的泛型（Generics）</p></li> <li><p>索引器（Indexers）</p></li> <li><p>条件编译（Conditional Compilation）</p></li> <li><p>简单的多线程（Multithreading）</p></li> <li><p>LINQ 和 Lambda 表达式</p></li> <li><p>集成 Window</p></li></ul> <h3 id="环境：c-和-net-框架"><a href="#环境：c-和-net-框架" class="header-anchor">#</a> 环境：C#和 .NET 框架</h3> <p>C# 是在为微软公司的 .NET 框架上开发程序而设计的，它属于 .NET 框架的一部分。</p> <p><img src="/Notebook/assets/img/net-compose.c91e686d.png" alt=""></p> <p>编程工具涵盖了编码和调试需要的一切，包括一下几点：</p> <ul><li>Visual Studio 集成开发环境（IDE）。</li> <li>.NET 兼容的编译器（例如：C#、Visual Basic .NET、F#、IronRuby 和托管的 C++）</li> <li>调试器</li> <li>网站开发服务端技术，比如 ASP.NET 或 WCF。</li></ul> <p>BCL （Base Class Libray，基类库）是 .NET 框架使用的一个大的类库，而且也可以在你的程序中使用。</p> <p>.Net 框架是一个创新的平台，能帮您编写出下面类型的应用程序：</p> <ul><li>Windows 应用程序</li> <li>Web 应用程序</li> <li>Web 服务</li> <li>.Net 框架应用程序是多平台的应用程序。框架的设计方式使它适用于下列各种语言：C#、C++、Visual Basic、Jscript、COBOL 等等。所有这些语言可以访问框架，彼此之间也可以互相交互。</li></ul> <p>.Net 框架由一个巨大的代码库组成，用于 C# 等客户端语言。下面列出一些 .Net 框架的组件：</p> <ul><li>公共语言运行库（Common Language Runtime - CLR）</li> <li>.Net 框架类库（.Net Framework Class Library）</li> <li>公共语言规范（Common Language Specification）</li> <li>通用类型系统（Common Type System）</li> <li>元数据（Metadata）和组件（Assemblies）</li> <li>Windows 窗体（Windows Forms）</li> <li>ASP.Net 和 ASP.Net AJAX</li> <li>ADO.Net</li> <li>Windows 工作流基础（Windows Workflow Foundation - WF）</li> <li>Windows 显示基础（Windows Presentation Foundation）</li> <li>Windows 通信基础（Windows Communication Foundation - WCF）</li> <li>LINQ</li></ul> <h4 id="大大改进的编程环境"><a href="#大大改进的编程环境" class="header-anchor">#</a> 大大改进的编程环境</h4> <ol><li>面向对象的开发环境</li> <li>自动垃圾收集</li> <li>互操作性</li> <li>不需要 COM</li> <li>简化的部署，不需要使用注册表注册。</li> <li>类型安全性。</li> <li>基类库（Base Class Library，BCL）。在写自己的程序时，可以使用其中的类：
<ul><li>通用基础类。文件操作、字符串操作、安全和加密。</li> <li>集合类。列表、字典、散列表以及位数组。</li> <li>线程和同步类。创建多线程。</li> <li>XML 类。操作 XML 文档。</li></ul></li></ol> <h4 id="编译成-cil"><a href="#编译成-cil" class="header-anchor">#</a> 编译成 CIL</h4> <p>.NET 语言的编译器接受源代码文件，并生成名为程序集的输出文件。</p> <ul><li>程序集要么是<code>可执行</code>的，要么是 <code>DLL</code>。</li> <li>程序集里的代码并不是本机代码，而是一种名称为 CIL（Common Intermediate Language，公共中间语言）的中间语言。</li> <li>程序集包含的信息中，包括下列项目：
<ul><li>程序的 CIL；</li> <li>程序中使用的类型的元数据；</li> <li>对其他程序集引用的元数据。</li></ul></li></ul> <p><img src="/Notebook/assets/img/c-sharp-compile.050eac60.png" alt=""></p> <h4 id="编译成本机代码并执行"><a href="#编译成本机代码并执行" class="header-anchor">#</a> 编译成本机代码并执行</h4> <p>程序的 CIL 直到它被调用时才会被编译成本机代码。在运行时，CLR 执行下面的步骤：</p> <ol><li>检查程序集的安全特性；</li> <li>在内存中分配空间。</li> <li>把程序集中的可执行代码发送给实时（Just-in-Time，JIT）编译器，把其中的一部分编译成本机代码。</li></ol> <p><img src="/Notebook/assets/img/c-sharp-compile-execute.0e5114f0.png" alt=""></p> <p>一旦 CIL 被编译成本机代码，CLR 就在它运行时管理它，执行像释放无主内存、检查数组边界、检查参数类型和管理异常之类的任务。</p> <h4 id="编译时和运行时"><a href="#编译时和运行时" class="header-anchor">#</a> 编译时和运行时</h4> <p><img src="/Notebook/assets/img/c-sharp-compiletime-runtime.1c059ac9.png" alt="c-sharp-compiletime-runtime"></p> <h4 id="clr"><a href="#clr" class="header-anchor">#</a> CLR</h4> <p>.NET 框架的核心组件是 CLR，它在操作系统的顶层，负责管理程序的执行。CLR 还提供下列服务：</p> <ul><li>自动垃圾收集；</li> <li>安全和认证；</li> <li>通过访问 BCL 得到广泛的编程功能呢，包括如 Web 服务和数据服务之类的功能。</li></ul> <p><img src="/Notebook/assets/img/c-sharp-CLR.dd7a7077.png" alt="c-sharp-CLR"></p> <h4 id="cli"><a href="#cli" class="header-anchor">#</a> CLI</h4> <p>CLI（Common Language Infrastructure，公共语言基础结构），它把所有 .NET 框架的组件连结成一个内聚的、一致的系统。</p> <ul><li>公共语言运行库（CLR）</li> <li>公共语言规范（CLS）</li> <li>基类库（BCL）</li> <li>元数据定义及语义</li> <li>公共中间语言（CIL）指令组</li> <li>公共类型系统（CTS）</li></ul> <p>CLI 是一组阐述了系统的架构、规则和约定的规范。</p> <h4 id="cli-的重要组成部分"><a href="#cli-的重要组成部分" class="header-anchor">#</a> CLI 的重要组成部分</h4> <ol><li>公共类型系统
CTS （Common Type System，公共类型系统内）定义了那些在托管代码中一定会使用的类型的特征。</li></ol> <ul><li>CTS 定义了一组丰富的内置类型，以及每种类型固有的、独有的特性。</li> <li>.NET 兼容编程语言提供的类型通常映射到 CTS 中已定义的内置类型集的某一个特殊子集。</li> <li><strong>CTS 最重要的特征之一是所有类型都继承自公共的基类——object。</strong></li> <li><strong>使用 CTS 可以确保系统类型和用户自定义类型能够被任何 .NET 兼容的语言所使用。</strong></li></ul> <ol start="2"><li>公共语言规范。
CLS （Common Language Specification，公共语言规范）详细说明了一个 .NET 兼容编程语言的规则、属性和行为，其主题包括数据类型、类结构和参数传递。</li></ol> <h4 id="c-的演化"><a href="#c-的演化" class="header-anchor">#</a> C# 的演化</h4> <p>c# 最新版是 8.0，每个新版本在新添加的特性中都有一个焦点特性。详细版本记录可以看<a href="https://docs.microsoft.com/zh-cn/dotnet/csharp/whats-new/csharp-version-history" target="_blank" rel="noopener noreferrer">C# 发展历史<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ul><li>8.0 异步流</li> <li>7.0 Out 变量、元组和析构函数</li> <li>6.0 提升效率的小功能 静态导入、异常筛选</li> <li>5.0 异步</li> <li>4.0 命名参数和可选参数</li> <li>3.0 LINQ（语言集成查询）</li> <li>2.0 范型</li> <li>1.0 C#</li></ul> <p>学习 C# 不仅是学习简单的编程，更是学习编程的方法。JavaScript 对使用者在编程时的严谨性要求不高，这实际上会减慢开发的速度。C#在这方面则要严格得多（通过强类型变量等内容），这不仅有助于使用者成为更出色的程序员，同时也会提升编程速度（比如强类型提供代码自动完成的提示，让使用者更快速、更准确地编程。）</p> <table><thead><tr><th>目标框架</th> <th>version</th> <th>C# 语言版本的默认值</th></tr></thead> <tbody><tr><td>.NET Core</td> <td>3.x</td> <td>C# 8.0</td></tr> <tr><td>.NET Core</td> <td>2.x</td> <td>C# 7.3</td></tr> <tr><td>.NET Standard</td> <td>2.1</td> <td>C# 8.0</td></tr> <tr><td>.NET Standard</td> <td>2.0</td> <td>C# 7.3</td></tr> <tr><td>.NET Standard</td> <td>1.x</td> <td>C# 7.3</td></tr> <tr><td>.NET Framework</td> <td>全部</td> <td>C# 7.3</td></tr></tbody></table> <h3 id="c-编程概述"><a href="#c-编程概述" class="header-anchor">#</a> C# 编程概述</h3> <h4 id="一个简单的-c-程序"><a href="#一个简单的-c-程序" class="header-anchor">#</a> 一个简单的 C# 程序</h4> <p>一个 C# 程序主要包括以下部分：</p> <ul><li>命名空间声明（Namespace declaration）</li> <li>一个 class</li> <li>Class 方法</li> <li>Class 属性</li> <li>一个 Main 方法</li> <li>语句（Statements）&amp; 表达式（Expressions）</li> <li>注释</li></ul> <p>如一个 SimpleProgram.cs。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span> <span class="token comment">// 告诉编译器这个程序使用 System 命名空间的类型</span>

<span class="token keyword">namespace</span> start <span class="token comment">// 声明一个新命名空间，名称微 start</span>
<span class="token punctuation">{</span>
    <span class="token keyword">class</span> <span class="token class-name">MainClass</span> <span class="token punctuation">{</span> <span class="token comment">// 声明一个新的类类型，名称为 MainClass</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span> <span class="token comment">// 声明一个名称为 Main 的方法作为类 MainClass 的成员</span>
        <span class="token comment">// Main 是一个特殊函数，编译器用它作为程序的起始点</span>
        <span class="token punctuation">{</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, Jeycu!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这条语句使用命名空间 System 中的一个名称为 Console 的类将消息输出到屏幕窗口，没有第1行的 using 语句，编译器就不会知道在哪里寻找类 Console</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>程序的第一行 <strong>using System</strong>; - <strong>using</strong> 关键字用于在程序中包含** System** 命名空间。 一个程序一般有多个 **using **语句。</li> <li>下一行是 <strong>namespace</strong> 声明。一个 <strong>namespace</strong> 里包含了一系列的类。HelloWorldApplication 命名空间包含了类 MainClass。</li> <li>下一行是 <strong>class</strong> 声明。类 <strong>MainClass</strong> 包含了程序使用的数据和方法声明。类一般包含多个方法。方法定义了类的行为。在这里，HelloWorld 类只有一个 Main 方法。</li> <li>下一行定义了 <strong>Main</strong> 方法，是所有 C# 程序的 <strong>入口点</strong>。<strong>Main</strong> 方法说明当执行时 类将做什么动作。</li> <li>下一行 /<em>...</em>/ 将会被编译器忽略，且它会在程序中添加额外的 注释。</li> <li>Main 方法通过语句 <strong>Console.WriteLine(&quot;Hello Jecyu!&quot;);</strong> 指定了它的行为。</li> <li>WriteLine 是一个定义在 System 命名空间中的 Console 类的一个方法。该语句会在屏幕上显示消息 &quot;Hello, Jecyu!&quot;。</li> <li>最后一行 <strong>Console.ReadKey()</strong>; 是针对 VS.NET 用户的。这使得程序会等待一个按键的动作，防止程序从 Visual Studio .NET 启动时屏幕会快速运行并关闭。</li></ul> <p><strong>补充说明</strong></p> <p>C# 程序是由一个或多个类型声明组成。程序中的类型可以以任何顺序声明。在上述程序中，只声明了 class 类型。</p> <p>**命名空间是与某个名称相关联的一组类型声明。**SimpleProgram 使用两个命名空间。它创建了一个名称为 Simple 的新命名空间，并在其中声明了期类型（类 MainClass），还使用了 System 命名空间定义的 Console 类。</p> <p>以下几点值得注意：</p> <ul><li>C# 是大小写敏感的。</li> <li>所有的语句和表达式必须以分号（;）结尾。</li> <li>程序的执行从 Main 方法开始。</li> <li>与 Java 不同的是，文件名可以不同于类的名称。</li></ul> <h4 id="编译-执行-c-程序"><a href="#编译-执行-c-程序" class="header-anchor">#</a> 编译 &amp; 执行 C# 程序</h4> <p>如果您使用 Visual Studio.Net 编译和执行 C# 程序，请按下面的步骤进行：</p> <ol><li>启动 Visual Studio。</li> <li>在菜单栏上，选择 File -&gt; New -&gt; Project。</li> <li>从模板中选择 Visual C#，然后选择 Windows。</li> <li>选择 Console Application。</li> <li>为您的项目制定一个名称，然后点击 OK 按钮。</li> <li>新项目会出现在解决方案资源管理器（Solution Explorer）中。</li> <li>在代码编辑器（Code Editor）中编写代码。</li> <li>点击 Run 按钮或者按下 F5 键来运行程序。会出现一个命令提示符窗口（Command Prompt window），显示 Hello World。</li></ol> <p>您也可以使用命令行代替 Visual Studio IDE 来编译 C# 程序：</p> <ol><li>打开一个文本编辑器，添加上面提到的代码。</li> <li>保存文件为 <code>helloworld.cs</code>。</li> <li>打开命令提示符工具，定位到文件所保存的目录。</li> <li>键入 <code>csc helloworld.cs</code> 并按下 enter 键来编译代码。csc 是指“C-Sharp 编译器”</li> <li>如果代码没有错误，命令提示符会进入下一行，并生成 helloworld.exe 可执行文件。</li> <li>接下来，键入 <code>helloworld</code> 来执行程序。</li> <li>您将看到 &quot;Hello World&quot; 打印在屏幕上。</li></ol> <h4 id="标识符"><a href="#标识符" class="header-anchor">#</a> 标识符</h4> <p>标识符是一种字符串，用来命名如变量、方法、参数和许多后面将要阐述的其他程序结构。</p> <p>可以通过把有意义的词连接成一个单独的描述性名称来创建自文档化（self-documenting）的标识符。某些字符能否在标识符中特定的位置出现是有规定的：</p> <ul><li>字母和下划线（a-z、A-Z 和_）可以用在任何位置。</li> <li>数字不能放在首位，但可以放在其他的任何地方。</li> <li>@字符只能放在标识符的首位。虽然允许使用，但不推荐。</li></ul> <h4 id="关键字"><a href="#关键字" class="header-anchor">#</a> 关键字</h4> <ul><li>关键字不能被用做变量名或任何其他形式的标识符，除非以@字符开始。</li> <li>所有 C#关键字全部都由小写字母组成（但是 .NET 类型名使用 Pascal 大小写约定）。</li></ul> <h4 id="main：程序的起始点"><a href="#main：程序的起始点" class="header-anchor">#</a> Main：程序的起始点</h4> <p>每个 C# 程序必须有一个类带有 Main 方法（函数）。</p> <ul><li>每个 C# 程序的可执行起始点在 Main 中的第一条指令。</li> <li>Main 必须首字母大写。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 更多语句</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="空白"><a href="#空白" class="header-anchor">#</a> 空白</h4> <p>程序中的空白指的是没有可视化输出的字符。程序员在源代码中使用的空白将被编译器忽略，但使代码更清晰易读。空白字符包括：</p> <ul><li>空格（Space）；</li> <li>制表符（Tab）；</li> <li>换行符；</li> <li>回车符。</li></ul> <h4 id="语句"><a href="#语句" class="header-anchor">#</a> 语句</h4> <p>语句是描述一个类型或告诉程序去执行某个动作的一条源代码指令。</p> <ul><li>简单语句以一个分号结束。</li></ul> <h4 id="从程序中输出文本"><a href="#从程序中输出文本" class="header-anchor">#</a> 从程序中输出文本</h4> <p>控制台窗口是一种简单的命令提示窗口，允许程序显示文本并从键盘接受输入。BCL 提供了一个名称为 Console 的类（在 System 命名空间中），该类包含了输入和输出数据到控制台窗口的方法。</p> <h5 id="write"><a href="#write" class="header-anchor">#</a> Write</h5> <p>Write shi Console 类的成员，它把一个文本字符发送到程序的控制台窗口。、</p> <h5 id="writeline"><a href="#writeline" class="header-anchor">#</a> WriteLine</h5> <p>WriteLine 是 Console 的另外一个成员，它和 Write 实现相同的功能，但会在每个输出字符串的结尾添加一个换行符。</p> <h5 id="格式字符串"><a href="#格式字符串" class="header-anchor">#</a> 格式字符串</h5> <p>Write 语句和 WriteLine 语句的常规形式中可以有一个以上的参数。</p> <ul><li>如果不只一个参数，参数间用逗号分隔。</li> <li>第一个参数必须总是字符串，称为格式字符串。格式字符串可以包含替代标记。
<ul><li>替代标记在格式化字符串中标出位置，在输出串中该位置将用一个值来替代。</li> <li>替代标记由一个整数及括住它的一对大括号组成，其中整数就是替换值的数字位置。
跟着格式字符串的参数称为替换值，这些替换值从 0 开始编号。</li></ul></li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code>Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Two smaple integers are {0} and {1}.&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Two smaple integers are 3 and 6.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>另外，在 C# 中可以使用任意数量的替代标记和任意数量的值。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code>Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Two smaple integers are {1}, {0} and {1}.&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>注意的是，标记不能引用超出替换值列表长度以外位置的值。如果引用了，不会产生编译错误，但会产生运行时错误（称为异常）。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code>Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Two smaple integers are {1}, {0} and {2}.&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="格式化数字字符串"><a href="#格式化数字字符串" class="header-anchor">#</a> 格式化数字字符串</h5> <p><code>{index, alignment:format}</code></p> <ul><li>index 使用列表中的第 index 项</li> <li>alignment 对齐说明符表示了字段中字符的最小宽度。
<ul><li>对齐说明符是可选的，并且使用逗号来和索引号分离。</li> <li>它由一个正整数或负整数组成。
<ul><li>整数表示了字段使用字符的最少数量。</li> <li>符号表示了右对齐或左对齐。正数表示右对齐，负数表示左对齐。</li></ul></li></ul></li> <li>format 格式字段指定了数字应该以哪种形式表示。例如，应当被当作货币、十进制数字、十六进制数字还是定点符号来表示？
<ul><li>冒号必须紧跟着格式说明符，中间不能有空格。</li> <li>格式说明符是一个字母字符，是 9 个内置字符格式之一。</li> <li>精度说明符是可选的，由 1 ～ 2 位数字组成。它的实际意义取决于格式说明符。</li></ul></li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code>Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;The value: {0}.&quot;</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;The value: {0:C}.&quot;</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 格式化为货币</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;The value: {0, -10:C}.&quot;</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// The value: 500.</span>
<span class="token comment">// The value: HK$500.00.</span>
<span class="token comment">// The value: HK$500.00 .</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="注释：为代码添加注解"><a href="#注释：为代码添加注解" class="header-anchor">#</a> 注释：为代码添加注解</h4> <ul><li>单行注释：<code>//</code></li> <li>分隔符注释：<code>/*...*/</code></li> <li>文档注释
<ul><li>文档注释包括 XML 文本，可以用于产生程序文档。这种类型的注释看起来像单行注释，但它们由三个斜杠而不是两个。</li> <li>如下<div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// &lt;summary&gt;</span>
<span class="token comment">// This class does...</span>
<span class="token comment">// &lt;/summary&gt;</span>
<span class="token keyword">class</span> <span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ul></li></ul> <p>注意：</p> <ul><li>对于单行注释，一直到行结束都有效。</li> <li>对于带分隔符的注释，直至遇到第一个结束分隔符都有效。</li></ul> <h3 id="类型、存储和变量"><a href="#类型、存储和变量" class="header-anchor">#</a> 类型、存储和变量</h3> <h4 id="c-程序是一组类型声明"><a href="#c-程序是一组类型声明" class="header-anchor">#</a> C# 程序是一组类型声明</h4> <p>C 程序是一组函数和数据类型，C++ 程序是一组函数和类型，然而 C# 程序是一组类型声明。</p> <ul><li><code>C#</code> 程序或 <code>DLL</code> 的源代码是一组一种或多种<code>类型声明</code>。</li> <li>对于<code>可执行程序</code>，<u>类型声明中必须有一个包含 Main 方法的类。</u></li> <li><code>命名空间是一种把相关的类型声明分组并命名的方法</code>。既然程序是一组相关的类型声明，那么通常会把程序声明在你创建的命名空间内部。</li></ul> <p>下面是一个由 3 个类型声明组成的程序。这 3 个类型被声明在一个名称为 MyProgram 的新命名空间内部。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">MyProgram</span> <span class="token punctuation">{</span> <span class="token comment">//  创建新的命名空间</span>
  DeclarationOfTypeA <span class="token comment">// 声明类型</span>
  DeclarationOfTypeB <span class="token comment">// 声明类型</span>
  <span class="token keyword">class</span> <span class="token class-name">C</span> <span class="token punctuation">{</span> <span class="token comment">// 声明类型</span>
    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="类型是一种模版"><a href="#类型是一种模版" class="header-anchor">#</a> 类型是一种模版</h4> <p>既然 C# 程序就是一组类型声明，那么学习 C# 就是学习如何创建和使用类型。
可以把类型想象成一个用来创建数据结构的模版。模版本身并不是数据结构，但它详细说明了由该模版构造的对象的特征。</p> <p>类型由下面的元素定义：</p> <ul><li>名称；</li> <li>用于保存数据成员的数据结构；</li> <li>一些行为及约束条件。</li></ul> <p><img src="/Notebook/assets/img/type-template.84e3e1e5.png" alt=""></p> <p>上图阐明了 short 类型和 int 类型的组成元素。</p> <h4 id="实例化类型"><a href="#实例化类型" class="header-anchor">#</a> 实例化类型</h4> <p>从某个类型模版创建实际的对象，称为实例化该类型。</p> <ul><li>通过实例化类型而创建的对象被称为类型的对象或类型的实例。</li> <li><strong>在 C# 程序中，每个数据项都是某种类型的实例</strong>。这些类型可以是语言自带的，可以是 BCL 或其他库提供的，也可以是程序员定义的。</li></ul> <p><img src="/Notebook/assets/img/instantiated-type.4bcc2980.png" alt="instantiated type"></p> <h4 id="数据成员和函数成员"><a href="#数据成员和函数成员" class="header-anchor">#</a> 数据成员和函数成员</h4> <p><strong>像 short、int 和 long 等这样的类型称为简单类型</strong>。这种类型只能存储一个数据项。
其他的类型可以存储多个数据项。比如数组（array）类型就可以存储多个同类型的数据项。</p> <h5 id="成员的类别"><a href="#成员的类别" class="header-anchor">#</a> 成员的类别</h5> <p>然而另外一些类型可以包含许多不同类型的数据项。这些类型中的数据项个体称为成员，并且与数组中使用数字来引用成员不同，这些成员有独特的名称。</p> <p>有两种成员：<code>数据成员</code>和<code>函数成员</code>。</p> <ul><li><code>数据成员</code>：保存了与这个类的对象或作为一个整体的类相关的数据。</li> <li><code>函数成员</code>：执行代码。函数成员定义类型的行为。</li></ul> <p><img src="/Notebook/assets/img/data-members-function-members.2a9a2e1d.png" alt=""></p> <p>图 3-3 列出了类型 XYZ 的一些数据成员和函数成员。</p> <h4 id="预定义类型"><a href="#预定义类型" class="header-anchor">#</a> 预定义类型</h4> <p>C# 提供了 16 种预定义类型，其中包括 13 种简单类型和 3 种非简单类型。</p> <p>所有预定义类型的名称都由<code>全小写的字母</code>组成。预定义的简单类型包括以下 3 种。</p> <ul><li>11 种数值类型。
<ul><li>不同长度的有符号和无符号<code>整数</code>类型。</li> <li>浮点数类型 <code>float</code> 和 <code>double</code>。</li> <li>一种称为 <code>decimal</code> 的高精度小数类型。与 float 和 double 不同，decimal 类型可以准确地表示分数。<code>decimal 类型常用于货币的计算</code>。</li></ul></li> <li>一种 <code>Unicode</code> 字符类型 char。</li> <li>一种布尔类型 <code>bool</code>。bool 类型表示布尔值并且必须为 true 或 false。</li></ul> <p>3 种非简单类型如下。</p> <ul><li><code>string</code>，它是一个 Unicode 字符<code>数组</code>。</li> <li><code>object</code>，它是所有其他类型的<code>基类</code>。</li> <li><code>dynmaic</code>，使用动态语言编写的程序集时使用。</li></ul> <p><img src="/Notebook/assets/img/predefined-type.4161a68d.png" alt="预定义类型"></p> <h4 id="用户定义类型"><a href="#用户定义类型" class="header-anchor">#</a> 用户定义类型</h4> <p>除了 C# 提供的 16 种预定义类型，还可以创建自己的用户定义类型。有 6 种类型可以由用户自己创建，它们是：</p> <ul><li>类类型（class）；</li> <li>结构类型（struct）；</li> <li>数组类型（array）；</li> <li>枚举类型（enum）；</li> <li>委托类型（delegate）；</li> <li>接口类型（interface）；</li></ul> <p>类型通过类型声明创建，类型声明包含以下信息：</p> <ul><li>要创建的类型的种类；</li> <li>新类型的名称；</li> <li>对类型中每个成员的声明（名称和规格）。array 和 delegate 除外，它们不含有命名成员。</li></ul> <p>一旦声明了类型，就可以创建和使用这种类型的对象，就像它们是预定义类型一样。</p> <p><img src="/Notebook/assets/img/user-definition.e545ddfe.png" alt=""></p> <h4 id="栈和堆"><a href="#栈和堆" class="header-anchor">#</a> 栈和堆</h4> <h5 id="栈"><a href="#栈" class="header-anchor">#</a> 栈</h5> <p>栈是一个内存数组，是一个 LIFO（Last-In-First）的数据结构。栈存储几种类型的数据：</p> <ul><li>某些类型变量的值；</li> <li>程序当前执行的环境；</li> <li>传递给方法的参数。</li></ul> <p><img src="/Notebook/assets/img/stack-push-pop.07655aff.png" alt=""></p> <h5 id="堆"><a href="#堆" class="header-anchor">#</a> 堆</h5> <p>堆是一块内存区域，在堆里可以分配大块的内存用于存储某类型的数据对象。与栈不同，堆里的内存能够以任意顺序存入和移除。
虽然程序可以在堆里保存数据，但是不能显示删除它们。CLR 的自动 GC（Garbage Collector，垃圾收集器）在判断出程序的代码将不会再访问某数据项时，自动清除无主的堆对象。</p> <p><img src="/Notebook/assets/img/Heap-GC.162faba1.png" alt=""></p> <h4 id="值类型和引用类型-3"><a href="#值类型和引用类型-3" class="header-anchor">#</a> 值类型和引用类型</h4> <p>数据项的类型定义了存储数据需要的内存大小及组成该类型的数据成员。类型还决定了对象在内存中的存储位置——栈或堆。</p> <p>类型被分为两种：值类型和引用类型，这两种类型的对象在内存中的存储方式不同。</p> <ul><li>值类型只需要一段单独的内存，用于存储实际的数据。</li> <li>引用类型需要两段内存。
<ul><li>第一段存储实际的数据，它总是位于堆中。</li> <li>第二段是一个引用，指向数据在堆中的存放位置。</li></ul></li></ul> <p><img src="/Notebook/assets/img/value-ref-store.9f48cca5.png" alt=""></p> <h5 id="存储引用类型对象的成员"><a href="#存储引用类型对象的成员" class="header-anchor">#</a> 存储引用类型对象的成员</h5> <ul><li>引用对象的数据部分始终存放在堆里。</li> <li>值类型对象，或引用类型数据的引用部分可以放在堆里，也可以放在栈里，这依赖于实际环境。</li></ul> <p><img src="/Notebook/assets/img/storage-reference-type-data.84d9e1ab.png" alt=""></p> <ul><li>尽管成员 A 是值类型，但它也是 MyType 实例数据的一部分，因此和对象的数据一起被存放在堆里。</li> <li>成员 B 是引用类型，所以它的数据部分会始终存放在堆里。不同的是，它的引用部分也被存放在堆里。</li></ul> <h5 id="c-类型分类"><a href="#c-类型分类" class="header-anchor">#</a> C# 类型分类</h5> <p><img src="/Notebook/assets/img/c-sharp-types.1387f75f.png" alt="C# 类型分类"></p> <h4 id="变量"><a href="#变量" class="header-anchor">#</a> 变量</h4> <p>一种多用途的编程语言必须允许程序存取数据，而这正是通过变量实现的。</p> <ul><li>变量是一个名称，表示程序执行时存储在内存中的数据。</li> <li>C# 提供了 4 种变量。
<ul><li>本地变量，在方法的作用域保存临时数据，不是类型的成员</li> <li>字段，保存和类型或类型实例相关的数据，是类型的成员</li> <li>参数</li> <li>数组元素</li></ul></li></ul> <h5 id="变量声明"><a href="#变量声明" class="header-anchor">#</a> 变量声明</h5> <p>变量在使用之前必须声明。变量声明定义了变量，并完成了两件事：</p> <ul><li>给变量命名，并为它关联一种类型。</li> <li>让编译器为它分配一块内存。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">int</span></span> var2<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>除声明变量的名称和类型以外，声明还能把它的内存初始化为一个明确的值。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">int</span></span> var2 <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>无初始化语句的本地变量有一个未定义的值，在未赋值之前不能使用。试图使用未定义的本地变量会导致编译器产生一条错误信息。</p> <h5 id="自动初始化"><a href="#自动初始化" class="header-anchor">#</a> 自动初始化</h5> <p>一些类型的变量如果在声明时没有被初始化，那么就会被自动设为默认值，而另一些却不能。</p> <h5 id="多变量声明"><a href="#多变量声明" class="header-anchor">#</a> 多变量声明</h5> <h5 id="使用变量的值"><a href="#使用变量的值" class="header-anchor">#</a> 使用变量的值</h5> <h4 id="静态类型和-dynmaic-关键字"><a href="#静态类型和-dynmaic-关键字" class="header-anchor">#</a> 静态类型和 dynmaic 关键字</h4> <p>每一个变量都包含变量类型，这样编译器就可以确定运行时需要的内存总量以及哪些部分应该存在栈上，哪些部分应该存在堆上。变量的类型在编译的时候确定并且运行时不能修改，这叫做静态类型。</p> <p>但是不是所有的语言都是静态类型的，诸如 IronPython 和 IronRuby 之类的脚本语言是动态类型的。也就是说，变量的类型直到运行时才能被解析。C# 提供 dynamic ，代表一个特定的、实际的 C# 类型，它知道如何在运行时解析自身。</p> <p>在编译时，编译器不会对 dynamic 类型的变量进行类型检查。</p> <h4 id="可空类型"><a href="#可空类型" class="header-anchor">#</a> 可空类型</h4> <h3 id="类的基本概念"><a href="#类的基本概念" class="header-anchor">#</a> 类的基本概念</h3> <p>当你定义一个类时，你定义了一个数据类型的蓝图。这实际上并没有定义任何的数据，但它定义了类的名称意味着什么，也就是说，类的对象由什么组成及在这个对象上可执行什么操作。对象是类的实例。构成类的方法和变量成为类的成员。</p> <h4 id="类的概述"><a href="#类的概述" class="header-anchor">#</a> 类的概述</h4> <h5 id="类是一种活动的数据结构"><a href="#类是一种活动的数据结构" class="header-anchor">#</a> 类是一种活动的数据结构</h5> <p>类是一个能存储数据并执行代码的数据结构。它包含数据成员和函数成员。</p> <ul><li>数据成员，它存储与类或类的实例相关的数据。数据成员通常模拟该类所表示的现实世界事物的特性。</li> <li>函数成员，它执行代码。通常会模拟所表示的现实世界事物的功能和操作。</li></ul> <h4 id="声明类"><a href="#声明类" class="header-anchor">#</a> 声明类</h4> <p>类的定义是以关键字 class 开始，后跟类的名称。类的主体，包含在一对花括号内。下面是类定义的一般形式：</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token operator">&lt;</span>access specifier<span class="token operator">&gt;</span> <span class="token keyword">class</span>  <span class="token class-name">class_name</span>
<span class="token punctuation">{</span>
    <span class="token comment">// member variables</span>
    <span class="token operator">&lt;</span>access specifier<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>data type<span class="token operator">&gt;</span> variable1<span class="token punctuation">;</span>
    <span class="token operator">&lt;</span>access specifier<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>data type<span class="token operator">&gt;</span> variable2<span class="token punctuation">;</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token operator">&lt;</span>access specifier<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>data type<span class="token operator">&gt;</span> variableN<span class="token punctuation">;</span>
    <span class="token comment">// member methods</span>
    <span class="token operator">&lt;</span>access specifier<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token keyword">return</span> type<span class="token operator">&gt;</span> <span class="token function">method1</span><span class="token punctuation">(</span>parameter_list<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// method body</span>
    <span class="token punctuation">}</span>
    <span class="token operator">&lt;</span>access specifier<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token keyword">return</span> type<span class="token operator">&gt;</span> <span class="token function">method2</span><span class="token punctuation">(</span>parameter_list<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// method body</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token operator">&lt;</span>access specifier<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token keyword">return</span> type<span class="token operator">&gt;</span> <span class="token function">methodN</span><span class="token punctuation">(</span>parameter_list<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// method body</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>请注意：</p> <ul><li>访问标识符 <code>&lt;access specifier&gt;</code> 指定了对类及其成员的访问规则。如果没有指定，则使用默认的访问标识符。类的默认访问标识符是 internal，成员的默认访问标识符是 private。</li> <li>数据类型 <code>&lt;data type&gt;</code> 指定了变量的类型，返回类型 <code>&lt;return type&gt;</code> 指定了返回的方法返回的数据类型。</li> <li>如果要访问类的成员，你要使用点<code>（.）</code>运算符。</li> <li>点运算符链接了对象的名称和成员的名称。</li></ul> <h4 id="类成员"><a href="#类成员" class="header-anchor">#</a> 类成员</h4> <h5 id="字段"><a href="#字段" class="header-anchor">#</a> 字段</h5> <h5 id="方法"><a href="#方法" class="header-anchor">#</a> 方法</h5> <h4 id="创建变量和类的实例"><a href="#创建变量和类的实例" class="header-anchor">#</a> 创建变量和类的实例</h4> <p>类的声明只是用于创建类的实例的蓝图。一旦类被声明，就可以创建类的实例。</p> <h4 id="为数据分配内存"><a href="#为数据分配内存" class="header-anchor">#</a> 为数据分配内存</h4> <p>声明类类型的变量所分配的内存是用来保存引用的，而不是用来保存类对象实际数据的。要为实际数据分配内存，需要使用 <code>new</code> 运算符。</p> <ul><li>new 运算符为任意指定类型的实例分配并初始化内存。</li></ul> <h4 id="实例成员"><a href="#实例成员" class="header-anchor">#</a> 实例成员</h4> <p>类成员相当于蓝图，通过这个蓝图想创建多少个类的实例都可以。</p> <ul><li>实例成员 类的每个实例都是不同的实体，它们都有自己的一组数据成员，不同于同一类的其他实例。因为这些数据成员都和类的实例相关，所以被称为实例成员。</li> <li>静态成员 实例成员是默认类型，但也可以声明与类而不是与实例相关的成员，称为静态成员。</li></ul> <h4 id="访问修饰符"><a href="#访问修饰符" class="header-anchor">#</a> 访问修饰符</h4> <ul><li>私有的（private）</li> <li>公有的（public）</li> <li>受保护的（protected）</li> <li>内部的（internal）</li> <li>受保护内部（protected internal）</li></ul> <h5 id="私有成员和公有访问"><a href="#私有成员和公有访问" class="header-anchor">#</a> 私有成员和公有访问</h5> <p>私有成员只能从声明它的类的内部访问，其他的类不能看见或访问它们。</p> <p><img src="/Notebook/assets/img/private-public-member.d0e65201.png" alt=""></p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token comment">// 公有访问和私有访问</span>
<span class="token comment">//</span>
<span class="token keyword">namespace</span> <span class="token namespace">BoxApplication2</span>
<span class="token punctuation">{</span>
    <span class="token keyword">class</span> <span class="token class-name">Box</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">double</span></span> length<span class="token punctuation">;</span> <span class="token comment">// 长度</span>
        <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">double</span></span> breadth<span class="token punctuation">;</span> <span class="token comment">// 宽度</span>
        <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">double</span></span> height<span class="token punctuation">;</span> <span class="token comment">// 高度</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">setLength</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">double</span></span> len<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            length <span class="token operator">=</span> len<span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">setBreadth</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">double</span></span> bre<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            breadth <span class="token operator">=</span> bre<span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">setHeight</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">double</span></span> hei<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            height <span class="token operator">=</span> hei<span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> <span class="token function">getVolume</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> length <span class="token operator">*</span> breadth <span class="token operator">*</span> height<span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">class</span> <span class="token class-name">Boxtester</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>

            <span class="token class-name">Box</span> Box1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Box</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Box</span> Box2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Box</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">double</span></span> volume<span class="token punctuation">;</span> <span class="token comment">// 默认为 0</span>

            <span class="token comment">// Box1 详述</span>
            Box1<span class="token punctuation">.</span><span class="token function">setLength</span><span class="token punctuation">(</span><span class="token number">6.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Box1<span class="token punctuation">.</span><span class="token function">setBreadth</span><span class="token punctuation">(</span><span class="token number">7.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Box1<span class="token punctuation">.</span><span class="token function">setHeight</span><span class="token punctuation">(</span><span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Box2 详述</span>
            Box2<span class="token punctuation">.</span><span class="token function">setLength</span><span class="token punctuation">(</span><span class="token number">10.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Box2<span class="token punctuation">.</span><span class="token function">setBreadth</span><span class="token punctuation">(</span><span class="token number">12.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Box2<span class="token punctuation">.</span><span class="token function">setHeight</span><span class="token punctuation">(</span><span class="token number">13.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Box1 的体积</span>
            volume <span class="token operator">=</span> Box1<span class="token punctuation">.</span><span class="token function">getVolume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Box1 的体积： {0}&quot;</span><span class="token punctuation">,</span> volume<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Box2 的体积</span>
            volume <span class="token operator">=</span> Box2<span class="token punctuation">.</span><span class="token function">getVolume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Box2 的体积： {0}&quot;</span><span class="token punctuation">,</span> volume<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Console<span class="token punctuation">.</span><span class="token function">ReadKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br></div></div><h5 id="从类的外部访问成员"><a href="#从类的外部访问成员" class="header-anchor">#</a> 从类的外部访问成员</h5> <p>要从类的外部访问实例成员，必须包括变量名称和成员名称，中间用句点（.）分隔。这称为点运算符（dot-syntax notation）。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name">DaysTemp</span> myDt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DaysTemp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建类的对象</span>
<span class="token class-name"><span class="token keyword">float</span></span> fValue <span class="token operator">=</span> myDt<span class="token punctuation">.</span><span class="token function">Average</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从外部访问</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="综合例子"><a href="#综合例子" class="header-anchor">#</a> 综合例子</h5> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">BoxApplication</span>
<span class="token punctuation">{</span>
    <span class="token keyword">class</span> <span class="token class-name">Box</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 声明字段</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">double</span></span> length<span class="token punctuation">;</span> <span class="token comment">// 长度</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">double</span></span> breadth<span class="token punctuation">;</span> <span class="token comment">// 宽度</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">double</span></span> height<span class="token punctuation">;</span> <span class="token comment">// 高度</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">class</span> <span class="token class-name">Boxtester</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>

            <span class="token class-name">Box</span> Box1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Box</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Box</span> Box2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Box</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">double</span></span> volume<span class="token punctuation">;</span> <span class="token comment">// 默认为 0</span>

            <span class="token comment">// Box1 详述</span>
            Box1<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">6.0</span><span class="token punctuation">;</span>
            Box1<span class="token punctuation">.</span>breadth <span class="token operator">=</span> <span class="token number">7.0</span><span class="token punctuation">;</span>
            Box1<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">5.0</span><span class="token punctuation">;</span>

            <span class="token comment">// Box2 详述</span>
            Box2<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">10.0</span><span class="token punctuation">;</span>
            Box2<span class="token punctuation">.</span>breadth <span class="token operator">=</span> <span class="token number">12.0</span><span class="token punctuation">;</span>
            Box2<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">13.0</span><span class="token punctuation">;</span>

            <span class="token comment">// Box1 的体积</span>
            volume <span class="token operator">=</span> Box1<span class="token punctuation">.</span>length <span class="token operator">*</span> Box1<span class="token punctuation">.</span>breadth <span class="token operator">*</span> Box1<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Box1 的体积： {0}&quot;</span><span class="token punctuation">,</span> volume<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Box2 的体积</span>
            volume <span class="token operator">=</span> Box2<span class="token punctuation">.</span>length <span class="token operator">*</span> Box2<span class="token punctuation">.</span>breadth <span class="token operator">*</span> Box2<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Box2 的体积： {0}&quot;</span><span class="token punctuation">,</span> volume<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Console<span class="token punctuation">.</span><span class="token function">ReadKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h3 id="方法-2"><a href="#方法-2" class="header-anchor">#</a> 方法</h3> <h4 id="方法内部的执行"><a href="#方法内部的执行" class="header-anchor">#</a> 方法内部的执行</h4> <p>方法体是一个块，是大括号括起的语句序列。块可以包含以下项目：</p> <ul><li>本地变量；</li> <li>控制流结构；</li> <li>方法调用；</li> <li>内嵌的块。</li></ul> <h4 id="本地变量"><a href="#本地变量" class="header-anchor">#</a> 本地变量</h4> <p>字段通常保存和对象状态有关的数据，而创建本地变量经常是用于保存本地或临时的计算数据。</p> <ul><li>本地变量的存在性和生存期仅限于创建它的块及其内嵌的块。
<ul><li>它从声明它那一点开始存在。</li> <li>它在块完成执行时结束存在。</li></ul></li> <li>可以在方法体内任意位置声明本地变量，但必须在使用它们前声明。</li></ul> <p><img src="/Notebook/assets/img/reality-local-var.4b8b46a4.png" alt=""></p> <h5 id="类型判断和-var-关键字"><a href="#类型判断和-var-关键字" class="header-anchor">#</a> 类型判断和 var 关键字</h5> <p>var 关键字</p> <h5 id="嵌套在块中的本地变量"><a href="#嵌套在块中的本地变量" class="header-anchor">#</a> 嵌套在块中的本地变量</h5> <p>注意：在 C# 中不管嵌套级别如何，都不能在第一个名称的有效范围内声明另一个同名的本地变量。</p> <p><img src="/Notebook/assets/img/local-var-lifecycle.da2df6bb.png" alt=""></p> <h4 id="本地常量"><a href="#本地常量" class="header-anchor">#</a> 本地常量</h4> <ul><li>常量在声明时必须初始化。</li> <li>常量在声明后不能改变。</li></ul> <p>常量的语法与字段或变量的声明相同，除了下面内容。</p> <ul><li>在类型之前增加关键字 const。</li> <li>必须有初始化语句，初始化值必须在编译期决定，通常是一个预定义的简单类型或由其组成的表达式。它还可以是 null 引用，但不能是某对象的引用，因为对象的引用是在运行时决定的。</li></ul> <h4 id="方法调用"><a href="#方法调用" class="header-anchor">#</a> 方法调用</h4> <ul><li>当前方法的执行在调用点被挂起；</li> <li>控制转移到被调用方法的开始；</li> <li>被调用方法执行直到完成；</li> <li>控制回到发起调用的方法。</li></ul> <p><img src="/Notebook/assets/img/method-call-process.04ec5cfc.png" alt=""></p> <h4 id="返回值"><a href="#返回值" class="header-anchor">#</a> 返回值</h4> <p>方法可以向调用代码返回一个值。返回的值被插入到调用代码中发起调用的表达式所在的位置。</p> <ul><li>要返回值，方法必须在方法名前面声明一个类型。</li> <li>如果方法不返回值，它必须声明 void 返回类型。</li></ul> <h4 id="参数"><a href="#参数" class="header-anchor">#</a> 参数</h4> <h5 id="形参"><a href="#形参" class="header-anchor">#</a> 形参</h5> <p>形参是本地变量，它声明在方法的参数列表中，而不是在方法体中。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PrintSum</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> x<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">float</span></span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>因为形参是变量，所以它们有类型和名称，并能被写入和读取。</li> <li>和方法中的其他本地变量不同，参数在方法体的外面定义并在方法开始之前初始化（但有一种类型除外，称为输出参数）。</li> <li>参数列表中可以有任意数目的形参声明，而且声明必须用逗号隔开。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PrintSum</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> x<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">float</span></span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name"><span class="token keyword">int</span></span> sum <span class="token operator">=</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="实参"><a href="#实参" class="header-anchor">#</a> 实参</h5> <p>当代码调用一个方法时，形参的值必须在代码开始执行之前被初始化。</p> <ul><li>用于初始化形参的表达式或变量称作实参（actual parameter，有时也称 argument）。</li> <li>实参位于方法调用的参数列表中。</li> <li>每一个实参必须与对应形参的类型相匹配，或是编译器必须能够把实参隐式转换为那个类型。</li></ul> <p>当方法被调用时，每个实参的值都被用于初始化相应的形参，方法体随后被执行。</p> <p><img src="/Notebook/assets/img/parameter-argument.e33b311d.png" alt=""></p> <p>实参的数量必须与形参的数量一致，并且每个实参的类型也必须和所对应的形参类型一致。这种形式的参数叫做位置参数。</p> <h4 id="值参数"><a href="#值参数" class="header-anchor">#</a> 值参数</h4> <p>值参数是把实参的值复制给形参。使用值参数，通过将实参的值复制到形参的方式把数据传递给方法。方法被调用时，系统做如下操作：</p> <ul><li>在栈中为形参分配空间。</li> <li>将实参的值复制给形参。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">class</span> <span class="token class-name">MyClass</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> Val <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">class</span> <span class="token class-name">MainClass</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">MyMethod</span><span class="token punctuation">(</span><span class="token class-name">MyClass</span> f1<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> f2<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            f1<span class="token punctuation">.</span>Val <span class="token operator">+=</span> <span class="token number">5</span><span class="token punctuation">;</span>
            f2 <span class="token operator">+=</span> <span class="token number">5</span><span class="token punctuation">;</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;f1.Val: {0}, f2: {1}&quot;</span><span class="token punctuation">,</span> f1<span class="token punctuation">.</span>Val
            <span class="token punctuation">,</span> f2<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name">MyClass</span> a1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">int</span></span> a2 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
            <span class="token function">MyMethod</span><span class="token punctuation">(</span>a1<span class="token punctuation">,</span> a2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 复制 a1 引用，复制 a2 的值</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;f1.Val: {0}, f2: {1}&quot;</span><span class="token punctuation">,</span> a1<span class="token punctuation">.</span>Val<span class="token punctuation">,</span> a2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><ul><li>在方法被调用前，用作实参的变量 a2 已经在栈里了。</li> <li>在方法开始时，系统在栈中为形参分配空间，并从实参复制值。
<ul><li>因为 a1 是引用类型的，所以引用被复制，结果实参和形参都引用堆中的同一个对象。</li> <li>因为 a2 是值类型的，所以值被复制，产生了一个独立的数据项。</li></ul></li> <li>在方法的结尾，f2 和对象 f1 的字段都被加上了 5。
<ul><li>方法执行后，形参从栈中弹出。</li> <li>a2，值类型，它的值不受方法行为的影响。</li></ul></li></ul> <h4 id="引用参数"><a href="#引用参数" class="header-anchor">#</a> 引用参数</h4> <ul><li>使用引用参数时，必须在方法的声明中和调用中都使用 <code>ref</code> 修饰符。</li> <li>实参必须是变量，在用作实参前必须被赋值。如果是引用类型变量，可以赋值为一个引用或 null。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">MyClass</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyClass2</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> Val <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">class</span> <span class="token class-name">Program2</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">MyMethod</span><span class="token punctuation">(</span><span class="token keyword">ref</span> <span class="token class-name">MyClass2</span> f1<span class="token punctuation">,</span> <span class="token keyword">ref</span> <span class="token class-name"><span class="token keyword">int</span></span> f2<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            f1<span class="token punctuation">.</span>Val <span class="token operator">+=</span> <span class="token number">5</span><span class="token punctuation">;</span>
            f2 <span class="token operator">+=</span> <span class="token number">5</span><span class="token punctuation">;</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;f1.Val: {0}, f2: {1}&quot;</span><span class="token punctuation">,</span> f1<span class="token punctuation">.</span>Val
            <span class="token punctuation">,</span> f2<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name">MyClass2</span> a1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">int</span></span> a2 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
            <span class="token function">MyMethod</span><span class="token punctuation">(</span><span class="token keyword">ref</span> a1<span class="token punctuation">,</span> <span class="token keyword">ref</span> a2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 变量 f1 和 a1 引用相同的内存位置，a2 和 f2 引用相同的内存位置。</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;引用参数：f1.Val: {0}, f2: {1}&quot;</span><span class="token punctuation">,</span> a1<span class="token punctuation">.</span>Val<span class="token punctuation">,</span> a2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>注意：记得要在方法的声明和调用上都使用 ref 关键字。</p> <p>对于值参数，系统在栈上为形参分配内存。相反，引用参数具有以下特征：</p> <ul><li>不会为形参在栈上分配内存。</li> <li>实际情况是，形参的参数名将作为实参变量的别名，指向相同的内存位置。</li></ul> <p>由于形参名和实参名的行为就好像指向相同的内存位置，所以在方法的执行过程中对形参作的任何改变在方法完成后依然有效（表现在实参变量上。）</p> <h5 id="引用类型作为值参数和引用参数"><a href="#引用类型作为值参数和引用参数" class="header-anchor">#</a> 引用类型作为值参数和引用参数</h5> <ul><li>将引用类型作为值参数传递：如果在方法内创建一个新对象并赋值给形参，将切断形参与实参之间的关联，并且在方法调用结束后，新对象也不复存在。</li> <li>将引用类型作为引用参数传递：</li></ul> <p>作为值参数：</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 将引用类型作为值参数传递</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">MyClass</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyClass3</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> Val <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">class</span> <span class="token class-name">Program3</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RefAsParameter</span><span class="token punctuation">(</span><span class="token class-name">MyClass3</span> f1<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            f1<span class="token punctuation">.</span>Val <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;After member assignment: {0}&quot;</span><span class="token punctuation">,</span> f1<span class="token punctuation">.</span>Val<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 50</span>
            f1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;After new object creation: {0}&quot;</span><span class="token punctuation">,</span> f1<span class="token punctuation">.</span>Val<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 20</span>

        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name">MyClass3</span> a1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Before method call: {0}&quot;</span><span class="token punctuation">,</span> a1<span class="token punctuation">.</span>Val<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 20</span>
            <span class="token function">RefAsParameter</span><span class="token punctuation">(</span>a1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 复制 a1 引用</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;After method call: {0}&quot;</span><span class="token punctuation">,</span> a1<span class="token punctuation">.</span>Val<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 50</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>作为引用参数：除了方法声明和方法调用要使用 <code>ref</code> 关键字外，其他代码与上面相同。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 将引用类型作为引用参数传递</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">MyClass</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyClass4</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> Val <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">class</span> <span class="token class-name">Program4</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RefAsParameter</span><span class="token punctuation">(</span><span class="token keyword">ref</span> <span class="token class-name">MyClass4</span> f1<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            f1<span class="token punctuation">.</span>Val <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;After member assignment: {0}&quot;</span><span class="token punctuation">,</span> f1<span class="token punctuation">.</span>Val<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 50</span>
            f1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;After new object creation: {0}&quot;</span><span class="token punctuation">,</span> f1<span class="token punctuation">.</span>Val<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 20</span>

        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name">MyClass4</span> a1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Before method call: {0}&quot;</span><span class="token punctuation">,</span> a1<span class="token punctuation">.</span>Val<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 20</span>
            <span class="token function">RefAsParameter</span><span class="token punctuation">(</span><span class="token keyword">ref</span> a1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 复制 a1 引用</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;After method call: {0}&quot;</span><span class="token punctuation">,</span> a1<span class="token punctuation">.</span>Val<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 20</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>引用参数的行为就像是将实参作为形参的别名。</p> <h4 id="输出参数"><a href="#输出参数" class="header-anchor">#</a> 输出参数</h4> <p>输出参数用于从方法体内把数据传出到调用代码，它们的行为与引用参数非常类似。</p> <ul><li>必须在声明和调用中都使用修饰符。输出参数的修饰法是 <code>out</code>。</li> <li>和引用参数相似，实参必须是变量，而不是其他类型的表达式。这是有道理的，因为方法需要内存位置保存返回值。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 输出参数</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">MyClass</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyClass5</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> Val <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">class</span> <span class="token class-name">Program5</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">MyMethod</span><span class="token punctuation">(</span><span class="token keyword">out</span> <span class="token class-name">MyClass4</span> f1<span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token class-name"><span class="token keyword">int</span></span> f2<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            f1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个类变量</span>
            f1<span class="token punctuation">.</span>Val <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>
            f2 <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name">MyClass4</span> a1 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">int</span></span> a2<span class="token punctuation">;</span>
            <span class="token function">MyMethod</span><span class="token punctuation">(</span><span class="token keyword">out</span> a1<span class="token punctuation">,</span> <span class="token keyword">out</span> a2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;After method call: {0}, {1}&quot;</span><span class="token punctuation">,</span> a1<span class="token punctuation">.</span>Val<span class="token punctuation">,</span> a2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>对于输出参数，形参就好像是实参的别名一样，但是还有一个需求，那就是它必须在方法内进行赋值。</p> <h4 id="参数数组"><a href="#参数数组" class="header-anchor">#</a> 参数数组</h4> <p>参数数组允许零个或多个实参对应一个特殊的形参。</p> <ul><li>在一个参数列表中只能有一个参数数组。</li> <li>由参数数组表示的所有参数都必须具有相同的类型。</li></ul> <p>声明一个参数数组必须做的事如下。</p> <ul><li>在数据类型前使用 <code>params</code> 修饰符。</li> <li>在数据类型后放置一组空的方括号。</li></ul> <h5 id="方法调用-2"><a href="#方法调用-2" class="header-anchor">#</a> 方法调用</h5> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 参数数组</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">MyClass</span>
<span class="token punctuation">{</span>
    <span class="token keyword">class</span> <span class="token class-name">MyClass6</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">listInts</span><span class="token punctuation">(</span><span class="token keyword">params</span> <span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> inVals<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>inVals <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>inVals<span class="token punctuation">.</span>Length <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> inVals<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">// 处理数组</span>
                <span class="token punctuation">{</span>
                    inVals<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> inVals<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">;</span>
                    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0}&quot;</span><span class="token punctuation">,</span> inVals<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 显示新值</span>

                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">class</span> <span class="token class-name">Program6</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">int</span></span> first <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">int</span></span> second <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">int</span></span> third <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>
            <span class="token class-name">MyClass6</span> mc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass6</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mc<span class="token punctuation">.</span><span class="token function">listInts</span><span class="token punctuation">(</span>first<span class="token punctuation">,</span> second<span class="token punctuation">,</span> third<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;After method call: {0}, {1}, {2}&quot;</span><span class="token punctuation">,</span> first<span class="token punctuation">,</span> second<span class="token punctuation">,</span> third<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>在使用一个为参数数组分离的调用时，编译器做下面的事：</p> <ul><li>接受实参列表，用它们在堆中创建并初始化一个数组。</li> <li>把数组的引用保存到栈中的数组。</li> <li>如果在对应的形参数组的位置没有实参，编译器会创建一个有零个元素的数组来使用。</li></ul> <h5 id="用数组作实参"><a href="#用数组作实参" class="header-anchor">#</a> 用数组作实参</h5> <p>也可以在方法调用之前创建并组装一个数组，把单一的数组变量作为实参传递。这种情况下，编译器使用你的数组而不是创建一个。</p> <h5 id="参数类型总结"><a href="#参数类型总结" class="header-anchor">#</a> 参数类型总结</h5> <p><img src="/Notebook/assets/img/c-sharp-types.1387f75f.png" alt=""></p> <h4 id="方法重载"><a href="#方法重载" class="header-anchor">#</a> 方法重载</h4> <p>一个类中可以有一个以上的方法具有相同的名称，这叫做方法重载（method overload）。使用相同名称的每个方法必须有一个和其他方法相同的签名（signature）。</p> <ul><li><strong>方法的签名由下列信息组成</strong>：
<ul><li>方法的名称；</li> <li>参数的数目；</li> <li>参数的数据类型和顺序；</li> <li>参数修饰符。</li></ul></li> <li>返回类型不是签名的一部分。</li> <li>请注意，形参的名称也不是签名的一部分。</li></ul> <h4 id="命名参数"><a href="#命名参数" class="header-anchor">#</a> 命名参数</h4> <p>至今我们所有用到的参数都是位置参数，也就是说每一个实参的位置都必须与相应的形参位置一一对应。
此外，C# 还允许我们使用命名参数（named parameter）。只要显式指定参数的名字，就可以以任意顺序在方法调用中列出实参。</p> <ul><li>方法的声明没有什么不一样。形参已经有名字了。</li> <li>不过在方法调用的时候，形参的名字后面跟着冒号和实际的参数值或表达式。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword">double</span></span> <span class="token function">GetCylinderVolume</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">double</span></span> radius<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> height<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">3.1416</span> <span class="token operator">*</span> radius <span class="token operator">*</span> radius <span class="token operator">*</span> height<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">MyClass</span> mc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">double</span></span> volume<span class="token punctuation">;</span>
        volume <span class="token operator">=</span> mc<span class="token punctuation">.</span><span class="token function">GetCylinderVolume</span><span class="token punctuation">(</span><span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token number">4.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        volume <span class="token operator">=</span> mc<span class="token punctuation">.</span><span class="token function">GetCylinderVolume</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">radius</span><span class="token punctuation">:</span> <span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">height</span><span class="token punctuation">:</span> <span class="token number">4.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 更多信息</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="可选参数"><a href="#可选参数" class="header-anchor">#</a> 可选参数</h4> <p>C# 还允许可选参数（optional parameter）。所谓可选参数就是我们可以在调用方法的时候包含这个参数，也可以省略它。</p> <p>对于可选参数的声明，我们需要知道如下几种重要事项：</p> <ul><li>不是所有的参数都可作为可选参数。
<ul><li>只要值类型的默认值在编译的时候可以确定，就可以使用值类型作为可选参数。</li> <li>只有默认值是 null 的时候，引用类型才可以作为可选参数来使用。</li></ul></li></ul> <p><img src="/Notebook/assets/img/optional-parameter.b37ea1d8.png" alt=""></p> <ul><li>所有必填参数（required parameter）必须在可选参数声明之前声明。如果有 parameter 参数，必须在所有可选参数之后声明。</li></ul> <p><img src="/Notebook/assets/img/optional-parameter2.a72dcba2.png" alt=""></p> <p>注意：</p> <ul><li>不能随意省略可选参数的组合，避免使用哪些可选参数不明确。你可以省略最后 n 个可选参数，但是不可以随意选择省略任意的可选参数，省略必须从最后开始。</li> <li>如果需要随意省略可选参数列表中的可选参数，而不是从列表的最后开始，那么必须使用可选参数的名字来消除赋值的歧义。</li></ul> <h4 id="栈桢（调用栈）"><a href="#栈桢（调用栈）" class="header-anchor">#</a> 栈桢（调用栈）</h4> <p>在调用方法的时候，内存从栈的顶部开始分配，保存和方法关联的一些数据项。这块内存叫做方法的栈帧（stack frame）。</p> <ul><li>栈桢的内存保存如下内容：
<ul><li>返回地址，也就是方法退出的时候继续执行的位置；</li> <li>这些参数分配的内存，也就是方法的值参数，或者还可能是参数数组（如果有的话）。</li> <li>各种和方法调用相关的其他数据管理项。</li></ul></li> <li>在方法调用时，整个栈桢都会压入栈。</li> <li>在方法退出的时候，整个栈帧都会压入栈。弹出栈帧有的时候也叫做栈展开（unwind）。</li></ul> <p><img src="/Notebook/assets/img/stack-frame.a6453ec7.png" alt=""></p> <h4 id="递归"><a href="#递归" class="header-anchor">#</a> 递归</h4> <p>除了调用其他方法，方法也可以调用自身。这叫做递归。递归会产生很优雅的代码。调用方法自身的机制和调用其他方法其实是完全一样的。都是为每一次调用把新的栈帧压入栈顶。</p> <h3 id="深入理解类"><a href="#深入理解类" class="header-anchor">#</a> 深入理解类</h3> <h4 id="类成员-2"><a href="#类成员-2" class="header-anchor">#</a> 类成员</h4> <p><img src="/Notebook/assets/img/classs-member-types.d66bd4ad.png" alt=""></p> <h4 id="成员修饰符的顺序"><a href="#成员修饰符的顺序" class="header-anchor">#</a> 成员修饰符的顺序</h4> <p>类成员声明语句由下列部分组成：核心声明、一组可选的修饰符和一组可选的特性（attribute）。用于描述这个结构的语法如下：</p> <p>【特性】【修饰符】核心声明</p> <ul><li>修饰符
<ul><li>如果有修饰符，必须放在核心声明之前。</li> <li>如果有多个修饰符，可以是任意顺序。</li></ul></li> <li>特性
<ul><li>如果有特性，必须放在修饰符和核心声明之前。</li> <li>如果有多个特性，可以是任意顺序。</li></ul></li></ul> <h4 id="实例类成员"><a href="#实例类成员" class="header-anchor">#</a> 实例类成员</h4> <p>类的每个实例拥有自己的各个类成员的副本，这些成员称为实例成员。改变一个实例字段的值不会影响任何其他实例中成员的值。</p> <h4 id="静态字段"><a href="#静态字段" class="header-anchor">#</a> 静态字段</h4> <p>除了实例字段，类还可以拥有静态字段。</p> <ul><li>静态字段被类的所有实例共享，所有实例都访问同一内存位置。因此，如果该内存位置的值被一个实例改变了，这种改变对所有的实例都可见。</li> <li>可以使用 <code>static</code> 修饰符将字段声明为静态。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">class</span> <span class="token class-name">D</span> <span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">int</span></span> Mem1<span class="token punctuation">;</span> <span class="token comment">// 实例字段</span>
    <span class="token keyword">static</span> <span class="token class-name"><span class="token keyword">int</span></span> Mem2<span class="token punctuation">;</span> <span class="token comment">// 静态字段</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>注意：静态成员 Mem2 是与所有实例的存储分开保存的，所以不能通过实例名字访问该静态成员。</p> <h4 id="从类的外部访问静态成员"><a href="#从类的外部访问静态成员" class="header-anchor">#</a> 从类的外部访问静态成员</h4> <p>在前一章中，我们可以使用点运算符可以从类的外部访问 public 实例成员。点运算符由实例名、点和成员组成。</p> <p>就像实例成员，静态成员也可以使用点运算符从类的外部访问。但因为没有实例，所以必须使用类名。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 静态字段</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">MyClass</span>
<span class="token punctuation">{</span>
    <span class="token keyword">class</span> <span class="token class-name">MyClass7</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">int</span></span> Mem1<span class="token punctuation">;</span> <span class="token comment">// 实例字段</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name"><span class="token keyword">int</span></span> Mem2<span class="token punctuation">;</span>  <span class="token comment">// 静态字段</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">class</span> <span class="token class-name">Program7</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>

            <span class="token class-name">MyClass7</span> d1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass7</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">MyClass7</span> d2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass7</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            MyClass7<span class="token punctuation">.</span>Mem2 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;After method call: {0}&quot;</span><span class="token punctuation">,</span> MyClass7<span class="token punctuation">.</span>Mem2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h5 id="静态成员的生存期"><a href="#静态成员的生存期" class="header-anchor">#</a> 静态成员的生存期</h5> <p>静态成员的生命期与实例成员的不同。</p> <ul><li>之前我们已经看到了，只有实例创建之后才产生实例成员，在实例销毁之后实例成员也就不存在了。</li> <li>但是即使类没有实例，也存在静态成员，并且可以访问。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">MyClass</span>
<span class="token punctuation">{</span>
    <span class="token keyword">class</span> <span class="token class-name">MyClass7</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">int</span></span> Mem1<span class="token punctuation">;</span> <span class="token comment">// 实例字段</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name"><span class="token keyword">int</span></span> Mem2<span class="token punctuation">;</span>  <span class="token comment">// 静态字段</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">class</span> <span class="token class-name">Program7</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>

            MyClass7<span class="token punctuation">.</span>Mem2 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;After method call: {0}&quot;</span><span class="token punctuation">,</span> MyClass7<span class="token punctuation">.</span>Mem2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="静态函数成员"><a href="#静态函数成员" class="header-anchor">#</a> 静态函数成员</h4> <p>除了静态字段，还有静态函数成员。</p> <ul><li>如同静态字段，静态函数成员独立于任何实例。即使没有类的实例，仍然可以调用静态方法。</li> <li>静态函数成员不能访问实例成员。然而，它们能访问其他静态成员。</li></ul> <p><img src="/Notebook/assets/img/static-method.35a64f3e.png" alt=""></p> <h4 id="其他静态成员"><a href="#其他静态成员" class="header-anchor">#</a> 其他静态成员</h4> <p><img src="/Notebook/assets/img/static-class-member.a15f9cb9.png" alt=""></p> <h4 id="成员常量"><a href="#成员常量" class="header-anchor">#</a> 成员常量</h4> <p>成员变量类似前一章所述的本地常量，只是它们被声明在类声明中而不是方法内。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">int</span></span> IntVal <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>与 C 和 C++ 不同，在 C# 中没有全局变量。每个常量都必须声明在类型内。</p> <h4 id="常量与静态量"><a href="#常量与静态量" class="header-anchor">#</a> 常量与静态量</h4> <p>然而，成员常量比本地常量更有趣，因为它们表现得像静态值。它们对类的每个实例都是“可见的”，而且即使没有类的实例也可以使用。与真正的静态量不同，常量没有自己的存储位置，而且是编译时被编译器替换。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 静态字段</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">MyClass</span>
<span class="token punctuation">{</span>
    <span class="token keyword">class</span> <span class="token class-name">MyClass7</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">int</span></span> Mem1<span class="token punctuation">;</span> <span class="token comment">// 实例字段</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name"><span class="token keyword">int</span></span> Mem2<span class="token punctuation">;</span>  <span class="token comment">// 静态字段</span>
        <span class="token keyword">public</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">int</span></span> intVal <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">class</span> <span class="token class-name">Program7</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>

            MyClass7<span class="token punctuation">.</span>Mem2 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 可以访问静态字段</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;After method call: {0}, {1}&quot;</span><span class="token punctuation">,</span> MyClass7<span class="token punctuation">.</span>Mem2<span class="token punctuation">,</span> MyClass7<span class="token punctuation">.</span>intVal<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10 100</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="属性"><a href="#属性" class="header-anchor">#</a> 属性</h4> <p>属性是代表类的实例或类中的一个数据项的成员。使用属性看起来非常像写入或读取一个字段，语法是相同的。从语法上无法区分它们。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name">MyClass</span> mc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mc<span class="token punctuation">.</span>MyField <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 给字段赋值</span>
mc<span class="token punctuation">.</span>MyProperty <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 给属性赋值</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>与字段类似，属性有如下特征：</p> <ul><li>它是命名的类成员。</li> <li>它有类型。</li> <li>它可以被赋值和读取。</li></ul> <p><strong>然而与字段不同，属性是一个函数成员。</strong></p> <ul><li>它不为数据存储分配内存。</li> <li>它执行代码。</li></ul> <p>属性是指定的一组两个匹配的、称为访问器的方法。</p> <ul><li>set 访问器为属性赋值。</li> <li>get 访问器从属性获取值。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token return-type class-name"><span class="token keyword">int</span></span> Value <span class="token punctuation">{</span>
    <span class="token keyword">set</span> <span class="token punctuation">{</span>
        SetAccessorCode
    <span class="token punctuation">}</span>
    <span class="token keyword">get</span> <span class="token punctuation">{</span>
        GetAccessorCode
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="属性声明和访问器"><a href="#属性声明和访问器" class="header-anchor">#</a> 属性声明和访问器</h5> <p>set 和 get 访问器有预定义的语法。可以把 set 访问器想象成一个方法，带有单一的参数“设置”属性的值。get 访问器没有参数并从属性返回一个值。</p> <ul><li>set 访问器总是：
<ul><li>拥有一个单独的、隐式的值参，名称为 <code>value</code>，与属性的类型相同；</li> <li>拥有一个返回类型的 <code>void</code>。</li></ul></li> <li>get 访问器总是：
<ul><li>没有参数；</li> <li>拥有一个与属性类型相同的返回类型。</li></ul></li></ul> <p>set 访问器中的隐式参数 <code>value</code> 是一个普通的值参。和其他值参一样，可以用它发送数据到方法体或这种情况中的访问器块。在块的内部，可以像普通变量那样使用 value，包括对它赋值。</p> <p>访问器的其他重点如下：</p> <ul><li>get 访问器的所有执行路径必须包含一条 <code>return</code> 语句，返回一个属性的值。</li> <li>访问器 <code>set</code> 和 <code>get</code> 可以以任何顺序声明，并且，除了这两个访问器外在属性上不允许有其他方法。</li></ul> <h5 id="使用属性"><a href="#使用属性" class="header-anchor">#</a> 使用属性</h5> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 属性</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">MyClass</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">MyClass8</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">int</span></span> TheRealValue<span class="token punctuation">;</span> <span class="token comment">// 后备字段：内存分配</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> MyValue <span class="token comment">// 属性：未分配内存</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">set</span>
      <span class="token punctuation">{</span>
        TheRealValue <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">get</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">return</span> TheRealValue<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program8</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>

      <span class="token class-name">MyClass8</span> mc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      mc<span class="token punctuation">.</span>MyValue <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 赋值：隐式调用 set 方法</span>
      <span class="token class-name"><span class="token keyword">int</span></span> test <span class="token operator">=</span> mc<span class="token punctuation">.</span>MyValue<span class="token punctuation">;</span> <span class="token comment">// 表达式：隐式调用 get 方法</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;After Property set: {0}, {1}&quot;</span><span class="token punctuation">,</span> mc<span class="token punctuation">.</span>MyValue<span class="token punctuation">,</span> test<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h5 id="属性和关联字段"><a href="#属性和关联字段" class="header-anchor">#</a> 属性和关联字段</h5> <p>（PS：这个属性的作用跟 vue 的计算属性的作用和相似。）属性常和字段关联，如上面的一节。一种常见的方式是在类中将字段声明为 <code>private</code> 以封装该字段，并声明一个 <code>public</code> 属性来控制从类的外部对该字段的访问。和属性关联的字段被称为后备字段或后备存储。</p> <h5 id="执行其他计算"><a href="#执行其他计算" class="header-anchor">#</a> 执行其他计算</h5> <p>属性访问符并不局限于仅仅对关联的后备字段传进传出数据。访问器 get 和 set 能执行任何计算，或不执行任何计算。唯一必须的行为是 get 访问器需要返回一个属性类型的值。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 属性</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">MyClass</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">MyClass8</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">int</span></span> TheRealValue<span class="token punctuation">;</span> <span class="token comment">// 后备字段：内存分配</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> MyValue <span class="token comment">// 属性：未分配内存</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">set</span>
      <span class="token punctuation">{</span>
        TheRealValue <span class="token operator">=</span> <span class="token keyword">value</span> <span class="token operator">&gt;</span> <span class="token number">100</span> <span class="token punctuation">?</span> <span class="token number">100</span> <span class="token punctuation">:</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">get</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">return</span> TheRealValue<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program8</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>

      <span class="token class-name">MyClass8</span> mc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      mc<span class="token punctuation">.</span>MyValue <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 赋值：隐式调用 set 方法</span>
      <span class="token class-name"><span class="token keyword">int</span></span> test <span class="token operator">=</span> mc<span class="token punctuation">.</span>MyValue<span class="token punctuation">;</span> <span class="token comment">// 表达式：隐式调用 get 方法</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;After Property set: {0}, {1}&quot;</span><span class="token punctuation">,</span> mc<span class="token punctuation">.</span>MyValue<span class="token punctuation">,</span> test<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h5 id="只读和只写属性"><a href="#只读和只写属性" class="header-anchor">#</a> 只读和只写属性</h5> <p>要想不定义属性的某个访问器，可以忽略访问器的声明。</p> <ul><li>只有 get 访问器的属性称为只读属性。只读属性是一种安全的，把一项数据从类或类的实例中传出，而不允许太多访问方法。</li> <li>只有 set 访问器的属性称为只写属性。只写属性是一种安全的，把一项数据从类的外部传入类，而不允许太多访问的方法。</li> <li>两个访问器中至少有一个必须定义，否则编译器会产生一条错误信息。</li></ul> <h5 id="属性与公共字段"><a href="#属性与公共字段" class="header-anchor">#</a> 属性与公共字段</h5> <h5 id="自动实现属性"><a href="#自动实现属性" class="header-anchor">#</a> 自动实现属性</h5> <h5 id="静态属性"><a href="#静态属性" class="header-anchor">#</a> 静态属性</h5> <h4 id="实例构造函数"><a href="#实例构造函数" class="header-anchor">#</a> 实例构造函数</h4> <p>实例构造函数是一个特殊的方法，它在创建类的每个新实例时执行。</p> <ul><li>构造函数用于初始化类实例的状态。</li> <li>如果希望从类的外部创建类的实例，需要将构造函数声明为 <code>public</code>。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 没有返回类型</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>构造函数的名称和类名相同。</li> <li>构造函数不能有返回值。</li></ul> <h5 id="带参数的构造函数"><a href="#带参数的构造函数" class="header-anchor">#</a> 带参数的构造函数</h5> <p>构造函数在下列方法和其他方法相似。</p> <ul><li>构造函数可以带参数。参数的语法和其他方法完全相同。</li> <li>构造函数可以被重载。</li></ul> <p>在使用创建对象表达式创建类的新实例时，要使用 new 运算符，后面跟着类的某个构造函数。new 运算符使用该构造函数创建类的实例。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 实例构造函数</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">MyClass</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">Class10</span>
  <span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">int</span></span> Id<span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">string</span></span> Name<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token function">Class10</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Id <span class="token operator">=</span> <span class="token number">28</span><span class="token punctuation">;</span>
      Name <span class="token operator">=</span> <span class="token string">&quot;Jecyu&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token function">Class10</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> Val<span class="token punctuation">)</span> <span class="token comment">// 设置 public 在类的外部也能创建类的实例</span>
    <span class="token punctuation">{</span>
      Id <span class="token operator">=</span> Val<span class="token punctuation">;</span>
      Name <span class="token operator">=</span> <span class="token string">&quot;Jecyu&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token function">Class10</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SoundOff</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Name {0}, Id {1}&quot;</span><span class="token punctuation">,</span> Name<span class="token punctuation">,</span> Id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program10</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>

      <span class="token class-name">Class10</span> mc1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Class10</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">Class10</span> mc2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Class10</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">Class10</span> mc3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Class10</span><span class="token punctuation">(</span><span class="token string">&quot;linjy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      mc1<span class="token punctuation">.</span><span class="token function">SoundOff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      mc2<span class="token punctuation">.</span><span class="token function">SoundOff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      mc3<span class="token punctuation">.</span><span class="token function">SoundOff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h5 id="默认构造函数"><a href="#默认构造函数" class="header-anchor">#</a> 默认构造函数</h5> <p>如果在类的声明中没有显式地提供实例构造函数，那么编译器会提供一个隐式的默认构造函数，它有以下特征：</p> <ul><li>没有参数。</li> <li>方法体为空。</li></ul> <p>如果你为类声明了任何构造函数，那么编译器就不会为该类定义默认构造函数。</p> <ul><li>因为已经至少有一个显式定义的构造函数，编译器不会创建任何额外的构造函数。</li> <li>在 Main 中，试图使用不带参数的构造函数创建新的实例。因为没有无参数的构造函数，所以编译器会产生一条错误信息。</li></ul> <h4 id="静态构造函数"><a href="#静态构造函数" class="header-anchor">#</a> 静态构造函数</h4> <p>构造函数也可以声明为 <code>static</code>。实例构造函数初始化类的每个新实例，而 static 构造函数初始化类级别的项。通常，静态构造函数初始化类的静态字段。</p> <ul><li>初始化类级别的项。
<ul><li>在引用任何静态成员之前。</li> <li>在创建类的任何实例之前。</li></ul></li> <li>静态构造函数在以下方面与实例构造函数相似。
<ul><li>静态构造函数的名称必须和类名相同。</li> <li>构造函数不能返回值。</li></ul></li> <li>静态构造函数在以下方面与实例构造函数不同。
<ul><li>静态函数声明中使用 <code>static</code> 关键字。</li> <li>类只能有一个静态构造函数，而且不能带参数。</li> <li>静态构造函数不能有访问修饰符。</li></ul></li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 静态构造函数</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">MyClass</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">RandomNumberClass</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Random</span> RandomKey<span class="token punctuation">;</span> <span class="token comment">// 私有静态字段</span>
    <span class="token keyword">static</span> <span class="token function">RandomNumberClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 静态构造函数</span>
    <span class="token punctuation">{</span>
      RandomKey <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 初始化 RandomKey</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">GetRandomNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> RandomKey<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program11</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>

      <span class="token class-name">RandomNumberClass</span> mc1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RandomNumberClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">RandomNumberClass</span> mc2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RandomNumberClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Next Random #: {0}&quot;</span><span class="token punctuation">,</span> mc1<span class="token punctuation">.</span><span class="token function">GetRandomNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Next Random #: {0}&quot;</span><span class="token punctuation">,</span> mc2<span class="token punctuation">.</span><span class="token function">GetRandomNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>关于静态函数的其他重要内容。</p> <ul><li>类既可以有静态构造函数也可以有实例构造函数。</li> <li>如同静态方法，静态构造函数不能访问所在类的实例成员，因此也不能使用 this 访问器。</li> <li>不能从程序显式调用静态构造函数，系统会自动调用它们，在：
<ul><li>类的任何实例被创建之前；</li> <li>类的任何静态成员被引用之前。</li></ul></li></ul> <h4 id="对象初始化语句"><a href="#对象初始化语句" class="header-anchor">#</a> 对象初始化语句</h4> <p>在此之前的内容中你已经看到，对象创建表达式由关键字 <code>new</code> 后面跟着一个类构造函数及其参数列表组成。<strong>对象初始化语句</strong>扩展了创建语法，在表达式的尾部放置了一组成员初始化语句。这允许你在创建新的对象实例时，设置字段和属性的值。</p> <p>该语法有两种形式，一种形式包括构造函数的参数列表，另一种不包括。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>new TypeName  <span class="token punctuation">{</span>FieldOrProp <span class="token operator">=</span> InitExpr, FieldOrProp <span class="token operator">=</span> InitExpr, <span class="token punctuation">..</span>.<span class="token punctuation">}</span>
new TypeName<span class="token punctuation">(</span>ArgList<span class="token punctuation">)</span>  <span class="token punctuation">{</span>FieldOrProp <span class="token operator">=</span> InitExpr, FieldOrProp <span class="token operator">=</span> InitExpr, <span class="token punctuation">..</span>.<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>关于对象初始化语句要了解的重要内容如下：</p> <ul><li>创建对象的代码必须能够访问要初始化的字段和属性。例如，在下面的代码中，X，Y 必须设置 public 。</li> <li>初始化发生在构造方法执行之后，因此在构造方法中设置的值可能会在之后对象初始化中重置为相同或不相同的值。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 对象初始化语句</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">MyClass</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">Point</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> X <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> Y <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program12</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>

      <span class="token class-name">Point</span> mc1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Point</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">Point</span> mc2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Point</span> <span class="token punctuation">{</span> X <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> Y <span class="token operator">=</span> <span class="token number">6</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Next Random #: {0}, {1}&quot;</span><span class="token punctuation">,</span> mc1<span class="token punctuation">.</span>X<span class="token punctuation">,</span> mc1<span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1，2</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Next Random #: {0}, {1}&quot;</span><span class="token punctuation">,</span> mc2<span class="token punctuation">.</span>X<span class="token punctuation">,</span> mc2<span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5，6</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h4 id="析构函数"><a href="#析构函数" class="header-anchor">#</a> 析构函数</h4> <p>析构函数（destructor）执行在类的实例被销毁之前需要的清理或释放非托管资源的行为。非托管资源是指通过 Win32 API 获得的文件句柄，或非托管模块。</p> <h4 id="readonly-修饰符"><a href="#readonly-修饰符" class="header-anchor">#</a> readonly 修饰符</h4> <p>字段可以用 <code>readonly</code> 修饰符声明。其作用类似于将字段声明为 const，一旦值被设定就不能被改变。</p> <ul><li>const 字段只能在字段的声明初始化语句中初始化，而 readonly 字段可以在下列任意位置设置它的值。</li> <li>const 字段的值必须在编译时决定，而 readonly 字段的值可以在运行时决定。这种增加的自由性允许你在不同的环境或不同的构造函数中设置不同的值。</li> <li>它可以是实例字段，也可以是静态字段。</li> <li>它在内存中有存储位置。</li></ul> <h4 id="this-关键字"><a href="#this-关键字" class="header-anchor">#</a> this 关键字</h4> <p>this 关键字在类中使用，是对当前实例的引用。它只能被用在下列类成员的代码块中。</p> <ul><li>实例构造函数。</li> <li>实例方法。</li> <li>属性和索引器的实例访问器。</li></ul> <p>很明显，因为静态成员不是实例的一部分，所以不能在任何静态函数成员的代码中使用 this 关键字。更适当地说，this 用于下列目的：</p> <ul><li>用于区分类的成员和本地变量或参数；</li> <li>作为调用方法的实参。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// this 关键字</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">MyClass</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">MyClass13</span>
  <span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">int</span></span> Var1 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">ReturnMaxSum</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> Var1<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> Var1 <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token class-name">Var1 <span class="token punctuation">?</span></span> Var1 <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Var1<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program13</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>

      <span class="token class-name">MyClass13</span> mc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass13</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Max: {0}&quot;</span><span class="token punctuation">,</span> mc<span class="token punctuation">.</span><span class="token function">ReturnMaxSum</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Max: {0}&quot;</span><span class="token punctuation">,</span> mc<span class="token punctuation">.</span><span class="token function">ReturnMaxSum</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h4 id="索引器"><a href="#索引器" class="header-anchor">#</a> 索引器</h4> <h5 id="什么是索引器"><a href="#什么是索引器" class="header-anchor">#</a> 什么是索引器</h5> <p>索引器是一组 get 和 set 访问器，与属性类似。</p> <h5 id="索引器和属性"><a href="#索引器和属性" class="header-anchor">#</a> 索引器和属性</h5> <p>索引器和属性有很多方面是相似的。</p> <ul><li>和属性一样，索引器不用分配内存来存储。</li> <li>索引器和属性都主要用来访问其他数据成员，它们与这些成员关联，并为它们提供获取和设置访问。
<ul><li>属性通常表示单独的数据成员。</li> <li>索引器通常表示多个数据成员。</li></ul></li></ul> <p>说明：可以认为索引器是为类的多个数据成员提供 set 和 get 的属性。通过提供索引器，可以在许多可能的数据成员进行选择。索引器本身可以是任何类型，不仅仅是数值类型。</p> <p>关于索引器，还有一些注意事项如下。</p> <ul><li>和属性一样，索引器可以只有一个访问器，也可以两个都有。</li> <li>索引器总是实例成员，因此不能声明为 <code>static</code>。</li> <li>和属性一样，实现 get 和 set 访问器的代码不必一定要关联到某个字段或属性。这段代码可以做任何事情或者什么也不做，只要 get 访问器返回某个指定类型的值即可。</li></ul> <h5 id="声明索引器"><a href="#声明索引器" class="header-anchor">#</a> 声明索引器</h5> <p>声明索引器的语法如下：</p> <ul><li>索引器没有名称。在名称的位置是关键字 this。</li> <li>参数列表在参数中间。</li> <li>参数列表中必须至少声明一个参数。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token return-type class-name">ReturnType</span> <span class="token keyword">this</span> <span class="token punctuation">[</span><span class="token class-name">Type</span> param1<span class="token punctuation">,</span> <span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">set</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h5 id="索引器的-set-访问器"><a href="#索引器的-set-访问器" class="header-anchor">#</a> 索引器的 set 访问器</h5> <p>当索引器被用于赋值时，set 访问器被调用，并接受两项数据。如下：</p> <ul><li>一个隐式参数，名称为 value，value 持有要保存的数据；</li> <li>一个或更多索引参数，表示数据要保存到哪里。</li></ul> <p>在 set 的访问器中的代码必须检查索引参数，以确定数据应该存往何处，然后保存它。</p> <ul><li>它的返回类型为 void。</li> <li>它使用的参数列表和索引器声明中的相同。</li> <li>它有一个名称 value 的隐含参数，值参类型和索引类型相同。</li></ul> <p><img src="/Notebook/assets/img/set-accessor.20db1fb2.png" alt=""></p> <h5 id="索引器的-get-访问器"><a href="#索引器的-get-访问器" class="header-anchor">#</a> 索引器的 get 访问器</h5> <p>当使用索引器获取值时，可以通过一个或多个索引参数，确定它表示的是哪个字段，并返回该字段的值。</p> <p><img src="/Notebook/assets/img/get-accessor.de314ab9.png" alt=""></p> <h5 id="关于索引器的补充"><a href="#关于索引器的补充" class="header-anchor">#</a> 关于索引器的补充</h5> <p>和属性一样，不能显式调用 get 和 set 访问器。取而代之，当索引器用在表达式取值时，将自动调用 get 访问器。当使用赋值语句对索引器赋值时，将自动调用 set 访问器。</p> <h5 id="一个示例"><a href="#一个示例" class="header-anchor">#</a> 一个示例</h5> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 索引器</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">MyClass</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">Employee</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> LastName<span class="token punctuation">;</span> <span class="token comment">// 调用字段 0</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> FirstName<span class="token punctuation">;</span> <span class="token comment">// 调用字段 1</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> CityOfBirth<span class="token punctuation">;</span> <span class="token comment">// 调用字段 2</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token class-name"><span class="token keyword">int</span></span> index<span class="token punctuation">]</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">set</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>index<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
          <span class="token keyword">case</span> <span class="token number">0</span><span class="token punctuation">:</span>
            LastName <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">:</span>
            FirstName <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span>
            CityOfBirth <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
          <span class="token keyword">default</span><span class="token punctuation">:</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentOutOfRangeException</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">get</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>index<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
          <span class="token keyword">case</span> <span class="token number">0</span><span class="token punctuation">:</span> <span class="token keyword">return</span> LastName<span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token keyword">return</span> FirstName<span class="token punctuation">;</span>
          <span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token keyword">return</span> CityOfBirth<span class="token punctuation">;</span>
          <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentOutOfRangeException</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program14</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>

      <span class="token class-name">Employee</span> mc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Employee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      mc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;Lin&quot;</span><span class="token punctuation">;</span>
      mc<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;Jecyu&quot;</span><span class="token punctuation">;</span>
      mc<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;WC&quot;</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Person: {0}, {1}, {2}&quot;</span><span class="token punctuation">,</span> mc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mc<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mc<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><h5 id="索引器重载"><a href="#索引器重载" class="header-anchor">#</a> 索引器重载</h5> <p>只要索引器的参数列表不同，类就可以有任意多个索引器。这叫做索引器重载，因为所有的索引器都有相同的“名称”：this 访问引用。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token keyword">this</span> <span class="token punctuation">[</span><span class="token class-name"><span class="token keyword">int</span></span> index<span class="token punctuation">]</span> <span class="token punctuation">{</span>
    <span class="token keyword">get</span> <span class="token punctuation">{</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
    <span class="token keyword">set</span> <span class="token punctuation">{</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token keyword">this</span> <span class="token punctuation">[</span><span class="token class-name"><span class="token keyword">int</span></span> index1<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> index2<span class="token punctuation">]</span> <span class="token punctuation">{</span>
    <span class="token keyword">get</span> <span class="token punctuation">{</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
    <span class="token keyword">set</span> <span class="token punctuation">{</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token keyword">this</span> <span class="token punctuation">[</span><span class="token class-name"><span class="token keyword">float</span></span> index<span class="token punctuation">]</span> <span class="token punctuation">{</span>
    <span class="token keyword">get</span> <span class="token punctuation">{</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
    <span class="token keyword">set</span> <span class="token punctuation">{</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>请记住，类中重载的索引器必须有不同的参数列表。</p> <h4 id="访问器的访问修饰符"><a href="#访问器的访问修饰符" class="header-anchor">#</a> 访问器的访问修饰符</h4> <p>默认情况下，成员的两个访问器有自身相同的访问级别。也就是说，如果一个属性有 public 级别，那么它的两个访问器都有同样的访问级别，对索引也一样。</p> <p>不过，你可以为两个访问器分配不同的访问级别。如下代码为 set 访问器声明为 <code>private</code>，为 get 访问器声明为 public。注意，在这段代码中，尽管可以从类的外部读取属性，但却只能在类的内部设置它。这是一个非常重要的封装工具。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span>
    <span class="token keyword">get</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Person</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;Jecyu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Person's name is {0}&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>访问器的访问修饰符有几个限制：</p> <ul><li>仅当成员（属性或索引器）既有 get 访问器也有 set 访问器时，其访问器才能有访问修饰符。</li> <li>虽然两个访问器都必须出现，但它们中只能有一个访问修饰符。</li> <li>访问器的访问修饰符必须比成员的访问级别有更严格的限制性。</li></ul> <p><img src="/Notebook/assets/img/accessor-limit-level.4bee696a.png" alt=""></p> <p>如果一个属性的访问级别是 <code>public</code>，在图里较低的 4 个级别中，可以把任意的一个级别给它的一个访问器。但如果属性的访问级别是 <code>protected</code>，唯一能够对访问器使用的访问修饰符是 <code>private</code>。</p> <h4 id="分部类和分部类型"><a href="#分部类和分部类型" class="header-anchor">#</a> 分部类和分部类型</h4> <p>类的声明可以分割为几个类的声明。</p> <ul><li>每个分部类的声明都包含一些类成员的声明。</li> <li>类的分部类声明可以在同一个文件也可以在同一个文件中。</li></ul> <p>每个局部声明必须被标为 <code>partial class</code>，而不是单独的关键字 <code>class</code>。分部类声明看起来和普通类声明相同，除了那个附加的类型修饰符 <code>partial</code>。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 分部方法</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">MyClass</span>
<span class="token punctuation">{</span>
  <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">MyClass15</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">partial</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PrintSum</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> x<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 定义分部方法</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> x<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> y<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token function">PrintSum</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">MyClass15</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">partial</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PrintSum</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> x<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> y<span class="token punctuation">)</span> <span class="token comment">// 实现分部方法</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Sum is {0}&quot;</span><span class="token punctuation">,</span> x <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">class</span> <span class="token class-name">Program15</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">MyClass15</span> mc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass15</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      mc<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h4 id="分部方法"><a href="#分部方法" class="header-anchor">#</a> 分部方法</h4> <p>分部方法是声明在分部类中不同部分的方法。分部部分的不同部分可以声明在不同的分部类中，也可以声明在同一个类中。分部方法的两个部分如下：</p> <ul><li>定义分部方法声明。
<ul><li>给出签名和返回类型。</li> <li>声明的实现部分只是一个分号。</li></ul></li> <li>实现分部方法声明。
<ul><li>给出签名和返回类型。</li> <li>是以正常形式的语句块实现。</li></ul></li></ul> <p>关于分部方法需要了解的重要内容如下：</p> <ul><li>定义声明和实现声明的签名和返回类型必须匹配。签名和返回类型有如下特征：
<ul><li>返回类型必须是 void。</li> <li>签名不能包括访问修饰符，这使部分方法是隐式私有的。</li> <li>参数列表不能包含有 out 参数。</li> <li>在定义声明和实现声明中都必须包含上下文关键字 <code>partial</code>，直接放在关键字 void 之前。</li></ul></li> <li>可以有定义部分而没有实现部分。在这种情况下，编译器把方法的声明以及方法内部任何对方法的调用都移除。不能只有分部方法的实现部分而没有定义部分。</li></ul> <h3 id="类和继承"><a href="#类和继承" class="header-anchor">#</a> 类和继承</h3> <h4 id="类继承"><a href="#类继承" class="header-anchor">#</a> 类继承</h4> <p>通过继承我们可以定义一个新类，新类纳入一个已经声明的类并进行扩展。</p> <ul><li>可以使用一个已经存在的类作为新类的基础。已存在的类称为基类（base class），新类称为派生类（derived class）。派生类的组成成员如下：
<ul><li>本身声明中的成员；</li> <li>基类的成员。</li></ul></li> <li>要声明一个派生类，需要在类名后加入基类规格说明。**基类规格说明由冒号和后面用作基类的类名称组成。**派生类被描述为直接继承自列出的基类。</li> <li>派生类扩展它的基类，因为它包含了基类的成员，加上它在本身声明中的新增功能。、</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">class</span> <span class="token class-name">otherClass</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">SomeClass</span></span> <span class="token punctuation">{</span>
  <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="访问继承的成员"><a href="#访问继承的成员" class="header-anchor">#</a> 访问继承的成员</h4> <p>继承的成员可以被访问，就像它们是派生类自己声明一样。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 类和继承——访问继承的成员</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">MyClass</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">SomeClass</span> <span class="token comment">// 基类</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> Field1 <span class="token operator">=</span> <span class="token string">&quot;base class field&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Method1</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> <span class="token keyword">value</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Base class--Method1:  {0}&quot;</span><span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">otherClass</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">SomeClass</span></span> <span class="token comment">// 派生类</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> Field2 <span class="token operator">=</span> <span class="token string">&quot;derived class field&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Method2</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> <span class="token keyword">value</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Derived class--Method2: {0}&quot;</span><span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>


  <span class="token keyword">class</span> <span class="token class-name">Program16</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">otherClass</span> mc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">otherClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      mc<span class="token punctuation">.</span><span class="token function">Method1</span><span class="token punctuation">(</span>mc<span class="token punctuation">.</span>Field1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 以基类字段为参数的基类方法</span>
      mc<span class="token punctuation">.</span><span class="token function">Method1</span><span class="token punctuation">(</span>mc<span class="token punctuation">.</span>Field2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 以派生字段为参数的基类方法</span>
      mc<span class="token punctuation">.</span><span class="token function">Method2</span><span class="token punctuation">(</span>mc<span class="token punctuation">.</span>Field1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 以基类字段为参数的派生方法</span>
      mc<span class="token punctuation">.</span><span class="token function">Method2</span><span class="token punctuation">(</span>mc<span class="token punctuation">.</span>Field2<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 以派生字段为参数的派生方法</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h4 id="所有类都派生自-object"><a href="#所有类都派生自-object" class="header-anchor">#</a> 所有类都派生自 object</h4> <p>除了特殊的类 <code>object</code> ，所有类都是派生类，即使它们没有基类规格说明。类 object 是唯一的非派生类，因为它是继承层次结构的基础。</p> <p>没有基类规格说明的类隐式地直接派生自类 <code>object</code>。不加基类规格说明只是指定 obecjt 为基类的简写。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">class</span> <span class="token class-name">SomeClass</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// 等价于</span>
<span class="token keyword">class</span> <span class="token class-name">SomeClass</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token keyword">object</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>关于类继承的其他重要内容如下：</p> <ul><li>一个类声明的基类规格说明中只能有一个单独的类，这称为单独类。</li> <li>虽然类只能直接继承一个基类，但是继承的层次没有限制。也就是说作为基类的类可以派生自另外一个类，而这个类又派生自另外一个类，一直下去，直至最终达到 <code>object</code>。</li> <li>所以，通常我们称一个类为派生类时，我们的意思是它直接派生自某类而不是 object。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">class</span> <span class="token class-name">SomeClass</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">OtherClass</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">SomeClass</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">MyNewClass</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">OtherClass</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="屏蔽基类的成员"><a href="#屏蔽基类的成员" class="header-anchor">#</a> 屏蔽基类的成员</h4> <p>虽然派生类不能删除它继承的任何成员，但可以用与基类成员名称相同的成员来屏蔽（mask）基类成员。这是继承的主要功能之一，非常实用。</p> <p>例如，我们要继承包含某个特殊方法的基类。该方法适合声明它的类，但却不一定适合派生类。在这种情况下，我们希望在派生类中声明新成员以屏蔽基类的方法。在派生类中屏蔽基类成员的一些要点如下：</p> <ul><li>要屏蔽一个继承的数据成员，需要声明一个新的相同类型的成员，并使用相同的名称。</li> <li>通过在派生类中声明新的带有相同签名的函数成员，可以隐藏或屏蔽继承的函数成员。请记住，签名由名称和参数列表组成，不包括返回类型。</li> <li><u>要让编译器知道你在故意屏蔽继承的成员，使用 new 修饰符。否则，程序可以成功编译，但编译器会警告你隐藏了一个继承的成员。</u></li> <li>也可以屏蔽静态成员。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 类和继承——屏蔽基类的访问</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">MyClass</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">SomeClass2</span> <span class="token comment">// 基类</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> Field1 <span class="token operator">=</span> <span class="token string">&quot;base class field&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Method1</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> <span class="token keyword">value</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Base class--Method1:  {0}&quot;</span><span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">otherClass2</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">SomeClass</span></span> <span class="token comment">// 派生类</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">new</span> <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> Field1 <span class="token operator">=</span> <span class="token string">&quot;derived class field&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Method1</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> <span class="token keyword">value</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Derived class--Method2: {0}&quot;</span><span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>


  <span class="token keyword">class</span> <span class="token class-name">Program17</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">otherClass2</span> mc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">otherClass2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      mc<span class="token punctuation">.</span><span class="token function">Method1</span><span class="token punctuation">(</span>mc<span class="token punctuation">.</span>Field1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 以基类字段为参数的基类方法</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h4 id="基类的访问"><a href="#基类的访问" class="header-anchor">#</a> 基类的访问</h4> <p>如果派生类必须完全地访问被隐藏的继承成员，可以使用基类访问（base access）表达式访问隐藏的继承成员。基类访问表达式由关键字<code>base</code>后面跟一个点和成员的名称组成，如下：</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 类和继承——屏蔽基类的访问</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">MyClass</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">SomeClass2</span> <span class="token comment">// 基类</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> Field1 <span class="token operator">=</span> <span class="token string">&quot;base class field&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Method1</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> <span class="token keyword">value</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Base class--Method1:  {0}&quot;</span><span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">otherClass2</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">SomeClass</span></span> <span class="token comment">// 派生类</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">new</span> <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> Field1 <span class="token operator">=</span> <span class="token string">&quot;derived class field&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Method1</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> <span class="token keyword">value</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Derived class--Method2: {0}&quot;</span><span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PrintField1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>Field1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 访问派生类</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token keyword">base</span><span class="token punctuation">.</span>Field1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 访问基类</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>


  <span class="token keyword">class</span> <span class="token class-name">Program17</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">otherClass2</span> mc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">otherClass2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      mc<span class="token punctuation">.</span><span class="token function">Method1</span><span class="token punctuation">(</span>mc<span class="token punctuation">.</span>Field1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 以基类字段为参数的基类方法</span>
      mc<span class="token punctuation">.</span><span class="token function">PrintField1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p>如果你的程序代码经常使用这个特性（即访问隐藏的继承成员），你可能想要重新评估类的设计。一般来说能有更好的设计，但是没有其他办法的时候也可以使用这个特性。</p> <h4 id="使用基类的引用"><a href="#使用基类的引用" class="header-anchor">#</a> 使用基类的引用</h4> <p>派生类的实例由基类的实例加上派生类新增的成员组成。派生类的引用指向整个类对象，包括基类部分。</p> <p>如果一个派生类对象的引用，就可以获取该对象基类部分的引用（使用类型转换运算符把该引用转换为基类类型）。类型转换运算符放置在对象引用的前面，由圆括号括起的要被转换成的类名组成。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 类和继承——使用基类的引用</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">MyClass</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">MyBaseClass</span> <span class="token comment">// 基类</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;This is the base class.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">MyDerivedClass</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MyBaseClass</span></span>
  <span class="token punctuation">{</span>
    <span class="token keyword">new</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;This is the derived class.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">class</span> <span class="token class-name">Program18</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">MyDerivedClass</span> derivedClass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyDerivedClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">MyBaseClass</span> mybc <span class="token operator">=</span> <span class="token punctuation">(</span>MyBaseClass<span class="token punctuation">)</span>derivedClass<span class="token punctuation">;</span> <span class="token comment">// 转换成基类</span>
      derivedClass<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从派生类部分调用 Print</span>
      mybc<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从基类部分调用 Print</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h5 id="虚方法和覆写方法"><a href="#虚方法和覆写方法" class="header-anchor">#</a> 虚方法和覆写方法</h5> <p>在上一节看到，当使用基类引用派生类对象时，得到的是基类的成员。<strong>虚方法可以使基类的引用“升至”派生类内。</strong></p> <p>可以使用基类的引用调用派生类（derived class）的方法，只需满足下面的条件：</p> <ul><li>派生类的方法和基类的方法有相同的签名和返回类型。</li> <li>基类的方法使用 <code>virtual</code> 标注。</li> <li>派生类的方法使用 <code>override</code> 标注。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 类和继承——使用基类的引用</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">MyClass</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">MyBaseClass2</span> <span class="token comment">// 基类</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">virtual</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;This is the base class.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">MyDerivedClass2</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MyBaseClass2</span></span>
  <span class="token punctuation">{</span>
    <span class="token keyword">override</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;This is the derived class.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">class</span> <span class="token class-name">Program19</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">MyDerivedClass2</span> derivedClass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyDerivedClass2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">MyBaseClass2</span> mybc <span class="token operator">=</span> <span class="token punctuation">(</span>MyBaseClass2<span class="token punctuation">)</span>derivedClass<span class="token punctuation">;</span>
      derivedClass<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      mybc<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用了 MyDerivedClass2 的方法</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p><img src="/Notebook/assets/img/virtual-override-method.f89e7607.png" alt=""></p> <p>其他关于 <code>virtual</code> 和 <code>override</code> 修饰符的重要信息如下：</p> <ul><li>覆写和被覆写的方法必须有相同的可访问性。换一种说法，被覆写的方法不能是 <code>private</code>，而覆写的方法是 <code>public</code>。</li> <li>不能覆写 <code>static</code> 方法或非虚方法。</li> <li>方法、属性和索引器，以及另一种成员类型事件，都可以被声明为 <code>virtual</code> 和 <code>override</code>。</li></ul> <h5 id="覆写标记为-override-的方法"><a href="#覆写标记为-override-的方法" class="header-anchor">#</a> 覆写标记为 override 的方法</h5> <p>覆写方法可以在继承的任何层次出现。</p> <ul><li>当使用对象基类部分的引用调用一个覆写的方法时，方法的调用被沿派生层次上溯执行，一直到标记为 <code>override</code> 的方法的最高派生（most-derived）版本。</li> <li>如果在更高的派生级别有该方法的其他声明，但没有被标记为 <code>override</code>，那么它们不会被调用。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 类和继承——使用基类的引用</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">MyClass</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">MyBaseClass3</span> <span class="token comment">// 基类</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">virtual</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;This is the base class.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">MyDerivedClass3</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MyBaseClass3</span></span>
  <span class="token punctuation">{</span>
    <span class="token keyword">override</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;This is the derived class.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">SecondDerivedClass</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MyDerivedClass3</span></span>
  <span class="token punctuation">{</span>
    <span class="token keyword">override</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;This is the Second derived class.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program20</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">SecondDerivedClass</span> derivedClass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SecondDerivedClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">MyBaseClass3</span> mybc <span class="token operator">=</span> <span class="token punctuation">(</span>MyBaseClass3<span class="token punctuation">)</span>derivedClass<span class="token punctuation">;</span>
      derivedClass<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// This is the Second derived class.</span>
      mybc<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// This is the Second derived class.</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h5 id="覆盖其他成员类型"><a href="#覆盖其他成员类型" class="header-anchor">#</a> 覆盖其他成员类型</h5> <p>在之前的几节中，我们已经学习了如何在方法上使用 <code>virtual/override</code>。其实在属性事件以及索引器也是一样的。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 类和继承——覆盖其他成员类型</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">MyClass</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">MyBaseClass4</span> <span class="token comment">// 基类</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">int</span></span> _myInt <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> MyProperty
    <span class="token punctuation">{</span>
      <span class="token keyword">get</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">return</span> _myInt<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">MyDerivedClass4</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MyBaseClass4</span></span>
  <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">int</span></span> _myInt <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> MyProperty
    <span class="token punctuation">{</span>
      <span class="token keyword">get</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">return</span> _myInt<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program21</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">MyDerivedClass4</span> derivedClass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyDerivedClass4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">MyBaseClass4</span> mybc <span class="token operator">=</span> <span class="token punctuation">(</span>MyBaseClass4<span class="token punctuation">)</span>derivedClass<span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>derivedClass<span class="token punctuation">.</span>MyProperty<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>mybc<span class="token punctuation">.</span>MyProperty<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h4 id="构造函数的执行"><a href="#构造函数的执行" class="header-anchor">#</a> 构造函数的执行</h4> <ul><li>继承层次链中每个类在执行它自己的函数构造函数体之前执行它的基类构造函数。</li> <li>要创造对象的基类对象部分，需要隐式调用基类的某个构造函数作为创建实例过程的一部分。</li></ul> <p>创建一个实例过程中完成的第一件事就是初始化对象的所有实例成员。在此之后，调用基类的构造函数，然后才执行该类自己的构造函数体。</p> <p><img src="/Notebook/assets/img/object-create-process.f00df8eb.png" alt=""></p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">class</span> <span class="token class-name">MyDerivedClass</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MyBaseClass</span></span> <span class="token punctuation">{</span>
  <span class="token class-name"><span class="token keyword">int</span></span> MyField1 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 1. 成员初始化</span>
  <span class="token class-name"><span class="token keyword">int</span></span> MyField2<span class="token punctuation">;</span>  <span class="token comment">// 成员初始化</span>

  <span class="token keyword">public</span> <span class="token function">MyDerivedClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment">// 3. 构造函数体执行</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">MyBaseClass</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> MyBaseClass <span class="token punctuation">{</span>  <span class="token comment">// 2. 基类构造函数调用</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h5 id="构造函数初始化语句"><a href="#构造函数初始化语句" class="header-anchor">#</a> 构造函数初始化语句</h5> <p>默认情况下，在构造对象时，将调用基类的无参构造函数。但构造函数可以重载，所以基类可能有一个以上的构造函数。如果希望派生类使用一个指定的基类构造函数而不是无参构造函数，必须在构造函数初始化语句中指定它。</p> <p>有两种形式的构造函数初始化语句。</p> <ul><li>第一种形式使用关键字 base 并指明使用哪一个基类构造函数。</li> <li>第二种形式使用关键字 this 并指明应该使用当前类的哪一个构造函数。</li></ul> <p>基类构造函数初始化语句放在冒号后面，冒号紧跟着类的构造函数声明的参数列表。构造函数初始化语句由关键字 base 和要调用的基类构造函数的参数列表组成。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">public</span> <span class="token function">MyDerivedClass</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> x<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> s<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>另一种方式（后续补充）</p> <h5 id="类访问修饰符"><a href="#类访问修饰符" class="header-anchor">#</a> 类访问修饰符</h5> <p>类可以被系统其他类看到并访问。</p> <p>可访问的（accessible）有时也称为可见的（visible），它们可以互换使用。类的可访问性有两个级别：<code>public</code> 和 <code>internal</code>。</p> <ul><li>标记为 <code>public</code> 的类可以被系统内任何程序集中的代码访问。要使一个类对其他<code>程序集</code>可见，使用 <code>public</code> 访问修饰符。</li> <li>标记为 <code>internal</code> 类只能被它自己所在的程序集内的看到。
<ul><li>这是默认的可访问级别，所以，除非在类的声明中显式的指定修饰符 <code>public</code>，程序集外部的代码不能访问该类。</li> <li>可以使用 <code>inernal</code> 访问修饰符显式地声明一个类为内部的。</li></ul></li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBaseClass</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">internal</span> <span class="token keyword">class</span> <span class="token class-name">MyBaseClass</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/Notebook/assets/img/class-accessible.fc52443d.png" alt=""></p> <h4 id="程序集间的继承"><a href="#程序集间的继承" class="header-anchor">#</a> 程序集间的继承</h4> <ol><li>选中当前的项目，编辑器选择项目-》编辑引用-》勾选要继承的程序集</li> <li>要继承的项目程序集，声明为 <code>public</code> 。</li> <li>在要使用的项目文件中，using 命名空间使用即可。</li></ol> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 源文件名称 Assembly1.cs</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token return-type class-name">namspace</span> BaseClassNS <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBaseClass</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PrintMe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;I am MyBaseClass.&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 源文件名称 Assembly2.cs</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">BaseClassNS</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">MyDerivedClass</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MyBaseClass</span></span> <span class="token punctuation">{</span> <span class="token comment">// 在其他程序集的基类</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="成员访问修饰符"><a href="#成员访问修饰符" class="header-anchor">#</a> 成员访问修饰符</h4> <p>声明在类中的每个成员对系统的不同部分可见，这依赖于类声明中指派给它的访问修饰符</p> <ul><li>所有显式声明在类声明中的成员是互相可见的，无论它们的访问性如何。</li> <li>继承的成员不在类的声明中显式声明，所以，如你所见，继承的成员对派生类的成员可以是可见的，也可以是不可见的。</li> <li>以下是 5 个成员访问级别的名称。
<ul><li>public</li> <li>private</li> <li>protected</li> <li>internal</li> <li>protected internal</li></ul></li> <li>必须对每个成员指定成员访问级别。如果不指定某个成员的访问级别，它的隐式访问级别为 <code>private</code>。</li> <li>成员不能比它的类有更高的可访问性。也就是说，如果一个类的可访问性限于它所在的程序集，那么类的成员个体也不能从程序集的外部看到，无论它们的访问修饰符是什么，<code>public</code> 也不例外。</li></ul> <h5 id="访问成员的区域"><a href="#访问成员的区域" class="header-anchor">#</a> 访问成员的区域</h5> <p>类通过成员的访问修饰符指明了哪些成员可以被其他类访问。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> Member1<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">int</span></span> Member2<span class="token punctuation">;</span>
  <span class="token keyword">protected</span> <span class="token class-name"><span class="token keyword">int</span></span> Member3<span class="token punctuation">;</span>
  <span class="token keyword">internal</span> <span class="token class-name"><span class="token keyword">int</span></span> Member4<span class="token punctuation">;</span>
  <span class="token keyword">protected</span> <span class="token keyword">internal</span> <span class="token class-name"><span class="token keyword">int</span></span> Member5<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>另一个类（如类 B）能否访问这些成员取决于该类的两个特征：</p> <ul><li>类 B 是否派生自 MyClass 类。</li> <li>类 B 是否和 MyClass 类在同一程序集。</li></ul> <p>这两个特征划分出 4 个集合。</p> <ul><li>在同一程序集且继承 MyClass。</li> <li>在同一程序集但不继承 MyClass。</li> <li>在不同的程序集且继承 MyClass。</li> <li>在不同的程序集但不继承 MyClass。</li></ul> <h5 id="公有成员的可访问性"><a href="#公有成员的可访问性" class="header-anchor">#</a> 公有成员的可访问性</h5> <p><code>public</code> 访问级别是限制性最少的。所有的类，包括程序集内部的类和外部的类都可以自由地访问成员。
公有类的公有成员对同一程序集或其他程序集的所有类可见。</p> <h5 id="私有成员的可访问性"><a href="#私有成员的可访问性" class="header-anchor">#</a> 私有成员的可访问性</h5> <p>私有成员的限制级别是最严格的。</p> <ul><li><code>private</code> 类成员只能被它自己的类成员访问。它不能被其他的类访问，包括继承它的类。</li> <li>然而，<code>private</code> 成员能被嵌套在它的类中的类成员访问。</li></ul> <p>任何类的私有成员只对它自己的类（或嵌套类）的成员可见。</p> <h5 id="受保护成员的可访问性"><a href="#受保护成员的可访问性" class="header-anchor">#</a> 受保护成员的可访问性</h5> <p><code>protected</code> 访问级别如同 <code>private</code> 访问级别，除了一点，它允许派生自该类的类访问该成员。</p> <p><img src="/Notebook/assets/img/protected-member.65a4cb4e.png" alt=""></p> <h5 id="内部成员的可访问性"><a href="#内部成员的可访问性" class="header-anchor">#</a> 内部成员的可访问性</h5> <p>标记为 <code>internal</code> 的成员对程序集内部的所有类可见，但对程序集外部的类不可见。</p> <p><img src="/Notebook/assets/img/internal-member.120fb4a8.png" alt=""></p> <h5 id="受保护内部成员的可访问性"><a href="#受保护内部成员的可访问性" class="header-anchor">#</a> 受保护内部成员的可访问性</h5> <p>标记为 <code>protected internal</code> 的成员对所有继承该类的类以及所有程序集内部的类可见。注意，这是<code>protected</code> 和 <code>internal</code> 的并集，不是交集。</p> <p><img src="/Notebook/assets/img/protected-internal-member.1e000ee9.png" alt=""></p> <h5 id="成员访问修饰符小结"><a href="#成员访问修饰符小结" class="header-anchor">#</a> 成员访问修饰符小结</h5> <p><img src="/Notebook/assets/img/member-accessible-summary.447016d6.png" alt=""></p> <h4 id="抽象成员"><a href="#抽象成员" class="header-anchor">#</a> 抽象成员</h4> <p>抽象成员是指设计为被覆写的函数成员。</p> <ul><li>必须是一个函数成员。也就是说，字段和常量不能为抽象成员。</li> <li>必须用 <code>abstract</code> 修饰符标记。</li> <li>不能有实现代码块。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">abstract</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PrintStuff</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">abstract</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> MyProperty <span class="token punctuation">{</span>
  <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token comment">// 分号替换实现</span>
  <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token comment">// 分号替换实现</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>抽象成员只可以在<code>抽象类</code>中声明。一共有 4 个类型的成员可以声明为抽象的：</p> <ul><li>方法；</li> <li>事件；</li> <li>属性；</li> <li>索引。</li></ul> <p>关于抽象成员的其他重要事项如下：</p> <ul><li>尽管抽象成员必须在派生类中用相应的成员覆写，但不能把 <code>virtual</code> 修饰符附加到 <code>abstract</code> 修饰符。</li> <li>类似虚成员，派生类中抽象成员的实现必须指定 <code>override</code> 修饰符。</li></ul> <p><img src="/Notebook/assets/img/virtual-vs-abstract-member.7dc88889.png" alt=""></p> <h4 id="抽象类"><a href="#抽象类" class="header-anchor">#</a> 抽象类</h4> <p>抽象类就是指设计为被继承的类。抽象类只能被用作其他类的基类。</p> <ul><li>不能创建抽象类的实例。</li> <li>抽象类使用 <code>abstract</code> 修饰符声明。</li> <li>抽象类可以包含抽象成员或普通的非抽象成员。抽象类的成员可以是抽象员和普通带实现的成员的任意组合。</li> <li>抽象类自己可以派生自另一个抽象类。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 类和继承——抽象类</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">MyClass</span>
<span class="token punctuation">{</span>
  <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbClass</span> <span class="token comment">// 抽象类</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">IdentifyBase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 普通方法</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;I am AbClass.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">abstract</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">IdentifyDerived</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 抽象方法</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">class</span> <span class="token class-name">DerivedClass</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">AbClass</span></span>
  <span class="token punctuation">{</span>
    <span class="token keyword">override</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">IdentifyDerived</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;I am DerivedClass.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">class</span> <span class="token class-name">Program23</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">DerivedClass</span> mc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DerivedClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      mc<span class="token punctuation">.</span><span class="token function">IdentifyBase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      mc<span class="token punctuation">.</span><span class="token function">IdentifyDerived</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h4 id="密封类"><a href="#密封类" class="header-anchor">#</a> 密封类</h4> <p>在上一节中，你看到抽象类必须用作基类，它不能像独立的类那样被实例化。密封类与它相反。</p> <ul><li>密封类只能被用作独立的类，它不能被用作基类。</li> <li>密封类使用 <code>sealed</code> 修饰符标注。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
  <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="静态类"><a href="#静态类" class="header-anchor">#</a> 静态类</h4> <p>静态类中所有成员都是静态的。静态类用于存放不受实例数据影响的数据和函数。静态类的一个常见用途可能就是创建一个包含一组数学方法和值的数学库。</p> <ul><li>类本身必须标记为 <code>static</code>。</li> <li>类的所有成员必须是静态的。</li> <li>类可以有一个静态构造函数，但不能有实例构造函数，不能创建该类的实例。</li> <li>静态类是隐式密封的，也就是说，不能继承静态类。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 类和继承——静态类</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">MyClass</span>
<span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMath</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name"><span class="token keyword">float</span></span> PI <span class="token operator">=</span> <span class="token number">3.14f</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">IsOdd</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> x<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">Times2</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> x<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">class</span> <span class="token class-name">Program24</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">int</span></span> val <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0} is odd is {1}.&quot;</span><span class="token punctuation">,</span> val<span class="token punctuation">,</span> MyMath<span class="token punctuation">.</span><span class="token function">IsOdd</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0} * 2 = {1}.&quot;</span><span class="token punctuation">,</span> val<span class="token punctuation">,</span> MyMath<span class="token punctuation">.</span><span class="token function">Times2</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h4 id="扩展方法"><a href="#扩展方法" class="header-anchor">#</a> 扩展方法</h4> <p>在迄今为止的内容中，你看到的每个方法都和声明它的类关联。<u>扩展方法特性扩展了这个边界，允许编写的方法和声明它的类之外的类关联。</u></p> <p>想知道如何使用这个特性，请看下面的代码。它包含类 MyData，该类存储 3 个 double 类型的值，并含有一个构造函数和一个名称为 Sum 的方法，该方法返回 3 个存储值的和。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 类和继承——扩展方法</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">MyClass</span>
<span class="token punctuation">{</span>
  <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">MyData</span> <span class="token comment">// 密封类</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">double</span></span> D1<span class="token punctuation">,</span> D2<span class="token punctuation">,</span> D3<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token function">MyData</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">double</span></span> d1<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> d2<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">double</span></span> d3<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      D1 <span class="token operator">=</span> d1<span class="token punctuation">;</span>
      D2 <span class="token operator">=</span> d2<span class="token punctuation">;</span>
      D3 <span class="token operator">=</span> d3<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> <span class="token function">Sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> D1 <span class="token operator">+</span> D2 <span class="token operator">+</span> D3<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>


  <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ExtendMyData</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> <span class="token function">Average</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">MyData</span> md<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> md<span class="token punctuation">.</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program25</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">MyData</span> md <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyData</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Sum: {0}&quot;</span><span class="token punctuation">,</span> md<span class="token punctuation">.</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Average: {0}&quot;</span><span class="token punctuation">,</span> md<span class="token punctuation">.</span><span class="token function">Average</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h4 id="命名约定"><a href="#命名约定" class="header-anchor">#</a> 命名约定</h4> <p><img src="/Notebook/assets/img/name-convention.1099239e.png" alt=""></p> <h3 id="表达式和运算符"><a href="#表达式和运算符" class="header-anchor">#</a> 表达式和运算符</h3> <h4 id="表达式"><a href="#表达式" class="header-anchor">#</a> 表达式</h4> <p>运算符是一个符号，它表示返回单个结果的操作。操作数（operand）是指作为运算符输入的数据元素。一个运算符会：</p> <ul><li>将操作数作为输入；</li> <li>执行某个操作；</li> <li>基于该操作返回一个值。</li></ul> <p>表达式是运算符和操作数的字符串。可以作为操作数的结构有：</p> <ul><li>字面量；</li> <li>常量；</li> <li>变量；</li> <li>方法调用；</li> <li>元素访问器，如数组访问器和索引器；</li> <li>其他表达式。</li></ul> <p>表达式可以使用运算符连接以创建其他表达式。</p> <p>表达式求值（evaluate）是将每个运算符应用到它的操作数的过程，以适当的顺序产生一个值。</p> <ul><li>值被返回到表达式求值的位置。在那里，它可能是一个封闭的表达式的操作数。</li> <li>除了返回值以外，一些表达式还有副作用，比如在内存中设置一个值。</li></ul> <h4 id="字面量"><a href="#字面量" class="header-anchor">#</a> 字面量</h4> <p><strong>字面量</strong>（literal）是源代码中键入的数字或字符串，表示一个指定类型的明确的、固定的值。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0}&quot;</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 整数字面量</span>
  Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0}&quot;</span><span class="token punctuation">,</span> <span class="token number">3.1416</span>）<span class="token punctuation">;</span> <span class="token comment">// 双精度字面量</span>
  Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0}&quot;</span><span class="token punctuation">,</span> <span class="token number">3.1416F</span>）<span class="token punctuation">;</span> <span class="token comment">// 浮点型字面量</span>
  Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0}&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span>）<span class="token punctuation">;</span> <span class="token comment">// 布尔型字面量</span>
  Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0}&quot;</span><span class="token punctuation">,</span> <span class="token string character">'x'</span>）<span class="token punctuation">;</span> <span class="token comment">// 字符型字面量</span>
  Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0}&quot;</span><span class="token punctuation">,</span> 'Hi there'）<span class="token punctuation">;</span> <span class="token comment">// 字符串字面量</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>因为字面量是写进源代码，所以它们的值必须在编译时可知。</p> <ul><li>bool 有两个字面量：true 和 false。</li> <li>对于引用类型变量，字面量 null 表示变量没有设置为内存中的数据。</li></ul> <h5 id="整数字面量"><a href="#整数字面量" class="header-anchor">#</a> 整数字面量</h5> <ul><li>没有小数点；</li> <li>带有可选的后缀，指明整数的类型。</li></ul> <h5 id="实数字面量"><a href="#实数字面量" class="header-anchor">#</a> 实数字面量</h5> <ul><li>十进制数字；</li> <li>一个可选的小数点；</li> <li>一个可选的指数部分；</li> <li>一个可选的后缀。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">float</span></span> f1 <span class="token operator">=</span> <span class="token number">236F</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">double</span></span> d1 <span class="token operator">=</span> <span class="token number">236.714</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">double</span></span> d2 <span class="token operator">=</span> <span class="token number">.35192</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">double</span></span> d3 <span class="token operator">=</span> <span class="token number">6.338e-26</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h5 id="字符字面量"><a href="#字符字面量" class="header-anchor">#</a> 字符字面量</h5> <p>字符字面量由两个单引号内的字符组成。字符字面量可以是下面任意一种：单个字符、一个简单转义序列、一个十六进制转义序列或一个 Unicode 转义序列。</p> <ul><li>字符字面量的类型是 char。</li> <li>简单转义序列是一个反斜杠后面跟着单个字符。</li> <li>十六进制转义序列是一个反斜杠，后面跟着一个大写或小写的 x，后面再跟着 4 个十六进制数字。</li> <li>Unicode 转义序列是一个反斜杠，后面跟着一个大写或小写的 u，后面再跟着 4 个十六进制数字。</li></ul> <p>例如，下面的代码展示了字符字面量的不同格式：</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">char</span></span> c1 <span class="token operator">=</span> <span class="token string character">'d'</span><span class="token punctuation">;</span> <span class="token comment">// 单个字符</span>
<span class="token class-name"><span class="token keyword">char</span></span> c2 <span class="token operator">=</span> <span class="token string character">'\n'</span><span class="token punctuation">;</span> <span class="token comment">// 简单转义字符</span>
<span class="token class-name"><span class="token keyword">char</span></span> c3 <span class="token operator">=</span> <span class="token string character">'\x0061'</span><span class="token punctuation">;</span> <span class="token comment">// 十六进制转义字符</span>
<span class="token class-name"><span class="token keyword">char</span></span> c4 <span class="token operator">=</span> <span class="token string character">'\u005a'</span><span class="token punctuation">;</span>  <span class="token comment">// Unicode 转义字符</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h5 id="字符串字面量"><a href="#字符串字面量" class="header-anchor">#</a> 字符串字面量</h5> <p>字符串字面量使用双引号标记，不同于字符字面量使用单引号。有两种字符串字面量类型：</p> <ul><li>常规字符串字面量；</li> <li>逐字字符串字面量。</li></ul> <p>常规字符串字面量由双引号内的字符序列组成。规则字符串字面量可以包含：</p> <ul><li>字符；</li> <li>简单转义序列；</li> <li>十六进制和 Unicode 转义序列。</li></ul> <p>例如：</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">string</span></span> st1 <span class="token operator">=</span> <span class="token string">&quot;Hi there&quot;</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">string</span></span> st2 <span class="token operator">=</span> <span class="token string">&quot;Val1\t5, Val2\t10&quot;</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">string</span></span> st3 <span class="token operator">=</span> <span class="token string">&quot;Add\x000ASome\u0007Interest&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>逐字字符串字面量的书写如同常规字符串字面量，但它以一个<code>@</code>字符为前缀。逐字字符串字面量有如下特征：</p> <ul><li>逐字字面量与常规字符串字面量区别在于转义字符串不会被求值。在双引号中间的所有内容，包括通常被认为是转义序列的内容，都被严格按字符串中列出的那样打印。</li> <li>逐字字面量的唯一例外是相邻的双引号组，它们被解释为单个双引号字符。</li></ul> <h4 id="求值顺序"><a href="#求值顺序" class="header-anchor">#</a> 求值顺序</h4> <p>表达式可以由许多嵌套的子表达式构成。子表达式的求值顺序可以使表达式的最终值发生变化。</p> <h5 id="优先级"><a href="#优先级" class="header-anchor">#</a> 优先级</h5> <p><img src="/Notebook/assets/img/Operator-precedence.c67354a9.png" alt=""></p> <h5 id="结合性"><a href="#结合性" class="header-anchor">#</a> 结合性</h5> <p>假设编译器正在计算一个表达式，且该表达式中所有运算符都有不同的优先级，那么编译器将计算每个子表达式，从级别最高的开始，按照优先级一直计算下去。</p> <p>但如果两个连续的运算符具有相同的优先级别怎么办？例如，已知表达式<code>2/6*4</code>。</p> <p>当连续的运算符有相同的优先级时，求值顺序由操作结合性决定。也就是说，已知两个相同优先级的运算符，依照运算符的结合性，其中的一个或另一个优先。运算符结合性的一些重要特征如下：</p> <ul><li>左结合运算符从左到右求值。</li> <li>右结合运算符从右到左求值。</li> <li>除赋值运算符以外，其他二元运算符是左结合的。</li> <li>赋值运算符和条件运算符是右结合的。</li></ul> <table><thead><tr><th>运算符类型</th> <th>结合性</th></tr></thead> <tbody><tr><td>赋值运算符</td> <td>右结合</td></tr> <tr><td>其他二元运算符</td> <td>左结合</td></tr> <tr><td>条件运算符</td> <td>右结合</td></tr></tbody></table> <p>可以使用圆括号显式地设定子表达式的求值顺序。括号内的子表达式：</p> <ul><li>覆盖优先级和结合性规则；</li> <li>求值顺序从嵌套的最内层到最外层。</li></ul> <h4 id="简单算术运算符"><a href="#简单算术运算符" class="header-anchor">#</a> 简单算术运算符</h4> <table><thead><tr><th>运算符</th> <th>名称</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td>+</td> <td>加</td> <td style="text-align:left;">计算两个操作数的和</td></tr> <tr><td>-</td> <td>减</td> <td style="text-align:left;">从第一个操作数中减去第二个操作数</td></tr> <tr><td>*</td> <td>乘</td> <td style="text-align:left;">求两个操作数的和</td></tr> <tr><td>/</td> <td>除</td> <td style="text-align:left;">用第二个操作数除第一个。整数除法，截取整数部分到最近的整数</td></tr></tbody></table> <h4 id="求余运算符"><a href="#求余运算符" class="header-anchor">#</a> 求余运算符</h4> <p>求余运算符（%）用第二个操作数除第一个操作数，忽略掉商，并返回余数。</p> <table><thead><tr><th>运算符</th> <th>名称</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td>%</td> <td>求余</td> <td style="text-align:left;">用第二个操作数除第一个操作数并返回余数</td></tr></tbody></table> <p>求余运算符还可以用于实数以得到实余数。</p> <h4 id="关系比较运算符和相等比较运算符"><a href="#关系比较运算符和相等比较运算符" class="header-anchor">#</a> 关系比较运算符和相等比较运算符</h4> <p>关系比较运算符和相等比较运算符是二元运算符，比较它们的操作数并返回 bool 型值。</p> <table><thead><tr><th>运算符</th> <th>名称</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td>&lt;</td> <td>小于</td> <td style="text-align:left;">如果第一个操作数小于第二个操作数，返回 true，否则返回 false</td></tr> <tr><td>&gt;</td> <td>大于</td> <td style="text-align:left;">如果第一个操作数大于第二个操作数，返回 true，否则返回 false</td></tr> <tr><td>&lt;=</td> <td>小于等于</td> <td style="text-align:left;">如果第一个操作数小于等于第二个操作数，返回 true，否则返回 false</td></tr> <tr><td>&gt;=</td> <td>大于等于</td> <td style="text-align:left;">如果第一个操作数大于等于第二个操作数，返回 true，否则返回 false</td></tr> <tr><td>==</td> <td>等于</td> <td style="text-align:left;">如果第一个操作数等于第二个操作数，返回 true，否则返回 false</td></tr> <tr><td>!=</td> <td>不等于</td> <td style="text-align:left;">如果第一个操作数不等于第二个操作数，返回 true，否则返回 false</td></tr></tbody></table> <p>说明：与 C 和 C++ 不同，在 C# 中数字不具有布尔意义。</p> <h5 id="比较操作和相等性操作"><a href="#比较操作和相等性操作" class="header-anchor">#</a> 比较操作和相等性操作</h5> <p>对于大多数引用类型来说，比较它们的相等性时，将只比较它们的引用。</p> <ul><li>如果引用相等，也就是说，如果它们指向内存中相同对象，那么相等性比较为 true，否则为 false，即使内存中两个分离的对象在所有其他方面都完全相等。</li> <li>这称为浅比较。</li></ul> <p>string 类型对象也是引用类型，但它的比较方式不同。比较字符串的相等性时，将比较它们的长度和内容（区分大小写）。</p> <ul><li>如果两个字符串有相同的长度和内容（区分大小写），那么相等性比较返回 true，即使它们占用不同的内存区域。</li> <li>这称为深比较（deep comparcomparison）</li></ul> <p>委托也是引用类型，比较委托的相等时，如果两个委托都是 null，或两者的调用列表中有相同数目的成员，并且调用列表相匹配，那么返回 true。</p> <p>比较数值表达式时，将比较类型和值。比较 enum 类型时，比较操作数的实际值。</p> <h4 id="递增运算符和递减运算符"><a href="#递增运算符和递减运算符" class="header-anchor">#</a> 递增运算符和递减运算符</h4> <p>递增运算符对操作数加 1。递减运算符对操作数减 1。</p> <table><thead><tr><th>运算符</th> <th>名称</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td>++</td> <td>前置递增++var</td> <td style="text-align:left;">变量的值+1 并保存，返回变量的新值</td></tr> <tr><td>后置递增 var++</td> <td>变量的值+1 并保存，返回变量递增之前的旧值</td> <td style="text-align:left;"></td></tr> <tr><td>--</td> <td>前置递减--var</td> <td style="text-align:left;">变量的值-1 并保存，返回变量的新值</td></tr> <tr><td>后置递增 var--</td> <td>变量的值-1 并保存，返回变量递增之前的旧值</td> <td style="text-align:left;"></td></tr></tbody></table> <p>比较这两种运算符的前置和后置形式</p> <ul><li>无论运算符使用前置形式还是后置形式，在语句执行之后，最终存放在操作数的变量中的值是相同的。</li> <li>唯一不同的是运算符返回给表达式的值。</li></ul> <table><thead><tr><th>运算符</th> <th>表达式：x=10</th> <th>返回给表达式的值</th> <th>计算后变量的值</th></tr></thead> <tbody><tr><td>前置递增</td> <td>++x</td> <td>11</td> <td>11</td></tr> <tr><td>后置递增</td> <td>x++</td> <td>10</td> <td>11</td></tr> <tr><td>前置递减</td> <td>--x</td> <td>9</td> <td>9</td></tr> <tr><td>后置递增</td> <td>x--</td> <td>10</td> <td>9</td></tr></tbody></table> <h4 id="条件逻辑运算符"><a href="#条件逻辑运算符" class="header-anchor">#</a> 条件逻辑运算符</h4> <p>逻辑运算符用于比较或否定它们的操作数的逻辑值，并返回结果逻辑值。</p> <p>逻辑与（AND）和逻辑或（OR）运算符是二元左结合运算符。逻辑非（NOT）是一元运算符。</p> <table><thead><tr><th>运算符</th> <th>名称</th> <th>描述</th></tr></thead> <tbody><tr><td>&amp;&amp;</td> <td>与</td> <td>如果两个操作数都是 true，结果为 true；否则为 fale</td></tr> <tr><td>||</td> <td>或</td> <td>如果至少一个操作数是 true，结果为 true；否则为 false</td></tr> <tr><td>!</td> <td>非</td> <td>如果操作数是 false，结果为 true；否则为 false</td></tr></tbody></table> <p>条件逻辑运算符使用“短路”（short circuit）模式操作，意思是，如果计算 Expr1 之后结果已经确定，那么它就会跳过 Expr2 的值。</p> <p>由于这种短路行为，不要在 Expr2 中放置带副作用的表达式（比如改变一个值），因为可能不会计算。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">bool</span></span> bVal<span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">int</span></span> iVal <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
bVal <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token number">9</span> <span class="token operator">==</span> iVal<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 结果 bVal = false，iVal = 10</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="逻辑运算符"><a href="#逻辑运算符" class="header-anchor">#</a> 逻辑运算符</h4> <p>按位逻辑运算符常用于设置位置组（bit pattern）的方法参数。这些运算符，除按位非运算符以外，都是二元左结合运算符，按位非是一元运算符。</p> <table><thead><tr><th>运算符</th> <th>名称</th> <th>描述</th></tr></thead> <tbody><tr><td>&amp;</td> <td>位与</td> <td>产生两个操作数的按位与。仅当两个操作位都为 1 时结果位才是 1</td></tr> <tr><td>|</td> <td>位或</td> <td>产生两个操作数的按位或。只要任意一个操作位为 1 结果位就是 1</td></tr> <tr><td>^</td> <td>位异或</td> <td>产生两个操作数的按位异或。仅当一个而不是两个操作数为 1 时结果位为 1</td></tr> <tr><td>~</td> <td>位非</td> <td>操作数的每个位都取反。该操作得到操作数的二进制反码（数字的反码是其二进制形式按位取反的结果。也就是说，每个 0 都变成 1，每个 1 都变成 0）</td></tr></tbody></table> <p><img src="/Notebook/assets/img/bitwise-logical-operator.79d6a7e8.png" alt=""></p> <h4 id="移位运算符"><a href="#移位运算符" class="header-anchor">#</a> 移位运算符</h4> <p>按位移位运算向左或向右把位组移动指定数量个位置，空出的位用 0 或 1 填充。</p> <p>移位运算符是二元左结合运算符。按位移位运算符如下所示。移动的位置数由 Count 给出。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code>Operand <span class="token operator">&lt;&lt;</span> Count <span class="token comment">// 左移</span>
Operand <span class="token operator">&gt;&gt;</span> Count <span class="token comment">// 右移</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>| 运算符 | 名称 | 描述 |
| ------ | ---- | ---- ||
| &lt;&lt; | 左移 | 将位组向左移动给定数目个位置。位从左边移出并丢失。右边打开的位位置用 0 填充 |
| &gt;&gt; | 右移 | 将位组向右移动给定数目个位置。位从右边移出并丢失 |</p> <h4 id="赋值运算符"><a href="#赋值运算符" class="header-anchor">#</a> 赋值运算符</h4> <p>赋值运算符对运算符右边的表达式求值，并用该值设置运算符左边的变量表达式的值。</p> <table><thead><tr><th>运算符</th> <th>描述</th></tr></thead> <tbody><tr><td>=</td> <td>简单赋值，计算右边表达式的值，并把返回值赋给左边的变量或表达式</td></tr> <tr><td>*=</td> <td>复合赋值，var*=expr 等价于 var = var*(expr)</td></tr> <tr><td>/=</td> <td>复合赋值，var/=expr 等价于 var = var/(expr)</td></tr> <tr><td>%=</td> <td>复合赋值，var%=expr 等价于 var = var%(expr)</td></tr> <tr><td>+=</td> <td>复合赋值，var+=expr 等价于 var = var+(expr)</td></tr> <tr><td>-=</td> <td>复合赋值，var-=expr 等价于 var = var-(expr)</td></tr> <tr><td>&lt;&lt;=</td> <td>复合赋值，var&lt;&lt;=expr 等价于 var = var&lt;&lt;(expr)</td></tr> <tr><td>&gt;&gt;=</td> <td>复合赋值，var&gt;&gt;=expr 等价于 var = var&gt;&gt;(expr)</td></tr> <tr><td>&amp;=</td> <td>复合赋值，var&amp;=expr 等价于 var = var&amp;(expr)</td></tr> <tr><td>^=</td> <td>复合赋值，var^=expr 等价于 var = var^(expr)</td></tr> <tr><td>|=</td> <td>复合赋值，var|=expr 等价于 var = var|(expr)</td></tr></tbody></table> <h4 id="条件运算符"><a href="#条件运算符" class="header-anchor">#</a> 条件运算符</h4> <p>条件运算符是一种强大且简洁的方法，基于条件的结果，返回两个值之一。</p> <p>| 运算符 | 名称 | 描述 |
| ------ | ---- | ---- ||
| ?: | 条件运算符 | 对一个表达式求值，并根据表达式是否返回 true 或 false，返回两个值之一 |</p> <p>条件运算符的语法如下所示。它有一个测试表达式和两个结果表达式。</p> <ul><li>Condition 必须返回一个 bool 类型的值。</li> <li>如果 Condition 求值为 true，那么对 Expression1 求值并返回。否则，对 Expression2 求值并返回。</li></ul> <p><code>Condition ? Expression1 : Expression2</code></p> <p>说明：<code>if...else</code> 语句是控制流语句，它应当用来做两个行为中的一个。条件运算符返回一个表达式，它应当用于返回两个值中的一个。</p> <h4 id="一元算术运算符"><a href="#一元算术运算符" class="header-anchor">#</a> 一元算术运算符</h4> <p>一元算数运算符设置数字值的符号。</p> <ul><li>一元正运算符简单返回操作数的值。</li> <li>一元负运算符返回减操作数得到的值。</li></ul> <p>| 运算符 | 名称 | 描述 |
| ------ | ---- | ---- ||
| + | 正号 | 返回操作数的数值 |
| - | 负号 | 返回减操作数得到的值 |</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">int</span></span> x <span class="token operator">=</span> <span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// x = 10</span>
<span class="token class-name"><span class="token keyword">int</span></span> y <span class="token operator">=</span> <span class="token operator">-</span>x<span class="token punctuation">;</span> <span class="token comment">// y = -10</span>
<span class="token class-name"><span class="token keyword">int</span></span> z <span class="token operator">=</span> <span class="token operator">-</span>y<span class="token punctuation">;</span> <span class="token comment">// z = 10</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="用户定义类型的转换"><a href="#用户定义类型的转换" class="header-anchor">#</a> 用户定义类型的转换</h4> <ul><li>可以为自己的类和结构定义隐式转换和显式转换。这允许把用户定义类型的对象转换成某个其他类型，反之亦然。</li> <li>C# 提供隐式转换和显式转换。
<ul><li>对于<code>隐式转换</code>，当决定在特定上下文中使用特定类型时，如有必要，编译器会自动执行转换。</li> <li>对于<code>显式转换</code>，编译器只在使用显式转换运算符时才执行转换。</li></ul></li></ul> <h4 id="运算符重载"><a href="#运算符重载" class="header-anchor">#</a> 运算符重载</h4> <p>如你所见，C#运算符被定义为使用预定义类型作为操作数来工作。如果面对一个用户定义类型，运算符还不知道如何处理它。运算符重载允许你定义 C# 运算符应该如何操作自定义类型的操作数。</p> <ul><li>运算符重载只用于类和结构。</li></ul> <p>详细内容后续补充。</p> <h4 id="typeof-运算符"><a href="#typeof-运算符" class="header-anchor">#</a> typeof 运算符</h4> <p><code>typeof</code> 运算符返回其参数的任何类型的 <code>System.Type</code> 对象。通过这个对象，可以了解类型的特征。<code>typeof</code>是一元运算符。</p> <table><thead><tr><th>运算符</th> <th>描述</th></tr></thead> <tbody><tr><td>typeof</td> <td>返回已知类型的 System.Type 值</td></tr></tbody></table> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// typeof 运算符</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Reflection</span><span class="token punctuation">;</span> <span class="token comment">// 使用反射命名空间来全面利用检测类型信息的功能</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>expressionsOperators</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">SomeClass</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> Field1<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> Field2<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">Method2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">Type</span> t <span class="token operator">=</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">SomeClass</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">FieldInfo<span class="token punctuation">[</span><span class="token punctuation">]</span></span> fi <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">GetFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">MethodInfo<span class="token punctuation">[</span><span class="token punctuation">]</span></span> mi <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">GetMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">FieldInfo</span> f <span class="token keyword">in</span> fi<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Field: {0}&quot;</span><span class="token punctuation">,</span> f<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">MethodInfo</span> m <span class="token keyword">in</span> mi<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Method: {0}&quot;</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token class-name">SomeClass</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SomeClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Type s: {0}&quot;</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 输出</span>
<span class="token comment">// Field: Field1</span>
<span class="token comment">// Field: Field2</span>
<span class="token comment">// Method: Method1</span>
<span class="token comment">// Method: Method2</span>
<span class="token comment">// Method: Equals</span>
<span class="token comment">// Method: GetHashCode</span>
<span class="token comment">// Method: GetType</span>
<span class="token comment">// Method: ToString</span>
<span class="token comment">// Type s: SomeClass</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><h4 id="其他运算符"><a href="#其他运算符" class="header-anchor">#</a> 其他运算符</h4> <h3 id="语句-2"><a href="#语句-2" class="header-anchor">#</a> 语句</h3> <h4 id="什么是语句"><a href="#什么是语句" class="header-anchor">#</a> 什么是语句</h4> <p>C# 中的语句跟 C 和 C++ 中的语句非常类似。</p> <ul><li>语句是描述某个类型或让程序执行某个动作的源代码指令。</li> <li>语句的种类主要有 3 种，如下所示：
<ul><li>声明语句 声明类型和变量；</li> <li>嵌入语句 执行动作或管理控制流。</li> <li>标签语句 控制跳转。</li></ul></li></ul> <p>嵌入语句，它不声明类型、变量或实例。相反，它们使用表达式和控制流结构与由声明语句声明的对象一起工作。</p> <ul><li>简单语句由一个表达式和后面跟着的分号组成。</li> <li><code>块</code>是由一对大括号括起来的语句序列。括起来的语句可以包括：
<ul><li>声明语句；</li> <li>嵌入语句；</li> <li>标签语句；</li> <li>嵌套块。</li></ul></li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">int</span></span> x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 简单声明</span>
<span class="token class-name"><span class="token keyword">int</span></span> z<span class="token punctuation">;</span> <span class="token comment">// 简单声明</span>
<span class="token punctuation">{</span> <span class="token comment">// 块</span>
  <span class="token class-name"><span class="token keyword">int</span></span> y <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span> <span class="token comment">// 简单声明</span>
  z <span class="token operator">=</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span> <span class="token comment">// 嵌入语句</span>
  top<span class="token punctuation">:</span> y <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span> <span class="token comment">// 标签语句</span>
  <span class="token range operator">..</span><span class="token punctuation">.</span>
  <span class="token punctuation">{</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>说明：块在语法上算作一个单条嵌入语句。在任何语法上需要一个嵌入语句的地方，都可以使用块。</p> <p><code>空语句</code> 仅由一个分号组成。可以把空语句用在以下情况的任意位置：语言的语法需要一条嵌入语句而程序逻辑又不需要任何动作。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  z <span class="token operator">=</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="表达式语句"><a href="#表达式语句" class="header-anchor">#</a> 表达式语句</h4> <p>表达式返回值，但它们也有副作用。</p> <ul><li>副作用是一种影响程序状态的行为。</li> <li>许多表达式求值只是为了它们的副作用。</li></ul> <p>可以在表达式后面放置语句终结符（分号）来创建一个表达式创建一条语句。表达式返回的任何值都会被丢弃。例如，下面的代码展示了一个表达式语句。它由赋值表达式（一个赋值运算符和两个操作数）和后面跟着的一个分号组成。它做下面两件事。</p> <ul><li>该表达式把运算符右边的值赋值给变量 x 引用的内存位置。虽然这可能是这条语句的主要动机，但却被视为副作用。</li> <li>设置了 x 的新值之后，表达式返回 x 的新值。但没有什么东西接收这个返回值，所以它被忽略了。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code>x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 计算这个表达式的全部原因就是完成这个副作用。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="控制流语句"><a href="#控制流语句" class="header-anchor">#</a> 控制流语句</h4> <p>C# 提供与现代编程语言相同的控制流结构。</p> <ul><li><code>条件执行</code>依据一个条件执行或跳过一个代码片段。条件执行语句如下：
<ul><li>if；</li> <li>if...else；</li> <li>switch</li></ul></li> <li><code>循环语句</code>重复执行一个代码片段。
<ul><li>while；</li> <li>do；</li> <li>for；</li> <li>foreach；</li></ul></li> <li><code>跳转语句</code>把控制流从一个代码片段改变到另一个代码片段中的指定语句。
<ul><li>break；</li> <li>continue；</li> <li>return；</li> <li>goto；</li> <li>throw。</li></ul></li></ul> <p>说明：与 C 和 C++ 不同，测试表达式必须返回 bool 型值。数字在 C# 中没有布尔意义。</p> <h4 id="if-语句"><a href="#if-语句" class="header-anchor">#</a> if 语句</h4> <p><code>if</code> 语句实现按条件执行。</p> <ul><li>TestExpr 必须计算成 bool 型值。</li> <li>如果 TestExpr 求值为 true，执行 Statement。</li> <li>如果求值为 false，则跳过 Statement。</li></ul> <h4 id="if-else-语句"><a href="#if-else-语句" class="header-anchor">#</a> if...else 语句</h4> <p><code>if...else</code> 语句实现双路分支。<code>if...else</code> 语句的语法如下。</p> <ul><li>如果 TestExpr 求值为 true，执行 Statement1。</li> <li>如果求值为 false，执行 Statement2。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>TestExpr<span class="token punctuation">)</span>
  Statement1
<span class="token keyword">else</span>
  Statement2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="while-循环"><a href="#while-循环" class="header-anchor">#</a> while 循环</h4> <p><code>while</code> 是一种简单循环结构，其测试表达式在循环的顶部执行。</p> <ul><li>首先对 TestExpr 求值。</li> <li>如果 TestExpr 求值为 false，将继续执行在 while 循环结尾之后的语句。</li> <li>否则，当 TestExpr 求值为 true 时，执行 Statement，并且再次对 TestExpr 求值。每次 TestExpr 求值为 true 时，Statement 都要再执行一次。循环在 TestExpr 求值为 true 时结束。</li></ul> <p><img src="/Notebook/assets/img/while-loop.2dbc907c.png" alt=""></p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">int</span></span> x <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>x <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;x: {0}&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
  x<span class="token operator">--</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Out of loop.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="do-循环"><a href="#do-循环" class="header-anchor">#</a> do 循环</h4> <p><code>do</code> 循环是一种简单循环结构，其测试表达式在循环的底部执行。</p> <ul><li>首先，执行 Statement。</li> <li>然后，对 TestExpr 求值。</li> <li>如果 TestExpr 返回 true，那么再次执行 Statement。</li> <li>每次 TestExpr 返回 true，都将再次执行 Statement。</li> <li>当 TestExpr 返回 false 时，控制传递到循环结构结尾之后的那条语句。</li></ul> <p><img src="/Notebook/assets/img/do-loop.4314376c.png" alt=""></p> <p>do 循环有几个特征，使它与其他控制流结构相区分。</p> <ul><li>循环体 Statement 至少执行一次，即使 TestExpr 初始化为 false，这是因为在循环底部才会对 TestExpr 求值；</li> <li>在测试表达式的关闭圆括号之后需要一个分号。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 结构</span>
<span class="token keyword">do</span>
  Statement<span class="token punctuation">;</span>
<span class="token keyword">while</span><span class="token punctuation">(</span> TestExpr <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 实例</span>
<span class="token class-name"><span class="token keyword">int</span></span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">do</span>
  Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;x is {0}&quot;</span><span class="token punctuation">,</span> x<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token keyword">while</span><span class="token punctuation">(</span> x <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 分号必须加上</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="for-循环"><a href="#for-循环" class="header-anchor">#</a> for 循环</h4> <p>只要测试表达式在循环体顶端计算时返回 true， for 循环结构就会执行循环体。</p> <ul><li>在 for 循环的开始，执行一次 Initializer。</li> <li>然后对 TestExpr 求值。</li> <li>如果它返回 true，执行 Statement，接着是 IterationExpr。</li> <li>然后返回到循环的顶端，再次对 TestExpr 求值。</li> <li>只要 TestExpr 返回 true，Statement 和 IterationExpr 都将被执行。</li> <li>一旦 TestExpr 返回 false，就继续执行 Statement 之后的语句。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">for</span> <span class="token punctuation">(</span>Initializer<span class="token punctuation">;</span> TextExpr<span class="token punctuation">;</span> IterationExpr<span class="token punctuation">)</span>
  Statement
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>语句中的一些部分是可选的，其他部分是必需的。</p> <ul><li>Initializer、TestEpr 和 IterationExpr 都是可选的。它们的位置可以空着。如果 TestExpr 位置是空的，那么测试就被假定返回 true。因此，要避免进入无限循环，必须有某种其他退出该语句的方法。</li> <li>作为字段分隔符，两个分号是必需的，即使其他部分都省略了。</li></ul> <p><img src="/Notebook/assets/img/for-loop.eea55504.png" alt=""></p> <ul><li>Initializer 只执行一次，在 for 结构的任何其他部分之前。它常被用于声明和初始化循环中使用的本地变量。</li> <li>对 TestExpr 求值以后决定应该执行 Statement 还是跳过。它必须计算成 bool 类型的值。如前所述，如果 TestExpr 为空白，将永远返回 true。</li> <li>IterationExpr 在 Statement 之后并且在返回循环顶端 TestExpr 之前立即执行。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Console<span class="token punctuation">.</span><span class="token function">WriterLine</span><span class="token punctuation">(</span><span class="token string">&quot;Inside loop. i: {0}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="for-循环语句中变量的作用域"><a href="#for-循环语句中变量的作用域" class="header-anchor">#</a> for 循环语句中变量的作用域</h5> <p>任何声明在 initializer 中的变量只在该 for 语句的内部可见。</p> <ul><li>这与 C 和 C++ 不同，C 和 C++ 中声明把变量引入到外围的块。</li></ul> <h5 id="初始化和迭代表达式中的多表达式"><a href="#初始化和迭代表达式中的多表达式" class="header-anchor">#</a> 初始化和迭代表达式中的多表达式</h5> <p>初始化表达式和迭代表达式都可以包含多个表达式，只要它们用逗号隔开。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">int</span></span> MaxI <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> j <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> MaxI<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">,</span> j <span class="token operator">+=</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0}, {1}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="switch-语句"><a href="#switch-语句" class="header-anchor">#</a> switch 语句</h4> <p><code>switch</code> 语句实现多路分支。</p> <ul><li><code>switch</code> 语句包含 0 个或多个分支。</li> <li>每个分支以一个或多个分支标签开始。</li> <li>每个分支的末尾必须为 break 语句或其他 4 种跳转语句。
<ul><li>跳转语句包括 break、return、continue、goto 和 throw。</li> <li>对于这 5 种跳转语句，break 最常用于 switch 分支的末尾。break 语句将执行过程跳转到 <code>switch</code> 语句的尾部。</li></ul></li></ul> <p>分支标签将按顺序求值。如果是某个标签与测试表达式的值匹配，就执行该分支，然后跳转到 <code>switch</code> 语句的尾部。</p> <p><img src="/Notebook/assets/img/switch-loop.821f5135.png" alt=""></p> <p>switch 标签的形式如下：
<code>case ConstantExpression:</code></p> <ul><li>测试表达式 TestExpr 在结构的顶端求值。</li> <li>如果 TestExpr 的值等于第一个分支标签中的常量表达式 ConstExpr1 的值，将执行该分支标签后面的语句列表，直到遇到一个跳转语句结束。</li> <li>default 分支是可选的，但如果包括了，就必须以一条跳转语句结束。通常用于处理异常。</li></ul> <h4 id="跳转语句"><a href="#跳转语句" class="header-anchor">#</a> 跳转语句</h4> <p>当控制流到达跳转语句时，程序执行被无条件转移到程序的另一部分。跳转语句包括：</p> <ul><li>break；</li> <li>continue；</li> <li>return；</li> <li>goto；</li> <li>throw。</li></ul> <h4 id="break-语句"><a href="#break-语句" class="header-anchor">#</a> break 语句</h4> <p>break 语句除了可以被用到 swtich 语句中，还可以被用在下列语句中：</p> <ul><li>for；</li> <li>foreach；</li> <li>while；</li> <li>do。</li></ul> <p>在这些语句体中，break 导致执行<code>跳出</code>最内层封装语句（innermost enclosing statement）。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">int</span></span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  x<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> x <span class="token operator">&gt;=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="continue-语句"><a href="#continue-语句" class="header-anchor">#</a> continue 语句</h4> <p>continue 语句导致程序执行转到下列类型循环的最内层封装语句的顶端。</p> <ul><li>for；</li> <li>foreach；</li> <li>while；</li> <li>do。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 执行循环5次</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 先执行3次</span>
    <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token comment">// 直接回到循环开始处</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 当 x &gt;= 3 时执行下面的语句</span>
  Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Value of x is {0}&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="标签语句"><a href="#标签语句" class="header-anchor">#</a> 标签语句</h4> <p>标签语句由一个标识符后面跟着一个冒号再跟着一个语句组成。它有下面的形式。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Identifier: Statement
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>标签语句的执行完全如同标签不存在一样，并仅执行 Statement 部分。</p> <ul><li>给语句增加一个标签允许控制从代码的其他部分转移到该语句。</li> <li>标签语句只允许用在块内部。</li></ul> <h5 id="标签"><a href="#标签" class="header-anchor">#</a> 标签</h5> <p>标签它们有自己的命名空间，所以标签语句中的标识符可以是任何有效的标识符，包括那些可能已经在重叠的作用域内声明的标识符，比如本地变量和参数。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">int</span></span> xyz <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
xyz<span class="token punctuation">:</span> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;No problem.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>然而，也存在一些限制。该标识符不能是：</p> <ul><li>关键字；</li> <li>在重叠范围内和另一个标签标识符相同。</li></ul> <h5 id="标签语句的作用域"><a href="#标签语句的作用域" class="header-anchor">#</a> 标签语句的作用域</h5> <p>标签语句不能从它的声明所在的块的外部可见（或可访问）。标签语句的作用域为：</p> <ul><li>它声明所在的块；</li> <li>任何嵌套在该块内部的块。</li></ul> <p><img src="/Notebook/assets/img/scope-of-label.52b4f203.png" alt=""></p> <h4 id="goto-语句"><a href="#goto-语句" class="header-anchor">#</a> goto 语句</h4> <p><code>goto</code> 语句无条件转移控制到一个标签语句。它的一般形式如下，其中 <code>Identifier</code> 是标签语句的标识符：</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">goto</span> Identifier<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>例子：</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">bool</span></span> thingsAreFine<span class="token punctuation">;</span>
<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  thingsAreFine <span class="token operator">=</span> <span class="token function">GetNuClearReactorCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>thingsAreFine<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Things are fine.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">goto</span> NotSoGood<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
NotSoGood<span class="token punctuation">:</span> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;We have a problem.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>goto 语句必须在标签语句的作用域之内。</p> <ul><li>goto 语句可以跳到它本身所在块内的任何标签内，或跳出到任何它被嵌套的块内的标签语句。</li> <li>goto 语句不能跳入任何嵌套在该语句本身所在块内部的任何块。</li></ul> <p>警告：使用 goto 语句是非常不好的，因为它会导致弱结构化、难以调试和维护代码。</p> <h5 id="goto-语句在-switch-语句内部"><a href="#goto-语句在-switch-语句内部" class="header-anchor">#</a> goto 语句在 switch 语句内部</h5> <p>还有另外两种 goto 语句的形式，用在 switch 语句内部。这些 goto 语句把控制转移到 switch 语句内部相应命名的分支标签。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>goto <span class="token keyword">case</span> ConstantExpression<span class="token punctuation">;</span>
got default<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="using-语句"><a href="#using-语句" class="header-anchor">#</a> using 语句</h4> <p>某些类型的非托管对象有数量限制或很耗费系统资源。在代码使用完它们后，尽可能快地释放它们是非常重要。using 语句有助于简化该过程并确保这些资源被适当地处置（dispose）。</p> <p>资源是指一个实现了 <code>System.IDisposable</code> 接口的类或结构。</p> <ul><li>分配资源；</li> <li>使用资源；</li> <li>处置资源。</li></ul> <h5 id="资源的包装使用"><a href="#资源的包装使用" class="header-anchor">#</a> 资源的包装使用</h5> <h5 id="多个资源和嵌套"><a href="#多个资源和嵌套" class="header-anchor">#</a> 多个资源和嵌套</h5> <h5 id="using-语句的另一种形式"><a href="#using-语句的另一种形式" class="header-anchor">#</a> using 语句的另一种形式</h5> <h4 id="其他语句"><a href="#其他语句" class="header-anchor">#</a> 其他语句</h4> <table><thead><tr><th>语句</th> <th>描述</th></tr></thead> <tbody><tr><td>checked、unchecked</td> <td>控制溢出检查上下文</td></tr> <tr><td>foreach</td> <td>遍历一个集合的每个成员</td></tr> <tr><td>tyr、throw、finally</td> <td>处理异常</td></tr> <tr><td>return</td> <td>将控制返回到调用函数的成员，而且还能返回一个值</td></tr> <tr><td>yield</td> <td>用于迭代</td></tr></tbody></table> <h3 id="结构"><a href="#结构" class="header-anchor">#</a> 结构</h3> <h4 id="什么是结构"><a href="#什么是结构" class="header-anchor">#</a> 什么是结构</h4> <p>结构是程序员定义的数据类型，与类非常类似。它们有数据成员和函数成员。虽然与类相似，但是有许多重要的区别。最重要的区别是：</p> <ul><li>类是引用类型而结构是值类型；</li> <li>结构是隐式密封的，这意味着它们不能被派生。</li></ul> <p>声明结构和声明类类似：</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">struct</span> <span class="token class-name">StructName</span> <span class="token punctuation">{</span>
  MemberDeclarations
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>Struct</span>
<span class="token punctuation">{</span>
  <span class="token keyword">struct</span> <span class="token class-name">Point</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> X<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> Y<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">Point</span> first<span class="token punctuation">,</span> second<span class="token punctuation">,</span> third<span class="token punctuation">;</span>
      first<span class="token punctuation">.</span>X <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
      first<span class="token punctuation">.</span>Y <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
      second<span class="token punctuation">.</span>X <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
      second<span class="token punctuation">.</span>Y <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
      third<span class="token punctuation">.</span>X <span class="token operator">=</span> first<span class="token punctuation">.</span>X <span class="token operator">+</span> second<span class="token punctuation">.</span>Y<span class="token punctuation">;</span>
      third<span class="token punctuation">.</span>Y <span class="token operator">=</span> first<span class="token punctuation">.</span>Y <span class="token operator">+</span> second<span class="token punctuation">.</span>Y<span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;first: {0}, {1}&quot;</span><span class="token punctuation">,</span> first<span class="token punctuation">.</span>X<span class="token punctuation">,</span> first<span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;second: {0}, {1}&quot;</span><span class="token punctuation">,</span> second<span class="token punctuation">.</span>X<span class="token punctuation">,</span> second<span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;third: {0}, {1}&quot;</span><span class="token punctuation">,</span> third<span class="token punctuation">.</span>X<span class="token punctuation">,</span> third<span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h4 id="结构是值类型"><a href="#结构是值类型" class="header-anchor">#</a> 结构是值类型</h4> <p>和所有值类型一样，结构类型变量含有自己的数据。因此：</p> <ul><li>结构类型的变量不能为 null；</li> <li>两个结构变量不能引用同一对象。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">class</span> <span class="token class-name">CSimple</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> x<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token class-name">Simple</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> x<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">CSimple</span> cs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CSimple</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Simple</span> ss <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Simple</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><img src="/Notebook/assets/img/class-vs-struct-memory.d20d7a53.png" alt=""></p> <h4 id="对结构赋值"><a href="#对结构赋值" class="header-anchor">#</a> 对结构赋值</h4> <p>把一个结构赋值给另一个结构，就将一个结构的值复制给另一个结构。这和复制变量不同，复制类变量时只复制引用。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>Struct</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">CSimple</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> X<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> Y<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">struct</span> <span class="token class-name">Simple</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> X<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> Y<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program2</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">CSimple</span> cs1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CSimple</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">CSimple</span> cs2 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token class-name">Simple</span> ss1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Simple</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">Simple</span> ss2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Simple</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      cs1<span class="token punctuation">.</span>X <span class="token operator">=</span> ss1<span class="token punctuation">.</span>X <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
      cs1<span class="token punctuation">.</span>Y <span class="token operator">=</span> ss1<span class="token punctuation">.</span>Y <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

      cs2 <span class="token operator">=</span> cs1<span class="token punctuation">;</span> <span class="token comment">// 赋值结构实例</span>
      ss2 <span class="token operator">=</span> ss1<span class="token punctuation">;</span> <span class="token comment">// 赋值类实例</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h4 id="构造函数和析构函数"><a href="#构造函数和析构函数" class="header-anchor">#</a> 构造函数和析构函数</h4> <p>结构可以允许有实例构造函数和静态构造函数，但不允许有析构函数。</p> <h5 id="实例构造函数-2"><a href="#实例构造函数-2" class="header-anchor">#</a> 实例构造函数</h5> <p>语言隐式地为每个结构提供一个无参数的构造函数。这个构造函数把结构的每个成员设置为该类型的默认值。值成员设置成它们的默认值，引用成员设置成 null。</p> <p>预定义的无参数构造函数对每个结构都存在，而且不能删除或重定义。但是，可以创建另外的构造函数，只要它们有参数。注意，这和类不同。对于类，编译器只在没有其他构造函数声明时提供隐式的无参数构造函数。</p> <p>调用一个构造函数，包括隐式无参数构造函数，要使用 new 运算符。注意，即使不从堆中分配内存也要使用 new 运算符。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>Struct</span>
<span class="token punctuation">{</span>

  <span class="token keyword">struct</span> <span class="token class-name">Simple2</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> X<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> Y<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token function">Simple2</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> a<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> b<span class="token punctuation">)</span> <span class="token comment">// 带有参数的构造函数</span>
    <span class="token punctuation">{</span>
      X <span class="token operator">=</span> a<span class="token punctuation">;</span>
      Y <span class="token operator">=</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program3</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">Simple2</span> s1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Simple2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用隐式构造函数</span>
      <span class="token class-name">Simple2</span> s2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Simple2</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;s1: {0}, {1}&quot;</span><span class="token punctuation">,</span> s1<span class="token punctuation">.</span>X<span class="token punctuation">,</span> s1<span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;s1: {0}, {1}&quot;</span><span class="token punctuation">,</span> s2<span class="token punctuation">.</span>X<span class="token punctuation">,</span> s2<span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// s1: 0, 0</span>
      <span class="token comment">// s1: 5, 10</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>也可以不使用 new 运算符创建结构的实例。然而，如果这样做，有一些限制，如下：</p> <ul><li>在显式设置数据成员之后，才能使用它们的值；</li> <li>在对所有数据成员赋值之后，才能使用任何函数成员。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">struct</span> <span class="token class-name">Simple</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> X<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> Y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Simple</span> s1<span class="token punctuation">,</span> s2<span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0}, {1}&quot;</span><span class="token punctuation">,</span> s1<span class="token punctuation">.</span>X<span class="token punctuation">,</span> s2Y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 编译错误</span>

    s2<span class="token punctuation">.</span>X <span class="token operator">=</span> <span class="token number">5</span>；
    s2<span class="token punctuation">.</span>Y <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0}, {1}&quot;</span><span class="token punctuation">,</span> s2<span class="token punctuation">.</span>X<span class="token punctuation">,</span> s2<span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 没问题</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h5 id="静态构造函数-2"><a href="#静态构造函数-2" class="header-anchor">#</a> 静态构造函数</h5> <p>与类相似，结构的静态构造函数创建并初始化静态数据成员，而且不能引用实例成员。结构的静态构造函数遵从与类的静态构造函数一样的规则。
以下两种行为，任意一种发生之前，将会调用静态构造函数。</p> <ul><li>调用显式声明的构造函数。</li> <li>引用结构的静态成员。</li></ul> <h4 id="字段初始化语句是不允许的"><a href="#字段初始化语句是不允许的" class="header-anchor">#</a> 字段初始化语句是不允许的</h4> <p>在结构中字段初始化语句是不允许的，如下所示。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">struct</span> <span class="token class-name">Simple</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 编译错误</span>
  <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 编译错误</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="结构是密封的"><a href="#结构是密封的" class="header-anchor">#</a> 结构是密封的</h4> <p>结构总是隐式密封的，因此，不能从它们派生其他结构。</p> <p>由于结构不支持继承，个别类成员修饰符用在结构成员上将没有意义。因此不能在结构声明时使用。不能用于结构的修饰符如下：</p> <ul><li>protected</li> <li>internal</li> <li>abstract</li> <li>virtual</li></ul> <p>结构本身派生自 <code>System.ValueType</code>，<code>System.ValueType</code> 派生自 <code>object</code>。</p> <h4 id="装箱和拆箱"><a href="#装箱和拆箱" class="header-anchor">#</a> 装箱和拆箱</h4> <p>如同其他值类型数据，如果想将一个结构实例作为引用类型对象，必须创建装箱（boxing）的副本。装箱的过程就是制作值类型变量的引用类型副本。装箱和拆箱（unboxing）后续再作详细阐述。</p> <h4 id="结构作为返回值和参数"><a href="#结构作为返回值和参数" class="header-anchor">#</a> 结构作为返回值和参数</h4> <p>结构可以用作返回值和参数。</p> <ul><li>返回值 当结构用作返回值时，将创建它的副本并从函数成员返回。</li> <li>值参数 当结构被用作值参数时，将创建实参结构的副本。该副本用于方法的执行中。</li> <li>ref 和 out 参数 如果把一个结构用作 <code>ref</code> 或 <code>out</code> 参数，传入方法的是该结构的一个引用，这样就可以修改其数据成员。</li></ul> <h4 id="关于结构的其他信息"><a href="#关于结构的其他信息" class="header-anchor">#</a> 关于结构的其他信息</h4> <p>对结构进行分配比创建类的实例开销小，所以使用结构代替类有时可以提高性能，但要注意到装箱和拆箱的高代价。</p> <p>最后，关于结构，需要知道的最后一些事情如下：</p> <ul><li>预定义简单类型（int、short、long，等等），尽管在 .NET 和 C# 中被视为原始类型，它们实际上在 .NET 都实现为结构。</li> <li>可以使用与声明分部类相同的方法声明分部结构。</li> <li>结构和类一样，可以实现接口。后续作阐述。</li></ul> <h3 id="枚举"><a href="#枚举" class="header-anchor">#</a> 枚举</h3> <h4 id="枚举-2"><a href="#枚举-2" class="header-anchor">#</a> 枚举</h4> <p>枚举是由程序员定义的类型，与类或结构一样。</p> <ul><li>与结构一样，枚举是值类型，因此直接存储它们的数据，而不是分开存储成引用和数据。</li> <li>枚举只有一种类型的成员：命名的整数值常量。</li></ul> <p>每个枚举类型都有一个底层整数类型，默认为 <code>int</code>。</p> <ul><li>每个枚举成员都被赋予一个底层类型的常量值。</li> <li>在默认情况下，编译器把第一个成员赋值为 0，并对每一个后续成员赋的值比前一个成员多 1。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>Enum</span>
<span class="token punctuation">{</span>
  <span class="token keyword">enum</span> <span class="token class-name">TrafficLight</span>
  <span class="token punctuation">{</span>
    Green<span class="token punctuation">,</span> <span class="token comment">// 逗号分隔，没有分号</span>
    Yellow<span class="token punctuation">,</span>
    Red
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// 可以把枚举值赋给变量</span>
      <span class="token class-name">TrafficLight</span> t1 <span class="token operator">=</span> TrafficLight<span class="token punctuation">.</span>Green<span class="token punctuation">;</span>
      <span class="token class-name">TrafficLight</span> t2 <span class="token operator">=</span> TrafficLight<span class="token punctuation">.</span>Yellow<span class="token punctuation">;</span>
      <span class="token class-name">TrafficLight</span> t3 <span class="token operator">=</span> TrafficLight<span class="token punctuation">.</span>Red<span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0}, \t{1}&quot;</span><span class="token punctuation">,</span> t1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>t1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Green, 	0</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0}, \t{1}&quot;</span><span class="token punctuation">,</span> t2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>t2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Yellow, 	1</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0}, \t{1}&quot;</span><span class="token punctuation">,</span> t3<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>t3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Red, 	2</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h5 id="设置底层类型和显式值"><a href="#设置底层类型和显式值" class="header-anchor">#</a> 设置底层类型和显式值</h5> <p>可以把冒号和类型名称放在枚举名之后，这样就可以使用 int 以外的整数类型。类型可以是任何整数类型。所有成员常量都属于枚举的底层类型。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>Enum</span>
<span class="token punctuation">{</span>
  <span class="token keyword">enum</span> <span class="token class-name">TrafficLight</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token keyword">ulong</span></span>
  <span class="token punctuation">{</span>
    Green <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span>
    Yellow <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">,</span>
    Red <span class="token operator">=</span> <span class="token number">15</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>成员常量的值可以是底层类型的任何值。要显式地设置一个成员的值，在枚举声明中的变量名之后使用初始化表达式。尽管不能有重复的名称，但可以有重复的值。</p> <h5 id="隐式成员编号"><a href="#隐式成员编号" class="header-anchor">#</a> 隐式成员编号</h5> <p>可以显式地赋值给任何成员常量。如果不初始化一个成员常量，编译器隐式地给它赋一个值。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">enum</span> <span class="token class-name">FaceCards</span> <span class="token punctuation">{</span>
  <span class="token comment">// Member</span>
  Jack <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">,</span>
  Queen<span class="token punctuation">,</span> <span class="token comment">// 12</span>
  King<span class="token punctuation">,</span> <span class="token comment">// 13</span>
  Ace<span class="token punctuation">,</span> <span class="token comment">// 14</span>
  NumberOfFaceCards <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span>
  SomeOtherValue<span class="token punctuation">,</span>
  HighestFaceCard <span class="token operator">=</span> Ace <span class="token comment">// 14，以上定义 ACE</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><img src="/Notebook/assets/img/enum-member-evaluation.0c63cf39.png" alt=""></p> <h4 id="位标志"><a href="#位标志" class="header-anchor">#</a> 位标志</h4> <p>后续补充</p> <h5 id="flags-特性"><a href="#flags-特性" class="header-anchor">#</a> Flags 特性</h5> <h5 id="使用位标志的示例"><a href="#使用位标志的示例" class="header-anchor">#</a> 使用位标志的示例</h5> <h4 id="关于枚举的补充"><a href="#关于枚举的补充" class="header-anchor">#</a> 关于枚举的补充</h4> <p>枚举只有单一的成员类型：声明的成员常量。</p> <ul><li>不能对成员使用修饰符。它们都隐式地具有和枚举相同的访问性。</li> <li>由于成员是常量，即使在没有该枚举类型的变量时它们也可以访问。使用枚举类型名，跟着一个点和成员名。</li> <li>枚举类型是一个独特的类型，比较不同枚举类型的成员会导致编译时错误。</li></ul> <p>.NET Enum 类型（enum 就是基于该类型的）还包括一些有用的静态方法：</p> <ul><li>GetName 方法以枚举类型对象和整数为参数，返回响应的枚举成员的名称；</li> <li>GetNames 方法以枚举类型对象为参数，返回该枚举中所有成员的全部名称。</li></ul> <h3 id="数组"><a href="#数组" class="header-anchor">#</a> 数组</h3> <p>数组实际上是由一个变量名称表示的一组同类型的数据元素。每个元素通过变量名称和一个或多个方括号中的索引来访问。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code>MyArray<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="定义"><a href="#定义" class="header-anchor">#</a> 定义</h4> <p>让我们从 C# 中与数组有关的一些重要定义开始。</p> <ul><li>元素 数组的独立数据项称作元素。数组的所有元素必须是相同类型的，或继承自相同的类型。</li> <li>秩/维度 数组可以有任何正数的维度数。数组的维度称作秩（rank）。</li> <li>维度长度 数组的每一个维度有一个长度，就是这个方向的位置个数。</li> <li>数组长度 数组的所有维度中的元素的总和称为数组的长度。</li></ul> <h4 id="重要细节"><a href="#重要细节" class="header-anchor">#</a> 重要细节</h4> <ul><li>数组一旦创建，大小就固定了。C# 不支持动态数组。</li> <li>数组索引号是从 0 开始的。也就是说，如果维度长度是 n，索引号范围是从 0 到 n-1。</li></ul> <p><img src="/Notebook/assets/img/csharp-array-length-rank.94e17ef5.png" alt=""></p> <h4 id="数组的类型"><a href="#数组的类型" class="header-anchor">#</a> 数组的类型</h4> <p>C# 提供了两种类型的数组。</p> <ul><li>一维数组可以认为是单行元素或元素向量。</li> <li>多维数组是由主向量中的位置组成的，每一个位置本身又是一个数组，称为子数组（sub-array）。子数组向量中的位置本身又是一个子数组。</li></ul> <p>另外，有两种类型的多维度数组：矩形数组（rectangular array）和交错数组（jagged array）。它们有如下特性：</p> <ul><li>矩形数组。
<ul><li>某个维度的所有子数组有相同长度的多维数组。</li> <li>不管有多少维度，总是使用一组方括号。
<code>int x = myArray[4, 6, 2]</code></li></ul></li> <li>交错数组
<ul><li>每一个子数组都是独立数组的多维度数组。</li> <li>可以有不同长度的子数组。</li> <li>为数组的每一个维度使用一对方括号。
<code>jagArray[2][7][4]</code></li></ul></li></ul> <p><img src="/Notebook/assets/img/c-sharp-array-types.05dfd676.png" alt=""></p> <h4 id="数组是对象"><a href="#数组是对象" class="header-anchor">#</a> 数组是对象</h4> <p>数组实例是从 <code>System.Array</code> 继承的对象。由于数组从 BCL 基类继承，它们也继承了很多有用的方法，如下所示：</p> <ul><li>Rank 返回数组维度数的属性。</li> <li>Length 返回数组长度（数组中所有元素的个数）的属性。</li></ul> <p>数组是引用类型，与所有引用类型一样，有数据的引用以及数据对象本身。引用在栈或堆上，而数组对象本身总是在堆上。</p> <p><img src="/Notebook/assets/img/c-sharp-array-structure.01f5c0aa.png" alt=""></p> <p>尽管数组总是引用类型，但是数组的元素可以是值类型也可以是也可以是引用类型。</p> <ul><li>如果存储的元素都是值类型，数组被称作值类型数组。</li> <li>如果存储在数组中的元素都是引用类型对象，数组被称作引用类型数组。</li></ul> <h4 id="一维数组和矩形数组"><a href="#一维数组和矩形数组" class="header-anchor">#</a> 一维数组和矩形数组</h4> <p>一维数组矩形数组的语法非常类似，因此把它们放在了一起。</p> <h5 id="声明一维数组或矩形数组"><a href="#声明一维数组或矩形数组" class="header-anchor">#</a> 声明一维数组或矩形数组</h5> <p>要声明一维数组或矩形数组，可以在类型和变量名称之间使用一对方括号。</p> <p>方括号内的逗号就是<code>秩说明符</code>，它们指定了数组的维度数。秩就是逗号数量加 1。比如没有逗号代表一维数组，一个逗号代表二维数组，以此类推。</p> <p>基类和秩说明符构成了数组类型。例如，如下代码行声明了 <code>long</code> 的一维数组。数组类型的是 <code>long[]</code> ，读作“long 数组”。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">long</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> secondArray<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如下代码展示了矩形数组声明的示例。注意以下几点：</p> <ul><li>可以使用任意多的秩说明符。</li> <li>不能在数组类型区域中方数组长度。秩是数组类型的一部分，而维度长度不是类型的一部分。</li> <li>数组声明后，维度数就是固定的了。然而，维度长度直到数组实例化时才确定。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">]</span></span> firstArray<span class="token punctuation">;</span> <span class="token comment">// 数组类型：三维整型数组</span>
<span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">]</span></span> arr1<span class="token punctuation">;</span> <span class="token comment">// 数组类型：二维整型数组</span>
<span class="token class-name"><span class="token keyword">long</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">]</span></span> arr1<span class="token punctuation">;</span> <span class="token comment">// 数组类型：三维long型数组</span>
<span class="token keyword">long</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span> SecondArray<span class="token punctuation">;</span> <span class="token comment">// 编译错误</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>说明：和 C/C++ 不同，方括号在基类型后，而不在变量名称后。</p> <h4 id="实例化一维数组或矩形数组"><a href="#实例化一维数组或矩形数组" class="header-anchor">#</a> 实例化一维数组或矩形数组</h4> <p>要实例化数组，我们可以使用<code>数组创建表达式</code>。数组创建表达式由 <code>new</code> 运算符构成，后面是基类名称和一对方括号。方括号中以逗号分隔每一维度的长度。</p> <ul><li>arr2 数组是包含 4 个 int 的一维数组。</li> <li>mcArr 数组是包含 4 个 MyClass 引用的一维数组。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> arr2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">int</span></span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token class-name">MyClass<span class="token punctuation">[</span><span class="token punctuation">]</span></span> mcArr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>说明：与对象创建表达式不一样，数组创建表达式不包含圆括号——即使是对于引用类型数组。</p> <h4 id="访问数组元素"><a href="#访问数组元素" class="header-anchor">#</a> 访问数组元素</h4> <p>在数组中使用整型值作为索引来访问数组元素。</p> <ul><li>每一个维度的索引从 0 开始。</li> <li>方括号内的索引在数组名称之后。</li></ul> <p>如下代码给出了声明、写入、读取一维数组和二维数组的示例。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> intArr1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">int</span></span><span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 声明一维数组</span>
intArr1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 向第3个元素写入值</span>
<span class="token class-name"><span class="token keyword">int</span></span> var1 <span class="token operator">=</span> intArr1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 从第3个元素读取值</span>

<span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">]</span></span> intArr2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">int</span></span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 声明二维数组</span>
intArr2<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span> <span class="token comment">// 向数组写入数据</span>
<span class="token class-name"><span class="token keyword">int</span></span> var2 <span class="token operator">=</span> intArr2<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 向数组读取数据</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="初始化数组"><a href="#初始化数组" class="header-anchor">#</a> 初始化数组</h4> <p>当数据被创建之后，每一个元素被自动初始化为类型的默认值。对于预定义的类型，整型默认值是 0。对于预定义的类型，整数默认值是 0，浮点型的默认值为 0.0，布尔值的默认值为 false，而引用类型的默认值则是 null。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> intArr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">int</span></span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 0 0 0 0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="显式初始化一维数组"><a href="#显式初始化一维数组" class="header-anchor">#</a> 显式初始化一维数组</h5> <p>对于一维数组，要设置显式初始值，我们可以在数组实例化的数组创建表达式之后加上一个初始化列表（initialization List）。</p> <ul><li>初始值必须以逗号分隔，并封闭在一组大括号内。</li> <li>不必输入维度长度，因为编译器可以通过初始化值的个数来推断长度。</li> <li>注意，在数组创建表达式和初始化列表中间没有分隔符。也就是说，没有等号或其他连接运算符。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> intArr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="显式初始化二维数组"><a href="#显式初始化二维数组" class="header-anchor">#</a> 显式初始化二维数组</h5> <p>要显式初始化矩形数组，需要遵守以下规则：</p> <ul><li>每一个初始值向量必须封闭在大括号内。</li> <li>每一个维度也必须嵌套并封闭在大括号内。</li> <li>除了初始值，每一个维度的初始化列表和组成部分也必须使用逗号分隔。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">]</span></span> intArray2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/Notebook/assets/img/initialization-rectangular-array.738b8a81.png" alt=""></p> <h5 id="快捷语法"><a href="#快捷语法" class="header-anchor">#</a> 快捷语法</h5> <p>在一条语句中声明、数组创建和初始化时，我们可以省略语法的数组创建表达式部分，只提供初始化部分。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">int</span></span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">// 等价下面</span>
<span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> arr <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">]</span></span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">int</span></span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token comment">// 等价下面</span>
<span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">]</span></span> arr <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h5 id="隐式类型数组"><a href="#隐式类型数组" class="header-anchor">#</a> 隐式类型数组</h5> <p>直到现在，我们一直都在数组声明的开始处显式指定数组类型。然而，和其他局部变量一样，数组可以是隐式类型的。也就是说存在以下情况。</p> <ul><li>当初始化数组时，我们可以让编译器根据初始化语句的类型来推断数组类型。只要所有初始化语句能隐式转换为单个类型，就可以这么做。</li> <li>和隐式类型的局部变量一样，使用 <code>var</code> 关键字来替代数组类型。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> intArr1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 显式</span>
<span class="token class-name"><span class="token keyword">var</span></span> intArr1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 隐式</span>

<span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">]</span></span> intArr2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">]</span></span><span class="token punctuation">{</span> <span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 显式</span>
<span class="token class-name"><span class="token keyword">var</span></span> intArr2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">{</span> <span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 隐式</span>

<span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> sArr1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">{</span><span class="token string">&quot;life&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;liberty&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pursuit of happiness&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> sArr1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;life&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;liberty&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pursuit of happiness&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="综合内容"><a href="#综合内容" class="header-anchor">#</a> 综合内容</h5> <p>创建一个矩形数组，并对其进行初始化。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 声明、创建和初始化一个隐式类型的数组</span>
<span class="token class-name"><span class="token keyword">var</span></span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">]</span></span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 输出值</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0}, {1} is {2}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> j<span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="交错数组"><a href="#交错数组" class="header-anchor">#</a> 交错数组</h4> <p>交错数组是数组的数组。与矩形数组不同，交错数组的子数组的元素个数可以不同。</p> <p><img src="/Notebook/assets/img/jagged-array.9271e077.png" alt=""></p> <h5 id="声明交错数组（性能优化）"><a href="#声明交错数组（性能优化）" class="header-anchor">#</a> 声明交错数组（性能优化）</h5> <p>交错数组的声明语法要求每一个维度都有一对独立的方括号。数组变量声明中的方括号数决定了数组的秩。</p> <ul><li>交错数组可能的维度可以是大于 1 的任意整数。</li> <li>和矩形数组一样，维度长度不能包括在数组类型的声明部分。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> someArr<span class="token punctuation">;</span> <span class="token comment">// 秩等于2</span>
<span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> otherArr<span class="token punctuation">;</span> <span class="token comment">// 秩等于3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="快捷实例化"><a href="#快捷实例化" class="header-anchor">#</a> 快捷实例化</h5> <p>我们可以将用数组创建表达式创建的顶层数组和交错数组的声明相结合。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> jagArr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">int</span></span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 不能在声明语句中初始化顶层数组之外的数组</span>
<span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> jagArr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">int</span></span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 编译错误</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="实例化交错数组"><a href="#实例化交错数组" class="header-anchor">#</a> 实例化交错数组</h5> <p>和其他类型的数组不一样，交错数组的完全初始化不能在一个步骤中完成。由于交错数组是独立数组的数组——每一个数组必须独立创建。实例化完整的交错数组需要如下步骤：</p> <ul><li>首先，实例化顶层数组。</li> <li>其次，分别实例化每一个子数组，把新建数组的引用赋给它们所属数组的合适元素。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">int</span></span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 1. 实例化顶层数组</span>
arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 2. 实例化子数组</span>
arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">{</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 3. 实例化子数组</span>
arr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">{</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 4. 实例化子数组</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h5 id="交错数组中的子数组"><a href="#交错数组中的子数组" class="header-anchor">#</a> 交错数组中的子数组</h5> <p>由于交错数组中的子数组本身就是数组，因此交错数组中也可能有矩形数组。例如，如下代码创建了一个有 3 个二维矩形数组的交错数组，并将它们初始化，然后显示了它们的值。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>Array</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">Program</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">]</span></span> arr<span class="token punctuation">;</span> <span class="token comment">// 带有二维数组的交错数组</span>
      arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">int</span></span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 实例化带有3个二维数组的交错数组</span>
      arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span> <span class="token punctuation">{</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span> <span class="token punctuation">{</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">50</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">500</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      arr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span> <span class="token punctuation">{</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">90</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">700</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">900</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span><span class="token function">GetLength</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">// 获取 arr维度0的长度</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">GetLength</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">// 获取 arr[i] 维度0 的长度</span>
        <span class="token punctuation">{</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">GetLength</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">// 获取 arr[i] 维度1 的长度</span>
          <span class="token punctuation">{</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;[{0}][{1}, {2}] = {3}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> j<span class="token punctuation">,</span> k<span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">j</span><span class="token punctuation">,</span> <span class="token class-name">k</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// [0][0, 0] = 10</span>
<span class="token comment">// [0][0, 1] = 20</span>

<span class="token comment">// [0][1, 0] = 100</span>
<span class="token comment">// [0][1, 1] = 200</span>


<span class="token comment">// [1][0, 0] = 30</span>
<span class="token comment">// [1][0, 1] = 40</span>
<span class="token comment">// [1][0, 2] = 50</span>

<span class="token comment">// [1][1, 0] = 300</span>
<span class="token comment">// [1][1, 1] = 400</span>
<span class="token comment">// [1][1, 2] = 500</span>


<span class="token comment">// [2][0, 0] = 60</span>
<span class="token comment">// [2][0, 1] = 70</span>
<span class="token comment">// [2][0, 2] = 80</span>
<span class="token comment">// [2][0, 3] = 90</span>

<span class="token comment">// [2][1, 0] = 600</span>
<span class="token comment">// [2][1, 1] = 700</span>
<span class="token comment">// [2][1, 2] = 800</span>
<span class="token comment">// [2][1, 3] = 900</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><h4 id="比较矩形数组和交错数组"><a href="#比较矩形数组和交错数组" class="header-anchor">#</a> 比较矩形数组和交错数组</h4> <p>矩形数组和交错数组的结构区别非常大。例如，下图演示了 3x3 的矩形数组以及一个由 3 个长度为 3 的一维数组构成的交错数组的结构。</p> <ul><li>两个数组都保存了 9 个整数，但是它们的结构却很不相同。</li> <li>矩形数组只有单个数组对象，而交错数组有 4 个数组对象。</li></ul> <p><img src="/Notebook/assets/img/rectarr-vs-jagarr.31999a47.png" alt=""></p> <p>在 CIL 中，一维数组有特定的指令用于性能优化。矩形数组没有这些指令，并且不在相同级别进行优化。因此，有时使用一维数组（可以被优化）的交错数组比矩形数组（不能被优化）更有效率。</p> <p>另一方面，矩形数组的编程复杂度要小得多，因为它会被作为一个单元而不是数组的数组。</p> <h4 id="foreach-语句"><a href="#foreach-语句" class="header-anchor">#</a> foreach 语句</h4> <p><code>foreach</code> 语句允许我们连续访问数组中的每一个元素。其实它是一个比较普遍的结构，因为可以和其他集合类型一起使用——但是在这部分内容中，我们只会讨论它和数组的使用。</p> <p>有关<code>foreach</code> 语句的重点如下所示：</p> <ul><li>迭代变量是临时的，并且和数组中元素的类型相同。<code>foreach</code> 语句使用<code>迭代变量</code>来相继表示数组中的每一个元素。</li> <li>Type 是数组中元素的类型。我们可以显式提供它的类型。或者，也可以使用 <code>var</code> 让其成为隐式类型并通过编译器来推断，因为编译器知道数组的类型。</li> <li>Identifier 是迭代变量的名字。</li> <li>ArrayName 是要处理的数组的名字。</li> <li>Statement 是要为数组中的每一个元素执行一次的单条语句或语句块。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token class-name">Type</span> Identifier <span class="token keyword">in</span> ArrayName<span class="token punctuation">)</span> <span class="token comment">// 显式类型迭代变量声明</span>
  Statement<span class="token punctuation">;</span>
<span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> Identifier <span class="token keyword">in</span> ArrayName<span class="token punctuation">)</span> <span class="token comment">// 隐式类型迭代变量声明</span>
  Statement<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>foreach</code> 语句以如下方式工作。</p> <ul><li>从数组的第一个元素开始并把它赋值给迭代变量。</li> <li>然后执行语句主体。<strong>在主体中，我们可以把迭代变量作为数组元素的只读别名。</strong></li> <li>在主体执行之后，<code>foreach</code> 语句选择数组中的下一个元素并重复处理。</li></ul> <p>这样，它就循环遍历了数组，允许我们逐个访问每一个元素。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>Array</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">Program2</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> arr1 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> item <span class="token keyword">in</span> arr1<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Item Value: {0}&quot;</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10, 20, 30, 40</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h5 id="迭代变量是只读的"><a href="#迭代变量是只读的" class="header-anchor">#</a> 迭代变量是只读的</h5> <p>由于迭代变量的值是只读的，所以它不能改变。但是，对于值类型数组和引用类型数组而言效果不一样。</p> <p>对于值类型数组，这意味着在用迭代变量表示数组元素的时候，我们不能改变它们。例如，在如下的代码中，尝试改变迭代变量中的数据产生了编译时错误信息：</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> arr1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> item <span class="token keyword">in</span> arr1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  item<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token comment">// 编译错误。不得改变变量值。</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>对于引用类型数组，我们仍然不能改变迭代变量，但是迭代变量只是保存了数据的引用，而不是数据本身。因此，<strong>虽不能改变引用，但我们可以通过迭代变量改变数据。</strong></p> <p>如下代码中，创建了一个有 4 个 SomeClass 对象的数组并将其初始化。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// foreach-改变引用类型的数据</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>Array</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">Program3</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">class</span> <span class="token class-name">SomeClass</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> MyField <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">SomeClass<span class="token punctuation">[</span><span class="token punctuation">]</span></span> mcArr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SomeClass</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 创建数组</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        mcArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SomeClass</span>
        <span class="token punctuation">{</span>
          MyField <span class="token operator">=</span> i <span class="token comment">// 设置字段</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 创建类对象</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">SomeClass</span> item <span class="token keyword">in</span> mcArr<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        item<span class="token punctuation">.</span>MyField <span class="token operator">+=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 改变数据</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">SomeClass</span> item <span class="token keyword">in</span> mcArr<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0}&quot;</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>MyField<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 读取改变的数据</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h5 id="foreach-语句和多维数组"><a href="#foreach-语句和多维数组" class="header-anchor">#</a> foreach 语句和多维数组</h5> <p>在多维数组，元素的处理次序是最右边的索引号最先递增。当索引从 0 到长度减 1 时，开始递增它左边的索引，右边的索引被重置为 0。</p> <ol><li>矩形数组的示例</li></ol> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// foreach 语句和多维数组</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>Array</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">Program4</span>
  <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">int</span></span> total <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">]</span></span> arr1 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">{</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> element <span class="token keyword">in</span> arr1<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        total <span class="token operator">+=</span> element<span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Element: {0}, Current Total: {1}&quot;</span><span class="token punctuation">,</span> element<span class="token punctuation">,</span> total<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 输出</span>
<span class="token comment">// Element: 10, Current Total: 10</span>
<span class="token comment">// Element: 11, Current Total: 21</span>
<span class="token comment">// Element: 12, Current Total: 33</span>
<span class="token comment">// Element: 13, Current Total: 46</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><ol start="2"><li>交错数组的示例</li></ol> <p>一个交错数组是数组的数组，我们必须为交错数组中的每一个维度使用独立的 <code>foreach</code> 语句。<code>foreach</code> 语句必须嵌套以确保每一个嵌套数组都被正确处理。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// foreach 语句和多维数组</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>Array</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">Program5</span>
  <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">int</span></span> total <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> arr1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">int</span></span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      arr1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      arr1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> array <span class="token keyword">in</span> arr1<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Starting new array.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 处理顶层数组</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> item <span class="token keyword">in</span> array<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
          total <span class="token operator">+=</span> item<span class="token punctuation">;</span>
          Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot; Item: {0}, Current Total: {1}&quot;</span><span class="token punctuation">,</span> item<span class="token punctuation">,</span> total<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 输出</span>
<span class="token comment">// Starting new array.</span>
<span class="token comment">//  Item: 10, Current Total: 10</span>
<span class="token comment">//  Item: 11, Current Total: 21</span>
<span class="token comment">// Starting new array.</span>
<span class="token comment">//  Item: 12, Current Total: 33</span>
<span class="token comment">//  Item: 13, Current Total: 46</span>
<span class="token comment">//  Item: 14, Current Total: 60</span>
<span class="token comment">//  Item: 15, Current Total: 75</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h4 id="数组协变"><a href="#数组协变" class="header-anchor">#</a> 数组协变</h4> <p>待补充</p> <h4 id="数组继承的有用成员"><a href="#数组继承的有用成员" class="header-anchor">#</a> 数组继承的有用成员</h4> <h5 id="clone-方法"><a href="#clone-方法" class="header-anchor">#</a> Clone 方法</h5> <h4 id="比较数组类型"><a href="#比较数组类型" class="header-anchor">#</a> 比较数组类型</h4> <p><img src="/Notebook/assets/img/array-types.e429a600.png" alt=""></p> <h3 id="委托-2"><a href="#委托-2" class="header-anchor">#</a> 委托</h3> <h4 id="什么是委托"><a href="#什么是委托" class="header-anchor">#</a> 什么是委托</h4> <p>可以认为委托是持有一个或多个方法的对象。当然，正常情况下你不会想要“执行”一个对象，但委托与典型的对象不同。可以执行委托，这时委托会执行它所“持有” 的方法。</p> <p>解决的问题：如何使用委托将可执行的代码从一个方法传递到另一个，以及为什么这样做是非常有用的。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>Delegate</span>
<span class="token punctuation">{</span>
  <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">MyDel</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1.声明委托类型</span>
  <span class="token keyword">class</span> <span class="token class-name">Progarm</span>
  <span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PrintLow</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> <span class="token keyword">value</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0} - Low Value&quot;</span><span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PrintHigh</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> <span class="token keyword">value</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0} - High Value&quot;</span><span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">Progarm</span> program <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Progarm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">MyDel</span> del<span class="token punctuation">;</span> <span class="token comment">// 2.声明委托变量</span>

      <span class="token comment">// 创建随机整数生成器对象，并得到0到99之间的一个随机数</span>
      <span class="token class-name">Random</span> rand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name"><span class="token keyword">int</span></span> randomValue <span class="token operator">=</span> rand<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0-99</span>

      <span class="token comment">// 3. 创建一个包含 PrintLow 或 PrintHigh 的委托对象并将其赋值给 del 变量</span>
      del <span class="token operator">=</span> randomValue <span class="token operator">&lt;</span> <span class="token number">50</span>
        <span class="token punctuation">?</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyDel</span><span class="token punctuation">(</span>program<span class="token punctuation">.</span>PrintLow<span class="token punctuation">)</span>
        <span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyDel</span><span class="token punctuation">(</span>program<span class="token punctuation">.</span>PrintHigh<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">del</span><span class="token punctuation">(</span>randomValue<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4.执行委托</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h4 id="委托概述"><a href="#委托概述" class="header-anchor">#</a> 委托概述</h4> <p>委托和类一样，是一种用户自定义的类型。但类表示的是数据和方法的集合，<strong>而委托则持有一个或多个方法，以及一系列预定义操作</strong>。</p> <p>可以通过以下操作步骤来使用委托。</p> <ol><li>声明一个委托类型。委托声明看上去和方法声明类似，只是没有实现块。</li> <li>使用该委托类型声明一个委托变量。</li> <li>创建委托类型的对象，把它赋值给委托变量。新的委托对象包括指向某个方法的引用，这个方法和第一步定义的签名和返回类型一致。</li> <li>你可以选择为委托对象增加其他方法。这些方法必须与第一步中定义的委托类型有相同的签名和类型。</li> <li>在代码中你可以像调用方法一样调用委托。在调用委托的时候，其包含的每一个方法都会被执行。</li></ol> <p><img src="/Notebook/assets/img/csharp-class-vs-delegate.0aa634c1.png" alt=""></p> <p>你可以把 <code>delegate</code> 看做一个包含有序方法列表的对象，这些方法具有相同的签名和返回类型。</p> <ul><li>方法的列表称为调用列表。</li> <li>委托保存的方法可以来自任何类或结构，只要它们在下面两点匹配：
<ul><li>委托的返回类型；</li> <li>委托的签名（包括 ref 和 out 修饰符）。</li></ul></li> <li>调用列表中的方法可以是实例方法也可以是静态方法。</li> <li>在调用委托的时候，会执行其调用列表中的所有方法。</li></ul> <p><img src="/Notebook/assets/img/delegate-as-methods.95f3ea2f.png" alt=""></p> <h4 id="声明委托类型"><a href="#声明委托类型" class="header-anchor">#</a> 声明委托类型</h4> <p>正如上面所述，委托是类型，就好像类是类型一样。与类一样，委托类型必须在被用来创建变量以及类型的对象之前声明。如下示例代码声明了委托类型。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">MyDel</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>委托类型的声明看上去与方法的声明很类似，有返回类型和签名。返回类型和签名指定了委托接受的方法的形式。</p> <p>委托类型声明在两个方面与方法声明不同。委托类型声明：</p> <ul><li>以 delegate 关键字开头；</li> <li>没有方法主体。</li></ul> <p>说明：虽然委托类型声明看上去和方法的声明一样，但它不需要在类内部声明，因为它是类型声明。</p> <h4 id="创建委托对象"><a href="#创建委托对象" class="header-anchor">#</a> 创建委托对象</h4> <p>委托是引用类型，因此有引用和对象。在委托类型声明之后，我们可以声明变量并创建类型的对象。如下代码演示了委托类型的变量声明：</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name">MyDel</span> delVar<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>有两种创建委托对象的方式，第一种是使用带 <code>new</code> 运算符的对象创建表达式，如下面代码所示。<code>new</code> 运算符的操作数的组成如下。</p> <ul><li>委托类型名。</li> <li>一组圆括号，其中包含作为调用列表中第一个成员的方法的名字。方法可以是实例方法或静态方法。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code>delVar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyDel</span><span class="token punctuation">(</span>myInsObj<span class="token punctuation">.</span>MyM1<span class="token punctuation">)</span><span class="token punctuation">;</span>
dVar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyDel</span><span class="token punctuation">(</span>SClass<span class="token punctuation">.</span>otherM2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建委托并保存引用</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>第二种使用快捷语法，它仅由方法说明符构成。这种快捷语法能够工作是因为在方法名称和其相应的委托类型之间存在隐式转换。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code>delVar <span class="token operator">=</span> myInsObj<span class="token punctuation">.</span>MyM1<span class="token punctuation">;</span>
dVar <span class="token operator">=</span> SClass<span class="token punctuation">.</span>otherM2<span class="token punctuation">;</span> <span class="token comment">// 创建委托并保存引用</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="给委托赋值"><a href="#给委托赋值" class="header-anchor">#</a> 给委托赋值</h4> <p>由于委托是引用类型，我们可以通过给它赋值来改变包含在委托变量中的引用。旧的委托对象会被垃圾回收器回收。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name">MyDel</span> delVar<span class="token punctuation">;</span>
delVar <span class="token operator">=</span> myInsObj<span class="token punctuation">.</span>MyM1<span class="token punctuation">;</span> <span class="token comment">// 创建委托对象并赋值</span>
delVar <span class="token operator">=</span> SClass<span class="token punctuation">.</span>OtherM2<span class="token punctuation">;</span> <span class="token comment">// 创建新的委托对象并赋值</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="组合委托"><a href="#组合委托" class="header-anchor">#</a> 组合委托</h4> <p>迄今为止，我们见过的所有委托在调用列表中都只有一个方法。委托可以使用额外的运算符来“组合”。这个运算最终会创建一个新的委托，其调用列表连接了作为操作数的两个委托的调用列表副本。</p> <p>例如，如下代码创建了 3 个委托。第 3 个委托由前两个委托组合而成。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name">MyDel</span> delA <span class="token operator">=</span> myInstObj<span class="token punctuation">.</span>MyM1<span class="token punctuation">;</span>
<span class="token class-name">MyDel</span> delB <span class="token operator">=</span> SClass<span class="token punctuation">.</span>OtherM2<span class="token punctuation">;</span>

<span class="token class-name">MyDel</span> delC <span class="token operator">=</span> delA <span class="token operator">+</span> delB<span class="token punctuation">;</span> <span class="token comment">// 组合调用列表</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>尽管术语组合委托（combing delegate）让我们觉得好像操作数委托被修改了，其实它们并没有被修改。事实上，委托是恒定的。委托对象被创建后不能再被改变。</p> <p><img src="/Notebook/assets/img/combing-delegate.9cb402b4.png" alt=""></p> <h4 id="为委托添加方法"><a href="#为委托添加方法" class="header-anchor">#</a> 为委托添加方法</h4> <p>尽管通过上一节的内容我们知道了委托其实是不变的，不过 C# 提供了看上去可以为委托添加方法的语法，即使用 <code>+=</code> 运算符。</p> <p>例如，如下代码为委托的调用列表“增加” 了两个方法。方法加在了调用列表的底部。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name">MyDel</span> delVar <span class="token operator">=</span> inst<span class="token punctuation">.</span>MyM1<span class="token punctuation">;</span> <span class="token comment">// 创建并初始化</span>
delVar <span class="token operator">+=</span> SCl<span class="token punctuation">.</span>m3<span class="token punctuation">;</span> <span class="token comment">// 增加方法</span>
delVar <span class="token operator">+=</span> X<span class="token punctuation">.</span>Act<span class="token punctuation">;</span> <span class="token comment">// 增加方法</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>在使用 <code>+=</code> 运算符时，实际发生的是创建了一个新的委托，其调用列表是左边的委托加上右边方法的组合。然后将这个新的委托赋值给 delVar。</p> <p>你可以委托添加多个方法。每次添加都会调用列表中创建一个新的元素。</p> <h4 id="从委托移除方法"><a href="#从委托移除方法" class="header-anchor">#</a> 从委托移除方法</h4> <p>我们还可以用<code>-=</code>运算符从委托解除方法。如下代码演示了<code>-=</code> 运算符的使用。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code>delVar <span class="token operator">-=</span> SCl<span class="token punctuation">.</span>m3<span class="token punctuation">;</span> <span class="token comment">// 从委托移除方法</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>与为委托增加方法一样，其实是创建了一个新的委托。新的委托是旧的委托的副本——只是没有了已经被移除方法的引用。</p> <p>如下是移除委托时需要记住的一些事项：</p> <ul><li>如果在调用列表中的方法有多个实例，<code>-=</code> 运算符将从列表最后开始搜索，并且移除第一个与方法匹配的实例。</li> <li>试图删除委托中不存在的方法没有效果。</li> <li>试图调用空委托会抛出异常。我们可以通过把委托和<code>null</code> 进行比较来判断委托的调用列表是否为空。如果调用列表为空，则委托是<code>null</code>。</li></ul> <h4 id="调用委托"><a href="#调用委托" class="header-anchor">#</a> 调用委托</h4> <p>可以像调用方法一样简单调用委托。用于调用委托的参数将会用于调用调用列表中的每一个方法。（除非有输出参数）</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name">MyDel</span> delVar <span class="token operator">=</span> inst<span class="token punctuation">.</span>MyM1<span class="token punctuation">;</span>
delVar <span class="token operator">+=</span> SCl<span class="token punctuation">.</span>m3<span class="token punctuation">;</span>
delVar <span class="token operator">+=</span> X<span class="token punctuation">.</span>Act<span class="token punctuation">;</span>
<span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token function">delVar</span><span class="token punctuation">(</span><span class="token number">55</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><img src="/Notebook/assets/img/combing-delegate.9cb402b4.png" alt=""></p> <p>如果一个方法在调用列表中出现多次，当委托被调用时，每次在列表中遇到这个方法时它都会被调用一次。</p> <h4 id="委托的示例"><a href="#委托的示例" class="header-anchor">#</a> 委托的示例</h4> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>Delegate</span>
<span class="token punctuation">{</span>
  <span class="token comment">// 定义一个没有返回值和参数的委托类型</span>
  <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PrintFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1.声明委托类型</span>
  <span class="token keyword">class</span> <span class="token class-name">Test</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Print1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Print1-- instance.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Print2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Print2 -- static.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Progarm2</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">Test</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个测试类的实例</span>
      <span class="token class-name">PrintFunction</span> pf<span class="token punctuation">;</span> <span class="token comment">// 创建一个空委托</span>
      pf <span class="token operator">=</span> t<span class="token punctuation">.</span>Print1<span class="token punctuation">;</span> <span class="token comment">//3. 实例化并初始化该委托；</span>

      <span class="token comment">// 给委托添加另外3个方法</span>
      pf <span class="token operator">+=</span> Test<span class="token punctuation">.</span>Print2<span class="token punctuation">;</span>
      pf <span class="token operator">+=</span> t<span class="token punctuation">.</span>Print1<span class="token punctuation">;</span>
      pf <span class="token operator">+=</span> Test<span class="token punctuation">.</span>Print2<span class="token punctuation">;</span>

      <span class="token comment">// 4.执行委托</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> pf<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token function">pf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">else</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Delegate is empty.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 输出</span>
<span class="token comment">// Print1-- instance.</span>
<span class="token comment">// Print2 -- static.</span>
<span class="token comment">// Print1-- instance.</span>
<span class="token comment">// Print2 -- static.</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h4 id="调用带返回值的委托"><a href="#调用带返回值的委托" class="header-anchor">#</a> 调用带返回值的委托</h4> <p>如果委托有返回值并且在调用列表中有一个以上的方法，会发生下面的情况：</p> <ul><li>调用列表中最后一个方法返回的值就是委托调用返回的值。</li> <li>调用列表中所有其他方法的返回值都会被忽略。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 委托——调用带返回值的委托</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>Delegate</span>
<span class="token punctuation">{</span>
  <span class="token comment">// 定义一个没有返回值和参数的委托类型</span>
  <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">MyDel2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1.声明带有返回值的委托类型</span>
  <span class="token keyword">class</span> <span class="token class-name">Test2</span>
  <span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">int</span></span> IntValue <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">Add2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      IntValue <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> IntValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">Add3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      IntValue <span class="token operator">+=</span> <span class="token number">3</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> IntValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Progarm3</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">Test2</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个测试类的实例</span>
      <span class="token class-name">MyDel2</span> mDel <span class="token operator">=</span> t<span class="token punctuation">.</span>Add2<span class="token punctuation">;</span> <span class="token comment">//2. 实例化并初始化该委托；</span>
      mDel <span class="token operator">+=</span> t<span class="token punctuation">.</span>Add3<span class="token punctuation">;</span>
      mDel <span class="token operator">+=</span> t<span class="token punctuation">.</span>Add2<span class="token punctuation">;</span>


      <span class="token comment">// 3.执行委托</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> mDel<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Value: {0}&quot;</span><span class="token punctuation">,</span> <span class="token function">mDel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">else</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Delegate is empty.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 输出：</span>
<span class="token comment">// Value: 12</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><h4 id="调用带引用参数的委托"><a href="#调用带引用参数的委托" class="header-anchor">#</a> 调用带引用参数的委托</h4> <p>如果委托有引用参数，参数值会根据调用列表中的一个或多个方法的返回值而改变。</p> <ul><li>在调用委托列表中的下一个方法时，参数的新值（不是初始值）会传给下一个方法。</li></ul> <p>例如，如下代码调用了具有引用参数的委托。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 委托——调用带引用参数的委托</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>Delegate</span>
<span class="token punctuation">{</span>
  <span class="token comment">// 定义一个没有返回值和参数的委托类型</span>
  <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">MyDel3</span><span class="token punctuation">(</span><span class="token keyword">ref</span> <span class="token class-name"><span class="token keyword">int</span></span> X<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1.声明带有返回值的委托类型</span>
  <span class="token keyword">class</span> <span class="token class-name">Progarm4</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Add2</span><span class="token punctuation">(</span><span class="token keyword">ref</span> <span class="token class-name"><span class="token keyword">int</span></span> x<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      x <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Add3</span><span class="token punctuation">(</span><span class="token keyword">ref</span> <span class="token class-name"><span class="token keyword">int</span></span> x<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      x <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">Progarm4</span> program <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Progarm4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">MyDel3</span> mDel <span class="token operator">=</span> program<span class="token punctuation">.</span>Add2<span class="token punctuation">;</span>
      mDel <span class="token operator">+=</span> program<span class="token punctuation">.</span>Add3<span class="token punctuation">;</span>
      mDel <span class="token operator">+=</span> program<span class="token punctuation">.</span>Add2<span class="token punctuation">;</span>

      <span class="token class-name"><span class="token keyword">int</span></span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
      <span class="token comment">// 执行委托</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> mDel<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token function">mDel</span><span class="token punctuation">(</span><span class="token keyword">ref</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Value: {0}&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">else</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Delegate is empty.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h4 id="匿名方法"><a href="#匿名方法" class="header-anchor">#</a> 匿名方法</h4> <p>至此，我们已经见过了使用静态方法或实例方法来初始化委托。对于这种情况，方法本身可以被代码的其他部分显式调用。当然，这个部分也必须是某个类或结构的成员。</p> <p>然而，如果方法只会被使用一次——用来初始化委托会怎么样呢？在这种情况下，除了创建委托的语法需要，没有必要创建独立的具名方法。匿名方法允许我们避免使用独立的具名方法。</p> <ul><li>匿名方法（anonymous method）是在初始化委托时内联（inline）声明的方法。</li></ul> <p><img src="/Notebook/assets/img/anonymous-vs-named-method.16fcdbec.png" alt=""></p> <h5 id="使用匿名方法"><a href="#使用匿名方法" class="header-anchor">#</a> 使用匿名方法</h5> <p>我们可以在以下地方使用匿名方法。</p> <ul><li>声明委托变量时作为初始化表达式。</li> <li>组合委托时在赋值语句的右边。</li> <li>为委托增加事件时在赋值语句的右边。</li></ul> <h5 id="匿名方法的语法"><a href="#匿名方法的语法" class="header-anchor">#</a> 匿名方法的语法</h5> <p>匿名方法表达式的语法包含以下组成部分：</p> <ul><li>delegate 类型关键字。</li> <li>参数列表，如果语句块没有任何使用参数则可以省略。</li> <li>语句块，它包含了匿名方法的代码。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">delegate</span> <span class="token punctuation">(</span>Parameters<span class="token punctuation">)</span> <span class="token punctuation">{</span> ImplementationCode<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol><li>匿名方法不会显式声明返回值。然而，实现代码本身的行为必须通过返回一个在类型上与委托的返回类型相同的值来匹配委托的返回类型。如果委托有 <code>void</code> 类型的返回值，匿名方法就不能返回值。</li> <li><strong>参数</strong>
除了数组参数，匿名方法的参数必须在如下方面与委托匹配：</li></ol> <ul><li>参数数量；</li> <li>参数类型及位置；</li> <li>修饰符。</li></ul> <p>我们可以通过使圆括号为空或省略圆括号来简化匿名方法的参数列表，但必须满足以下两个条件：</p> <ul><li>委托的参数列表不包含任何 out 参数；</li> <li>匿名方法不使用任何参数。</li></ul> <p>例如，如下代码声明了没有任何 out 参数的委托，匿名方法也没有使用任何参数。由于两个条件都满足了，我们就可以省略匿名方法的参数列表。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SomeDel</span><span class="token punctuation">(</span> <span class="token class-name"><span class="token keyword">int</span></span> X<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 声明委托类型</span>
<span class="token class-name">SomeDel</span> SDel <span class="token operator">=</span> <span class="token keyword">delegate</span> <span class="token punctuation">{</span> <span class="token comment">// 省略的参数列表</span>
  <span class="token function">PrintMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">CleanUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="3"><li>params 参数</li></ol> <p>如果委托声明的参数列表包含了 params 参数，那么匿名方法的参数列表将忽略 params 关键字。例如，在如下列代码中：</p> <ul><li>委托类型声明指定最后一个参数为 params 类型的参数；</li> <li>然而，匿名方法列表忽略了 params 关键字。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SomeDel</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> X<span class="token punctuation">,</span> <span class="token keyword">params</span> <span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> Y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">SomeDel</span> mDel <span class="token operator">=</span> <span class="token keyword">delegate</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> X<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> Y<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="变量和参数的作用域"><a href="#变量和参数的作用域" class="header-anchor">#</a> 变量和参数的作用域</h5> <p>变量以及声明在匿名方法内部的局部变量的作用域限制在实现方法的主体内。</p> <ol><li>外部变量</li></ol> <ul><li>与委托的具名方法不同，匿名方法可以访问它们外围作用域的局部变量和环境。</li> <li>外围作用域的变量叫做<code>外部变量（outer variable）</code>。</li> <li>用在匿名方法实现代码中的变量称为方法<code>捕获（captured）</code>。</li></ul> <p><img src="/Notebook/assets/img/anonymous-params-scope.78e498a0.png" alt=""></p> <ol start="2"><li>捕获变量的生命周期的扩展。
只要捕获方法还是委托的一部分，即使变量已经离开了作用域，捕获的外部变量也会一直有效。</li></ol> <p><img src="/Notebook/assets/img/anonymous-method-captured.0ac30f16.png" alt=""></p> <h4 id="lambda-表达式"><a href="#lambda-表达式" class="header-anchor">#</a> Lambda 表达式</h4> <p>我们刚刚已经看到了，C# 2.0 引入了匿名方法。然而它的语法有一点麻烦，而且需要一些编译器已经知道的信息。C# 3.0 引入了 Lambda 表达式，简化了匿名方法的语法，从而避免包含这些多余的信息。</p> <p>在匿名方法的语法中，delegate 关键字是有点多余，因为编译器已经知道我们在将方法赋值给委托。我们可以很容易通过以下步骤把匿名方法转换为 Lambda 表达式。</p> <ul><li>删除 delegate 关键字。</li> <li>在参数列表和匿名方法主体之间方 Lambda 运算符<code>=&gt;</code>。Lambda 运算符读作“goes to”。</li></ul> <p>编辑器还可以从委托的声明中知道委托参数的类型，因此 Lambda 表达式允许我们省略类型参数，如 le2 的赋值代码所示。</p> <ul><li>带有参数类型的参数列表称为显式类型。</li> <li>省略类型的参数列表称为隐式类型。</li> <li>如果只有一个隐式参数，我们可以省略周围的圆括号，如 le3 的赋值代码所示。</li> <li>最后，Lambda 表达式允许表达式的主体是语句块或表达式。如果语句块包含了一个返回语句，我们可以将语句替换为 <code>return</code> 关键字后的表达式，如 le4 的赋值代码表达式。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 委托——匿名方法和 Lambda 表达式</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>Delegate</span>
<span class="token punctuation">{</span>
  <span class="token comment">// 定义一个有返回值和参数的委托类型</span>
  <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> <span class="token function">MyDel4</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> par<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1.声明带有返回值的委托类型</span>
  <span class="token keyword">class</span> <span class="token class-name">Progarm5</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">MyDel4</span> del <span class="token operator">=</span> <span class="token keyword">delegate</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 匿名方法</span>
      <span class="token class-name">MyDel4</span> le1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> x<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// Lambda 表达式</span>
      <span class="token class-name">MyDel4</span> le2 <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token class-name">MyDel4</span> le3 <span class="token operator">=</span> x <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token class-name">MyDel4</span> le4 <span class="token operator">=</span> x <span class="token operator">=&gt;</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token comment">// 执行委托</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> del<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Value: {0}&quot;</span><span class="token punctuation">,</span> <span class="token function">del</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Value: {0}&quot;</span><span class="token punctuation">,</span> <span class="token function">le1</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Value: {0}&quot;</span><span class="token punctuation">,</span> <span class="token function">le2</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Value: {0}&quot;</span><span class="token punctuation">,</span> <span class="token function">le3</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Value: {0}&quot;</span><span class="token punctuation">,</span> <span class="token function">le4</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">else</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Delegate is empty.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><ul><li>表达式的参数列表的参数不一定需要包含类型（隐式类型），除非委托有 <code>ref</code> 或 <code>out</code> 参数。——此时必须注明类型（显式类型）。</li> <li>如果只有一个参数，并且是隐式类型的，周围的圆括号可以被省略，否则必须有括号。</li> <li>如果没有参数，必须使用一组空的圆括号。</li></ul> <h3 id="事件"><a href="#事件" class="header-anchor">#</a> 事件</h3> <h4 id="发布者和订阅者"><a href="#发布者和订阅者" class="header-anchor">#</a> 发布者和订阅者</h4> <p>很多程序都有一个共同的需求，即当一个特定的程序事件发生时，程序的其他部分可以得到该事件已经发生的通知。</p> <p><code>发布者/订阅者模式（publisher/subscriber pattern）</code>可以满足这种需求。在这种模式中，<code>发布者</code>类定义了一系列程序的其他部分可能感兴趣的事件。其它类可以<code>”注册“</code>，以便在这些事件发生时发布者可以通知它们。这些<code>订阅者</code>类通过向发布者提供一个方法来“注册”以获取通知。当事件发生时，发布者<code>“触发事件”</code>，然后执行订阅者提交的所有事件。</p> <p>由订阅者提供的方法称为<code>回调方法</code>，因为发布者通过执行这些方法来“往回调用订阅者的方法”。还可以将它们称为事件处理程序，因为它们是为处理事件而调用的代码。</p> <p><img src="/Notebook/assets/img/publisher-subscriber.accaff6e.png" alt=""></p> <p>下面是一些有关事件的重要事项：</p> <ul><li>**发布者（publisher）**发布某个事件的类或结构，其他类可以在该事件发生时得到通知。</li> <li>**订阅者（subscriber）**注册并在事件发生时得到通知的类或结构。</li> <li>**事件处理程序（event handler）**由订阅者注册到事件的方法，在发布者触发事件时执行。</li> <li><strong>触发（raise）事件、调用（invoke）或触发（fire）事件的术语</strong> 当事件触发时，所有注册到它的方法都会被依次调用。</li></ul> <p>前面一章介绍了委托。事件的很多部分都与委托类似。实际上，事件就像是专门用于某种特殊用途的简单委托。委托和事件的行为之所以相似，是有充分理由的。事件包含了一个私有的委托。</p> <p><img src="/Notebook/assets/img/event-delegate.71b2bfde.png" alt=""></p> <p>有关事件的私有委托需要了解的重要事项如下：</p> <ul><li>事件提供了对它的私有控制委托的结构化访问。也就是说你无法直接访问委托。</li> <li>事件中可用的操作比委托要少，对于事件我们只可以添加、删除或调用事件处理程序。</li> <li>事件被触发时，它调用委托来依次调用调用列表中的方法。</li></ul> <p><img src="/Notebook/assets/img/event-struction.c82649da.png" alt=""></p> <h4 id="源代码组件概览"><a href="#源代码组件概览" class="header-anchor">#</a> 源代码组件概览</h4> <p>需要在事件中使用的代码有 5 部分。</p> <ul><li><strong>委托类型声明</strong> 事件和事件处理程序必须有共同的签名和返回类型，它们通过委托类型进行描述。</li> <li><strong>事件处理程序声明</strong> 订阅者类会在事件触发时执行的方法声明。它们不一定是有显式命名的方法，还可以是匿名方法或 Lambda 表达式。</li> <li><strong>事件声明</strong> 发布类必须声明一个订阅者可以注册的事件成员。当声明的事件为 <code>public</code> 时，称为发布了事件。</li> <li><strong>事件注册</strong> 订阅者必须订阅事件才能在它被触发时得到通知。</li> <li><strong>触发事件的代码</strong> 发布者类中“触发”事件并导致调用注册的所有事件处理程序的代码。</li></ul> <p><img src="/Notebook/assets/img/c-sharp-use-event-component.23193d0d.png" alt=""></p> <h4 id="声明事件"><a href="#声明事件" class="header-anchor">#</a> 声明事件</h4> <p>发布者类必须提供事件对象。创建事件比较简单——只需要委托类型和名字。事件声明的语法如下代码所示，代码中声明了一个叫做 CountedADozen 的事件。注意如下有关 CountedADozen 事件的内容。</p> <ul><li>事件声明在一个类中。</li> <li>它需要委托类型的名称，任何附加到事件（如注册）的处理程序都必须与委托类型的签名和返回类型相匹配。</li> <li>它声明为 <code>public</code>，这样其他类和结构可以在它上面注册事件处理程序。</li> <li>不能使用对象创建表达式（new 表达式）来创建它的对象。</li></ul> <h5 id="事件是成员"><a href="#事件是成员" class="header-anchor">#</a> 事件是成员</h5> <p>一个常见的误解是把事件认为是类型，然而它不是。和方法、属性一样，事件是类或结构的成员，这一点引出了几个重要的特性。</p> <ul><li>由于事件是成员：
<ul><li>我们不能在一段可执行代码中声明事件；</li> <li>它必须声明在类或结构中，和其他成员一样。</li></ul></li> <li>事件成员被隐式自动初始化 null。
事件声明需要委托类型的名字，我们可以声明一个委托类型或者使用已存在的。如果我们声明一个委托类型，它必须指定事件保存的方法的签名和返回类型。</li></ul> <p>BCL 声明了一个叫做 <code>EventHandler</code> 的委托，专门用于系统事件。</p> <h4 id="订阅事件"><a href="#订阅事件" class="header-anchor">#</a> 订阅事件</h4> <p>订阅者向事件添加事件处理程序。对于一个要添加到事件的事件处理程序来说，它必须具有与事件的委托相同的返回类型和签名。</p> <ul><li>使用 <code>+=</code> 运算符来为事件增加事件处理程序，如下面代码所示。事件处理程序位于该运算符的右边。</li> <li>事件处理程序的规范可以是以下任意一种：
<ul><li>实例方法的名称；</li> <li>静态方法的名称；</li> <li>匿名方法；</li> <li>Lambda 表达式。</li></ul></li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code>incrementer<span class="token punctuation">.</span>CountedADozen <span class="token operator">+=</span> IncrementDozensCount<span class="token punctuation">;</span> <span class="token comment">// 实例方法</span>
incrementer<span class="token punctuation">.</span>CountedADozen <span class="token operator">+=</span> Class<span class="token punctuation">.</span>CounterHandleB<span class="token punctuation">;</span> <span class="token comment">// 静态方法</span>
<span class="token range operator">..</span><span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="触发事件"><a href="#触发事件" class="header-anchor">#</a> 触发事件</h4> <p>事件成员本身只是保存了需要被调用的事件处理程序。如果事件没有被触发，什么都不会发生。我们需要确保在合适的时候有代码来做这事情。</p> <ul><li>在触发事件之前和<code>null</code> 进行比较，从而查看是否包含事件处理程序，如果事件是 <code>null</code>，则表示没有，不能执行。</li> <li>触发事件的语法和调用方法一样：
<ul><li>使用事件名称，后面跟的参数列表包含在圆括号中；</li> <li>参数列表必须与事件的委托类型相匹配。</li></ul></li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>Event</span>
<span class="token punctuation">{</span>
  <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1. 声明委托</span>
  <span class="token comment">// 发布者</span>
  <span class="token keyword">class</span> <span class="token class-name">Incrementer</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">Handler</span> CountedADozen<span class="token punctuation">;</span> <span class="token comment">// 2. 创建事件并发布</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DoCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">12</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> CountedADozen <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
          <span class="token function">CountedADozen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5. 每增加12个计数触发事件一次</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 订阅者</span>
  <span class="token keyword">class</span> <span class="token class-name">Dozens</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> DozensCount
    <span class="token punctuation">{</span>
      <span class="token keyword">get</span><span class="token punctuation">;</span>
      <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 构造函数</span>
    <span class="token keyword">public</span> <span class="token function">Dozens</span><span class="token punctuation">(</span><span class="token class-name">Incrementer</span> incrementer<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      DozensCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      incrementer<span class="token punctuation">.</span>CountedADozen <span class="token operator">+=</span> IncrementDozensCount<span class="token punctuation">;</span> <span class="token comment">// 3. 订阅事件</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 4. 声明事件处理程序</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">IncrementDozensCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      DozensCount<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">Incrementer</span> incrementer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Incrementer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">Dozens</span> dozensCounter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dozens</span><span class="token punctuation">(</span>incrementer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注册事件</span>
      incrementer<span class="token punctuation">.</span><span class="token function">DoCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 触发事件</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Number of dozens = {0}&quot;</span><span class="token punctuation">,</span> dozensCounter<span class="token punctuation">.</span>DozensCount<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 8</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><h4 id="标准事件的用法"><a href="#标准事件的用法" class="header-anchor">#</a> 标准事件的用法</h4> <p>GUI 编程是事件驱动，也就是说在程序运行时，它可以在任何时候被事件打断，比如点击按钮、按下按键或系统定时器。在这些情况发生时，程序需要处理事件然后继续其他事情。</p> <p>显然，程序事件的异步处理是使用 C# 事件的绝佳场景。Window GUI 编程如此广泛地使用了事件，对于事件的使用，.NET 框架提供了一个标准模式。事件使用的标准模式的根本就是 <code>System</code> 命名空间的 <code>EventHandler</code> 委托类型。<code>EventHandler</code> 委托类型的声明如下代码所示。关于声明需要注意以下几点：</p> <ul><li>第一个参数用于保存触发事件的对象的引用。由于是 <code>object</code> 类型的，所以可以匹配任何类型的实例；</li> <li>第二个参数用来保存状态信息，指明什么类型适用于该应用程序。</li> <li>返回类型是 <code>void</code>。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">EventHandler</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArg</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>EventHandler</code> 第二个参数是 <code>EventArgs</code> 类的对象，它声明在 System 命名空间中。你可能会想，既然第二个参数用于传递数据，<code>EventArgs</code> 类的对象应该可以保存一些类型的数据，你可能错了。</p> <ul><li><code>EventArgs</code> 设计为不能传递任何数据。它用于不需要传递数据的事件处理程序——通常会被忽略。</li> <li>如果你希望传递数据，必须声明一个派生自 <code>EventArgs</code> 的类，使用合适的字段来保存需要传递的数据。</li></ul> <p>尽管<code>EventArgs</code> 类实际上并不传递数据，但它是使用 <code>EventHandler</code> 委托模式的重要部分。不管参数使用的实际类型是什么，object 类和 EventArgs 总是基类。这样 EventHandler 就能提供一个对所有事件和事件处理器都通用的签名，只允许两个参数，而不是各自都有不同签名。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>Event</span>
<span class="token punctuation">{</span>
  <span class="token comment">// 发布者</span>
  <span class="token keyword">class</span> <span class="token class-name">Incrementer2</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// 使用系统定义的 EventHandler 委托</span>
    <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">EventHandler</span> CountedADozen<span class="token punctuation">;</span> <span class="token comment">// 创建事件并发布</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DoCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">12</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> CountedADozen <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
          <span class="token comment">// 触发事件时使用 EventHandler 的参数</span>
          <span class="token function">CountedADozen</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 每增加12个计数触发事件一次</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 订阅者</span>
  <span class="token keyword">class</span> <span class="token class-name">Dozens2</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> DozensCount
    <span class="token punctuation">{</span>
      <span class="token keyword">get</span><span class="token punctuation">;</span>
      <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 构造函数</span>
    <span class="token keyword">public</span> <span class="token function">Dozens2</span><span class="token punctuation">(</span><span class="token class-name">Incrementer2</span> incrementer<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      DozensCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      incrementer<span class="token punctuation">.</span>CountedADozen <span class="token operator">+=</span> IncrementDozensCount<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 声明事件处理程序</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">IncrementDozensCount</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> source<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span> <span class="token comment">// 事件处理程序的签名必须与委托的签名匹配</span>
    <span class="token punctuation">{</span>
      DozensCount<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program2</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">Incrementer2</span> incrementer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Incrementer2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">Dozens2</span> dozensCounter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dozens2</span><span class="token punctuation">(</span>incrementer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注册事件</span>
      incrementer<span class="token punctuation">.</span><span class="token function">DoCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 触发事件</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Number of dozens = {0}&quot;</span><span class="token punctuation">,</span> dozensCounter<span class="token punctuation">.</span>DozensCount<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 8</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><h5 id="通过扩展-eventargs-来传递数据"><a href="#通过扩展-eventargs-来传递数据" class="header-anchor">#</a> 通过扩展 EventArgs 来传递数据</h5> <p>待泛型篇章后补充。</p> <h5 id="移除事件处理程序"><a href="#移除事件处理程序" class="header-anchor">#</a> 移除事件处理程序</h5> <p>在用完了事件处理程序之后，可以从事件中把它移除。可以利用 <code>-=</code> 运算符把事件处理程序从事件中移除，如下所示：</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code>p<span class="token punctuation">.</span>SimpleEvent <span class="token operator">-=</span> s<span class="token punctuation">.</span>MethodB<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="事件访问器"><a href="#事件访问器" class="header-anchor">#</a> 事件访问器</h4> <p>之前提过，<code>+=</code> 和 <code>-=</code> 运算符是事件允许的唯一运算符。看到这里我们应该知道，这些运算符有预定义的行为。</p> <p>然而，我们可以修改这些运算符的行为，并且使用它们时可以让事件执行任何我们希望的自定义代码。</p> <p>要改变这两个运算符的操作，可以为事件定义事件访问器。</p> <ul><li>有两个访问其：add 和 remove。</li> <li>声明事件的访问器看上去和声明一个属性差不多。</li></ul> <p>下面的示例演示了具有访问器的事件声明。两个访问器都有叫做<code>value</code> 的隐式值参数，它接受实例或静态方法的引用。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token return-type class-name">EventHandler</span> CountedADozen <span class="token punctuation">{</span>
  <span class="token keyword">add</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 执行 += 运算符的代码</span>
  <span class="token keyword">remove</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 执行 -= 运算符的代码</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>声明了事件访问器之后，事件不包含任何内嵌委托对象。我们必须实现自己的机制来存储和移除事件注册的方法。</p> <p>事件访问器表现为 void 方法，也就是不能使用包含返回值的 return 语句。</p> <h3 id="接口"><a href="#接口" class="header-anchor">#</a> 接口</h3> <h4 id="什么是接口"><a href="#什么是接口" class="header-anchor">#</a> 什么是接口</h4> <p>接口是指定一组函数成员而不实现它们的引用类型。所以只能类和结构来实现接口。这种描述听起来有点抽象，因此我们先来看看接口能够帮助我们解决的问题，以及是如何解决的。</p> <p>以下面的代码为例。观察 Program 类的 Main 方法，它创建并初始化了一个 CA 类的对象，并将该对象传递给 PrintInfo 方法。PrintInfo 需要一个 CA 类型的对象，并打印包含在对象中的信息。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">class</span> <span class="token class-name">CA</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> Name<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> Age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">CB</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> First<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> Last<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">double</span></span> PersonAge<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PrintInfo</span><span class="token punctuation">(</span><span class="token class-name">CA</span> item<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Name: {0}, Age {1}&quot;</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> item<span class="token punctuation">.</span>Age<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">CA</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;Jecyu Lin&quot;</span><span class="token punctuation">,</span> Age <span class="token operator">=</span> <span class="token number">25</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">PrintInfo</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>只要传入的是 CA 类型的对象，PrintInfo 就能正常工作。但如果传入的是 CB 类（同样是见上面的代码），就不行了。<u>假设 PrintInfo 方法中的算法非常有用，我们能用它操作不同类的对象。</u></p> <p>现在的代码不能满足上面的需求，原因有很多。<u>首先，PrintInfo 的形参指明了实参必须为 CA 类型的对象，因此传入 CB 或其他类型的对象将会导致编译错误。</u>但即使我们能绕开这一点使其接受 CB 类型的对象还是会有问题，因为 CB 的结构与 CA 的不同。字段的名称和类型与 CA 不一样，PrintInfo 对这些字段一无所知。</p> <p><u>我们能不能创建一个能够成功传入 PrintInfo 的类，并且不管该类是什么样的结构，PirntInfo 都能正常处理呢？接口使这种设想变为可能。</u></p> <p>如下代码所示。</p> <ul><li>首先，它声明了一个 IInfo 接口，包含两个方法——GetName 和 GetAge，每个方法都返回 string。</li> <li>类 CA 和类 CB 各自实现了 IInfo 接口（将其放到基类列表中），并实现了该接口所需的两个方法。</li> <li>Main 创建了 CA 和 CB 的实例，并传入 PrintInfo。</li> <li>由于类实例实现了接口，PrintInfo 可以调用那两个方法，每个类实例执行各自的方法，就好像执行自己类声明的方法。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 用接口使 PrintInfo 方法能够用于多个类</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuInterface</span>
<span class="token punctuation">{</span>
  <span class="token keyword">interface</span> <span class="token class-name">IInfo</span> <span class="token comment">// 1. 声明接口</span>
  <span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">CA</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IInfo</span></span> <span class="token comment">// 2. 声明实现了接口的 CA 类</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> Name<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> Age<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> Name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> Age<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">CB</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IInfo</span></span> <span class="token comment">// 3. 在 CB 类中实现两个接口方法</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> First<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> Last<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">double</span></span> PersonsAge<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> First <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> Last<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> PersonsAge<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PrintInfo</span><span class="token punctuation">(</span><span class="token class-name">IInfo</span> item<span class="token punctuation">)</span> <span class="token comment">// 4. 传入接口的引用</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Name: {0}, Age {1}&quot;</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span><span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span><span class="token function">GetAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">CA</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;Jecyu Lin&quot;</span><span class="token punctuation">,</span> Age <span class="token operator">=</span> <span class="token number">25</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token class-name">CB</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> First <span class="token operator">=</span> <span class="token string">&quot;Jecyu&quot;</span><span class="token punctuation">,</span> Last <span class="token operator">=</span> <span class="token string">&quot;Lin&quot;</span><span class="token punctuation">,</span> PersonsAge <span class="token operator">=</span> <span class="token number">25</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token comment">// 5. 对象的引用能自动转换为它们实现的接口的引用</span>
      <span class="token function">PrintInfo</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintInfo</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><h5 id="使用-icomarable-接口的示例"><a href="#使用-icomarable-接口的示例" class="header-anchor">#</a> 使用 IComarable 接口的示例</h5> <p>我们已经了解了接口能够解决的问题，接下来看第二个示例并深入一些细节。我们先来看看如下代码，它接受了一个没有排序的整数数组并且按升序进行排序。这段代码的功能如下：</p> <ul><li>第一行代码创建了包含了 5 个无序整数的数组；</li> <li>第二行代码使用了 Array 类的静态 Sort 方法来排序元素；</li> <li>用 foreach 循环输出它们，显示以升序排序的数字。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> myInt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 创建 int</span>
Array<span class="token punctuation">.</span><span class="token function">Sort</span><span class="token punctuation">(</span>myInt<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 按大小排序</span>
<span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token keyword">in</span> myInt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出它们</span>
<span class="token punctuation">}</span>

<span class="token comment">// 输出</span>
<span class="token comment">// 2 4 9 16 20</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Sort 方法在 int 数组上工作得很好，但是如果我们尝试在自己的类上使用会发生什么呢？如下所示：</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>  <span class="token comment">// 声明一个简单类</span>
  <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> TheValue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token class-name">MyClass<span class="token punctuation">[</span><span class="token punctuation">]</span></span> mc  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 声明一个有5个元素的数组</span>
<span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token comment">// 创建并初始化元素</span>
Array<span class="token punctuation">.</span><span class="token function">Sort</span><span class="token punctuation">(</span>mc<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 尝试使用 Sort 排序抛出异常</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>如果你尝试运行这段代码的话，不会得到排序而是会得到一个异常。<u>Sort 并不能针对 MyClass 对象数组进行排序的原因是它不知道如何比较用于自定义的对象以及如何进行排序。Array 类的 Sort 方法其实依赖于一个叫做 <code>IComparable</code> 的接口，它声明在 BCL 中，包含唯一的方法 CompareTo。</u></p> <p>下面的代码展示了 IComparable 接口的声明。<u>注意，接口主体包含 CompareTo 方法的声明，指定了它接受一个 object 类型的参数。尽管方法具有名称、参数和返回类型，但却没有实现。</u>它的实现用一个分号表示。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IComparable</span> <span class="token punctuation">{</span>
  <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">CompareTo</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>尽管在接口声明中没有为 CompareTo 方法提供实现，但 IComparable 接口的 .NET 文档中描述了该方法应该做的事情，可以在创建实现接口的类或结构时参考。文档中写道，在调用 CompareTo 方法时，它应该返回以下几个值之一：</p> <ul><li>负数值 当前对象小于参数对象</li> <li>正数值 当前对象大于参数对象</li> <li>零 两个对象在比较时相等</li></ul> <p>Sort 使用的算法依赖于元素的 CompareTo 方法来决定两个元素的次序。int 类型实现了 IComparable，但是 MyClass 没有，因此当 Sort 尝试调用 MyClass 不存在的 CompareTo 方法时会抛出异常。</p> <p>我们可以通过让类实现 IComparable 来使 Sort 方法可以用于 MyClass 类型的对象。要实现一个接口，类或结构必须做两件事情：</p> <ul><li>必须在基类列表后面列出接口名称；</li> <li>必须为接口的每一个成员提供实现。</li></ul> <p>如下代码所示</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code>  <span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IComparable</span></span> <span class="token comment">// 类实现引用</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> TheValue<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">CompareTo</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> obj<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">MyClass</span> mc <span class="token operator">=</span> <span class="token punctuation">(</span>MyClass<span class="token punctuation">)</span>obj<span class="token punctuation">;</span> <span class="token comment">// 参数类</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>TheValue <span class="token operator">&lt;</span> mc<span class="token punctuation">.</span>TheValue<span class="token punctuation">)</span> <span class="token comment">// this 当前的实例类，mc 为传进来的类</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>TheValue <span class="token operator">&gt;</span> mc<span class="token punctuation">.</span>TheValue<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>下面显示了更新后的完整代码</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 用接口使 PrintInfo 方法能够用于多个类</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuInterface</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IComparable</span></span> <span class="token comment">// 类实现引用</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> TheValue<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">CompareTo</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> obj<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">MyClass</span> mc <span class="token operator">=</span> <span class="token punctuation">(</span>MyClass<span class="token punctuation">)</span>obj<span class="token punctuation">;</span> <span class="token comment">// 参数类</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>TheValue <span class="token operator">&lt;</span> mc<span class="token punctuation">.</span>TheValue<span class="token punctuation">)</span> <span class="token comment">// this 当前的实例类，mc 为传进来的类</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>TheValue <span class="token operator">&gt;</span> mc<span class="token punctuation">.</span>TheValue<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program2</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PrintOut</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> s<span class="token punctuation">,</span> <span class="token class-name">MyClass<span class="token punctuation">[</span><span class="token punctuation">]</span></span> mc<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> m <span class="token keyword">in</span> mc<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0}&quot;</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span>TheValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">var</span></span> myInt <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token class-name">MyClass<span class="token punctuation">[</span><span class="token punctuation">]</span></span> mcArr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 创建 MyClass 对象的数组</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        mcArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mcArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>TheValue <span class="token operator">=</span> myInt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token function">PrintOut</span><span class="token punctuation">(</span><span class="token string">&quot;Initial Order: &quot;</span><span class="token punctuation">,</span> mcArr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出初始数组</span>
      Array<span class="token punctuation">.</span><span class="token function">Sort</span><span class="token punctuation">(</span>mcArr<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintOut</span><span class="token punctuation">(</span><span class="token string">&quot;Sorted order: &quot;</span><span class="token punctuation">,</span> mcArr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出排序后的数组</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><h4 id="声明接口"><a href="#声明接口" class="header-anchor">#</a> 声明接口</h4> <p>上一节使用的是 BCL 中已经声明的接口。在这部分内容中，我们将来看看如何声明接口。关于声明接口，需要知道的重要事项如下：</p> <ul><li>接口声明不能包含以下成员
<ul><li>数据成员。</li> <li>静态成员。</li></ul></li> <li>接口声明只能包含以下类型的非静态成员函数的声明：
<ul><li>方法；</li> <li>属性；</li> <li>事件；</li> <li>索引器。</li></ul></li> <li><u>这些函数成员的声明不能包含任何实现代码，而在每一个成员声明的主体后必须使用分号。</u></li> <li><u>按照惯例，接口名称必须从大写的 I 开始（比如 ISaveable）</u></li> <li><u>与类和结构一样，接口声明还可以分隔成分部接口声明。</u></li></ul> <p>例如，下面的代码演示了具有两个方法成员接口的声明：</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">interface</span> <span class="token class-name">IMyInterface1</span> <span class="token punctuation">{</span>
  <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">DoStuff</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> nVar1<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">long</span></span> lVar2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token return-type class-name"><span class="token keyword">double</span></span> <span class="token function">DoOtherStuff</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> s<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">long</span></span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>接口的访问性和接口成员的访问性之间有一些重要区别。</p> <ul><li>接口声明可以有任何的访问修饰符 public、protected、internal 或 private。</li> <li><u>然而，接口的成员是隐式 public 的，不允许有任何访问修饰符，包括 public。</u></li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IMyInterface2</span> <span class="token punctuation">{</span> <span class="token comment">// 接口允许访问修饰符</span>
  <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">Method1</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> nVal1<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">long</span></span> lVar2<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 错误，接口成员不允许访问修饰符</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="实现接口"><a href="#实现接口" class="header-anchor">#</a> 实现接口</h4> <p>只有类和结构才能实现接口。如 Sort 示例所示，要实现接口，类和结构必须：</p> <ul><li>在基类列表中包括接口名称；</li> <li>为每一个接口的成员提供实现。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IMyInterface1</span></span> <span class="token punctuation">{</span>
  <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">DoStuff</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> nVar1<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">long</span></span> lVar2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
  <span class="token punctuation">}</span>
  <span class="token return-type class-name"><span class="token keyword">double</span></span> <span class="token function">DoOtherStuff</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> s<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">long</span></span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>关于实现接口，需要了解的重要事项如下：</p> <ul><li>如果类实现了接口，它必须实现接口的所有成员。</li> <li><u>如果类从基类继承并实现了接口，基类列表中的基类名称必须放在所有接口之前，如下所示（注意，只能有一个基类，所以列出的其他类型必须为接口名。）</u></li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">class</span> <span class="token class-name">Derived</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MyBaseClass</span><span class="token punctuation">,</span> <span class="token class-name">IIfc1</span><span class="token punctuation">,</span> <span class="token class-name">IEnumerable</span><span class="token punctuation">,</span> <span class="token class-name">IComparable</span></span> <span class="token punctuation">{</span>
  <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="接口是引用类型"><a href="#接口是引用类型" class="header-anchor">#</a> 接口是引用类型</h4> <p>接口不仅仅是类或结构要实现的成员列表。它是一个引用类型。</p> <p>我们不能直接通过类对象的成员访问接口。<u>然而，我们可以通过把类对象引用强制转换为接口类型来获取指向接口的引用。一旦有了接口的引用，我们就可以使用点号来调用接口的方法。</u></p> <p>例如，如下代码给出了一个从类对象引用获取接口引用的示例。</p> <ul><li>在第一个语句中，mc 变量是一个实现了 IIfc1 接口的类对象的引用。语句将该引用强制转换为指向接口的引用，并把它赋值给变量 ifc。</li> <li>在第二个语句中，使用指向接口的引用来调用方法。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name">IIfc1</span> ifc <span class="token operator">=</span> <span class="token punctuation">(</span>IIfc1<span class="token punctuation">)</span>mc<span class="token punctuation">;</span> <span class="token comment">// 将类对象的引用转换为接口类型的引用</span>
ifc<span class="token punctuation">.</span><span class="token function">PrintOut</span><span class="token punctuation">(</span><span class="token string">&quot;interface&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用引用方法</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>完整代码如下：</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 接口是引用类型</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuInterface</span>
<span class="token punctuation">{</span>
  <span class="token keyword">interface</span> <span class="token class-name">IIfc1</span>
  <span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PrintOut</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">MyClass2</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IIfc1</span></span> <span class="token comment">// 类实现引用</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PrintOut</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> s<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Calling through: {0}&quot;</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program3</span>
  <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">MyClass2</span> mc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建类对象</span>
      mc<span class="token punctuation">.</span><span class="token function">PrintOut</span><span class="token punctuation">(</span><span class="token string">&quot;object&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用类对象的实现方法</span>

      <span class="token class-name">IIfc1</span> ifc <span class="token operator">=</span> <span class="token punctuation">(</span>IIfc1<span class="token punctuation">)</span>mc<span class="token punctuation">;</span> <span class="token comment">// 将类对象的引用转换为接口类型的引用</span>
      ifc<span class="token punctuation">.</span><span class="token function">PrintOut</span><span class="token punctuation">(</span><span class="token string">&quot;interface&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用引用方法</span>

    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h4 id="接口和-as-运算符"><a href="#接口和-as-运算符" class="header-anchor">#</a> 接口和 as 运算符</h4> <p>在上一节中，我们已经知道了<u>可以使用强制转换运算符来获取对象接口的引用，另一个更好的方式是使用 <code>as</code> 运算符。</u></p> <p>如果我们尝试将类对象引用强制转换类未实现的接口的引用，强制转换操作会抛出一个异常。我们可以通过使用 as 运算符来避免这个问题。具体方法如下所示：</p> <ul><li>如果类实现了接口，表达式返回指向接口的引用；</li> <li>如果类没有实现接口，表达式返回 null 而不是抛出异常。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">//IIfc1 ifc = (IIfc1)mc; // 将类对象的引用转换为接口类型的引用</span>
  <span class="token class-name">IIfc1</span> ifc <span class="token operator">=</span> mc <span class="token keyword">as</span> <span class="token class-name">IIfc1</span><span class="token punctuation">;</span> <span class="token comment">// 使用 as 运算符</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ifc <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    ifc<span class="token punctuation">.</span><span class="token function">PrintOut</span><span class="token punctuation">(</span><span class="token string">&quot;interface&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用引用方法</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="实现多个接口"><a href="#实现多个接口" class="header-anchor">#</a> 实现多个接口</h4> <p>到目前为止，类只实现了单个引用。</p> <ul><li>类或结构可以实现任意数量的接口。</li> <li>所有实现的接口必须列在基类列表中并以逗号分隔。（如果有基类名称，则在其之后）。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 实现多个接口</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuInterface</span>
<span class="token punctuation">{</span>
  <span class="token keyword">interface</span> <span class="token class-name">IDataRetrieve</span>
  <span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">GetData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">interface</span> <span class="token class-name">IDataStore</span>
  <span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SetData</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">MyData</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IDataRetrieve</span><span class="token punctuation">,</span> <span class="token class-name">IDataStore</span></span>
  <span class="token punctuation">{</span> <span class="token comment">// 声明类</span>
    <span class="token class-name"><span class="token keyword">int</span></span> Mem1<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">GetData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> Mem1<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SetData</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> x<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Mem1 <span class="token operator">=</span> x<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program4</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">MyData</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      data<span class="token punctuation">.</span><span class="token function">SetData</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Value = {0}&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span><span class="token function">GetData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h4 id="实现具有重复成员的接口"><a href="#实现具有重复成员的接口" class="header-anchor">#</a> 实现具有重复成员的接口</h4> <p>由于类可以实现任意数量的接口，有可能两个或多个接口都有相同的签名和返回类型。编译器如何处理这样的情况呢？</p> <p>例如，假设我们有两个接口 IIfc1 和 IIfc2，如下所示。每一个接口都有一个名称为 PrintOut 的方法，具有相同的签名和返回类型。如果我们要创建实现两个接口的类，怎么样处理重复接口的方法呢？</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">interface</span> <span class="token class-name">IIfc1</span> <span class="token punctuation">{</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PrintOut</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">IIfc2</span> <span class="token punctuation">{</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PrintOut</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>答案是：如果一个类实现了多个接口，并且其中一些接口有相同签名和返回类型的成员，那么类可以实现单个成员来满足所有包含重复成员的接口。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">interface</span> <span class="token class-name">IIfc1</span> <span class="token punctuation">{</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PrintOut</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">IIfc2</span> <span class="token punctuation">{</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PrintOut</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">MyClass</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IIfc1</span><span class="token punctuation">,</span> <span class="token class-name">IIfc2</span></span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PrintOut</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Calling through: {0}&quot;</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="多个接口的引用"><a href="#多个接口的引用" class="header-anchor">#</a> 多个接口的引用</h4> <p>我们已经在之前的内容知道了接口是引用类型，并且可以通过将对象引用强制转换为接口类型的引用。如果类实现了多个接口，我们可以获取每一个接口的独立引用。</p> <p>例如，下面的类实现了两个具有单个 PrintOut 方法的接口。Main 中的代码以 3 种方式调用了 PrintOut。</p> <ul><li>通过类对象。</li> <li>通过指向 IIfc1 接口的引用。</li> <li>通过指向 IIfc2 接口的引用。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">interface</span> <span class="token class-name">IIfc1</span> <span class="token punctuation">{</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PrintOut</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">IIfc2</span> <span class="token punctuation">{</span>
  <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PrintOut</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">MyClass</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IIfc1</span><span class="token punctuation">,</span> <span class="token class-name">IIfc2</span></span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PrintOut</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Calling through: {0}&quot;</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Progarm</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">MyClass</span> mc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">IIfc1</span> ifc1 <span class="token operator">=</span> <span class="token punctuation">(</span>IIfc1<span class="token punctuation">)</span> mc<span class="token punctuation">;</span>
    <span class="token class-name">IIfc2</span> ifc2 <span class="token operator">=</span> <span class="token punctuation">(</span>IIfc2<span class="token punctuation">)</span> mc<span class="token punctuation">;</span>
    mc<span class="token punctuation">.</span><span class="token function">PrintOut</span><span class="token punctuation">(</span><span class="token string">&quot;object&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ifc1<span class="token punctuation">.</span><span class="token function">PrintOut</span><span class="token punctuation">(</span><span class="token string">&quot;object&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ifc2<span class="token punctuation">.</span><span class="token function">PrintOut</span><span class="token punctuation">(</span><span class="token string">&quot;object&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h4 id="派生成员作为实现"><a href="#派生成员作为实现" class="header-anchor">#</a> 派生成员作为实现</h4> <p><u>实现接口的类可以从它的基类继承实现的代码。</u>例如，如下的代码演示了类从它的基类代码继承了实现。</p> <ul><li>IIfc1 是一个具有 PrintOut 方法成员的接口；</li> <li>MyBaseClass 包含了一个叫做 PrintOut 的方法，它和 IIfc3 的方法相匹配。</li> <li>Derived 类有一个空的声明主体，但它派生自 MyBaseClass，并在基类列表中包含了 IIfc3。</li> <li>即使 Derived 的声明主体是空的，基类中的代码还是能满足实现接口方法的需求。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 派生成员作为实现</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuInterface</span>
<span class="token punctuation">{</span>
  <span class="token keyword">interface</span> <span class="token class-name">IIfc3</span>
  <span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PrintOut</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">MyBaseClass</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PrintOut</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> s<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Calling through: {0}&quot;</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Derived</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MyBaseClass</span><span class="token punctuation">,</span> <span class="token class-name">IIfc3</span></span>
  <span class="token punctuation">{</span>

  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program5</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">Derived</span> d <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Derived</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建类对象</span>
      d<span class="token punctuation">.</span><span class="token function">PrintOut</span><span class="token punctuation">(</span><span class="token string">&quot;object.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用方法</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h4 id="显式接口成员实现"><a href="#显式接口成员实现" class="header-anchor">#</a> 显式接口成员实现</h4> <p>在上一节中，我们已经看到单个类可以实现多个接口需要的成员。</p> <p>但是，如果我们希望为每一个接口分离实现该怎么做呢？在这种情况下，我们可以创建显式接口成员实现。显式接口成员实现有如下特性：</p> <ul><li>与所有接口实现类似，位于实现了接口的类或结构中；</li> <li><u>它使用限定接口名称来声明，由接口名称和成员名称以及它们中间的点分隔符号构成。</u></li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 显式接口成员实现</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuInterface</span>
<span class="token punctuation">{</span>
  <span class="token keyword">interface</span> <span class="token class-name">IIfc4</span>
  <span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PrintOut</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">interface</span> <span class="token class-name">IIfc5</span>
  <span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PrintOut</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">MyClass6</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IIfc4</span><span class="token punctuation">,</span> <span class="token class-name">IIfc5</span></span>
  <span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> IIfc4<span class="token punctuation">.</span><span class="token function">PrintOut</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> s<span class="token punctuation">)</span> <span class="token comment">// 显式接口成员实现</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;IIfc4: {0}&quot;</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> IIfc5<span class="token punctuation">.</span><span class="token function">PrintOut</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> s<span class="token punctuation">)</span> <span class="token comment">// 显式接口成员实现</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;IIfc5: {0}&quot;</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program6</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">MyClass6</span> mc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass6</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建类对象</span>

      <span class="token class-name">IIfc4</span> ifc4 <span class="token operator">=</span> <span class="token punctuation">(</span>IIfc4<span class="token punctuation">)</span>mc<span class="token punctuation">;</span>
      <span class="token class-name">IIfc5</span> ifc5 <span class="token operator">=</span> <span class="token punctuation">(</span>IIfc5<span class="token punctuation">)</span>mc<span class="token punctuation">;</span>
      ifc4<span class="token punctuation">.</span><span class="token function">PrintOut</span><span class="token punctuation">(</span><span class="token string">&quot;interface 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      ifc5<span class="token punctuation">.</span><span class="token function">PrintOut</span><span class="token punctuation">(</span><span class="token string">&quot;interface 2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h4 id="接口可以继承接口"><a href="#接口可以继承接口" class="header-anchor">#</a> 接口可以继承接口</h4> <p>之前我们已经知道接口实现可以从基类被继承，而接口本身也可以从一个或多个接口继承。</p> <ul><li>要指定某个接口继承其他接口，应在接口声明中把基类以逗号分隔的列表形式放在接口名称的冒号之后，如下所示：</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 接口可以继承接口</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuInterface</span>
<span class="token punctuation">{</span>
  <span class="token keyword">interface</span> <span class="token class-name">IDataRetrieve2</span>
  <span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">GetData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">interface</span> <span class="token class-name">IDataStore2</span>
  <span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SetData</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 从前两个接口继承</span>
  <span class="token keyword">interface</span> <span class="token class-name">IDataIO</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IDataRetrieve2</span><span class="token punctuation">,</span> <span class="token class-name">IDataStore2</span></span>
  <span class="token punctuation">{</span>

  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">MyClass7</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IDataIO</span></span>
  <span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">int</span></span> nPrivateData<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">GetData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> nPrivateData<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SetData</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> x<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      nPrivateData <span class="token operator">=</span> x<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program7</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">MyClass7</span> mc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass7</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建类对象</span>

      mc<span class="token punctuation">.</span><span class="token function">SetData</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0}&quot;</span><span class="token punctuation">,</span> mc<span class="token punctuation">.</span><span class="token function">GetData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>与类不同，它在基类列表中只能有一个类名，而接口可以在基接口列表中有多个接口。</p> <ul><li>列表中的接口本身可以继承其他接口。</li> <li>结果接口包含它声明的所有接口和所有接口的成员。</li></ul> <h4 id="不同类实现同一个接口的示例"><a href="#不同类实现同一个接口的示例" class="header-anchor">#</a> 不同类实现同一个接口的示例</h4> <p>如下代码演示了已经介绍过的接口的一些方面。程序声明了一个名称为 Animal 的类，它被作为其他一些类的基类来表示各种类型的动物。它还声明了一个叫做 ILiveBirth 的接口。</p> <p>Cat、Dog 和 Bird 都从 Animal 基类继承。Cat 和 Dog 都实现了 ILiveBirth 接口，而 Bird 类没有。</p> <p>在 Main 中，程序创建了 Animal 对象的数组并对 3 个动物类的对象进行填充。最后，程序遍历数组并使用 as 运算符获取指向 ILiveBirth 接口的引用，并调用了 BabyCalled 方法。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuInterface</span>
<span class="token punctuation">{</span>
  <span class="token keyword">interface</span> <span class="token class-name">ILiveBirth</span>
  <span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">BabyCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span> <span class="token comment">// 基类</span>
  <span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Animal</span><span class="token punctuation">,</span> <span class="token class-name">ILiveBirth</span></span> <span class="token comment">// 声明 Cat 类</span>
  <span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword">string</span></span> ILiveBirth<span class="token punctuation">.</span><span class="token function">BabyCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">&quot;Kitten&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Animal</span><span class="token punctuation">,</span> <span class="token class-name">ILiveBirth</span></span> <span class="token comment">// 声明 Dog 类</span>
  <span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword">string</span></span> ILiveBirth<span class="token punctuation">.</span><span class="token function">BabyCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">&quot;puppy&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Bird</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Animal</span></span> <span class="token comment">// 声明 Bird 类</span>
  <span class="token punctuation">{</span>

  <span class="token punctuation">}</span>

  <span class="token keyword">class</span> <span class="token class-name">Program8</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">Animal<span class="token punctuation">[</span><span class="token punctuation">]</span></span> animals <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Animal</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      animals<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      animals<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      animals<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Bird</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">Animal</span> a <span class="token keyword">in</span> animals<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token class-name">ILiveBirth</span> b <span class="token operator">=</span> a <span class="token keyword">as</span> <span class="token class-name">ILiveBirth</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
          Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Baby is called: {0}&quot;</span><span class="token punctuation">,</span> b<span class="token punctuation">.</span><span class="token function">BabyCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h3 id="转换"><a href="#转换" class="header-anchor">#</a> 转换</h3> <h4 id="什么是转换"><a href="#什么是转换" class="header-anchor">#</a> 什么是转换</h4> <p>要理解什么是转换，让我们先从声明两个不同类型的变量，然后把一个变量（源）的值赋值给另外一个变量（目标）的简单示例开始讲起。<u>在赋值之前，源的值必须转换成目标类型的值。</u></p> <p><img src="/Notebook/assets/img/csharp-conversion.62c38b49.png" alt=""></p> <ul><li><u>转换（conversion）是接受一个类型的值并使用它作为另一个类型的等价值的过程。</u></li> <li><u>转换后的值应和源值一样的，但其类型为目标类型。</u></li></ul> <p>例如，图 16-2 中的代码给出了两个不同类型的变量的声明。</p> <p><img src="/Notebook/assets/img/short-to-sbyte.73dbc5f3.png" alt=""></p> <ul><li>var1 是 short 类型的 16 位有符号整数，初始值为 5。var2 是 sbyte 类型的 8 位有符号整数，初始值为 10。</li> <li>第三行代码把 var1 赋值给 var2。由于它们是两种不同的类型，<u>在进行赋值之前，var1 的值必须先转换与 var2 类型相同的值类型。</u></li> <li>还要注意，<u>var1 的类型和值都没有改变。尽管称之为转换，但只是代表源值作为目标类型来使用，不是源值转换为目标类型。</u></li></ul> <p><img src="/Notebook/assets/img/zero-extension.777aecf3.png" alt=""></p> <h4 id="隐式转换"><a href="#隐式转换" class="header-anchor">#</a> 隐式转换</h4> <p>有些类型的转换不会丢失数据或精度。例如，将 8 位的值转换为 16 位是非常容易的，而且不会丢失数据。</p> <ul><li>语言会自动做这些转换，这叫做<code>隐式转换</code>。</li> <li>从位数更少的源转换为位数更多的目标类型时，目标中多出来的位需要用 0 或 1 填充。</li> <li>当从更小的无符号类型转换为更大的无符号类型时，目标类型多出来的最高位都以 0 填充，这叫<code>零扩展（zero extension）</code>。</li></ul> <p>对于有符号类型的转换而言，额外的高位用源表达式的符号位进行填充。</p> <ul><li>这样就维持了被转换的值的正确符号和大小。</li> <li>这叫做<code>符号扩展（sign extension）</code></li></ul> <p><img src="/Notebook/assets/img/sign-extension.beed19a7.png" alt=""></p> <h4 id="显式转换和强制转换"><a href="#显式转换和强制转换" class="header-anchor">#</a> 显式转换和强制转换</h4> <p>如果要把短类型转换为长类型，对于长类型来说，保存所有短类型的字符很简单。然而，在其他情况下，目标类型也许无法在不损失数据的情况下提供源值。</p> <p>例如，假设我们希望把 ushort 的值转化为 byte。</p> <ul><li>ushort 可以保存任何 0 ～ 65535 之间的值。</li> <li>byte 只能保存 0 ～ 255 之间的值。</li> <li>只要希望转换的 ushort 值小于 256，那么就不会丢失数据。然而，如果更大，最高位的数据会丢失。</li></ul> <p><img src="/Notebook/assets/img/ushort-to-byte.7844afca.png" alt=""></p> <p>很明显，只有当无符号 16 位 ushort 的值是一个相对小一些的数字（0.4%）时，才能在不损失数据的情况下安全转换为无符号 8 位 byte 类型。数据中的其他结果会溢出（overflow），产生其他值。</p> <h5 id="强制转换"><a href="#强制转换" class="header-anchor">#</a> 强制转换</h5> <p>对于预定义的类型，C# 会自动将一个数据类型转换为另一个数据类型，但只是针对那些从源类型到目标类型时会丢失值的情况。也是说，<u>对于源类型的任意值在被转换成目标类型时会丢失值的情况，语言是不会提供这两种类型的自动转换的。</u>如果希望对这样的类型进行转换，就必须使用显式转换。这叫做<code>强制转换表达式</code>。</p> <p>如下代码给出了一个强制转换表达式的示例。它把 var1 的值转换为 sbyte 类型。强制转换表达式的构成如下所示：</p> <ul><li>一对圆括号，里面是目标类型。</li> <li>圆括号后是源表达式。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token punctuation">(</span><span class="token keyword">sbyte</span><span class="token punctuation">)</span> var1<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果我们强制转换表达式，就意味着要承担执行操作可能引起的丢失数据的后果。它从本质上是在说：“不管是否会发生数据丢失，我知道在做什么，总之进行转换吧。”</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuConversion</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">ushort</span></span> sh <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
      <span class="token class-name"><span class="token keyword">byte</span></span> sb <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span>sh<span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;sb: {0} = Ox{0:X}&quot;</span><span class="token punctuation">,</span> sb<span class="token punctuation">)</span><span class="token punctuation">;</span>

      sh <span class="token operator">=</span> <span class="token number">1365</span><span class="token punctuation">;</span>
      sb <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span>sh<span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;sb: {0} = 0x{0:X}&quot;</span><span class="token punctuation">,</span> sb<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 输出</span>
<span class="token comment">// sb: 10 = OxA</span>
<span class="token comment">// sb: 85 = 0x55</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h4 id="转换的类型"><a href="#转换的类型" class="header-anchor">#</a> 转换的类型</h4> <p>有很多标准的、预定义的用于数字和引用类型的转换。下图演示了不同的转换类型。</p> <p><img src="/Notebook/assets/img/conversion-type.c418367c.png" alt=""></p> <ul><li>除了标准转换，还可以为自定义类型定义隐式转换和显式转换。</li> <li>还有一个预定义的转换类型，叫做装箱，可以将任何值类型转换为：
<ul><li>object 类型；</li> <li>System.ValueType 类型。</li></ul></li> <li>拆箱可以将一个装箱的值转换为原始类型。</li></ul> <p><img src="/Notebook/assets/img/c-sharp-boxing.71708c8c.png" alt=""></p> <h4 id="数字的转换"><a href="#数字的转换" class="header-anchor">#</a> 数字的转换</h4> <p>任何数字类型都可以转换为其他数字类型。如图所示，一些转换是隐式，而另外一些转换则必须是显式。</p> <p><img src="/Notebook/assets/img/c-sharp-number-conversion.c4f7fd46.png" alt=""></p> <h5 id="隐式数字转换"><a href="#隐式数字转换" class="header-anchor">#</a> 隐式数字转换</h5> <p>图 16-9 演示了隐式数字转换。</p> <ul><li>如果有路径，从源类型到目标类型可以按照箭头进行隐式转换。</li> <li>任何从源类型到目标类型的箭头方向上没有路径的数字转换都必须是显式转换。</li></ul> <p>图中所示的，正如我们期望的那样，占据较少位的数字类型可以隐式转换为占据较多位的数字类型。</p> <p><img src="/Notebook/assets/img/Implicit-number-conversion.00faffdf.png" alt=""></p> <h5 id="溢出检测上下文"><a href="#溢出检测上下文" class="header-anchor">#</a> 溢出检测上下文</h5> <p>我们已经知道了，显式转换可能会丢失数据并且不能在目标类型中同等地表示源值。<u>对于整数类型，C# 给我们提供了选择运行时是否应该在进行进行类型转换时检测结果溢出的能力。这将通过 <code>checked</code> 运算符和<code>checked</code> 语句实现。</u></p> <ul><li>代码片段是否被检查称作溢出检测上下文。
<ul><li>如果我们指定一个表达式或一段代码为 <code>checked</code>，CLR 会在转换产生溢出时抛出一个 <code>OverflowException</code> 异常。</li> <li>如果代码不是 <code>checked</code>，转换会继续而不管是否产生溢出。</li></ul></li> <li>默认的溢出检测是不检查的。</li></ul> <ol><li>checked 和 unchecked 运算符
checked 和 unchecked 运算符控制表达式的溢出检测上下文。表达式放置在一对圆括号内并不能是一个方法。语法如下所示：</li></ol> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">checked</span> <span class="token punctuation">(</span>表达式<span class="token punctuation">)</span>
<span class="token keyword">unchecked</span> <span class="token punctuation">(</span>表达式<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>例如，如下代码执行了相同的转换——第一个在 checked 运算符内，第二个在 unchecked 运算符内。</p> <ul><li>在 unchecked 上下文中，会忽略溢出，结果值是 208。</li> <li>在 checked 上下文中，抛出了 OverflowException 异常。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuConversion</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program2</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">ushort</span></span> sh <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span>
      <span class="token class-name"><span class="token keyword">byte</span></span> sb<span class="token punctuation">;</span>

      sb <span class="token operator">=</span> <span class="token keyword">unchecked</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span>sh<span class="token punctuation">)</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;sb: {0}&quot;</span><span class="token punctuation">,</span> sb<span class="token punctuation">)</span><span class="token punctuation">;</span>

      sb <span class="token operator">=</span> <span class="token keyword">checked</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span>sh<span class="token punctuation">)</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;sb: {0}&quot;</span><span class="token punctuation">,</span> sb<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><ol start="2"><li>checked 语句和 unchecked 语句
checked 和 unchecked 运算符用于圆括号内的单个表达式。而 checked 和 unchecked 语句执行相同的功能，但控制的是一块代码中的所有转换，而不是单个表达式。</li></ol> <ul><li>checked 语句和 unchecked 语句可以被嵌套在任意层次。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">ushort</span></span> sh <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">byte</span></span> sb<span class="token punctuation">;</span>
<span class="token keyword">unchecked</span> <span class="token punctuation">{</span>
  sb <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span>sh<span class="token punctuation">;</span>
  Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;sb: {0}&quot;</span><span class="token punctuation">,</span> sb<span class="token punctuation">)</span><span class="token punctuation">;</span>
  sb <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span>sh<span class="token punctuation">;</span>
  Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;sb: {0}&quot;</span><span class="token punctuation">,</span> sb<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="显式数字转换"><a href="#显式数字转换" class="header-anchor">#</a> 显式数字转换</h5> <p>我们已经知道了，隐式转换之所以能自动从源表达式转换到目标类型是因为不可能丢失数据。<u>然而，对于显式转换而言，就可能丢失数据。因此，作为一个程序员，知道发生数据丢失时转换会如何处理很重要。</u></p> <p><img src="/Notebook/assets/img/explicit-number-conversion.b4d3ad84.png" alt=""></p> <ol><li>整数类型到整数类型</li></ol> <p>图 16-11 显示了从整数到整数的显式转换的行为。在 checked 的情况下，如果转换会丢失数据，操作会抛出一个 OverflowExveption 异常。在 unchecked 的情况下，丢失的位不会发出警告。</p> <p><img src="/Notebook/assets/img/explicit-number-conversion-int-to-int.43d8b6b6.png" alt=""></p> <ol start="2"><li>float 或 double 转到整数类型</li></ol> <p>当把浮点类型转换为整数类型时，值会舍掉小数截断为最接近的整数。如果截断后的值不在目标类型的范围内：</p> <ul><li>如果溢出检测上下文是 checked，则 CLR 会抛出 OverflowException 异常；</li> <li>如果上下文是 unchecked，则 C# 将不定义它的值是什么。</li></ul> <ol start="3"><li>decimal 到整数类型</li></ol> <p>当从 decimal 转换到整数类型时，如果结果值不在目标类型的范围内，则 CLR 会抛出 overflowException。</p> <ol start="4"><li>double 到 float</li></ol> <p>float 类型的值占 32 位，而 double 类型的值占 64 位。double 类型的值被舍入到最接近的 float 类型的值。</p> <ul><li>如果值太小而不能用 float 表示，那么值会被设置为正或负 0；</li> <li>如果值太大而不能用 float 表示，那么值会被设置为正无穷大或负无穷大。</li></ul> <ol start="5"><li>float 或 double 到 decimal</li></ol> <ul><li>如果值太小而不能用 decimal 类型表示，那么值就会被设置为 0。</li> <li>如果值太大，那么 CLR 就会抛出 overflowException 异常。</li></ul> <ol start="6"><li>decimal 到 float 或 double</li></ol> <p>从 decimal 类型转换到 float 类型总是会成功。然而，可能损失精度。</p> <h4 id="引用转换"><a href="#引用转换" class="header-anchor">#</a> 引用转换</h4> <p>我们已经知道引用类型对象由内存中的两部分组成：引用和数据。</p> <ul><li>由引用保存的那部分信息是它指向的数据类型。</li> <li><u>引用转换接受源引用并返回一个指向堆中同一位置的引用，但是把引用“标记”为其他类型。</u></li></ul> <h5 id="隐式引用转换"><a href="#隐式引用转换" class="header-anchor">#</a> 隐式引用转换</h5> <p>与语言为我们自动实现的隐式数字转换类似，还有隐式引用转换。如图 16-18 所示。</p> <ul><li>所有引用类型可以被隐式转换为 object 类型。</li> <li>任何类型可以隐式转换到它继承的接口。</li> <li>类可以隐式转换到：
<ul><li>它继承链中任何类；</li> <li>它实现的任何接口。</li></ul></li></ul> <p><img src="/Notebook/assets/img/class--interface-implicit-conversiton.cabd4d36.png" alt=""></p> <p>委托可以隐式转换成图 16-19 所示的 .NET BCL 类和接口。Array 数组，其中的元素是 Ts 类型，可以隐式转换成：</p> <ul><li>图 16-19 所示的 .NET BCL 类和接口；</li> <li>另一个数组 ArrayT，其中的元素是 Tt 类型（如果满足下面条件）
<ul><li>两个数组具有一样的维度；</li> <li>元素类型 Ts 和 Tt 都是引用类型，不是值类型。</li> <li>在类型 Ts 和 Tt 存在隐式转换。</li></ul></li></ul> <p><img src="/Notebook/assets/img/implicit-delegate-array-conversion.10736e73.png" alt=""></p> <h5 id="显式引用转换"><a href="#显式引用转换" class="header-anchor">#</a> 显式引用转换</h5> <p>显式引用转换是从一个普通类型到一个更精确类型的引用转换。</p> <ul><li>显式转换包括：
<ul><li>从 object 到任何引用类型的转换；</li> <li>从基类到它继承的类的转换。</li></ul></li></ul> <p>如果转换的类型不受限制，很可能会导致我们很容易尝试引用在内存中实际不存在的类成员。然而，编译器确实允许这样的转换，到那时，如果系统在运行时遇到它们则会抛出一个异常。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 引用转换</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuConversion</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">A</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> Field1<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">A</span></span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> Field2<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program3</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">A</span> myVal1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">B</span> myVal2 <span class="token operator">=</span> <span class="token punctuation">(</span>B<span class="token punctuation">)</span>myVal1<span class="token punctuation">;</span> <span class="token comment">// 不存在，在运行时抛出异常</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h5 id="有效显式转换"><a href="#有效显式转换" class="header-anchor">#</a> 有效显式转换</h5> <p>在运行时能成功进行有 3 种情况（也就是不抛出 InvalidCastException 异常）的显式转换有 3 种情况。</p> <ol><li>第一种情况：显式转换是没有必要的。也就是说，语言已经为我们进行了隐式转换。例如</li></ol> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">B</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">A</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token class-name">B</span> myVar1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">A</span> myVar2 <span class="token operator">=</span> <span class="token punctuation">(</span>A<span class="token punctuation">)</span> myVar1<span class="token punctuation">;</span> <span class="token comment">// 不必转换，因为 A 是 B的基类</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="2"><li>源引用是 null。例如在下面的代码中，即使转换基类的引用到衍生类的引用通常是不安全的，但是由于源引用是 null，这种转换还是允许的。</li></ol> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">B</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">A</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token class-name">A</span> myVal1 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token class-name">B</span> myVar2 <span class="token operator">=</span> <span class="token punctuation">(</span>B<span class="token punctuation">)</span>myVal1<span class="token punctuation">;</span> <span class="token comment">// 允许转换，因为 myVar1 为空</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="3"><li>由源引用指向的实际数据可以被安全地进行隐式转换。</li></ol> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name">B</span> myVal1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">A</span> myVar2 <span class="token operator">=</span> myVal1<span class="token punctuation">;</span> <span class="token comment">// 将 myVal1 隐式转换为 A 类型</span>
<span class="token class-name">B</span> myVar3 <span class="token operator">=</span> <span class="token punctuation">(</span>B<span class="token punctuation">)</span>myVal2<span class="token punctuation">;</span>  <span class="token comment">// 该转换是允许的，因为数据是B类型的</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="装箱转换"><a href="#装箱转换" class="header-anchor">#</a> 装箱转换</h4> <p>包括值类型在内的所有 C# 类型都派生自 object 类型。然而，值类型是高效轻量的类型，因为默认情况下在堆上不包括它们的对象组件。然而，如果需要对象组件，我们可以使用装箱（boxing）。<u>装箱是一种隐式转换，它接受值类型的值，根据这个值在堆上创建一个完整的引用类型对象并返回对象引用。</u></p> <p>例如，图 16-22 演示 3 行代码。</p> <ul><li>前两行代码声明并初始化了值类型变量 i 和引用类型变量 oi。</li> <li>在代码的第三行，我们希望把变量 i 的值赋给 oi。<u>但是 oi 是引用类型的变量，我们必须在堆上分配一个对象的引用。然而，变量 i 是值类型，不存在指向堆上某对象的引用。</u></li> <li>因此，系统将 i 的值装修如下：
<ul><li>在堆上创建了 int 类型的对象；</li> <li>将 i 的值复制给 int 对象；</li> <li>返回 int 对象的引用，让 oi 作为引用保存。</li></ul></li></ul> <p><img src="/Notebook/assets/img/boxing-value-type-to-reference-type.9b31fa1c.png" alt=""></p> <h5 id="装箱是创建副本"><a href="#装箱是创建副本" class="header-anchor">#</a> 装箱是创建副本</h5> <p>装箱返回的是值的引用类型副本。在装箱产生后，该值有两份副本——原始值类型和引用类型副本，每一个都可以独立操作。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 装箱转换——装箱创建副本</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuConversion</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program4</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 创建并初始化值类型</span>
      <span class="token class-name"><span class="token keyword">object</span></span> oi <span class="token operator">=</span> i<span class="token punctuation">;</span> <span class="token comment">// 对 i 装箱并把引用赋值给 oi</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;i: {0}, oi: {1}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> oi<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// i: 10, oi: 10</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h5 id="装箱转换-2"><a href="#装箱转换-2" class="header-anchor">#</a> 装箱转换</h5> <p>任何值类型 ValueType 都可以被隐式转换为 object 类型、System.ValueType 或 Interface（如果 ValueType 实现了 Interface）</p> <h4 id="拆箱转换"><a href="#拆箱转换" class="header-anchor">#</a> 拆箱转换</h4> <p>拆箱（unboxing）是把装箱后的对象转换回值类型的过程。</p> <ul><li>拆箱是显式转换。</li> <li>系统把值拆箱成 ValueType 时执行了如下的步骤：
<ul><li>它检测到要拆箱的对象实际是 ValueType 的装箱值；</li> <li>它把对象的值复制到变量。</li></ul></li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 装箱转换——装箱创建副本</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuConversion</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program4</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 创建并初始化值类型</span>
      <span class="token class-name"><span class="token keyword">object</span></span> oi <span class="token operator">=</span> i<span class="token punctuation">;</span> <span class="token comment">// 对 i 装箱并把引用赋值给 oi</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;i: {0}, oi: {1}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> oi<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// i: 10, oi: 10</span>

      i <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>
      oi <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;i: {0}, oi: {1}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> oi<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// i: 12, oi: 15</span>
      <span class="token class-name"><span class="token keyword">int</span></span> j <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>oi<span class="token punctuation">;</span> <span class="token comment">// 对 oi 拆箱并把值赋值给 j</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;i: {0}, oi: {1}, j: {2}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> oi<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// i: 12, oi: 15, j: 15</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="用户自定义转换"><a href="#用户自定义转换" class="header-anchor">#</a> 用户自定义转换</h4> <p>除了标准转换，我们还可以为类和结构定义隐式和显式转换。
用户自定义转换的语法如下代码所示：</p> <ul><li>除了 implicit 和 explicit 关键字之外，隐式和显式转换的声明语法是一样的。</li> <li>需要 public 和 static 修饰符。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">implicit</span> <span class="token keyword">operator</span> <span class="token function">TargetType</span><span class="token punctuation">(</span><span class="token class-name">SourceType</span> Identifier<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> ObjectOfTargetType<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>示例：</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">implicit</span> <span class="token keyword">operator</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token class-name">Person</span> p<span class="token punctuation">)</span> <span class="token comment">// 将 person 转换为 int</span>
<span class="token punctuation">{</span>
  <span class="token keyword">return</span> p<span class="token punctuation">.</span>Age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h5 id="用户自定义转换的约束"><a href="#用户自定义转换的约束" class="header-anchor">#</a> 用户自定义转换的约束</h5> <p>用户自定义转换有一些重要的约束，最重要的如下所示：</p> <ul><li>只可以为类和结构定义用户自定义转换。</li> <li>不能重定义标准隐式转换和显式转换。</li> <li>对于源类型 S 和目标类型 T，如下命题为真：
<ul><li>S 和 T 必须是不同类型。</li> <li>S 和 T 不能通过继承关联。</li> <li>S 和 T 都不能是接口类型或者 object 类型。</li> <li>转换运算符必须是 S 或 T 的成员。</li></ul></li> <li>对于相同的源和目标类型，我们不能声明隐式转换和显式转换。</li></ul> <h5 id="用户自定义转换的示例"><a href="#用户自定义转换的示例" class="header-anchor">#</a> 用户自定义转换的示例</h5> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 用户自定义转换的示意</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuConversion</span>
<span class="token punctuation">{</span>

  <span class="token keyword">class</span> <span class="token class-name">Person</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> Name<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> Age<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> age<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Name <span class="token operator">=</span> name<span class="token punctuation">;</span>
      Age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">implicit</span> <span class="token keyword">operator</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token class-name">Person</span> p<span class="token punctuation">)</span> <span class="token comment">// 将 person 转换为 int</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> p<span class="token punctuation">.</span>Age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">implicit</span> <span class="token keyword">operator</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i<span class="token punctuation">)</span> <span class="token comment">// 将 int 转换为 person</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;bill&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program5</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">Person</span> jecyu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;Jecyu&quot;</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 把 Person 对象转换为 int</span>
      <span class="token class-name"><span class="token keyword">int</span></span> age <span class="token operator">=</span> jecyu<span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Person Info: {0}, {1}&quot;</span><span class="token punctuation">,</span> jecyu<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 把 int 转换为 Person 对象</span>
      <span class="token class-name">Person</span> bill <span class="token operator">=</span> <span class="token number">26</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Person Info: {0}, {1}&quot;</span><span class="token punctuation">,</span> bill<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> bill<span class="token punctuation">.</span>Age<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h5 id="评估用户自定义转换"><a href="#评估用户自定义转换" class="header-anchor">#</a> 评估用户自定义转换</h5> <p>到目前为止讨论的用户自定义转换都是在单步内直接把源类型转换为目标类型对象，如图：</p> <p><img src="/Notebook/assets/img/singleStep-user-diy-conversion.b4384370.png" alt=""></p> <p>但是，用户自定义转换在完整转换中最多可以有 3 个步骤，它们包括：</p> <ul><li>预备标准转换；</li> <li>用户自定义转换；</li> <li>后续标准转换。</li></ul> <p><img src="/Notebook/assets/img/multi-step-user-diy-conversion.dcd7ef7f.png" alt=""></p> <h5 id="多步用户自定义转换的示例"><a href="#多步用户自定义转换的示例" class="header-anchor">#</a> 多步用户自定义转换的示例</h5> <ul><li>由于 Employee 继承自 Person，从 Employee 到 Person 有标准转换。</li> <li>从 int 到 float 是隐式数字转换，也是标准转换。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 多步用户自定义转换的示例</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuConversion</span>
<span class="token punctuation">{</span>

  <span class="token keyword">class</span> <span class="token class-name">Person2</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> Name<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> Age<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">implicit</span> <span class="token keyword">operator</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token class-name">Person2</span> p<span class="token punctuation">)</span> <span class="token comment">// 将 person 转换为 int</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> p<span class="token punctuation">.</span>Age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Person2</span></span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program6</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">Employee</span> bill <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Employee</span>
      <span class="token punctuation">{</span>
        Name <span class="token operator">=</span> <span class="token string">&quot;William&quot;</span><span class="token punctuation">,</span>
        Age <span class="token operator">=</span> <span class="token number">25</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token comment">// 把 Employee 类型转换 float</span>
      <span class="token class-name"><span class="token keyword">float</span></span> fVar <span class="token operator">=</span> bill<span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Person Info: {0}, {1}&quot;</span><span class="token punctuation">,</span> bill<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> fVar<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h4 id="is-运算符"><a href="#is-运算符" class="header-anchor">#</a> is 运算符</h4> <p>之前说过了，有些转换是不成功的，并且会在运行时抛出一个 InvalidCastException 异常。我们可以使用 is 运算符来检查转换是否会成功完成，从而避免盲目尝试转换。</p> <p>is 运算符的语法如下，Expr 是源表达式：</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code>Expr <span class="token keyword">is</span> <span class="token class-name">TargetType</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 多步用户自定义转换的示例</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuConversion</span>
<span class="token punctuation">{</span>

  <span class="token keyword">class</span> <span class="token class-name">Person3</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> Name <span class="token operator">=</span> <span class="token string">&quot;Anonymous&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> Age <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Employee2</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Person3</span></span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program7</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">Employee2</span> bill <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Employee2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">Person3</span> p<span class="token punctuation">;</span>

      <span class="token comment">// 检测变量 bill 是否能够转换为 Person 类型</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>bill <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>bill <span class="token keyword">is</span> <span class="token class-name">Person3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        p <span class="token operator">=</span> bill<span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Person Info: {0}, {1}&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> p<span class="token punctuation">.</span>Age<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h4 id="as-运算符"><a href="#as-运算符" class="header-anchor">#</a> as 运算符</h4> <p>as 运算符和强制转换运算符类似，只是它不抛出异常。如果转换失败，它返回 null 而不是抛出异常。</p> <p>as 运算符的语法如下：</p> <ul><li>Expr 是源表达式；</li> <li>TargetType 是目标类型，它必须是引用类型。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code>Expr <span class="token keyword">as</span> <span class="token class-name">TargetType</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 多步用户自定义转换的示例</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuConversion</span>
<span class="token punctuation">{</span>

  <span class="token keyword">class</span> <span class="token class-name">Person3</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> Name <span class="token operator">=</span> <span class="token string">&quot;Anonymous&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> Age <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Employee2</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Person3</span></span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program7</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">Employee2</span> bill <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Employee2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">Person3</span> p<span class="token punctuation">;</span>

      <span class="token comment">// 检测变量 bill 是否能够转换为 Person 类型</span>
      <span class="token comment">//if (bill is Person3)</span>
      <span class="token comment">//{</span>
      <span class="token comment">//  p = bill;</span>
      <span class="token comment">//  Console.WriteLine(&quot;Person Info: {0}, {1}&quot;, p.Name, p.Age);</span>
      <span class="token comment">//}</span>

      <span class="token comment">// as 运算符</span>
      p <span class="token operator">=</span> bill <span class="token keyword">as</span> <span class="token class-name">Person3</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Person Info: {0}, {1}&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> p<span class="token punctuation">.</span>Age<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h3 id="泛型"><a href="#泛型" class="header-anchor">#</a> 泛型</h3> <h4 id="什么是泛型"><a href="#什么是泛型" class="header-anchor">#</a> 什么是泛型</h4> <p>使用已经学习的语言结构，我们已经可以建立多种不同类型的强大对象。大部分情况下是声明类，然后封装需要的行为，最后创建这些类的实例。</p> <p>到现在为止，所有类声明中用到类型都是特定的类型——或许是程序员定义的，或许是语言或 BCL 定义的。然而，很多时候，<u>我们可以把类的行为提取或重构出来，使之不仅能应用到它们编码的数据类型上，而且还能应用到其他类型上的话，类就会更有用</u>。</p> <p>有了泛型就可以做到这一点了。我们可以重构代码并且额外增加一个抽象层，对于这样的代码来说，数据类型就不用硬编码了。这是专门为多段代码在不同的数据类型上执行相同指令的情况专门设计的。</p> <p>也许听起来很抽象，让我们看一个示例，这样更清晰：</p> <h5 id="一个栈的示例"><a href="#一个栈的示例" class="header-anchor">#</a> 一个栈的示例</h5> <p>假设我们首先创建了如下的代码，它声明了一个叫做 MyIntStack 的类，该类实现了一个 int 类型的栈。它允许我们把 int 压入栈中，以及把它们弹出。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">class</span> <span class="token class-name">MyIntStack</span>  <span class="token comment">// int 类型的栈</span>
<span class="token punctuation">{</span>
  <span class="token class-name"><span class="token keyword">int</span></span> StackPointer <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> StackArray<span class="token punctuation">;</span> <span class="token comment">// int 类型数组</span>

  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Push</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 参数类型 int</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">Pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 返回类型 innt</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>假设现在希望将相同的功能应用于 float 类型的值，可以有一种方式来实现，一种方式是按照下面的步骤产生后续的代码。</p> <ul><li>剪切并粘贴 MyIntStack 类的代码。</li> <li>把类名改为 MyFloatStack。</li> <li>把整个类声明中相应的 int 声明改为 float 声明。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">class</span> <span class="token class-name">MyFloatStack</span>  <span class="token comment">// int 类型的栈</span>
<span class="token punctuation">{</span>
  <span class="token class-name"><span class="token keyword">int</span></span> StackPointer <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token class-name"><span class="token keyword">float</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> StackArray<span class="token punctuation">;</span> <span class="token comment">// int 类型数组</span>

  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Push</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">float</span></span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 参数类型 int</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">float</span></span> <span class="token function">Pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 返回类型 innt</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这个方法当然可行，但是很容易出错而且有如下缺点：</p> <ul><li>我们需要仔细检查类的每一个部分来看哪些类型的声明需要修改，哪些类型的声明需要保留。</li> <li>每次需要新类型（long、double、string 等）的栈类时，我们都需要重复这个过程。</li> <li>在这些过程后，我们有了很多几乎相同代码的副本，占据了额外的空间。</li> <li>调试和维护这些相似的实现不但复杂而且容易出错。</li></ul> <h4 id="c-中的泛型"><a href="#c-中的泛型" class="header-anchor">#</a> C# 中的泛型</h4> <p>泛型（generic）特性提供了一种更优雅的方式，可以让多个类型共享一组代码。泛型允许我们声明类型参数化（type-parametertype-parameterized）的代码，可以用不同的类型进行实例化。也就是说，<u>我们可以用“类型占位符”来写代码，然后创建类的实例时指明真实的类型。</u></p> <p>读到这里，我们应该很清楚类型不是对象而是对象的模版这个概念了。同样地，<u>泛型类型也不是类型，而是类型的模版。</u></p> <p><img src="/Notebook/assets/img/generic-type-template.b6a0fbca.png" alt=""></p> <p>C# 提供了 5 种泛型：类、结构、接口、委托和方法。注意，前面 4 个是类型，而方法是成员。</p> <p><img src="/Notebook/assets/img/generic-and-user-diy.3a960329.png" alt=""></p> <h5 id="继续栈的例子"><a href="#继续栈的例子" class="header-anchor">#</a> 继续栈的例子</h5> <p>在栈的示例中，MyIntStack 和 MyFloatStack 两个类的主体声明都差不多，只不过在处理由栈保存的类型时有不同。</p> <ul><li>在 MyIntStack 中，这些位置使用 int 类型占据。</li> <li>在 MyFloatStack 中，这些位置被 float 占据 。</li></ul> <p>通过如下步骤我们可以从 MyIntStack 创建一个泛型类。</p> <ol><li>在 MyIntStack 类定义中，使用类型占位符 T 而不是 float 来替换 int。</li> <li>修改类名称为 MyStack。</li> <li>在类名后放置<code>&lt;T&gt;</code>。</li></ol> <p>结果就是如下的泛型声明。<u>由尖括号和 T 构成的字符串表明 T 是类型的占位符。（也不一定是字母 T，它可以是任何标识符。）</u>在类声明的主体中，每一个 T 都会被编译器替换为实际类型。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">class</span> <span class="token class-name">MyStack<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
  <span class="token class-name"><span class="token keyword">int</span></span> StackPointer <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token class-name">T<span class="token punctuation">[</span><span class="token punctuation">]</span></span> StackArray<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Push</span><span class="token punctuation">(</span><span class="token class-name">T</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token return-type class-name">T</span> <span class="token function">Pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="泛型类"><a href="#泛型类" class="header-anchor">#</a> 泛型类</h4> <p>既然已经见过泛型类，让我们再来详细了解一下它，并看看如何创建和使用它。</p> <p>创建和使用常规的、非泛型的类有两个步骤：声明类和创建类的实例。但是泛型类不是实际的类，而是类的模版，所以我们必须先从它们构建实际类实例。</p> <p><img src="/Notebook/assets/img/generic-real-tyep.3b5267c5.png" alt=""></p> <h4 id="声明泛型类"><a href="#声明泛型类" class="header-anchor">#</a> 声明泛型类</h4> <p>声明一个简单的泛型类和声明普通类差不多，区别如下。</p> <ul><li>在类名之后放置一组尖括号。</li> <li>在尖括号中用逗号分隔的占位符字符串来表示希望提供的类型。这叫做类型参数（type parameter）。</li> <li>在泛型声明的主体中使用类型参数来表示应该替代的类型。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">class</span> <span class="token class-name">SomeClass<span class="token punctuation">&lt;</span>T1<span class="token punctuation">,</span> T2<span class="token punctuation">&gt;</span></span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token class-name">T1</span> SomeVar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">T1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token class-name">T2</span> OtherVar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">T2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="创建构造类型"><a href="#创建构造类型" class="header-anchor">#</a> 创建构造类型</h4> <p>一旦创建了泛型类型，我们就需要告诉编译器能使用哪些真实类型来替代占位符。（类型参数）编译器获取这些真实类型并创建构造类型（用来创建真实类对象的模版）。</p> <p>创建构造类型的语法如下，包括列出类名并在尖括号中提供真实类型来替代类型参数。要替代类型参数的真实参数叫做类型实参（type argument）。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code>SomeClass<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">short</span><span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>编译器接受了类型实参并且替换泛型类主体中的相应类型参数，产生了构造类型——从它创建真实类型的实例。</p> <h4 id="创建变量和实例"><a href="#创建变量和实例" class="header-anchor">#</a> 创建变量和实例</h4> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuGeneric</span>
<span class="token punctuation">{</span>

  <span class="token keyword">class</span> <span class="token class-name">MyStack<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">{</span>
    <span class="token class-name">T<span class="token punctuation">[</span><span class="token punctuation">]</span></span> StackArray<span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">int</span></span> StackPointer <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Push</span><span class="token punctuation">(</span><span class="token class-name">T</span> x<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>IsStackFull<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        StackArray<span class="token punctuation">[</span>StackPointer<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">T</span> <span class="token function">Pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">!</span>IsStackEmpty<span class="token punctuation">)</span>
        <span class="token punctuation">?</span> StackArray<span class="token punctuation">[</span><span class="token operator">--</span>StackPointer<span class="token punctuation">]</span>
        <span class="token punctuation">:</span> StackArray<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">int</span></span> MaxStack <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token comment">// 是否满</span>
    <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsStackFull
    <span class="token punctuation">{</span>
      <span class="token keyword">get</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">return</span> StackPointer <span class="token operator">&gt;=</span> MaxStack<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 是否为空</span>
    <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsStackEmpty
    <span class="token punctuation">{</span>
      <span class="token keyword">get</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">return</span> StackPointer <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token function">MyStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      StackArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">T</span><span class="token punctuation">[</span>MaxStack<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> StackPointer <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot; Value: {0}&quot;</span><span class="token punctuation">,</span> StackArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">MyStack<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> StackInt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyStack<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">MyStack<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> StackString <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyStack<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      StackInt<span class="token punctuation">.</span><span class="token function">Push</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      StackInt<span class="token punctuation">.</span><span class="token function">Push</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      StackInt<span class="token punctuation">.</span><span class="token function">Push</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      StackInt<span class="token punctuation">.</span><span class="token function">Push</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      StackInt<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      StackString<span class="token punctuation">.</span><span class="token function">Push</span><span class="token punctuation">(</span><span class="token string">&quot;This is fun&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      StackString<span class="token punctuation">.</span><span class="token function">Push</span><span class="token punctuation">(</span><span class="token string">&quot;Hi there&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      StackString<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br></div></div><h5 id="比较泛型和非泛型栈"><a href="#比较泛型和非泛型栈" class="header-anchor">#</a> 比较泛型和非泛型栈</h5> <p><img src="/Notebook/assets/img/generic-stack-vs-not-generic-stack.b7a63f84.png" alt=""></p> <h4 id="类型参数的约束"><a href="#类型参数的约束" class="header-anchor">#</a> 类型参数的约束</h4> <p>在泛型栈的示例中，栈除了保存和弹出它包含的一些项之外没有做任何事情。它不会尝试添加、比较或做其他任何需要用到项本身的运算符的事情。理由还是很恰当的，由于泛型栈不会知道它们保存的项的类型是什么。理由还是很恰当的，<u>由于泛型栈不会知道它们保存的项的类型是什么，它不会知道这些类型实现的成员。</u></p> <p><u>然而，所有的 C# 对象最终都从 object 类继承，因此，栈可以确认的是，这些保存的项都实现了 object 类的成员。它们包括 ToString、Equals 以及 GetType</u>。除了这些，它不知道还有哪些成员可用。</p> <p>只要我们的代码不妨问它处理的一些类型的对象（或者只要它始终是 object 类型的成员），泛型类就可以处理任何类型。符合约束的类型参数叫做未绑定的类型参数（unbounded type parameter）。然而，<u>如果代码尝试使用其他成员，编译器就会产生一个错误信息。</u></p> <p>例如，如下代码声明了一个叫做 Simple 的类，它有一个叫做 LessThan 的方法，接受了两个泛型类型的变量。<u>LessThan 尝试用小于运算符返回的结果。但是由于不是所有的类都实现了小于运算符，也就不能用任何类代替 T，所以编译器会产生一个错误信息。</u></p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">class</span> <span class="token class-name">Simple<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">LessThan</span><span class="token punctuation">(</span><span class="token class-name">T</span> i1<span class="token punctuation">,</span> <span class="token class-name">T</span> i2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> i1 <span class="token operator">&lt;</span> i2<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>要让泛型变得更有用，我们需要提供额外的信息让编译器知道参数可以接受哪些类型。这些额外的信息叫做<code>约束（constrain）</code>。只有符合约束的类型才能替代给定的类型参数，来产生构造类型。</p> <h5 id="where-子句"><a href="#where-子句" class="header-anchor">#</a> Where 子句</h5> <p>约束使用 <code>where</code> 子句列出。</p> <ul><li>每一个有约束的类型参数有自己的 where 子句。</li> <li>如果形参有多个约束，它们在 where 子句中使用逗号分隔。</li></ul> <p>where 子句的语法如下：
<code>where TypeParam: constraint, constrain, ...</code></p> <p>有关 where 语句的要点如下：</p> <ul><li>它们在类型参数列表的关闭尖括号之后。</li> <li>它们不使用逗号或其他符号分隔。</li> <li>它们可以以任何次序列出。</li> <li>where 是上下文关键字，所以可以在其他上下文使用。</li></ul> <p>例如，如下泛型类有 3 个类型参数。T1 是未绑定的，对于 T2，只有 Customer 类型或从 Customer 继承的类型的类才能用作类型实参，而对于 T3，只有实现了 IComparable 接口的类才能用于类型实参。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">class</span> <span class="token class-name">MyClass<span class="token punctuation">&lt;</span>T1<span class="token punctuation">,</span> T2<span class="token punctuation">,</span> T3<span class="token punctuation">&gt;</span></span>
          <span class="token keyword">where</span> <span class="token class-name">T2</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Customer</span></span> <span class="token comment">// T2 的约束</span>
          <span class="token keyword">where</span> <span class="token class-name">T3</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IComparable</span></span> <span class="token comment">// T3 的约束</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="约束类型和次序"><a href="#约束类型和次序" class="header-anchor">#</a> 约束类型和次序</h5> <p>共有 5 种类型的约束。</p> <p><img src="/Notebook/assets/img/constraint-type.d221fb1a.png" alt=""></p> <p>where 语句可以以任何次序列出。然而，where 子语句中的约束必须有特定的顺序。</p> <ul><li>最多只能有一个主约束，如果有则必须放在第一位。</li> <li>可以有任意多的接口名约束。</li> <li>如果存在构造函数约束，则必须放在最后。</li></ul> <p><img src="/Notebook/assets/img/constraint-order.afea5d9a.png" alt=""></p> <h4 id="泛型方法"><a href="#泛型方法" class="header-anchor">#</a> 泛型方法</h4> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 泛型方法</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuGeneric</span>
<span class="token punctuation">{</span>

  <span class="token keyword">class</span> <span class="token class-name">Simple</span>  <span class="token comment">// 非泛型类</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token generic-method"><span class="token function">ReverseAndPrint</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">T<span class="token punctuation">[</span><span class="token punctuation">]</span></span> arr<span class="token punctuation">)</span> <span class="token comment">// 泛型方法</span>
    <span class="token punctuation">{</span>
      Array<span class="token punctuation">.</span><span class="token function">Reverse</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">T</span> item <span class="token keyword">in</span> arr<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;{0} &quot;</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program2</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// 创建各种类型数组</span>
      <span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> intArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">11</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> stringArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span> <span class="token string">&quot;first&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;second&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;third&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token class-name"><span class="token keyword">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> doubleArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span> <span class="token number">3.567</span><span class="token punctuation">,</span> <span class="token number">7.891</span><span class="token punctuation">,</span> <span class="token number">2.345</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

      Simple<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ReverseAndPrint</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>intArray<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用方法</span>
      Simple<span class="token punctuation">.</span><span class="token function">ReverseAndPrint</span><span class="token punctuation">(</span>intArray<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 推断类型并调用</span>

      Simple<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ReverseAndPrint</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>stringArray<span class="token punctuation">)</span><span class="token punctuation">;</span>
      Simple<span class="token punctuation">.</span><span class="token function">ReverseAndPrint</span><span class="token punctuation">(</span>stringArray<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 推断类型并调用</span>

      Simple<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ReverseAndPrint</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">double</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>doubleArray<span class="token punctuation">)</span><span class="token punctuation">;</span>
      Simple<span class="token punctuation">.</span><span class="token function">ReverseAndPrint</span><span class="token punctuation">(</span>doubleArray<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h4 id="扩展方法和泛型类"><a href="#扩展方法和泛型类" class="header-anchor">#</a> 扩展方法和泛型类</h4> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 泛型——扩展方法</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuGeneric</span>
<span class="token punctuation">{</span>

  <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ExtendHolder</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token generic-method"><span class="token function">Print</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">Holder<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> h<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">T<span class="token punctuation">[</span><span class="token punctuation">]</span></span> vals <span class="token operator">=</span> h<span class="token punctuation">.</span><span class="token function">GetValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0},\t{1}, \t{2}&quot;</span><span class="token punctuation">,</span> vals<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> vals<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> vals<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Holder<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">{</span>
    <span class="token class-name">T<span class="token punctuation">[</span><span class="token punctuation">]</span></span> Vals <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">T</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token function">Holder</span><span class="token punctuation">(</span><span class="token class-name">T</span> v0<span class="token punctuation">,</span> <span class="token class-name">T</span> v1<span class="token punctuation">,</span> <span class="token class-name">T</span> v2<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Vals<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> v0<span class="token punctuation">;</span>
      Vals<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> v1<span class="token punctuation">;</span>
      Vals<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> v2<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">T<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token function">GetValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> Vals<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program3</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">Holder<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> intHolder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Holder<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">Holder<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> stringHolder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Holder<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;a1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;c3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      intHolder<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      stringHolder<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h4 id="泛型结构"><a href="#泛型结构" class="header-anchor">#</a> 泛型结构</h4> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 泛型结构</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuGeneric</span>
<span class="token punctuation">{</span>
  <span class="token keyword">struct</span> <span class="token class-name">PieceOfData<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">PieceOfData</span><span class="token punctuation">(</span><span class="token class-name">T</span> <span class="token keyword">value</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      _data <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token class-name">T</span> _data<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">T</span> Data
    <span class="token punctuation">{</span>
      <span class="token keyword">get</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">return</span> _data<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">set</span>
      <span class="token punctuation">{</span>
        _data <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">class</span> <span class="token class-name">Program4</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">PieceOfData<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> intData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">PieceOfData<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">PieceOfData<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> stringData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">PieceOfData<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;Hi there.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;intData = {0}&quot;</span><span class="token punctuation">,</span> intData<span class="token punctuation">.</span>Data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;stringData = {0}&quot;</span><span class="token punctuation">,</span> stringData<span class="token punctuation">.</span>Data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h4 id="泛型委托"><a href="#泛型委托" class="header-anchor">#</a> 泛型委托</h4> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 泛型委托</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuGeneric</span>
<span class="token punctuation">{</span>
  <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token generic-method"><span class="token function">MyDelegate</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">T</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 泛型委托</span>
  <span class="token keyword">class</span> <span class="token class-name">Simple2</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PrintString</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> s<span class="token punctuation">)</span> <span class="token comment">// 方法匹配委托</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">static</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PrintUpperString</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> s<span class="token punctuation">)</span> <span class="token comment">// 方法匹配委托</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0}&quot;</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token function">ToUpper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program5</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">MyDelegate<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> myDel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyDelegate<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>Simple2<span class="token punctuation">.</span>PrintString<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建委托的实例</span>
      myDel <span class="token operator">+=</span> Simple2<span class="token punctuation">.</span>PrintUpperString<span class="token punctuation">;</span> <span class="token comment">// 添加方法</span>

      <span class="token function">myDel</span><span class="token punctuation">(</span><span class="token string">&quot;Hi there.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用委托</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h5 id="添加上返回类型的泛型"><a href="#添加上返回类型的泛型" class="header-anchor">#</a> 添加上返回类型的泛型</h5> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 泛型委托</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuGeneric</span>
<span class="token punctuation">{</span>
  <span class="token keyword">delegate</span> <span class="token return-type class-name">TR</span> <span class="token generic-method"><span class="token function">Func</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T1<span class="token punctuation">,</span> T2<span class="token punctuation">,</span> TR<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">T1</span> p<span class="token punctuation">,</span> <span class="token class-name">T2</span> p2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 泛型委托</span>
  <span class="token keyword">class</span> <span class="token class-name">Simple3</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">PrintString</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> p1<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> p2<span class="token punctuation">)</span> <span class="token comment">// 方法匹配委托</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">int</span></span> total <span class="token operator">=</span> p1 <span class="token operator">+</span> p2<span class="token punctuation">;</span>
      <span class="token keyword">return</span> total<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program6</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> myDel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>Simple3<span class="token punctuation">.</span>PrintString<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建委托的实例</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Total: {0}&quot;</span><span class="token punctuation">,</span> <span class="token function">myDel</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h4 id="泛型接口"><a href="#泛型接口" class="header-anchor">#</a> 泛型接口</h4> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 泛型接口</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuGeneric</span>
<span class="token punctuation">{</span>
  <span class="token keyword">interface</span> <span class="token class-name">IMyfc<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token comment">// 泛型接口</span>
  <span class="token punctuation">{</span>
    <span class="token return-type class-name">T</span> <span class="token function">ReturnIt</span><span class="token punctuation">(</span><span class="token class-name">T</span> intValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 非泛型类</span>
  <span class="token keyword">class</span> <span class="token class-name">Simple4</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IMyfc<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IMyfc<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span> <span class="token comment">// 源于同一泛型接口的两个不同接口</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">ReturnIt</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> intValue<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> intValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">ReturnIt</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> stringValue<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> stringValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program7</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">Simple4</span> trival <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Simple4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0}&quot;</span><span class="token punctuation">,</span> trival<span class="token punctuation">.</span><span class="token function">ReturnIt</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0}&quot;</span><span class="token punctuation">,</span> trival<span class="token punctuation">.</span><span class="token function">ReturnIt</span><span class="token punctuation">(</span><span class="token string">&quot;Hi there.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h4 id="协变"><a href="#协变" class="header-anchor">#</a> 协变</h4> <p>后续补充</p> <h4 id="逆变"><a href="#逆变" class="header-anchor">#</a> 逆变</h4> <h5 id="接口的协变和逆变"><a href="#接口的协变和逆变" class="header-anchor">#</a> 接口的协变和逆变</h5> <h5 id="有关可变性的更多内容"><a href="#有关可变性的更多内容" class="header-anchor">#</a> 有关可变性的更多内容</h5> <h3 id="枚举器和迭代器"><a href="#枚举器和迭代器" class="header-anchor">#</a> 枚举器和迭代器</h3> <h4 id="枚举器和可枚举类型"><a href="#枚举器和可枚举类型" class="header-anchor">#</a> 枚举器和可枚举类型</h4> <p>在前面，我们已经知道可以使用 foreach 语句来遍历数组中的元素。在本章中，我们会进一步探讨数组，来看看为什么它们可以被 foreach 语句处理。我们还会研究如何用迭代器为用户自定义的类增加这个功能。</p> <h5 id="使用-foreach-语句"><a href="#使用-foreach-语句" class="header-anchor">#</a> 使用 foreach 语句</h5> <p>当我们为数组使用 foreach 语句时，这个语句为我们依次取出了数组中的每一个元素，允许我们读取它的值。例如，如下的代码声明了一个有 4 个元素的数组，然后使用 foreach 来循环打印这些项的值：</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> arr1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 定义数组</span>
<span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> item <span class="token keyword">in</span> arr1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Item value: {0}&quot;</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 输出</span>
<span class="token comment">// Item value：10</span>
<span class="token comment">// Item value：11</span>
<span class="token comment">// Item value：12</span>
<span class="token comment">// Item value：13</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>为什么数组可以这么做？<u>原因是数组可以按需提供一个叫做枚举器（enumerator）的对象。</u>枚举器可以依次返回请求的数组中的元素。枚举器“知道”项的次序并且跟踪它在列中的位置，然后返回请求的当前项目。</p> <p>对于有枚举器的类型而言，必须有一个方法来获取它。<u>获取一个对象枚举器的方法是调用对象的 <code>GetEnumerator</code> 方法。实现 <code>GetEnumerator</code> 方法的类型叫做可枚举类型（enumerable type 或 enumerable）。</u>数组是可枚举类型。</p> <p><img src="/Notebook/assets/img/enumerable-type-enumerator.a85d2505.png" alt=""></p> <p>foreach 结构设计用来和可枚举类型一起使用。只要它的遍历对象是可枚举类型，比如数组，它就会执行如下行为：</p> <ul><li>通过调用 GetEnumerator 方法获取对象的枚举器；</li> <li>从枚举器中请求每一项并且把它作为迭代变量（ieration variable），代码可以读取该变量但不可以改变。</li></ul> <h4 id="ieumerator-接口"><a href="#ieumerator-接口" class="header-anchor">#</a> IEumerator 接口</h4> <p>实现了 IEnumerator 接口的枚举器包含 3 个函数成员：Current、MoveNext 以及 Reset。</p> <ul><li>Current 是返回序列中当前位置项的属性。
<ul><li>它是只读属性；</li> <li>它返回 object 类型的引用，所以可以返回任何类型。</li></ul></li> <li>MoveNext 是把枚举器位置前进到集合中下一项的方法。它也返回布尔值，指示新的位置是有效位置还是已经超过了序列的尾部。
<ul><li>如果新的位置还是有效，方法返回 true。</li> <li>如果新的位置是无效的（比如当前位置到达了尾部），方法返回 false。</li> <li>枚举器的原始位置在序列中的第一项之前，因此 MoveNext 必须在第一次使用 Current 之前调用。</li></ul></li> <li>Reset 是把位置重置为原始状态的方法。</li></ul> <p><img src="/Notebook/assets/img/enumerator-little-collection.c0877e37.png" alt=""></p> <p>枚举器与序列中的当前项保持联系的方式完全取决于实现。可以通过对象引用、索引值或其他方式来实现。对于内置的一维数组来说，就使用项的索引。对于内置的一维数组，就使用项的索引。</p> <p><img src="/Notebook/assets/img/enumerator-status.be47255b.png" alt=""></p> <p>有了集合的枚举器，我们就可以使用 MoveNext 和 Current 成员来模仿 foreach 循环遍历中的项。如下。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuEnumerator</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">Program</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> MyArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token class-name">IEnumerator</span> ie <span class="token operator">=</span> MyArray<span class="token punctuation">.</span><span class="token function">GetEnumerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">while</span> <span class="token punctuation">(</span>ie<span class="token punctuation">.</span><span class="token function">MoveNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 手动模拟</span>
      <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>ie<span class="token punctuation">.</span>Current<span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h4 id="ienumerable-接口"><a href="#ienumerable-接口" class="header-anchor">#</a> IEnumerable 接口</h4> <p>可枚举类型是指实现了 IEnumerable 接口的类。IEnumerable 只有一个成员——GetEnumerator 方法，它返回对象的枚举器。</p> <p>下面的代码展示了一个可枚举类的完整示例，该类叫做 Spectrum，它的枚举器类为 Color-Enumerator。Program 类在 Main 方法中创建了一个 Spectrum 实例，用于 foreach 循环。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuEnumerator</span>
<span class="token punctuation">{</span>
  <span class="token comment">// 枚举器</span>
  <span class="token keyword">class</span> <span class="token class-name">ColorEnumerator</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IEnumerator</span></span>
  <span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> _colors<span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">int</span></span> _position <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token comment">// 构造函数</span>
    <span class="token keyword">public</span> <span class="token function">ColorEnumerator</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> theColors<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      _colors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">string</span></span><span class="token punctuation">[</span>theColors<span class="token punctuation">.</span>Length<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 构造函数</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> theColors<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        _colors<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> theColors<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 当前项</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> Current
    <span class="token punctuation">{</span>
      <span class="token keyword">get</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_position <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
          <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">InvalidCastException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_position <span class="token operator">&gt;=</span> _colors<span class="token punctuation">.</span>Length<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
          <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">InvalidCastException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> _colors<span class="token punctuation">[</span>_position<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 移动到下一项</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">MoveNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>_position <span class="token operator">&lt;</span> _colors<span class="token punctuation">.</span>Length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        _position<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">else</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 重置状态</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 实现 reset</span>
    <span class="token punctuation">{</span>
      _position <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 可枚举类</span>
  <span class="token keyword">class</span> <span class="token class-name">Spectrum</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IEnumerable</span></span>
  <span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> colors <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">&quot;violet&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;blue&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;cyan&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;green&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;yellow&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;orange&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;red&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">IEnumerator</span> <span class="token function">GetEnumerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ColorEnumerator</span><span class="token punctuation">(</span>colors<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program2</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">Spectrum</span> spectrum <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Spectrum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> color <span class="token keyword">in</span> spectrum<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br></div></div><h4 id="泛型枚举接口"><a href="#泛型枚举接口" class="header-anchor">#</a> 泛型枚举接口</h4> <p>目前我们描述的都是非泛型版本。实际上，在大多数情况下你应该使用泛型 <code>IEnumerable&lt;T&gt;</code> 和 <code>IEnumerator&lt;T&gt;</code>。它们叫做泛型是因为使用了 C# 泛型。</p> <p>两者的本质区别如下所示。</p> <ul><li>对于非泛型接口形式：
<ul><li>IEnumberable 接口的 GetEnumerator 方法返回实现 IEnumerator 枚举器类的实例。</li> <li>实现 IEnumerator 的类实现了 Current 属性，它返回 object 的引用，然后我们必须把它转化为实际类型的对象。</li></ul></li> <li>对于泛型接口形式：
<ul><li><code>IEnumberable&lt;T&gt;</code>接口的 GetEnumerator 方法返回实现 <code>IEnumerator&lt;T&gt;</code>枚举器类的实例。</li> <li>实现 <code>IEnumerator&lt;T&gt;</code> 的类实现了 Current 属性，它返回实际类型的对象，而不是 object 基类的引用。</li></ul></li></ul> <p>需要重点注意的是，我们目前看到的所有的非泛型接口的实现不是类型安全的。<u>它们返回 object 类型的引用，然后必须转换为实际类型。</u></p> <p><u>而泛型接口的枚举器是安全的，它返回实际类型的引用。</u>如果要创建自己的可枚举类，应该实现这些泛型接口。非泛型版本可用于 C# 2.0 以前没有泛型的遗留代码。</p> <p>实现代码待后续补充。</p> <h4 id="迭代器"><a href="#迭代器" class="header-anchor">#</a> 迭代器</h4> <p>可枚举类和枚举器在 .NET 集合类中被广泛使用，所以熟悉它们如何工作重要。不过，虽然我们已经知道如何创建自己的可枚举类和枚举器了，但是我们还是很高兴听到，C#从 2.0 版本开始提供了更简单的创建枚举器和可枚举类型的方式。<u>实际上，编译器将为我们创建它们。这种结构叫做迭代器。我们可以把手动编码的可枚举类型和枚举器替换为由迭代器生成的可枚举类型和枚举器。</u></p> <p>在解释细节之前，我们先来看两个示例。下面的方法声明了一个产生和返回枚举器的迭代器。</p> <ul><li>迭代器返回一个泛型枚举器，该枚举器返回 3 个 string 类型的项。</li> <li>yield return 语句声明这是枚举中的下一项。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">public</span> <span class="token return-type class-name">IEnumerator<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token function">BlackAndWhite</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 迭代器</span>
<span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token string">&quot;black&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token string">&quot;gray&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token string">&quot;white&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h5 id="迭代器块"><a href="#迭代器块" class="header-anchor">#</a> 迭代器块</h5> <p>迭代器块是有一个或多个 yield 语句的代码块。</p> <ul><li>方法主体；</li> <li>访问器主体；</li> <li>运算符主体。</li></ul> <h5 id="使用迭代器来创建枚举器"><a href="#使用迭代器来创建枚举器" class="header-anchor">#</a> 使用迭代器来创建枚举器</h5> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 泛型枚举器</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span> <span class="token comment">// 引入泛型</span>

<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuEnumerator</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">MyClass</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// 返回泛型枚举器，它返回的是字符串对象</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">IEnumerator<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetEnumerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">BlackAndWhite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回枚举器</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">IEnumerator<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token function">BlackAndWhite</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 迭代器</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token string">&quot;black&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 如果方法在第一个 yield 返回，后面两条语句永远不会达到</span>
      <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token string">&quot;gray&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token string">&quot;white&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program4</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">MyClass</span> mc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> shade <span class="token keyword">in</span> mc<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>shade<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h5 id="使用迭代器来创建可枚举类型"><a href="#使用迭代器来创建可枚举类型" class="header-anchor">#</a> 使用迭代器来创建可枚举类型</h5> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 泛型枚举器</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span> <span class="token comment">// 引入泛型</span>

<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuEnumerator</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">MyClass</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// 返回泛型枚举器，它返回的是字符串对象</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">IEnumerator<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token function">GetEnumerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// 引用可枚举类型的接口对象</span>
      <span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> myEnumerable <span class="token operator">=</span> <span class="token function">BlackAndWhite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取可枚举类型</span>
      <span class="token keyword">return</span> myEnumerable<span class="token punctuation">.</span><span class="token function">GetEnumerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取枚举器</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 返回可枚举类型</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token function">BlackAndWhite</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token string">&quot;black&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 如果方法在第一个 yield 返回，后面两条语句永远不会达到</span>
      <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token string">&quot;gray&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token string">&quot;white&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program4</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">MyClass</span> mc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> shade <span class="token keyword">in</span> mc<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>shade<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> shade <span class="token keyword">in</span> mc<span class="token punctuation">.</span><span class="token function">BlackAndWhite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>shade<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h4 id="常见迭代器模式"><a href="#常见迭代器模式" class="header-anchor">#</a> 常见迭代器模式</h4> <p>前面两节的内容显示了，我们可以创建迭代器返回可枚举类型或枚举器。</p> <ul><li>当我们实现返回枚举器的迭代器时，必须通过实现 GetEnumerator 让类可枚举，它返回由迭代器返回的枚举器。</li> <li>如果我们在类中实现迭代器返回可枚举类型，我们可以让类实现 GetEnumerator 来让类本身可被枚举，或不实现 GetEnumerator，让类不可枚举。
<ul><li>如果实现 GetEnumerator ，让它调用迭代器方法以获取自动生成的实现 IEnumerable 的类实例。然后，从 IEnumerable 对象返回由 GetEnumerator 创建的枚举器。</li> <li>如果通过不实现 GetEnumerator 使类本身不可枚举，仍然可以使用由迭代器返回的可枚举类，只需要直接调用迭代器方法。</li></ul></li></ul> <p><img src="/Notebook/assets/img/common-iterator-mode.7658f606.png" alt=""></p> <h4 id="产生多个可枚举类型"><a href="#产生多个可枚举类型" class="header-anchor">#</a> 产生多个可枚举类型</h4> <h4 id="将迭代器作为属性"><a href="#将迭代器作为属性" class="header-anchor">#</a> 将迭代器作为属性</h4> <h4 id="迭代器的实质"><a href="#迭代器的实质" class="header-anchor">#</a> 迭代器的实质</h4> <h3 id="linq"><a href="#linq" class="header-anchor">#</a> LINQ</h3> <h4 id="什么是-linq"><a href="#什么是-linq" class="header-anchor">#</a> 什么是 LINQ</h4> <p>在关系型数据库系统中，数据被组织放入规范化很好的表中，并且通过简单而又强大的语法 SQL 来进行访问。SQL 可以和数据库中的任何数据配合使用，因为数据被放入表中，并遵从一些严格的规则。</p> <p><u>然而，在程序中却与数据库相反，保存在类对象或结构中的数据差异很大。</u>因此，没有通用的查询语言从数据结构中获取数据。从对象获取数据的方法一直都是作为程序的一部分而设计的。然而使用 LINQ 可以很轻松地查询对象集合。</p> <p>如下是 LINQ 的重要高级特性。</p> <ul><li>LINQ（发音 link）代表语言集成查询（Language Intergrated Query）。</li> <li><u>LINQ 是 .NET 框架的扩展，你可以从数据库、程序对象的集合以及 XML 文档中查询数据。</u></li> <li><u>使用 LINQ，你可以从数据库、程序对象的集合以及 XML 文档中查询数据。</u></li></ul> <p>如下代码演示了一个简单的使用 LINQ 的示例。在这段代码中，被查询的数据是简单的 int 数组。<u>语句中查询的定义就是 from 和 select 关键字。尽管查询在语句中定义，但直到最后的 foreach 语句请求结果的时候才执行。</u></p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuLINQ</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> numbers <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">15</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 数据源</span>
      <span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> lowNums <span class="token operator">=</span> <span class="token keyword">from</span> n <span class="token keyword">in</span> numbers
                                 <span class="token keyword">where</span> <span class="token class-name">n</span> <span class="token operator">&lt;</span> <span class="token number">10</span>
                                 <span class="token keyword">select</span> n<span class="token punctuation">;</span>
      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> x <span class="token keyword">in</span> lowNums<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;{0}, &quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h4 id="linq-提供程序"><a href="#linq-提供程序" class="header-anchor">#</a> LINQ 提供程序</h4> <p>在之前的示例中，数据源只是 int 数组，它是程序在内存中的对象。然而，LINQ 还可以和各种类型的数据源一起工作，比如 SQL 数据库、XML 文档，等等。然而，<u>每一种数据类型，在其背后一定有根据该数据源类型实现 LINQ 查询的代码块。这些代码模块叫做 LINQ 提供程序（provider）。</u>有关 LINQ 的要点如下：</p> <ul><li>微软为一些常见的数据源类型提供了 LINQ 程序，如图所示。</li> <li>我们可以使用任何支持 LINQ 的语言（在着这里是 C#）来查询有 LINQ 提供程序的数据源类型。</li> <li>第三方在不断提供对各种数据源类型的 LINQ 提供程序。</li></ul> <p><img src="/Notebook/assets/img/LINQ-system.7974b871.png" alt=""></p> <h5 id="匿名类型"><a href="#匿名类型" class="header-anchor">#</a> 匿名类型</h5> <p>在介绍 LINQ 查询特性之前，让我们先学习一个允许我们创建无名类类型的特性。不足为奇，它叫做“anonymous type”。匿名类型经常用于 LINQ 查询的结果之中。</p> <p>前面介绍了<code>对象初始化语句</code>，它允许我们在使用对象创建表达式时初始化新类实例的字段和属性。只是提醒一下，这种形式的对象创建表达式由三部分组成：<u>new 关键字、类名或构造函数以及对象初始化语句。</u>对象初始化语句在一组大括号内包含了以逗号分隔的成员初始化列表。</p> <p>创建匿名类型的变量使用相同的形式，但是没有类名和构造函数。如下的代码行演示了匿名类型的对象创建表达式。</p> <p><code>new {FieldProp = InitExpr, FieldProp = InitExpr, ...}</code></p> <p>如下代码给出了一个创建和使用匿名类型的示例。它创建了一个叫做 student 的变量，这是一个有 3 个 <code>string</code> 属性和一个 <code>int</code> 属性的匿名类型。注意，在 WriteLine 语句中， 可以像访问具名类型的成员那样访问实例的成员。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuLINQ</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program2</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">var</span></span> student <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;Jecyu&quot;</span><span class="token punctuation">,</span> Age <span class="token operator">=</span> <span class="token number">22</span><span class="token punctuation">,</span> Major <span class="token operator">=</span> <span class="token string">&quot;Digital&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0}, Age:{1}, Major:{2}&quot;</span><span class="token punctuation">,</span> student<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> student<span class="token punctuation">.</span>Age<span class="token punctuation">,</span>
      student<span class="token punctuation">.</span>Major<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// Jecyu, Age:22, Major:Digital</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>需要了解的有关匿名类型的重要事项如下：</p> <ul><li>匿名类型只能和局部变量配合使用，不能用于类成员。</li> <li>由于匿名类型没有名字，我们必须使用 var 关键字作为变量类型。</li> <li>不能设置匿名类型对象的属性。编译器为匿名类型创建的属性是只读的。</li></ul> <p><u>当编译器遇到匿名类型的对象初始化语句时，它创建了一个有名字的新类类型。</u>对于每一个成员初始化语句，它推断其类型并创建一个只读属性来访问它的值。属性和成员初始化语句具有相同的名字。<u>匿名类型被构造后，编译器创建了这个类型的对象。</u></p> <p>除了对象初始化语句的赋值形式，匿名类型的对象初始化语句还有其他两种允许的形式：<u>简单标识符和成员访问表达式。</u>这两种形式叫做<code>投影初始化语句（projection initializer）</code></p> <p>下面的变量声明演示了所有的 3 种形式。第一个成员初始化语句是赋值形式，第二个是成员访问表达式，第三个是标识符形式。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">var</span></span> student <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">{</span>Age <span class="token operator">=</span> <span class="token number">19</span><span class="token punctuation">,</span> Other<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> Major <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 赋值形式 Age = 19，成员访问 Other.Name，标识符 Major</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>例如，如下代码使用了所有的 3 种类型。注意，投影初始化语句必须定义在匿名类型声明之前。Major 是一个局部变量，Name 是 Other 类的静态字段。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuLINQ</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">Other</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> Name <span class="token operator">=</span> <span class="token string">&quot;Jecyu&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program3</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">string</span></span> Major <span class="token operator">=</span> <span class="token string">&quot;History&quot;</span><span class="token punctuation">;</span>
      <span class="token class-name"><span class="token keyword">var</span></span> student <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> Age <span class="token operator">=</span> <span class="token number">19</span><span class="token punctuation">,</span> Other<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> Major <span class="token punctuation">}</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0}, Age:{1}, Major:{2}&quot;</span><span class="token punctuation">,</span> student<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> student<span class="token punctuation">.</span>Age<span class="token punctuation">,</span>
   student<span class="token punctuation">.</span>Major<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>刚才演示的映射初始化语句形式和这里给出的赋值形式的结果一样：</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">var</span></span> student <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">{</span>Age <span class="token operator">=</span> <span class="token number">19</span><span class="token punctuation">,</span> Name <span class="token operator">=</span> Other<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> Major <span class="token operator">=</span> Major<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 赋值形式 Age = 19，成员访问 Other.Name，标识符 Major</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果编译器遇到了另一个具有相同的参数名、相同的推断类型和相同顺序的匿名类型，它会重用这个类型并直接创建新的实例，不会创建新的匿名类型。</p> <h4 id="方法语法和查询语法"><a href="#方法语法和查询语法" class="header-anchor">#</a> 方法语法和查询语法</h4> <p>我们在写 LINQ 查询时可以使用两种形式的语法：查询语法和方法语法。</p> <ul><li>方法语法（method syntax）使用标准的方法调用。这些方法是一组叫做标准查询运算符的方法，本章稍后介绍。</li> <li>查询语法（query syntax）看上去和 SQL 语句很相似，使用查询表达式形式书写。</li> <li>在一个查询中可以组合两种形式。</li></ul> <p><u>查询语法是声明式（declarative）的，也就是说，查询描述的是你想要返回的东西，但并没有指明如何执行这个查询。方法语法是命令式（imperative）的，它指明了查询语法调用的顺序。</u><strong>编译器会将使用查询语法表示的查询翻译为方法调用的形式。这两种形式在运行时没有性能的差异。</strong></p> <p>微软推荐使用查询语法，因为它更易读，能更清晰地表明查询意图，因此也更不容易出错。然而，有些运算符必须使用方法语法来书写。</p> <p>如下代码演示了这两种形式以及它们的组合。对于方法语法的那部分代码，注意 Where 方法的参数使用了 Lambda 表达式。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuLINQ</span>
<span class="token punctuation">{</span>

  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program4</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> numbers <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token class-name"><span class="token keyword">var</span></span> numsQuery <span class="token operator">=</span> <span class="token keyword">from</span> n <span class="token keyword">in</span> numbers <span class="token comment">// 查询语法</span>
                      <span class="token keyword">where</span> <span class="token class-name">n</span> <span class="token operator">&lt;</span> <span class="token number">20</span>
                      <span class="token keyword">select</span> n<span class="token punctuation">;</span>
      <span class="token class-name"><span class="token keyword">var</span></span> numsMethod <span class="token operator">=</span> numbers<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 方法语法</span>
      <span class="token class-name"><span class="token keyword">int</span></span> numsCount <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">from</span> n <span class="token keyword">in</span> numbers <span class="token comment">// 两种形式的结合</span>
                       <span class="token keyword">where</span> <span class="token class-name">n</span> <span class="token operator">&lt;</span> <span class="token number">20</span>
                       <span class="token keyword">select</span> n<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> x <span class="token keyword">in</span> numsQuery<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;{0} &quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> x <span class="token keyword">in</span> numsMethod<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;{0} &quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h4 id="查询变量"><a href="#查询变量" class="header-anchor">#</a> 查询变量</h4> <p>LINQ 查询可以返回两种类型的结果——可以是一个<code>枚举</code>，它满足查询参数的项列表；也可以是一个叫做<code>标量（scalar）</code>的单一值，它是满足查询条件的结果的某种摘要形式。</p> <p>如下示例代码进行了这些工作。</p> <ul><li>第一个语句创建了 int 的数组并且使用 3 个值进行初始化。</li> <li>第二个语句返回一个 IEnumerable 对象，它可以用来枚举查询的结果。</li> <li>第三个语句执行一个查询，然后调用一个方法（Count）来返回从查询返回的总数。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> numbers <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">28</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 数据源</span>
  <span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span> lowNums <span class="token operator">=</span> <span class="token keyword">from</span> n <span class="token keyword">in</span> numbers
                             <span class="token keyword">where</span> <span class="token class-name">n</span> <span class="token operator">&lt;</span> <span class="token number">20</span>
                             <span class="token keyword">select</span> n<span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">int</span></span> numsCount <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">from</span> n <span class="token keyword">in</span> numbers <span class="token comment">// 两种形式的结合</span>
                 <span class="token keyword">where</span> <span class="token class-name">n</span> <span class="token operator">&lt;</span> <span class="token number">20</span>
                 <span class="token keyword">select</span> n<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><u>第二条和第三条语句等号左边的变量叫做查询变量。</u></p> <p>理解查询变量的用法很重要。在执行前面的代码，<u>lowNums 查询变量不会包含查询的结果。</u>相反，编译器会创建能够执行这个查询的代码。</p> <p>查询变量 numCount 包含的是真实的整数值，它只能通过真实运行查询后的结果。区别在于查询执行的时间，可以总结如下。</p> <ul><li><u>如果查询表达式返回枚举，查询一直到处理枚举时才会执行。</u></li> <li><u>如果枚举被处理多次，查询就会执行多次。</u></li> <li>如果在进行遍历之后，查询执行之前数据有改动，则查询会使用新的数据。</li> <li><u>如果查询表达式返回标量，查询立即执行，并且把结果保存在查询变量中。</u></li></ul> <h4 id="查询表达式的结构"><a href="#查询表达式的结构" class="header-anchor">#</a> 查询表达式的结构</h4> <p>如图 19-2 所示，查询表达式由查询体后的 from 子句组成。有关查询表达式需要了解的一些重要事项如下。</p> <ul><li>子句必须按照一定的顺序出现。</li> <li><u><code>from</code> 子句和<code>select...group</code> 子句这两部分是必需的。</u></li> <li>其他子句是可选的。</li> <li><u>在 LINQ 查询表达式中，<code>select</code> 子句在表达式最后。这与 SQL 的 SELECT 语句在查询的开始处不一样。C#这么做的原因之一是让 Visual Studio 智能感应能在我们输入代码时给我们更多选项。</u></li> <li>可以有任意多的 <code>from...let...where</code> 子句，如图 19-2 所示。</li></ul> <p><img src="/Notebook/assets/img/LINQ-Query-Statement.a6a23135.png" alt=""></p> <h5 id="from-子句"><a href="#from-子句" class="header-anchor">#</a> from 子句</h5> <h5 id="join-子句"><a href="#join-子句" class="header-anchor">#</a> join 子句</h5> <h4 id="标准查询运算符"><a href="#标准查询运算符" class="header-anchor">#</a> 标准查询运算符</h4> <p>标准查询运算符由一系列 API 方法组成，它能让我们查询任何 .NET 数组或集合。有关标准查询运算符的重要性如下。</p> <ul><li>被查询的集合对象叫做序列，它必须实现 <code>1IEnumerable&lt;T&gt;</code> 接口，T 是类型。</li> <li>标准查询运算符使用方法语法。</li> <li><u>一些运算符返回 <code>Ienumerable</code> 对象（或其他序列），而其他的一些运算符返回标量。返回标量的运算符立即执行，并返回一个值，而不是可枚举类型对象。</u></li> <li>很多操作符都以一个谓词作为参数。谓词是一个方法，它以对象作为参数，根据对象是否满足某个条件而返回 <code>true</code> 或 <code>false</code>。</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuLINQ</span>
<span class="token punctuation">{</span>

  <span class="token keyword">class</span> <span class="token class-name">Program5</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> numbers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">int</span></span> total <span class="token operator">=</span> numbers<span class="token punctuation">.</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name"><span class="token keyword">int</span></span> howMany <span class="token operator">=</span> numbers<span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Total: {0}, Count: {1}&quot;</span><span class="token punctuation">,</span> total<span class="token punctuation">,</span> howMany<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Total: 12, Count: 3</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h5 id="将委托作为参数"><a href="#将委托作为参数" class="header-anchor">#</a> 将委托作为参数</h5> <ul><li>泛型委托用于给运算符提供用户自定义的代码。</li></ul> <h4 id="linq-to-xml"><a href="#linq-to-xml" class="header-anchor">#</a> LINQ to XML</h4> <p>可扩展标记语言（XML）是存储和交换数据的重要方法。LINQ 为语言增加了一些特性，使得 XML 用起来比 XPath 和 XSLT 容易得多。如果你熟悉这些方法的话，会很高兴 LINQ to XML 在许多方面简化了 XML 的创建、查询和操作。当然，还包括以下几个方面。</p> <ul><li>我们可以使用单一语句自顶向下创建 XML 树。</li> <li>我们可以不使用包含数的 XML 文档在内存中创建并操作 XML。</li> <li>我们可以不使用 Text 子节点来创建和操作字符串节点。</li> <li><u>一个最大的不同（改进）是，在搜索一个 XML 树时，不需要遍历它。相反只需要查询树并让它返回想要的结果。</u></li></ul> <p>尽管我不会完整介绍 <code>XML</code>，但是在介绍一些 LINQ 提供的 XML 操作特性之前，我会先简单介绍一下 <code>XML</code>。</p> <h5 id="标记语言"><a href="#标记语言" class="header-anchor">#</a> 标记语言</h5> <p>标记语言（markup language）是文档中的一组标签，它提供有关稳定的信息并组织其内容。也就是说，<u>标记标签不是文档的数据——它们包含关于数据的数据。有关数据的数据称为元数据。</u></p> <p><u>标记语言是被定义的一组标签，旨在传递有关文档内容的特定类型的元数据。</u></p> <h5 id="xml-基础"><a href="#xml-基础" class="header-anchor">#</a> XML 基础</h5> <h5 id="xml-类"><a href="#xml-类" class="header-anchor">#</a> XML 类</h5> <h5 id="使用-xml-特性"><a href="#使用-xml-特性" class="header-anchor">#</a> 使用 XML 特性</h5> <h5 id="节点的其他类型"><a href="#节点的其他类型" class="header-anchor">#</a> 节点的其他类型</h5> <h5 id="使用-linq-to-xml-的-linq-查询"><a href="#使用-linq-to-xml-的-linq-查询" class="header-anchor">#</a> 使用 LINQ to XML 的 LINQ 查询</h5> <h3 id="异步编程"><a href="#异步编程" class="header-anchor">#</a> 异步编程</h3> <h4 id="什么是异步"><a href="#什么是异步" class="header-anchor">#</a> 什么是异步</h4> <h4 id="async-await-特性的结构"><a href="#async-await-特性的结构" class="header-anchor">#</a> async/await 特性的结构</h4> <h4 id="什么是异步方法"><a href="#什么是异步方法" class="header-anchor">#</a> 什么是异步方法</h4> <h5 id="异步方法的控制流"><a href="#异步方法的控制流" class="header-anchor">#</a> 异步方法的控制流</h5> <h5 id="await-表达式"><a href="#await-表达式" class="header-anchor">#</a> await 表达式</h5> <h5 id="取消一个异步操作"><a href="#取消一个异步操作" class="header-anchor">#</a> 取消一个异步操作</h5> <h5 id="异步处理和-await-表达式"><a href="#异步处理和-await-表达式" class="header-anchor">#</a> 异步处理和 await 表达式</h5> <h5 id="在调用方法中同步地等待任务"><a href="#在调用方法中同步地等待任务" class="header-anchor">#</a> 在调用方法中同步地等待任务</h5> <h5 id="在异步方法中异步地等待任务"><a href="#在异步方法中异步地等待任务" class="header-anchor">#</a> 在异步方法中异步地等待任务</h5> <h5 id="task-delay-方法"><a href="#task-delay-方法" class="header-anchor">#</a> Task.Delay 方法</h5> <h4 id="gui-程序中的异步操作"><a href="#gui-程序中的异步操作" class="header-anchor">#</a> GUI 程序中的异步操作</h4> <h4 id="使用异步的-lambda-表达式"><a href="#使用异步的-lambda-表达式" class="header-anchor">#</a> 使用异步的 Lambda 表达式</h4> <h4 id="一个完整的-gui-示例"><a href="#一个完整的-gui-示例" class="header-anchor">#</a> 一个完整的 GUI 示例</h4> <h4 id="backgroundworker-类"><a href="#backgroundworker-类" class="header-anchor">#</a> BackgroundWorker 类</h4> <h4 id="并行循环"><a href="#并行循环" class="header-anchor">#</a> 并行循环</h4> <h4 id="其他异步编程模式"><a href="#其他异步编程模式" class="header-anchor">#</a> 其他异步编程模式</h4> <h4 id="begininvoke-和-endinvoke"><a href="#begininvoke-和-endinvoke" class="header-anchor">#</a> BeginInvoke 和 EndInvoke</h4> <h4 id="计时器"><a href="#计时器" class="header-anchor">#</a> 计时器</h4> <h3 id="命名空间和程序集"><a href="#命名空间和程序集" class="header-anchor">#</a> 命名空间和程序集</h3> <p>在第一章中，我们在高层次上观察了编译过程。<u>编译器接受源代码文件并生成名称为程序集的输出文件</u>。这一章中，我们将详细阐述程序集以及它们是如何生成和部署的。你还会看到命名空间是如何帮助组织类型的。</p> <p>在迄今为止所看到的所有程序中，大部分都声明并使用它们自己的类。然而，在许多项目中，你会想使用来自其他程序集的类或类型。<u>这些其他的程序集可能来自 BCL，或来自一个第三方供应商，或你自己创建了它们。这些程序集称为类库，而且它们的程序集文件的名称通常以 <code>.dll</code> 扩展名结尾而不是 <code>.exe</code> 扩展名。</u></p> <p>例如，假设你想创建一个类库，它包含可以被其他程序集使用的类和类型。一个简单库的源代码如下面示例中所示，它包含在名称 SuperLib.cs 的文件中。该库含有单独一个名称为 <code>SquareWidget</code> 的公有类。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">JecyuLib</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SquareWidget</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">double</span></span> SideLength <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> Area
    <span class="token punctuation">{</span>
      <span class="token keyword">get</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">return</span> SideLength <span class="token operator">*</span> SideLength<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> SideLegth <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><code>SuperLib.cs</code> ➡️ C# 编译器 ➡️ SuperLib 程序集（SuperLib.dll）</p> <p>要使用 Visual Studio 创建类库，在已安装的 Windows 模版中创建类库模版。具体来说，在 Visual Studio 中进行的操作步骤如下。</p> <ol><li>选择 File➡New➡Project，然后会打开 New Project 窗口。</li> <li>左边的面板，在 Installed ➡ Templates 面板中找到 Visual C# 节点并选中。</li> <li>在中间的面板中选择 Class Library 模版。</li></ol> <h4 id="引用其他程序集"><a href="#引用其他程序集" class="header-anchor">#</a> 引用其他程序集</h4> <p>假设你还要写一个名称为 MyWidgets 的程序，想要使用 SquareWidget 类。程序的代码在一个名称为 MyWidget.cs 的文件中，如下面的示例所示。这段代码简单创建一个类型为 SquareWidget 的对象并使用该对象的成员。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">Program</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">SquareWidget</span> sq <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SquareWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 来自 SuperLib 类库</span>
      sq<span class="token punctuation">.</span>SideLength <span class="token operator">=</span> <span class="token number">5.0</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>sq<span class="token punctuation">.</span>Area<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>注意，这段代码没有声明类 SquareWidget。相反，使用的是定义在 SuperLib 的类。然而，当你编译 MyWidgets 程序时，编译器必须知道你的代码在使用程序集 SuperLib，这样它才能得到关于类 SquareWidget 的信息。要实现这点，需要给编译器一个到该程序集的引用，给出它的名称和位置。</p> <p>在 Visual Studio 中，可以用下面的方法把引用添加到项目。</p> <ul><li>选择 Solution Explorer，并在该项目名下找到 References 目录。References 目录包含项目使用的程序集的列表。</li> <li>右键单击 References 目录并选择 Add Reference。有 5 个可以从中选择的标签页，允许你以不同的方法找到类库。</li> <li>对于我们的程序，选择 Browser 标签，浏览到包含 SquareWidget 类定义的 DLL 文件，并选择它。</li> <li>点击 OK 按钮，引用就被加入到项目了。</li></ul> <p><img src="/Notebook/assets/img/refer-assembly.d86ca469.png" alt=""></p> <p>现在假设你的程序已经很好地用 SuqareWidget 类工作了，但你想扩展它的能力以使用一个名称为 CircleWidget 的类，它被定义在另一个名称为 UltraLib 的程序集中。MyWidgets 的源代码看上去像下面这样。它创建一个 SquareWidget 对象和一个 CircleWidget 对象，它们分别定义在 SuperLib 中和 UltraLib 中。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">class</span> <span class="token class-name">WidgetProgram</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">SquareWidget</span> q <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SquareWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 来自 SuperLib</span>
    <span class="token class-name">CircleWidget</span> circle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CircleWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 来自 UltralLib</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>类库 UltralLib 的源代码如下面的示例所示。注意，除了类 CircleWidget 之外，就像库 SuperLib，它还声明了一个名称为 SquareWidget 的类。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SquareWidget</span> <span class="token punctuation">{</span>
  <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CircleWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">double</span></span> Radius <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">double</span></span> Area <span class="token punctuation">{</span>
    <span class="token keyword">get</span> <span class="token punctuation">{</span><span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>因为两个库都含有名称 SquareWidget 的类，当你试图编译程序 MyWidgets 时，编译器产生一条错误消息，因为它不知掉使用类 SquareWidget 的哪个版本。</p> <h4 id="命名空间"><a href="#命名空间" class="header-anchor">#</a> 命名空间</h4> <p>在 MyWidget 示例中，由于你有源代码，你能通过在 SuperLib 源代码或 UltralLib 源代码仅仅改变 SquareWidget 类的名称来解决命名冲突。<u>但是，如果这些类是由不同的公司开发的，而且你还不能拥有源代码会怎么样呢？</u>假设 SuperLib 由一个名称为 MyCorp 的公司生产，UltralLib 由 ABCCorp 公司生产。在这种情况下，如果你使用任何有冲突的类或类型，你将不能把这两个库放在一起使用。</p> <p>但是，假设 MyCorp 有一个策略，让所有类的前缀都是公司名字加上类产品名和描述名。并且进一步假设 ABCCorp 也有相同的策略。这样的话，我们示例中的 3 个类名就可能是 MyCorpSquareWidget、ABCCorpSquareWidget 和 ABCCorpCircleWidget。</p> <p>但是，在我们的示例程序中，需要使用冗长的名字，看上去如下所示。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">class</span> <span class="token class-name">WidgetProgram</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">SquareWidget</span> q <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyCorpSquareWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 来自 SuperLib</span>
    <span class="token class-name">CircleWidget</span> circle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ABCCorpCircleWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 来自 UltralLib</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>尽管这可以解决冲突问题，但是即使有智能感知，这些新的、已消除歧义的名字还是难以阅读。</p> <p>不过，假设除了标识符中一般允许的字符，还可以在字符串中使用点——尽管不是在类名的最前面或最后面，那么这些名字就更好理解了，比如 MyCorp.SquareWidget。</p> <p><strong>这就给了我们命名空间名和命名空间的定义。</strong></p> <ul><li>你可以把命名空间视为一个字符串（在字符串中可以使用点），它加在类名或类型名的前面并且通过点进行分隔。</li> <li>包括命名空间名、分隔点，以及类名的完整字符串叫做类的完全限定名。</li> <li>命名空间是共享命名空间名的一组类和类型。</li></ul> <p>你可以使用命名空间垃圾把一组类型组织在一起并且给它们起一个名字。一般而言，命名空间名描述的是命名空间中包含的类型，并且和其他命名空间名不同。</p> <p><u>你可以通过在包含你的类型声明的源文件中声明命名空间，从而创建命名空间。</u>如下代码演示了声明命名空间的语法。然后在命名空间声明的大括号中声明牛的所有类和其他类型。那么这些类型就是这个命名空间的成员了。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">NamespaceName</span> <span class="token punctuation">{</span>
  TypeDeclaratiions
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="命名空间名称"><a href="#命名空间名称" class="header-anchor">#</a> 命名空间名称</h5> <p>如你所见，命名空间的名称可以包含创建该程序集的公司的名称。除了标识公司以外，该名称还用于帮助程序快速了解定义在命名空间内的类型的种类。</p> <p>关于命名空间名称的一些要点如下：</p> <ul><li>命名空间名称可以是任何有效标识符。</li> <li>另外，命名空间名称可以包含句点符号，用于把类型组织成层次。</li></ul> <p>下面是命名空间命名指南：</p> <ul><li>使用公司名开始命名空间名称；</li> <li>在公司名之后跟着技术名称；</li> <li>不要把命名命名为与类或类型相同的名称。</li></ul> <p>例如，Acme Widget 公司的软件开发部门在下面 3 个命名空间中开发软件，如下面的代码所示：</p> <ul><li>AcmeWidgets.SuperWidget</li> <li>AcmeWidgets.Media</li> <li>AcmeWigets.Games</li></ul> <h5 id="命名空间的补充"><a href="#命名空间的补充" class="header-anchor">#</a> 命名空间的补充</h5> <p>关于命名空间，有其他几个要点应该知道。</p> <ul><li>在命名空间内，每个类型名必须有别于所有其他类型。</li> <li><u>命名空间内的类型称为命名空间的成员。</u></li> <li>一个源文件可以包含任意数目的命名空间声明，可以顺序也可以嵌套。</li></ul> <p>.NET 框架 BCL 提供了数千个已定义的类和类型以供生成程序时选择。为了帮助组织这组有用的功能，相关功能的类型被声明在相同的命名空间里。BCL 使用超过 100 个命名空间来组织它的。类型。</p> <h5 id="命名空间跨文件扩展"><a href="#命名空间跨文件扩展" class="header-anchor">#</a> 命名空间跨文件扩展</h5> <p><u>命名空间不是封闭的。这意味着可以在源文件的后面或另一个源文件中再次声明它，以对它增加更多的类型声明。</u></p> <h5 id="嵌套命名空间"><a href="#嵌套命名空间" class="header-anchor">#</a> 嵌套命名空间</h5> <p>命名空间可以被嵌套，从而产生嵌套的命名空间。嵌套命名空间允许你创建类型的概念层次。有两种方法声明一个嵌套的命名空间，如下所示。</p> <ul><li>原文嵌套 可以把命名空间的声明放在一个封装的命名空间声明体内部，从而创建一个嵌套的命名空间。</li> <li>分离的声明 也可以为嵌套命名空间创建分离的声明，但必须在声明中使用它的完全限定名称。</li></ul> <p><img src="/Notebook/assets/img/Nested-namespaces.f81a5663.png" alt=""></p> <p><u>虽然嵌套命名空间位于父命名空间内部，但是其成员并不属于包裹的父命名空间。有一个常见的误区，认为既然嵌套的命名空间位于父命名空间内部，其成员也父命名空间的子集，这是不正确的，命名空间之间是相互独立的。</u></p> <h4 id="using-指令"><a href="#using-指令" class="header-anchor">#</a> using 指令</h4> <p>完全限定名可能相当长，在代码中通篇使用它们会变得十分乏味。然而，有两个编译器指令，可以使你避免不得不使用完全限定名：<code>using 命名空间指令和 using 别名指令</code>。</p> <p>关于 using 指令的两个要点如下：</p> <ul><li>它们必须放在源文件的顶端，在任何类型声明之前。</li> <li>它们应用于当前源文件的所有命名空间。</li></ul> <h5 id="using-命名空间指令"><a href="#using-命名空间指令" class="header-anchor">#</a> using 命名空间指令</h5> <p>using 命名空间指令通知编译器你将要使用来自某个指定命名空间的类型。然后你可以继续，并使用简单类名而不必全路径修饰它们。</p> <p>当编译器遇到一个不在当前命名空间的名称时，它检查在 using 命名空间指令中给出的命名空间列表，并把该未知名称加到列表中的第一个命名空间后面。如果结果完全限定名称匹配了这个程序集或引用程序集中的一个类，编译器将使用那个类。如果不匹配，那么它试验列表中下一个命名空间。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="using-别名指令"><a href="#using-别名指令" class="header-anchor">#</a> using 别名指令</h5> <p>using 别名指令允许起一个别名给：</p> <ul><li>命名空间；</li> <li>命名空间内的一个类型。</li></ul> <p>例如，下面的代码展示了两个 using 别名指令的使用。第一个指令告诉编译器标识符 Syst 是命名空间 System 的别名。第二个指令标识符 SC 是类 System.Console 的别名。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token class-name">Syst</span> <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token class-name">SC</span> <span class="token operator">=</span> <span class="token class-name">System<span class="token punctuation">.</span>Console</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="程序集的结构"><a href="#程序集的结构" class="header-anchor">#</a> 程序集的结构</h4> <p>如你在第 1 章看到的，程序就不包含本地机器代码，<u>而是公共中间语言代码。它还包含实时编译器（JIT）在运行时转换 CIL 到本机代码所需的一切，包括对它所引用的其他程序集的引用。</u></p> <p>程序集的文件扩展名通常为 .exe 或 .dll。</p> <p>大部分程序集由一个单独的文件构成。</p> <p><img src="/Notebook/assets/img/single-assembly-struct.cdacfa02.png" alt=""></p> <p>程序集代码文件称为模块。尽管大部分程序集由文件组成，但有些也有多个文件。对于有多个模块的程序集，一个文件是主模块（primary module），而其他的是次要模块（secondary modules）。</p> <ul><li>主模块含有程序集的清单和到次要模块的引用。</li> <li>次要模块的文件名以扩展名 .netmodule 的结尾。</li> <li>多文件程序集被视为一个单一单元。它们一起部署并一起定版。</li></ul> <p><img src="/Notebook/assets/img/multi-file-assembly.ec8d8533.png" alt=""></p> <h4 id="程序集标识符"><a href="#程序集标识符" class="header-anchor">#</a> 程序集标识符</h4> <p>在 .NET 框架中，程序集的文件名不像在其他操作系统和环境中那么重要，更重要的是程序集的标识符（identity）。</p> <p>程序集的标识符有 4 个组成部分，它们一起唯一标识了该程序集，如下所示。</p> <ul><li>简单名 这只是不带扩展名的文件名。每个程序集都有一个简单名。它也被称为程序集名或友好名称（friendly name）。</li> <li>版本号 它由 4 个句点分开的整数字符串组成，形式为 MajorVersion.MinorVersion.Buiild.Revisioin，例如 2.0.35.9。</li> <li>文化信息 它是一个字符串，由 2 ～ 5 个字符组成，代表一种语言，或代表一种语言和一个国家或地区。例如，在美国使用英语的文化名是 en-US。在德国使用德语，它是 de-DE。</li> <li>公钥 这个 128 字节字符串应该是生产该程序集的公司唯一的。</li></ul> <h4 id="强命名程序集"><a href="#强命名程序集" class="header-anchor">#</a> 强命名程序集</h4> <p><u>强命名（strongly named）程序集有一个唯一的数字签名依附于它。</u>强命名程序集比没有强名称的程序集更加安全，原因有以下几点：</p> <ul><li>强名称唯一标识了程序集。没有其他人能创建一个与之有相同名称的程序集，所以用户可以确信该程序集来自于其声称的来源。</li> <li>没有 CLR 安全组件来捕获更改，带强名称的程序集的内容不能被改变。</li></ul> <p>程序员不产生强名称。编译器产生它，接受关于程序集的信息，并散列化这些信息以创建一个唯一的数据签名依附到该程序集。它在散列处理中使用的信息如下：</p> <ul><li>组成程序集的字节序列；</li> <li>简单名称；</li> <li>版本号；</li> <li>文化信息；</li> <li>公钥/私钥对。</li></ul> <h5 id="创建强命名程序集"><a href="#创建强命名程序集" class="header-anchor">#</a> 创建强命名程序集</h5> <p>要使用 Visual Studio 强命名一个程序集，必须有一份公钥/私钥对文件的副本。如果没有密钥文件，可以让 Visual Studio 产生一个。可以实行以下步骤。</p> <ol><li>打开工程的属性。</li> <li>选择签名页。</li> <li>选择 Sign the Assembly 复选框并输入密钥文件的位置或创建一个新的。</li></ol> <p>在编译代码时，编译器会生存一个强命名的程序集。</p> <p><img src="/Notebook/assets/img/create-strongly-named-assembly.9935e015.png" alt=""></p> <h4 id="程序集的私有方式部署"><a href="#程序集的私有方式部署" class="header-anchor">#</a> 程序集的私有方式部署</h4> <p>在目标机器上部署一个程序就像在该机器上创建一个目录并把应用程序复制过去一样简单。如果应用程序不需要其他程序集（比如 DLL），或如果所需的 DLL 在同一目录下，那么程序应该会就在它所在的地方良好工作。<u>这种方法部署的程序集称为<code>私有程序集</code>，而且这种部署方法称为复制文件（XCopy）部署。</u></p> <p>私有程序集几乎可以被放在任何目录中，而且只要它们依赖的文件都在同一目录或子目录下几句足够了。事实上，可以在文件系统的不同部分有多个目录，每个目录都有同样的一组程序集，并且它们都会各自不同的围追良好工作。</p> <p>关于私有程序集部署的一些重要事情如下：</p> <ul><li>私有程序集所在的目录被称为应用程序目录。</li> <li>私有程序集可以是强命名的也可以是弱命名的。</li> <li>没有必要在注册表中注册组件。</li> <li>要卸载一个私有程序集，只要从文件系统中删除它即可。</li></ul> <h4 id="共享程序集和-gac"><a href="#共享程序集和-gac" class="header-anchor">#</a> 共享程序集和 GAC</h4> <p>私有程序集是非常有用的，但有时你会想把一个 DLL 放在一个中心位置，这样一个单独的复制就能被系统中其他的程序集共享。<u>.NET 有这样的贮藏库，称为全局程序集缓存（GAC）。放进 GAC 的程序集称为共享程序集。</u></p> <p>关于 GAC 的一些重要内容如下：</p> <ul><li>只有强命名程序集能被添加到 GAC。</li> <li>GAC 的早期版本支接受带 .dll 扩展名的文件，现在也可以添加带 .exe 扩展名的程序集了。</li> <li>GAC 位于 Windows 系统目录的子目录中。.NET 4.0 之前位于 \Windows\Assembly 中，从 .NET 4.0 开始位于 \Windows\Microsoft.NET\assembly 中。</li></ul> <h5 id="把程序集安装-gac"><a href="#把程序集安装-gac" class="header-anchor">#</a> 把程序集安装 GAC</h5> <p>当试图安装一个程序集到 GAC 时，CLR 的安全组件首先必须检验程序集上的数字签名是否有效。如果没有数据签名，或它是无效，系统将不会把它安装到 GAC。</p> <p><code>gacutil.exe</code> 命名行工具允许从 GAC 添加或删除程序集，并列出 GAC 包含的程序集。它的 3 个最有用的参数标记如下所示：</p> <ul><li>/i：把一个程序集插入 GAC。</li> <li>/u：从 GAC 卸载一个程序集。</li> <li>/l：列出 GAC 中的程序集。</li></ul> <h5 id="gac-内的并肩执行"><a href="#gac-内的并肩执行" class="header-anchor">#</a> GAC 内的并肩执行</h5> <p>在程序集部署到 GAC 之后，它就能被系统中其他程序集使用了。然而，请记住程序集的标识符由完全限定名称的全部 4 个部分组成。所以，如果一个库的版本号改变了，或如果它有一个不同的程序集。</p> <p>结果就是在 GAC 中可以有许多不同的程序集，它们把相同的文件名。虽然它们有相同的文件名，但它们是不同的程序集而且在 GAC 中完美地共存。<u>这使不同的应用程序在同一时间很容易使用不同版本的同一 DLL，因为它们是带不同标识符的不同程序集。这就被称为并肩执行（side-by-side Execution）</u>。</p> <h4 id="配置文件"><a href="#配置文件" class="header-anchor">#</a> 配置文件</h4> <p>配置文件含有关于应用程序的信息，供 CLR 在运行时使用。它们可以指示 CLR 去做这样的事情，比如使用一个不同版本的 DLL，或搜索程序引用的 DLL 时在附加目录中寻找。</p> <p><u>配置文件由 XML 代码组成，并不包含 C# 代码。</u>它们的一种用途是更新一个应用程序集以使用新版本的 DLL。</p> <p>例如，假设有一个应用程序引用了 GAC 中的一个 DLL。在应用程序的清单中，该引用的标识符必须完全匹配 GAC 中。如果一个新版本的 DLL 发布了，它可以被添加到 GAC 中，在那里它可以幸福和老版本共存。</p> <p><u>然而，如果你不想重新编译程序但又希望它使用新的 DLL，那么你就可以创建一个配追文件告诉 CLR 去使用新的版本而不是旧版本。配置文件被放在应用程序目录中。</u></p> <h4 id="延迟签名"><a href="#延迟签名" class="header-anchor">#</a> 延迟签名</h4> <p>公司小心地保护它们官方的<code>公钥/私钥对</code>是非常重要的，否则，如果不可靠的人得到了它，就可以发布伪装成该公司的代码。为了避免这种情况公司显然不能允许自由访问含有它们的<code>公钥/私钥对</code>的文件。<strong>在大公司中，最终程序集的强命名经常在开发过程的最尾部由特殊的有密钥访问权限的小组执行。</strong></p> <p>可是，由于个别原因，这会在开发和测试过程中导致问题。首先，由于公钥是程序集标识符的 4 个部分之一，所以直到提供了公钥它才能被设置。而且，弱命名的程序集不能被部署到 GAC。开发人员和测试人员都需要有能流编译和测试该代码，并使用它将要被部署发布的方式，包括它的标识符和在 GAC 中的位置。</p> <p><u>为了允许这个，有一种修改了的赋值强命名的形式，称为延迟签名（delayed signing）或部分签名（partial signing），它克服了这些问题，而且没有释放过对私钥的访问。</u></p> <p><img src="/Notebook/assets/img/signing-in-different-assembly.b70beedb.png" alt=""></p> <h3 id="异常"><a href="#异常" class="header-anchor">#</a> 异常</h3> <h4 id="什么是异常"><a href="#什么是异常" class="header-anchor">#</a> 什么是异常</h4> <p><u>异常是程序中的运行时错误，它违反了系统约束或应用程序约束，或出现了在正常操作时未预料的情形。</u>例如，程序试图除以 0 或试图写出一个只读文件。当这些发生后，系统捕获这个错误，并抛出一个异常：</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuException</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">Program</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">int</span></span> x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
      <span class="token class-name"><span class="token keyword">int</span></span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      x <span class="token operator">/=</span> y<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 异常信息：</span>
<span class="token comment">// Unhandled Exception:</span>
<span class="token comment">// System.DivideByZeroException: Attempted to divide by zero.</span>
<span class="token comment">//   at classdemo.JecyuException.Program.main () [0x00006] in /Users/linjy/Documents/Developer/Game-Development/Learn-C-Sharp-Demo/start/class-demo/JecyuException/Exception1.cs:10</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="try-语句"><a href="#try-语句" class="header-anchor">#</a> try 语句</h4> <p><u>try 语句用来指明为避免出现异常而被保存的代码段，并在发生异常时提供代码处理异常。</u>try 语句由 3 个部分组成，如图 22-1 所示。</p> <ul><li>try 块包含为避免出现异常而被保护的代码。</li> <li>catch 子句部分含有一个或多个 catch 子句。这些是处理异常的代码段，它们也称为是异常处理程序。</li> <li>finally 块含有在所有情况下都要被执行的代码，无论有没有异常发生。</li></ul> <p><img src="/Notebook/assets/img/try-statement-struct.ab57cabc.png" alt=""></p> <h5 id="处理异常"><a href="#处理异常" class="header-anchor">#</a> 处理异常</h5> <p>前面的示例显示了除以 0 会导致一个异常。可以修改此程序，把那段代码放在一个 try 块中，并提供一个简单的 catch 子句，以处理该异常。当异常发生时，它被捕获并在 catch 块中处理。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuException</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">Program2</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">int</span></span> x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
      <span class="token keyword">try</span>
      <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">int</span></span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        x <span class="token operator">/=</span> y<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">catch</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Handing all exception - Keep on Running.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 输出</span>
<span class="token comment">// Handing all exception - Keep on Running.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h4 id="异常类"><a href="#异常类" class="header-anchor">#</a> 异常类</h4> <p>有许多不同类型的异常可以在程序中发生。BCL 定义了许多类，每一个类代表一个指定的异常类型。当一个异常发生时，CLR：</p> <ul><li>创建该类型的异常对象；</li> <li>寻找适当的 catch 子句以处理它。</li></ul> <p>![](../.vuepress/public/images/c-sharp-exception-hierarchy.png)</p> <p>异常对象含有只读属性，带有导致该异常的信息。这些属性的其中一些如表所示。</p> <table><thead><tr><th>属性</th> <th>类型</th> <th>描述</th></tr></thead> <tbody><tr><td>Message</td> <td>string</td> <td>这个属性含有解释异常原因的信息</td></tr> <tr><td>StackTrace</td> <td>string</td> <td>这个属性含有描述异常发生在何处的信息</td></tr> <tr><td>InnerException</td> <td>Exception</td> <td>如果当前异常是由另一个异常引起的，这个属性包含前一个异常的引用</td></tr> <tr><td>HelpLink</td> <td>string</td> <td>这个属性可以被应用程序定义的异常设置，为异常原因信息及提供 URN 或 URL</td></tr> <tr><td>Source</td> <td>string</td> <td>如果没有被应用程序定义的异常设定，那么这个属性含有异常所在的成许久的名称</td></tr></tbody></table> <h4 id="catch-子句"><a href="#catch-子句" class="header-anchor">#</a> catch 子句</h4> <p>catch 子句处理异常。它有 3 种形式，允许不同级别的处理。</p> <p><img src="/Notebook/assets/img/catch-statement-style.b81304ae.png" alt=""></p> <h4 id="使用特定-catch-子句的示例"><a href="#使用特定-catch-子句的示例" class="header-anchor">#</a> 使用特定 catch 子句的示例</h4> <p>回到除以 0 的示例，下面的代码把前面的 catch 子句修改为指定处理 DivideByZeroException 类的异常。在前面的示例中，catch 子句会处理所在 try 块中引起的任何异常，而这个示例将只处理 DivideByZeroException 类的异常。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// try...catch 处理异常</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuException</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">Program3</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">int</span></span> x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
      <span class="token keyword">try</span>
      <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">int</span></span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        x <span class="token operator">/=</span> y<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">DivideByZeroException</span> e<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Message: {0}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Source: {0}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>Source<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Stack: {0}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>StackTrace<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">finally</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;In finally statement.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h4 id="catch-子句段"><a href="#catch-子句段" class="header-anchor">#</a> catch 子句段</h4> <p>catch 子句的目的是允许你以一种优雅的方式处理异常。如果你的 catch 子句接受一个参数，那么系统会把这个异常变量设置为异常对象，这样你就可以检查并确定异常的原因。如果异常是前一个异常引起的，你可以通过异常变量的 InnerException 属性来获得对前一个异常对象的引用。</p> <p>catch 子句段可以包含多个 catch 子句。</p> <p>当异常发生时，系统按顺序搜索 catch 子句的列表，第一个匹配该异常对象类型的 catch 子句被执行。因此，catch 子句的排序有两个重要的规则。具体如下。、</p> <ul><li>特定 catch 子句必须以一种顺序排列，最明确的异常类型第一，直到最普通的类型。例如，如果声明了一个派生自 NullReferenceException 的异常类，那么派生异常类型的 catch 子句应该被列在 NullReferenceException 的 catch 子句之前。</li> <li><u>如果有一个一般 catch 子句，它必须是最后一个，并且在所有特定 catch 子句之后。</u>不鼓励使用一般 catch 子句，因为它允许程序继续执行隐藏错误，让程序处于一种未知的状态。应尽可能使用特定子句。</li></ul> <p><img src="/Notebook/assets/img/catch-child-statement.e4e8bf06.png" alt=""></p> <h4 id="finally-块"><a href="#finally-块" class="header-anchor">#</a> finally 块</h4> <p>如果程序的控制流进入了一个带 finally 块的 try 语句，那么 finally 始终会被执行。</p> <ul><li>如果在 try 块内部没有异常发生，那么在 try 块的结尾，控制流跳过任何 catch 子句并到 finally 块。</li> <li>如果在 try 块内部发生了异常，那么在 catch 子句段中无论哪一个适当的 catch 子句被执行，接着就是 finally 块的执行。</li></ul> <p>即使 try 块中有 return 语句或在 catch 块中抛出一个异常，finally 块也总是会在返回到调用代码之前执行。</p> <h4 id="为异常寻找处理代码"><a href="#为异常寻找处理代码" class="header-anchor">#</a> 为异常寻找处理代码</h4> <p>当程序产生一个异常时，系统查看该程序是否为它提供了一个处理代码。</p> <ul><li>如果在 try 块内发生了异常，系统会查看是否有任何一个 catch 子句能处理该异常。</li> <li>如果找到了适当的 catch 子句，以下 3 项的 1 项会发生。
<ul><li>该 catch 子句被执行。</li> <li>如果有 finally 块，那么它被执行。</li> <li>执行在 try 语句的尾部继续（也就是说，在 finally 块之后，或如果没有 finally 块，就在最后一个 catch 子句之后。）</li></ul></li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// try...catch 处理异常</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuException</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">Program3</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">int</span></span> x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
      <span class="token keyword">try</span>
      <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">int</span></span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        x <span class="token operator">/=</span> y<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">DivideByZeroException</span> e<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Message: {0}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Source: {0}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>Source<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Stack: {0}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>StackTrace<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">finally</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;In finally statement.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h4 id="更进一步搜索"><a href="#更进一步搜索" class="header-anchor">#</a> 更进一步搜索</h4> <p>如果异常在一个没有被 try 语句保护的代码段产生，或如果 try 语句没有匹配的异常处理程序，系统将不得不更进一步寻找匹配的处理代码。为此它会按顺序搜索调用栈，以看看是否存在带匹配的处理程序的封装 try 块。</p> <p><img src="/Notebook/assets/img/c-sharp-exception-handle.a101c5f7.png" alt=""></p> <h5 id="搜索调用栈的示例"><a href="#搜索调用栈的示例" class="header-anchor">#</a> 搜索调用栈的示例</h5> <p>在下面的代码中，Main 开始执行并调用方法 A，A 调用方法 B。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// try...catch 处理异常，搜索调用栈</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuException</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">MyClass</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">try</span>
      <span class="token punctuation">{</span>
        <span class="token function">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">System<span class="token punctuation">.</span>NullReferenceException</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;catch clause in A()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">finally</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;finally clause in A()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">int</span></span> x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">try</span>
      <span class="token punctuation">{</span>
        x <span class="token operator">/=</span> y<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">System<span class="token punctuation">.</span>IndexOutOfRangeException</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;catch clause in B()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">finally</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;finally clause in B()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program4</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">MyClass</span> mc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">try</span>
      <span class="token punctuation">{</span>
        mc<span class="token punctuation">.</span><span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">DivideByZeroException</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;catch clause in Main()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">finally</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;finally clause in Main()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;After try statement in Main.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;   --keep running.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 输出</span>
<span class="token comment">// finally clause in B()</span>
<span class="token comment">// finally clause in A()</span>
<span class="token comment">// catch clause in Main()</span>
<span class="token comment">// finally clause in Main()</span>
<span class="token comment">// After try statement in Main.</span>
<span class="token comment">//    --keep running.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><h4 id="抛出异常"><a href="#抛出异常" class="header-anchor">#</a> 抛出异常</h4> <p>可以使用 <code>throw</code> 语句使代码显式地引发一个异常。<code>throw</code> 语句的语法如下：
<code>throw ExceptionObject</code></p> <p>例如，下面的代码定义了一个名称为 PrintArg 的方法，它带一个 string 参数并把它打印出来。在 try 块内部，它首先检查以确认该参数不是 null。如果是 null，它创建一个 ArgumentNullException 实例并抛出它。该异常实例在 catch 语句中被捕获，并且该出错信息被打印。Main 调用该方法两次：一次用 null 参数，然后用一个有效参数。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 抛出异常</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuException</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">MyClass2</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PrintArg</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> arg<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">try</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>arg <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
          <span class="token class-name">ArgumentNullException</span> myEx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentNullException</span><span class="token punctuation">(</span><span class="token string">&quot;arg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">throw</span> myEx<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ArgumentNullException</span> e<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Message: {0}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program5</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">string</span></span> s <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      MyClass2<span class="token punctuation">.</span><span class="token function">PrintArg</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
      MyClass2<span class="token punctuation">.</span><span class="token function">PrintArg</span><span class="token punctuation">(</span><span class="token string">&quot;Hi there!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h4 id="不带异常对象的抛出"><a href="#不带异常对象的抛出" class="header-anchor">#</a> 不带异常对象的抛出</h4> <p><code>throw</code> 语句还可以不带异常对象使用，在 catch 块内部。</p> <ul><li>这种形式重新抛出当前异常，系统继续它的搜索，为该异常寻找另外的处理代码。</li> <li>这种形式只能用在 catch 语句内部。</li></ul> <p>例如，下面的代码从第一个 catch 子句内部重新抛出异常；</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 抛出异常</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuException</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">MyClass3</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PrintArg</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> arg<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">try</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">try</span>
        <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>arg <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
          <span class="token punctuation">{</span>
            <span class="token class-name">ArgumentNullException</span> myEx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentNullException</span><span class="token punctuation">(</span><span class="token string">&quot;arg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> myEx<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ArgumentNullException</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
          Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;inner catch: {0}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">throw</span><span class="token punctuation">;</span> <span class="token comment">// 重新抛出异常，没有附加参数</span>
        <span class="token punctuation">}</span>

      <span class="token punctuation">}</span>
      <span class="token keyword">catch</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Outer Catch: Handling an Exception.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program6</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">string</span></span> s <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      MyClass3<span class="token punctuation">.</span><span class="token function">PrintArg</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 输出</span>
<span class="token comment">// inner catch: Value cannot be null.</span>
<span class="token comment">// Parameter name: arg</span>
<span class="token comment">// Outer Catch: Handling an Exception.</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h3 id="预处理指令"><a href="#预处理指令" class="header-anchor">#</a> 预处理指令</h3> <p>源代码指定了程序的定义，预处理指令（preprocessor directive）指示编译器如何处理源代码。</p> <h4 id="什么是预处理指令"><a href="#什么是预处理指令" class="header-anchor">#</a> 什么是预处理指令</h4> <h4 id="基本规则"><a href="#基本规则" class="header-anchor">#</a> 基本规则</h4> <h4 id="define-和-undef-指令"><a href="#define-和-undef-指令" class="header-anchor">#</a> #define 和 #undef 指令</h4> <h4 id="条件编译"><a href="#条件编译" class="header-anchor">#</a> 条件编译</h4> <h4 id="诊断指令"><a href="#诊断指令" class="header-anchor">#</a> 诊断指令</h4> <h4 id="行号指令"><a href="#行号指令" class="header-anchor">#</a> 行号指令</h4> <h4 id="区域指令"><a href="#区域指令" class="header-anchor">#</a> 区域指令</h4> <h4 id="pragma-warning-指令"><a href="#pragma-warning-指令" class="header-anchor">#</a> #pragma warning 指令</h4> <h3 id="反射和特性"><a href="#反射和特性" class="header-anchor">#</a> 反射和特性</h3> <h4 id="元数据和反射"><a href="#元数据和反射" class="header-anchor">#</a> 元数据和反射</h4> <p>大多数程序都要处理数据，包括读、写、操作和显示数据。（图形也是一种数据的形式。）然而，对于某些程序来说，它们操作的数据不是数字、文本或图形，而是程序和程序类型本身的信息。</p> <h4 id="type-类"><a href="#type-类" class="header-anchor">#</a> Type 类</h4> <h4 id="获取-type-对象"><a href="#获取-type-对象" class="header-anchor">#</a> 获取 Type 对象</h4> <h4 id="什么是特性"><a href="#什么是特性" class="header-anchor">#</a> 什么是特性</h4> <h4 id="应用特性"><a href="#应用特性" class="header-anchor">#</a> 应用特性</h4> <h4 id="预定义的保留的特性"><a href="#预定义的保留的特性" class="header-anchor">#</a> 预定义的保留的特性</h4> <h4 id="有关应用特性的更多内容"><a href="#有关应用特性的更多内容" class="header-anchor">#</a> 有关应用特性的更多内容</h4> <h4 id="自定义特性"><a href="#自定义特性" class="header-anchor">#</a> 自定义特性</h4> <h4 id="访问特性"><a href="#访问特性" class="header-anchor">#</a> 访问特性</h4> <h3 id="其他主题"><a href="#其他主题" class="header-anchor">#</a> 其他主题</h3> <h4 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h4> <h4 id="字符串"><a href="#字符串" class="header-anchor">#</a> 字符串</h4> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 字符串</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuOther</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">string</span></span> s1 <span class="token operator">=</span> <span class="token string">&quot;hi there! this, is: a string.&quot;</span><span class="token punctuation">;</span>
      <span class="token class-name"><span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> delimiters <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string character">' '</span><span class="token punctuation">,</span> <span class="token string character">'!'</span><span class="token punctuation">,</span> <span class="token string character">','</span><span class="token punctuation">,</span> <span class="token string character">':'</span><span class="token punctuation">,</span> <span class="token string character">'.'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> words <span class="token operator">=</span> s1<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span>delimiters<span class="token punctuation">,</span> StringSplitOptions<span class="token punctuation">.</span>RemoveEmptyEntries<span class="token punctuation">)</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Word Count: {0}\n\rThe Words...&quot;</span><span class="token punctuation">,</span> words<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> s <span class="token keyword">in</span> words<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot; {0}&quot;</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="使用-stringbuilder-类"><a href="#使用-stringbuilder-类" class="header-anchor">#</a> 使用 StringBuilder 类</h4> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 字符串</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuOther</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program2</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token string">&quot;Hi there.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0}&quot;</span><span class="token punctuation">,</span> sb<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      sb<span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">&quot;Hi&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 替换子字符串</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0}&quot;</span><span class="token punctuation">,</span> sb<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="把字符串解析为数据值"><a href="#把字符串解析为数据值" class="header-anchor">#</a> 把字符串解析为数据值</h4> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 把字符串解析为数据值</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuOther</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program3</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">string</span></span> s1 <span class="token operator">=</span> <span class="token string">&quot;25.873&quot;</span><span class="token punctuation">;</span>
      <span class="token class-name"><span class="token keyword">string</span></span> s2 <span class="token operator">=</span> <span class="token string">&quot;36.240&quot;</span><span class="token punctuation">;</span>

      <span class="token class-name"><span class="token keyword">double</span></span> d1 <span class="token operator">=</span> <span class="token keyword">double</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name"><span class="token keyword">double</span></span> d2 <span class="token operator">=</span> <span class="token keyword">double</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token class-name"><span class="token keyword">double</span></span> total <span class="token operator">=</span> d1 <span class="token operator">+</span> d2<span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Total: {0}&quot;</span><span class="token punctuation">,</span> total<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 把字符串解析为数据值 TryParse</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuOther</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program4</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name"><span class="token keyword">string</span></span> parseResultSummary<span class="token punctuation">;</span>
      <span class="token class-name"><span class="token keyword">string</span></span> stringFirst <span class="token operator">=</span> <span class="token string">&quot;28&quot;</span><span class="token punctuation">;</span>
      <span class="token class-name"><span class="token keyword">int</span></span> intFirst<span class="token punctuation">;</span>

      <span class="token class-name"><span class="token keyword">bool</span></span> success <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token function">TryParse</span><span class="token punctuation">(</span>stringFirst<span class="token punctuation">,</span> <span class="token keyword">out</span> intFirst<span class="token punctuation">)</span><span class="token punctuation">;</span>
      parseResultSummary <span class="token operator">=</span> success
                             <span class="token punctuation">?</span> <span class="token string">&quot;was successfully parsed&quot;</span>
                             <span class="token punctuation">:</span> <span class="token string">&quot;was not successfully parsed&quot;</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;String {0} {1}&quot;</span><span class="token punctuation">,</span> stringFirst<span class="token punctuation">,</span> parseResultSummary<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token class-name"><span class="token keyword">string</span></span> stringSecond <span class="token operator">=</span> <span class="token string">&quot;vt750&quot;</span><span class="token punctuation">;</span>
      <span class="token class-name"><span class="token keyword">int</span></span> intSecond<span class="token punctuation">;</span>
      success <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token function">TryParse</span><span class="token punctuation">(</span>stringSecond<span class="token punctuation">,</span> <span class="token keyword">out</span> intSecond<span class="token punctuation">)</span><span class="token punctuation">;</span>
      parseResultSummary <span class="token operator">=</span> success
                            <span class="token punctuation">?</span> <span class="token string">&quot;was successfully parsed&quot;</span>
                            <span class="token punctuation">:</span> <span class="token string">&quot;was not successfully parsed&quot;</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;String {0} {1}&quot;</span><span class="token punctuation">,</span> stringSecond<span class="token punctuation">,</span> parseResultSummary<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h4 id="关于可空类型的更多内容"><a href="#关于可空类型的更多内容" class="header-anchor">#</a> 关于可空类型的更多内容</h4> <h5 id="为可空类型赋值"><a href="#为可空类型赋值" class="header-anchor">#</a> 为可空类型赋值</h5> <h5 id="使用空接合运算符"><a href="#使用空接合运算符" class="header-anchor">#</a> 使用空接合运算符</h5> <h5 id="使用可空用户自定义类型"><a href="#使用可空用户自定义类型" class="header-anchor">#</a> 使用可空用户自定义类型</h5> <h4 id="main-方法"><a href="#main-方法" class="header-anchor">#</a> Main 方法</h4> <h4 id="文档注释"><a href="#文档注释" class="header-anchor">#</a> 文档注释</h4> <h4 id="嵌套类型"><a href="#嵌套类型" class="header-anchor">#</a> 嵌套类型</h4> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 嵌套类的示例</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuOther</span>
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">MyClass</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">class</span> <span class="token class-name">MyCounter</span> <span class="token comment">// 嵌套类</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Count
      <span class="token punctuation">{</span>
        <span class="token keyword">get</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">public</span> <span class="token keyword">static</span> MyCounter <span class="token keyword">operator</span> <span class="token operator">++</span><span class="token punctuation">(</span><span class="token class-name">MyCounter</span> current<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        current<span class="token punctuation">.</span>Count<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> current<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token class-name">MyCounter</span> counter<span class="token punctuation">;</span> <span class="token comment">// 嵌套类类型的字段</span>
    <span class="token keyword">public</span> <span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 构造函数</span>
    <span class="token punctuation">{</span>
      counter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 增量方法</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">Incr</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>counter<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 获取计数值</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">GetValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> counter<span class="token punctuation">.</span>Count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">class</span> <span class="token class-name">Program5</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">MyClass</span> mc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      mc<span class="token punctuation">.</span><span class="token function">Incr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      mc<span class="token punctuation">.</span><span class="token function">Incr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      mc<span class="token punctuation">.</span><span class="token function">Incr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      mc<span class="token punctuation">.</span><span class="token function">Incr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      mc<span class="token punctuation">.</span><span class="token function">Incr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      mc<span class="token punctuation">.</span><span class="token function">Incr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Total: {0}&quot;</span><span class="token punctuation">,</span> mc<span class="token punctuation">.</span><span class="token function">GetValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><h4 id="析构函数和处置模式"><a href="#析构函数和处置模式" class="header-anchor">#</a> 析构函数和处置模式</h4> <h4 id="和-com-的互操作"><a href="#和-com-的互操作" class="header-anchor">#</a> 和 COM 的互操作</h4> <h2 id="单元测试"><a href="#单元测试" class="header-anchor">#</a> 单元测试</h2> <p>版本：8.6.3</p> <ol><li><p>创建 MSTest 项目。
使用 .NET-Core 创建的项目，只能使用 .Net-Core 的单元测试项目。否则使用普通的测试项目。</p></li> <li><p>在单元测试项目引用需要测试的项目程序集，右键项目-&gt; 添加引用 -&gt; 勾选程序集。</p></li></ol> <p><img src="/Notebook/assets/img/2020-06-17-14-20-38-visual-studio-unit-test.c598bf98.png" alt=""></p> <ol start="3"><li>编写单元测试类</li></ol> <ul><li>测试方法要求
<ul><li>使用 <code>[TestMethod]</code> 特性进行修饰。</li> <li>它将返回 void。</li> <li>它不能含有参数。</li> <li>非静态方法</li></ul></li></ul> <p>被测试的类，必须带有 Main 静态方法作为入口（ C# 程序的 入口点。Main 方法说明当执行时 类将做什么动作），这个后续研究为什么被引用的类还需要 Main。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">/*
 * 单例模式
 */</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">Design<span class="token punctuation">.</span>Patterns</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> uniqueInstance<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token function">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">Singleton</span> <span class="token function">GetSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>uniqueInstance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        uniqueInstance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> uniqueInstance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Say</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, I am Singleton.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>单元测试用例</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>VisualStudio<span class="token punctuation">.</span>TestTools<span class="token punctuation">.</span>UnitTesting</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Design<span class="token punctuation">.</span>Patterns</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">UnitTest<span class="token punctuation">.</span>DegisnTests</span>
<span class="token punctuation">{</span>
  <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">TestClass</span></span><span class="token punctuation">]</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SingletonDemo01Test</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">SingletonDemo01Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">TestMethod</span></span><span class="token punctuation">]</span> <span class="token comment">// 测试用例</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">TestMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token class-name">Singleton</span> singleton1 <span class="token operator">=</span> Singleton<span class="token punctuation">.</span><span class="token function">GetSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">Singleton</span> singleton2 <span class="token operator">=</span> Singleton<span class="token punctuation">.</span><span class="token function">GetSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Assert<span class="token punctuation">.</span><span class="token function">ReferenceEquals</span><span class="token punctuation">(</span>singleton1<span class="token punctuation">,</span> singleton2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><ol start="4"><li>启动单元测试，打开查看 -&gt; 测试，之后会打开侧边栏，点击运行所有测试或调试所有测试。</li></ol> <p>可以运行全部的测试文件，也可以单个测试。</p> <p><img src="/Notebook/assets/img/2020-06-17-15-30-14visual-studio-test-02.b1aaa8e2.png" alt=""></p> <h2 id="基础（中级）"><a href="#基础（中级）" class="header-anchor">#</a> 基础（中级）</h2> <h3 id="协程"><a href="#协程" class="header-anchor">#</a> 协程</h3> <ul><li>https://blog.csdn.net/a_little_a_day/article/details/78519265</li> <li><a href="https://gameinstitute.qq.com/community/detail/117921" target="_blank" rel="noopener noreferrer">C#之 Coroutine<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>协程：协同程序，在主程序运行的同时，开启另外一段逻辑处理，来协同当前程序的执行。</p> <p>开启协程的两种方式</p> <p>1、StartCoroutine(string methodName)</p> <p>注意：</p> <p>(1)、参数是方法名(字符串类型)，此方法可以包含一个参数</p> <p>(2)、形参方法可以有返回值</p> <p>2、StartCoroutine（IEnumerator method)</p> <p>(1)、参数是方法名(TestMethod()),方法中可以包含多个参数</p> <p>(2)、IEnumrator 类型的方法不能含有 <code>ref</code> 或者 <code>out</code> 类型的参数，但可以含有被传递的引用</p> <p>(3)、必须有有返回值，且返回值类型为 IEnumrator,返回值使用（yield retuen + 表达式或者值，或者 yield break）语句</p> <p>终止协程的两种方式：</p> <p>StopCoroutine (string methodName)，只能终止指定的协程</p> <p>使用时注意：</p> <p>在程序中调用 StopCoroutine() 方法只能终止以字符串形式启动的协程</p> <ul><li>yield：挂起，程序遇到 yield 关键字时会被挂起，暂停执行，等待条件满足时从当前位置继续执行</li> <li><code>yield return 0 or yield return null</code>：程序在下一帧中从当前位置继续执行`</li> <li><code>yield return 1，2，3</code>,......: 程序等待 1，2，3...帧之后从当前位置继续执行</li> <li><code>yield return new WaitForSeconds(n)</code>: 程序等待 n 秒后从当前位置继续执行。</li> <li><code>yield new WaitForEndOfFrame()</code>：在所有的渲染以及 GUI 程序执行完成后从当前位置继续执行</li> <li><code>yield new WaitForFixedUpdate()</code>：所有脚本中的 FixedUpdate()函数都被执行后从当前位置继续执行</li> <li>yield return WWW:等待一个网络请求完成后从当前位置继续执行</li> <li><code>yield return StartCoroutine()</code>:等待一个协程执行完成后从当前位置继续执行</li> <li>yield break
如果使用 yield break 语句，将会导致协程的执行条件不被满足，不会从当前的位置继续执行程序，而是直接从当前位置跳出函数体，回到函数的根部</li></ul> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">CardRevealed</span><span class="token punctuation">(</span><span class="token class-name">MemoryCard</span> card<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// 将卡片对象存储在两个卡片变量的一个中，这取决于第一个变量是否已经被占用。</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_firstRevealed <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      _firstRevealed <span class="token operator">=</span> card<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
      _secondRevealed <span class="token operator">=</span> card<span class="token punctuation">;</span>
      <span class="token comment">// 比较两个翻开卡片的 ID</span>
      Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">&quot;Match ?&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>_firstRevealed<span class="token punctuation">.</span>id <span class="token operator">==</span> _secondRevealed<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">StartCoroutine</span><span class="token punctuation">(</span><span class="token function">CheckMatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 当两张卡片都显示时调用协程</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">private</span> <span class="token return-type class-name">IEnumerator</span> <span class="token function">CheckMatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_firstRevealed<span class="token punctuation">.</span>id <span class="token operator">==</span> _secondRevealed<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      _score<span class="token operator">++</span><span class="token punctuation">;</span>
      Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">&quot;Score：&quot;</span> <span class="token operator">+</span> _score<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WaitForSeconds</span><span class="token punctuation">(</span><span class="token number">0.5f</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 如果卡片不匹配则不翻开</span>
      _firstRevealed<span class="token punctuation">.</span><span class="token function">Unreveal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      _secondRevealed<span class="token punctuation">.</span><span class="token function">Unreveal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 不管是否匹配，都清除变量</span>
    _firstRevealed <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    _secondRevealed <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>在处理长时间异步操作（例如等待 HTTP 传输、资源加载或文件 I/O 完成）时，最适合使用协程。</p> <h3 id="override-和-overload-以及-new-修饰符"><a href="#override-和-overload-以及-new-修饰符" class="header-anchor">#</a> override 和 overload 以及 new 修饰符</h3> <p>C# 支持重写实例方法和属性，但不支持重写字段或任何静态成员。为了进行重写，要求在基类和派生类中都显式地执行一个操作，在基类中，必须将允许重写的每个成员标记为 virtual。假如一个 virtual 或 protected 成员没有包括 virtual 修饰符，就不允许子类重写该方法。</p> <p>与 Java 相比，默认情况下 Java 中 的方法都是虚方法，如果希望方法具有非虚的行为，就必须显示密封它。相反，C#的方法都默认为非虚方法，想要子类重写它就必须用 virtual 修饰符修饰。</p> <p>另外，override 修饰符在这时候必须要和 virtual 配套使用。与 Java 和 C++ 不同，C#应用于派生类的 verride 关键字是必须的。C# 不允许隐式重写。为了重写方法，基类和派生类成员必须匹配，而且要有对</p> <p>接下来说说 override 和 overload 的区别。</p> <p>重载应该叫 <code>overload</code>，重写叫 <code>override</code>；重载某个方法是在同一个类中发生的！重写是在子类中重写父类中的方法。</p> <p>1.override:</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// 父类：</span>
<span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token comment">// 子类：</span>
<span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>2.overload: 同一类中或父子关系类中皆可.</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">ToString</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> id<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>重写(override)</code>是用于重写基类的虚方法,这样在派生类中提供一个新的方法；</p> <ul><li>相同的方法名，不同的方法签名（方法名称、参数的数目、参数类型和顺序、参数修饰符）</li> <li>同一类或者父子关系类都可以</li> <li>重载更多的是处理不同的类型参数，函数做的还是相同的事情。</li></ul> <p><code>重载(overload)</code>是提供了一种机制, 相同函数名通过不同的返回值类型以及参数来表来区分的机制。</p> <ul><li>相同的方法签名（父类中要覆写的方法声明了 virtual），在子类中实现重写。</li> <li>覆写则有可能是完全不同的事情。</li></ul> <p>一句话：覆写（Override）的两个函数的函数特征相同，重载（Overload）的两个函数的函数名虽然相同，但函数特征不同。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token comment">// override vs overload vs new 重写</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">namespace</span> <span class="token namespace">classdemo<span class="token punctuation">.</span>JecyuClass</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">C1</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">string</span></span> myString<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token function">C1</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> str<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>myString <span class="token operator">=</span> str<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">IndexOf</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> s<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">IndexOf</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 函数嵌套函数，函数式编程</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">IndexOf</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> s<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> startIndex<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">IndexOf</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> startIndex<span class="token punctuation">,</span> myString<span class="token punctuation">.</span>Length <span class="token operator">-</span> startIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">IndexOf</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> s<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> startIndex<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> count<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> myString<span class="token punctuation">.</span><span class="token function">IndexOf</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> startIndex<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GetName</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> str<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;baseClass Method {0}&quot;</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>



  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">C2</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">C1</span></span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">C2</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> str<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">IndexOf</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> s<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> startIndex<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> count<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token number">666</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">new</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GetName</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> str<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Derived Class {0}&quot;</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// 父类</span>
      <span class="token class-name">C1</span> c1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">C1</span><span class="token punctuation">(</span><span class="token string">&quot;Jecyu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>c1<span class="token punctuation">.</span><span class="token function">IndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;y&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 3</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>c1<span class="token punctuation">.</span><span class="token function">IndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;y&quot;</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; -1 从4开始找不到</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>c1<span class="token punctuation">.</span><span class="token function">IndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;y&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt;3</span>

      <span class="token comment">// 子类</span>
      <span class="token class-name">C2</span> c2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">C2</span><span class="token punctuation">(</span><span class="token string">&quot;Jecyu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>c2<span class="token punctuation">.</span><span class="token function">IndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;ac&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 666</span>
      Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>c2<span class="token punctuation">.</span><span class="token function">IndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;ac&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 666</span>
      c2<span class="token punctuation">.</span><span class="token function">GetName</span><span class="token punctuation">(</span><span class="token string">&quot;Jecyu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; Derived Class Jecyu</span>

    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br></div></div><p>总结：</p> <ol><li>重写(override)</li></ol> <hr> <p>使用 override 修饰符来修改方法、属性、索引器或事件。重写方法提供从基类继承的成员的新实现。由重写声明重写的方法称为重写基方法。重写基方法必须与重写方法具有相同的签名。
不能重写非虚方法或静态方法。重写基方法必须是虚拟的、抽象的或重写的。也就是说，用 <code>override</code> 修饰符重写的基类中的方法必须是 <code>virtual</code>, <code>abstract</code> 或 <code>override</code> 方法。</p> <ol start="2"><li>重载(overload)</li></ol> <hr> <p>当类包含两个名称相同但签名不同的方法时发生方法重载。</p> <h4 id="new-修饰符"><a href="#new-修饰符" class="header-anchor">#</a> new 修饰符</h4> <p>从上面可以知道，重载或者是重写对于子类来说，都只是添加新的方法、或者重写父类的方法，如果要屏蔽基类的成员，可以使用 <code>new</code>
修饰符进行屏蔽，它可以屏蔽静态成员。</p> <div class="language-cs line-numbers-mode"><pre class="language-cs"><code><span class="token keyword">class</span> <span class="token class-name">Derived</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Base</span></span> <span class="token punctuation">{</span>
  <span class="token keyword">new</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">GetName</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> str<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Derived Class {0}&quot;</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>但是从上面的 GetName 可以看出，new 其实跟 override 用法差不多。new 的使用场景是如果父类方法用了 virtual 修饰符，子类重写方法没有 override 关键字，编译器就会报错。</p> <p>这里一个明显的解决方案是为子类方法添加 override 修饰符（假如它的父类成员是 virtual 的），但是第二种方法是使用 new 修饰符，这种情况称为脆弱的基类。</p> <p>至于它与 override 的比较效果待后续研究。- <a href="https://docs.microsoft.com/zh-cn/dotnet/csharp/programming-guide/classes-and-structs/knowing-when-to-use-override-and-new-keywords" target="_blank" rel="noopener noreferrer">了解何时使用 Override 和 New 关键字（C# 编程指南）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 微软 c# 文档。</p> <h2 id="进阶活用（高级）"><a href="#进阶活用（高级）" class="header-anchor">#</a> 进阶活用（高级）</h2> <h3 id="修改事件运算符的行为"><a href="#修改事件运算符的行为" class="header-anchor">#</a> 修改事件运算符的行为</h3> <h2 id="项目实战"><a href="#项目实战" class="header-anchor">#</a> 项目实战</h2> <h2 id="底层原理"><a href="#底层原理" class="header-anchor">#</a> 底层原理</h2> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <ul><li>测试
<ul><li><a href="https://docs.microsoft.com/zh-cn/dotnet/core/testing/unit-testing-best-practices" target="_blank" rel="noopener noreferrer">.NET Core 和 .NET Standard 单元测试最佳做法<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.microsoft.com/zh-cn/dotnet/core/tutorials/testing-library-with-visual-studio" target="_blank" rel="noopener noreferrer">教程：在 Visual Studio 中使用 .NET Core 测试 .NET Standard 库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://zhuanlan.zhihu.com/p/94854332" target="_blank" rel="noopener noreferrer">C#-面向对象：争议 TDD（测试驱动开发）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li> <li><a href="https://www.cnblogs.com/netlyf/archive/2009/09/08/1562642.html" target="_blank" rel="noopener noreferrer">C#中 override 和 overload 的区别<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 讲解方法重写 override 和方法重载 overload 的区别。</li> <li><a href="https://zhuanlan.zhihu.com/p/74225708" target="_blank" rel="noopener noreferrer">C#笔记（Virtual，Abstract，Override，new）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.microsoft.com/zh-cn/dotnet/csharp/programming-guide/classes-and-structs/knowing-when-to-use-override-and-new-keywords" target="_blank" rel="noopener noreferrer">了解何时使用 Override 和 New 关键字（C# 编程指南）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 微软 c# 文档。</li> <li><a href="http://www.manew.com/thread-95023-1-1.html" target="_blank" rel="noopener noreferrer">自学总结 C#中数组 Array，ArrayList，List 的区别<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">7/14/2020, 8:14:17 PM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/Notebook/programming-language/node.html">
        Node.js
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Notebook/assets/js/app.accc6ad4.js" defer></script><script src="/Notebook/assets/js/4.2708dfb6.js" defer></script><script src="/Notebook/assets/js/3.0cb2ce57.js" defer></script>
  </body>
</html>
