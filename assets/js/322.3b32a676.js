(window.webpackJsonp=window.webpackJsonp||[]).push([[322],{1638:function(t,s,a){"use strict";a.r(s);var n=a(44),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"二次封装-iview-tree-实现搜索树踩坑总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二次封装-iview-tree-实现搜索树踩坑总结"}},[t._v("#")]),t._v(" 二次封装 iview Tree 实现搜索树踩坑总结")]),t._v(" "),a("h2",{attrs:{id:"旧版本实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#旧版本实现"}},[t._v("#")]),t._v(" 旧版本实现")]),t._v(" "),a("p",[t._v("主目录：")]),t._v(" "),a("ul",[a("li",[t._v("checkTree.vue")]),t._v(" "),a("li",[t._v("tree.vue")]),t._v(" "),a("li",[t._v("状态乱。")])]),t._v(" "),a("h3",{attrs:{id:"暴露出来的-bug"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#暴露出来的-bug"}},[t._v("#")]),t._v(" 暴露出来的 bug")]),t._v(" "),a("h2",{attrs:{id:"重写版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重写版本"}},[t._v("#")]),t._v(" 重写版本")]),t._v(" "),a("p",[t._v("主目录：")]),t._v(" "),a("p",[t._v("以及编码前先要考虑好每个对象组件的动作集合，影响的关系。像分析游戏一样。")]),t._v(" "),a("p",[t._v("分析在一次交互中各个对象的动作、依赖关系。游戏是分析每一帧。不要觉得这一步浪费时间，理清所有的关系。")]),t._v(" "),a("p",[a("strong",[t._v("知识点：")])]),t._v(" "),a("ul",[a("li",[t._v("深拷贝")]),t._v(" "),a("li",[t._v("引用类型")]),t._v(" "),a("li",[t._v("函数副作用")]),t._v(" "),a("li",[t._v("二次封装属性事件（v-bind、v-listener 的覆盖、重复、例如封装里也要使用等）")]),t._v(" "),a("li",[t._v("代码竞态条件（同时 watch 多个属性，执行的顺序要求有先后次序）")])]),t._v(" "),a("p",[t._v("针对上面的问题：看看一些优秀的开源项目（小型项目、大型项目）是如何解决的。")]),t._v(" "),a("p",[t._v("先分析好思路，状态，考虑全面再编写")]),t._v(" "),a("p",[t._v("避免封装时使用相同 emit")]),t._v(" "),a("p",[t._v("字典记录状态，有时候仅仅靠着 iview tree 本身的触发事件，获得的 selected 值是不够准确的。")]),t._v(" "),a("h2",{attrs:{id:"函数副作用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#函数副作用"}},[t._v("#")]),t._v(" 函数副作用")]),t._v(" "),a("p",[t._v("如果真的产生了函数之外的")]),t._v(" "),a("p",[t._v("如果需要产生副作用的，则最好通过函数传参的形式进行处理。这样后续也明确修改状态。")]),t._v(" "),a("h2",{attrs:{id:"是否要深拷贝"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#是否要深拷贝"}},[t._v("#")]),t._v(" 是否要深拷贝")]),t._v(" "),a("p",[t._v("有些东西不需要深拷贝，例如进度条的显示状态，跟上传的请求是挂钩的。封装的组件，对外 emit 需要深拷贝，避免影响组件内状态。")]),t._v(" "),a("h2",{attrs:{id:"记录状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#记录状态"}},[t._v("#")]),t._v(" 记录状态")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建{id: _showChildren}字典对象, 记录当前目录展开闭合状态")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("treeDic")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tree"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" any"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    tree"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("forEach")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" item")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("showChildrenStatusDic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Boolean")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_showChildren"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("children "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("children"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("treeDic")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("children"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])]),a("p",[t._v("左耳听风-函数式编程。")]),t._v(" "),a("h2",{attrs:{id:"参考资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[t._v("#")]),t._v(" 参考资料")])])}),[],!1,null,null,null);s.default=e.exports}}]);