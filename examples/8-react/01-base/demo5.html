<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>ç‚¹èµæŒ‰é’®</title>
</head>
<body>
  <div class="wrapper">
  </div>
  <script>
    // æˆ‘ä»¬éœ€è¦è¿™ä¸ªç‚¹èµåŠŸèƒ½çš„ HTML å­—ç¬¦ä¸²è¡¨ç¤ºçš„ DOM ç»“æ„ï¼Œæ‰èƒ½æ·»åŠ äº‹ä»¶
    const createDOMFromString = (domString) => {
      const div = document.createElement('div');
      div.innerHTML = domString;
      return div;
    }
    // ç—›ç‚¹ï¼šé¿å… changeLikeText è¿‡å¤šçš„ dom æ“ä½œ
    // è§£å†³ï¼šçŠ¶æ€æ”¹å˜ â¡ï¸ æ„å»ºæ–°çš„ DOM å…ƒç´ æ›´æ–°é¡µé¢ ï¼ˆModel View Controllerï¼‰,é‡æ–°æ’å…¥æ–°çš„ DOM å…ƒç´  
    class LikeButton {
      constructor() {
        this.state = { isLiked: false }
      }
      changeLikeText() {
          // const likeText = this.el.querySelector('.like-text');
          // this.state.isLiked = !this.state.isLiked;
          // likeText.innerHTML = this.state.isLiked ? 'å–æ¶ˆ' : "ç‚¹èµ"
          this.setState({
            isLiked: !this.state.isLiked
          })
      }
      /**
       * @description: è®¾ç½®å®ä¾‹çš„ stateï¼Œç„¶åé‡æ–°è°ƒç”¨ä¸€ä¸‹ render æ–¹æ³•ï¼Œ
        åªè¦è°ƒç”¨ setState() ç»„ä»¶å°±ä¼šé‡æ–°æ¸²æŸ“ï¼Œè¿™æ ·å°±ä¸ç”¨æ‰‹åŠ¨æ“ä½œ dom äº†ã€‚
       * @param {Object}  
       * @return: null
       */
       setState(state) {
        const oldEl = this.el;
        this.state = state;
        this.el = this.render();
        if (this.onStateChange) this.onStateChange(oldEl, this.el)
      }
      render() {
        this.el = createDOMFromString(
          `
            <button id='like-btn'>
              <span class="like-text">${this.state.isLiked ? 'å–æ¶ˆ': 'ç‚¹èµ' }</span>
              <span>ğŸ‘</span>
            </button>
          `
        )
        this.el.addEventListener('click',this.changeLikeText.bind(this), false)
        return this.el;
      }
    }
    
    const wrapper = document.querySelector('.wrapper');
    const likeButton = new LikeButton();
    wrapper.appendChild(likeButton.render());
    likeButton.onStateChange = (oldEl, newEl) => {
      wrapper.insertBefore(newEl, oldEl); // æ’å…¥æ–°çš„å…ƒç´ 
      wrapper.removeChild(oldEl); // åˆ é™¤æ—§çš„å…ƒç´ 
    }

    // è§£å†³ï¼šæ¯å½“ setState æ„é€ å®Œæ–°çš„ DOM å…ƒç´ åï¼Œå°±ä¼šé€šè¿‡ onStateChange å‘ŠçŸ¥å¤–éƒ¨æ’å…¥æ–°çš„ DOM å…ƒç´ ï¼Œç„¶ååˆ é™¤æ—§çš„å…ƒç´ ï¼Œé¡µé¢å°±æ›´æ–°äº†ã€‚ä¸å†éœ€è¦æ‰‹åŠ¨æ›´æ–°
    // è¿™é‡Œæ¯æ¬¡ setState éƒ½é‡æ–°æ„é€ ã€æ–°å¢ã€åˆ é™¤ DOM å…ƒç´ ï¼Œä¼šå¯¼è‡´æµè§ˆå™¨è¿›è¡Œå¤§é‡çš„é‡æ’ï¼Œä¸¥é‡å½±å“æ€§èƒ½ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ Virtual-DOM çš„ç­–ç•¥è§„é¿æ‰ã€‚
    // ç—›ç‚¹ï¼šé‡æ–°å¦å¤–åšä¸€ä¸ªæ–°ç»„ä»¶ï¼Œè­¬å¦‚è¯´è¯„è®ºç»„ä»¶ï¼Œé‚£ä¹ˆé‡Œé¢çš„è¿™äº› setState æ–¹æ³•è¦é‡æ–°å†™ä¸€é
  </script>
</body>
</html>